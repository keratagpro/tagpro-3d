function restoreFocus(){$(document).find("#volumeSlider").focus()}if(function(t,e){var i,r,n=typeof e,o=t.location,s=t.document,a=s.documentElement,l=t.jQuery,h=t.$,c={},u=[],p="2.0.3",d=u.concat,m=u.push,f=u.slice,y=u.indexOf,_=c.toString,g=c.hasOwnProperty,x=p.trim,v=function(t,e){return new v.fn.init(t,e,i)},b=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,S=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,D=/^-ms-/,T=/-([\da-z])/gi,A=function(t,e){return e.toUpperCase()},E=function(){s.removeEventListener("DOMContentLoaded",E,!1),t.removeEventListener("load",E,!1),v.ready()};function I(t){var e=t.length,i=v.type(t);return!v.isWindow(t)&&(!(1!==t.nodeType||!e)||("array"===i||"function"!==i&&(0===e||"number"==typeof e&&e>0&&e-1 in t)))}v.fn=v.prototype={jquery:p,constructor:v,init:function(t,i,r){var n,o;if(!t)return this;if("string"==typeof t){if(!(n="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:S.exec(t))||!n[1]&&i)return!i||i.jquery?(i||r).find(t):this.constructor(i).find(t);if(n[1]){if(i=i instanceof v?i[0]:i,v.merge(this,v.parseHTML(n[1],i&&i.nodeType?i.ownerDocument||i:s,!0)),C.test(n[1])&&v.isPlainObject(i))for(n in i)v.isFunction(this[n])?this[n](i[n]):this.attr(n,i[n]);return this}return(o=s.getElementById(n[2]))&&o.parentNode&&(this.length=1,this[0]=o),this.context=s,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):v.isFunction(t)?r.ready(t):(t.selector!==e&&(this.selector=t.selector,this.context=t.context),v.makeArray(t,this))},selector:"",length:0,toArray:function(){return f.call(this)},get:function(t){return null==t?this.toArray():t<0?this[this.length+t]:this[t]},pushStack:function(t){var e=v.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return v.each(this,t,e)},ready:function(t){return v.ready.promise().done(t),this},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},map:function(t){return this.pushStack(v.map(this,(function(e,i){return t.call(e,i,e)})))},end:function(){return this.prevObject||this.constructor(null)},push:m,sort:[].sort,splice:[].splice},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){var t,i,r,n,o,s,a=arguments[0]||{},l=1,h=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[1]||{},l=2),"object"==typeof a||v.isFunction(a)||(a={}),h===l&&(a=this,--l);l<h;l++)if(null!=(t=arguments[l]))for(i in t)r=a[i],a!==(n=t[i])&&(c&&n&&(v.isPlainObject(n)||(o=v.isArray(n)))?(o?(o=!1,s=r&&v.isArray(r)?r:[]):s=r&&v.isPlainObject(r)?r:{},a[i]=v.extend(c,s,n)):n!==e&&(a[i]=n));return a},v.extend({expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noConflict:function(e){return t.$===v&&(t.$=h),e&&t.jQuery===v&&(t.jQuery=l),v},isReady:!1,readyWait:1,holdReady:function(t){t?v.readyWait++:v.ready(!0)},ready:function(t){(!0===t?--v.readyWait:v.isReady)||(v.isReady=!0,!0!==t&&--v.readyWait>0||(r.resolveWith(s,[v]),v.fn.trigger&&v(s).trigger("ready").off("ready")))},isFunction:function(t){return"function"===v.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?c[_.call(t)]||"object":typeof t},isPlainObject:function(t){if("object"!==v.type(t)||t.nodeType||v.isWindow(t))return!1;try{if(t.constructor&&!g.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},error:function(t){throw new Error(t)},parseHTML:function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||s;var r=C.exec(t),n=!i&&[];return r?[e.createElement(r[1])]:(r=v.buildFragment([t],e,n),n&&v(n).remove(),v.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(t){var i;if(!t||"string"!=typeof t)return null;try{i=(new DOMParser).parseFromString(t,"text/xml")}catch(t){i=e}return i&&!i.getElementsByTagName("parsererror").length||v.error("Invalid XML: "+t),i},noop:function(){},globalEval:function(t){var e,i=eval;(t=v.trim(t))&&(1===t.indexOf("use strict")?((e=s.createElement("script")).text=t,s.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(D,"ms-").replace(T,A)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,i){var r=0,n=t.length,o=I(t);if(i){if(o)for(;r<n&&!1!==e.apply(t[r],i);r++);else for(r in t)if(!1===e.apply(t[r],i))break}else if(o)for(;r<n&&!1!==e.call(t[r],r,t[r]);r++);else for(r in t)if(!1===e.call(t[r],r,t[r]))break;return t},trim:function(t){return null==t?"":x.call(t)},makeArray:function(t,e){var i=e||[];return null!=t&&(I(Object(t))?v.merge(i,"string"==typeof t?[t]:t):m.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:y.call(e,t,i)},merge:function(t,i){var r=i.length,n=t.length,o=0;if("number"==typeof r)for(;o<r;o++)t[n++]=i[o];else for(;i[o]!==e;)t[n++]=i[o++];return t.length=n,t},grep:function(t,e,i){var r=[],n=0,o=t.length;for(i=!!i;n<o;n++)i!==!!e(t[n],n)&&r.push(t[n]);return r},map:function(t,e,i){var r,n=0,o=t.length,s=[];if(I(t))for(;n<o;n++)null!=(r=e(t[n],n,i))&&(s[s.length]=r);else for(n in t)null!=(r=e(t[n],n,i))&&(s[s.length]=r);return d.apply([],s)},guid:1,proxy:function(t,i){var r,n,o;return"string"==typeof i&&(r=t[i],i=t,t=r),v.isFunction(t)?(n=f.call(arguments,2),o=function(){return t.apply(i||this,n.concat(f.call(arguments)))},o.guid=t.guid=t.guid||v.guid++,o):e},access:function(t,i,r,n,o,s,a){var l=0,h=t.length,c=null==r;if("object"===v.type(r))for(l in o=!0,r)v.access(t,i,l,r[l],!0,s,a);else if(n!==e&&(o=!0,v.isFunction(n)||(a=!0),c&&(a?(i.call(t,n),i=null):(c=i,i=function(t,e,i){return c.call(v(t),i)})),i))for(;l<h;l++)i(t[l],r,a?n:n.call(t[l],l,i(t[l],r)));return o?t:c?i.call(t):h?i(t[0],r):s},now:Date.now,swap:function(t,e,i,r){var n,o,s={};for(o in e)s[o]=t.style[o],t.style[o]=e[o];for(o in n=i.apply(t,r||[]),e)t.style[o]=s[o];return n}}),v.ready.promise=function(e){return r||(r=v.Deferred(),"complete"===s.readyState?setTimeout(v.ready):(s.addEventListener("DOMContentLoaded",E,!1),t.addEventListener("load",E,!1))),r.promise(e)},v.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),(function(t,e){c["[object "+e+"]"]=e.toLowerCase()})),i=v(s),function(t,e){var i,r,n,o,s,a,l,h,c,u,p,d,m,f,y,_,g,x="sizzle"+-new Date,b=t.document,w=0,S=0,C=st(),D=st(),T=st(),A=!1,E=function(t,e){return t===e?(A=!0,0):0},I=typeof e,P=1<<31,B={}.hasOwnProperty,M=[],O=M.pop,R=M.push,L=M.push,k=M.slice,F=M.indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(this[e]===t)return e;return-1},N="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",V="[\\x20\\t\\r\\n\\f]",G="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",U=G.replace("w","w#"),j="\\["+V+"*("+G+")"+V+"*(?:([*^$|!~]?=)"+V+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+U+")|)|)"+V+"*\\]",z=":("+G+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+j.replace(3,8)+")*)|.*)\\)|)",X=new RegExp("^"+V+"+|((?:^|[^\\\\])(?:\\\\.)*)"+V+"+$","g"),H=new RegExp("^"+V+"*,"+V+"*"),J=new RegExp("^"+V+"*([>+~]|"+V+")"+V+"*"),W=new RegExp(V+"*[+~]"),$=new RegExp("="+V+"*([^\\]'\"]*)"+V+"*\\]","g"),Y=new RegExp(z),q=new RegExp("^"+U+"$"),K={ID:new RegExp("^#("+G+")"),CLASS:new RegExp("^\\.("+G+")"),TAG:new RegExp("^("+G.replace("w","w*")+")"),ATTR:new RegExp("^"+j),PSEUDO:new RegExp("^"+z),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+V+"*(even|odd|(([+-]|)(\\d*)n|)"+V+"*(?:([+-]|)"+V+"*(\\d+)|))"+V+"*\\)|)","i"),bool:new RegExp("^(?:"+N+")$","i"),needsContext:new RegExp("^"+V+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+V+"*((?:-\\d)?\\d*)"+V+"*\\)|)(?=[^-]|$)","i")},Z=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/^(?:input|select|textarea|button)$/i,et=/^h\d$/i,it=/'|\\/g,rt=new RegExp("\\\\([\\da-f]{1,6}"+V+"?|("+V+")|.)","ig"),nt=function(t,e,i){var r="0x"+e-65536;return r!=r||i?e:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{L.apply(M=k.call(b.childNodes),b.childNodes),M[b.childNodes.length].nodeType}catch(t){L={apply:M.length?function(t,e){R.apply(t,k.call(e))}:function(t,e){for(var i=t.length,r=0;t[i++]=e[r++];);t.length=i-1}}}function ot(t,e,i,n){var s,a,h,c,d,y,_,v,w,S;if((e?e.ownerDocument||e:b)!==p&&u(e),i=i||[],!t||"string"!=typeof t)return i;if(1!==(c=(e=e||p).nodeType)&&9!==c)return[];if(m&&!n){if(s=Q.exec(t))if(h=s[1]){if(9===c){if(!(a=e.getElementById(h))||!a.parentNode)return i;if(a.id===h)return i.push(a),i}else if(e.ownerDocument&&(a=e.ownerDocument.getElementById(h))&&g(e,a)&&a.id===h)return i.push(a),i}else{if(s[2])return L.apply(i,e.getElementsByTagName(t)),i;if((h=s[3])&&r.getElementsByClassName&&e.getElementsByClassName)return L.apply(i,e.getElementsByClassName(h)),i}if(r.qsa&&(!f||!f.test(t))){if(v=_=x,w=e,S=9===c&&t,1===c&&"object"!==e.nodeName.toLowerCase()){for(y=ft(t),(_=e.getAttribute("id"))?v=_.replace(it,"\\$&"):e.setAttribute("id",v),v="[id='"+v+"'] ",d=y.length;d--;)y[d]=v+yt(y[d]);w=W.test(t)&&e.parentNode||e,S=y.join(",")}if(S)try{return L.apply(i,w.querySelectorAll(S)),i}catch(t){}finally{_||e.removeAttribute("id")}}}return function(t,e,i,n){var s,a,h,c,u,p=ft(t);if(!n&&1===p.length){if((a=p[0]=p[0].slice(0)).length>2&&"ID"===(h=a[0]).type&&r.getById&&9===e.nodeType&&m&&o.relative[a[1].type]){if(!(e=(o.find.ID(h.matches[0].replace(rt,nt),e)||[])[0]))return i;t=t.slice(a.shift().value.length)}for(s=K.needsContext.test(t)?0:a.length;s--&&(h=a[s],!o.relative[c=h.type]);)if((u=o.find[c])&&(n=u(h.matches[0].replace(rt,nt),W.test(a[0].type)&&e.parentNode||e))){if(a.splice(s,1),!(t=n.length&&yt(a)))return L.apply(i,n),i;break}}return l(t,p)(n,e,!m,i,W.test(t)),i}(t.replace(X,"$1"),e,i,n)}function st(){var t=[];return function e(i,r){return t.push(i+=" ")>o.cacheLength&&delete e[t.shift()],e[i]=r}}function at(t){return t[x]=!0,t}function lt(t){var e=p.createElement("div");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ht(t,e){for(var i=t.split("|"),r=t.length;r--;)o.attrHandle[i[r]]=e}function ct(t,e){var i=e&&t,r=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||P)-(~t.sourceIndex||P);if(r)return r;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function ut(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function pt(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function dt(t){return at((function(e){return e=+e,at((function(i,r){for(var n,o=t([],i.length,e),s=o.length;s--;)i[n=o[s]]&&(i[n]=!(r[n]=i[n]))}))}))}for(i in a=ot.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},r=ot.support={},u=ot.setDocument=function(t){var e=t?t.ownerDocument||t:b,i=e.defaultView;return e!==p&&9===e.nodeType&&e.documentElement?(p=e,d=e.documentElement,m=!a(e),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",(function(){u()})),r.attributes=lt((function(t){return t.className="i",!t.getAttribute("className")})),r.getElementsByTagName=lt((function(t){return t.appendChild(e.createComment("")),!t.getElementsByTagName("*").length})),r.getElementsByClassName=lt((function(t){return t.innerHTML="<div class='a'></div><div class='a i'></div>",t.firstChild.className="i",2===t.getElementsByClassName("i").length})),r.getById=lt((function(t){return d.appendChild(t).id=x,!e.getElementsByName||!e.getElementsByName(x).length})),r.getById?(o.find.ID=function(t,e){if(typeof e.getElementById!==I&&m){var i=e.getElementById(t);return i&&i.parentNode?[i]:[]}},o.filter.ID=function(t){var e=t.replace(rt,nt);return function(t){return t.getAttribute("id")===e}}):(delete o.find.ID,o.filter.ID=function(t){var e=t.replace(rt,nt);return function(t){var i=typeof t.getAttributeNode!==I&&t.getAttributeNode("id");return i&&i.value===e}}),o.find.TAG=r.getElementsByTagName?function(t,e){if(typeof e.getElementsByTagName!==I)return e.getElementsByTagName(t)}:function(t,e){var i,r=[],n=0,o=e.getElementsByTagName(t);if("*"===t){for(;i=o[n++];)1===i.nodeType&&r.push(i);return r}return o},o.find.CLASS=r.getElementsByClassName&&function(t,e){if(typeof e.getElementsByClassName!==I&&m)return e.getElementsByClassName(t)},y=[],f=[],(r.qsa=Z.test(e.querySelectorAll))&&(lt((function(t){t.innerHTML="<select><option selected=''></option></select>",t.querySelectorAll("[selected]").length||f.push("\\["+V+"*(?:value|"+N+")"),t.querySelectorAll(":checked").length||f.push(":checked")})),lt((function(t){var i=e.createElement("input");i.setAttribute("type","hidden"),t.appendChild(i).setAttribute("t",""),t.querySelectorAll("[t^='']").length&&f.push("[*^$]="+V+"*(?:''|\"\")"),t.querySelectorAll(":enabled").length||f.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),f.push(",.*:")}))),(r.matchesSelector=Z.test(_=d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&lt((function(t){r.disconnectedMatch=_.call(t,"div"),_.call(t,"[s!='']:x"),y.push("!=",z)})),f=f.length&&new RegExp(f.join("|")),y=y.length&&new RegExp(y.join("|")),g=Z.test(d.contains)||d.compareDocumentPosition?function(t,e){var i=9===t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},E=d.compareDocumentPosition?function(t,i){if(t===i)return A=!0,0;var n=i.compareDocumentPosition&&t.compareDocumentPosition&&t.compareDocumentPosition(i);return n?1&n||!r.sortDetached&&i.compareDocumentPosition(t)===n?t===e||g(b,t)?-1:i===e||g(b,i)?1:c?F.call(c,t)-F.call(c,i):0:4&n?-1:1:t.compareDocumentPosition?-1:1}:function(t,i){var r,n=0,o=t.parentNode,s=i.parentNode,a=[t],l=[i];if(t===i)return A=!0,0;if(!o||!s)return t===e?-1:i===e?1:o?-1:s?1:c?F.call(c,t)-F.call(c,i):0;if(o===s)return ct(t,i);for(r=t;r=r.parentNode;)a.unshift(r);for(r=i;r=r.parentNode;)l.unshift(r);for(;a[n]===l[n];)n++;return n?ct(a[n],l[n]):a[n]===b?-1:l[n]===b?1:0},e):p},ot.matches=function(t,e){return ot(t,null,null,e)},ot.matchesSelector=function(t,e){if((t.ownerDocument||t)!==p&&u(t),e=e.replace($,"='$1']"),r.matchesSelector&&m&&(!y||!y.test(e))&&(!f||!f.test(e)))try{var i=_.call(t,e);if(i||r.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(t){}return ot(e,p,null,[t]).length>0},ot.contains=function(t,e){return(t.ownerDocument||t)!==p&&u(t),g(t,e)},ot.attr=function(t,i){(t.ownerDocument||t)!==p&&u(t);var n=o.attrHandle[i.toLowerCase()],s=n&&B.call(o.attrHandle,i.toLowerCase())?n(t,i,!m):e;return s===e?r.attributes||!m?t.getAttribute(i):(s=t.getAttributeNode(i))&&s.specified?s.value:null:s},ot.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},ot.uniqueSort=function(t){var e,i=[],n=0,o=0;if(A=!r.detectDuplicates,c=!r.sortStable&&t.slice(0),t.sort(E),A){for(;e=t[o++];)e===t[o]&&(n=i.push(o));for(;n--;)t.splice(i[n],1)}return t},s=ot.getText=function(t){var e,i="",r=0,n=t.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=s(t)}else if(3===n||4===n)return t.nodeValue}else for(;e=t[r];r++)i+=s(e);return i},o=ot.selectors={cacheLength:50,createPseudo:at,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(rt,nt),t[3]=(t[4]||t[5]||"").replace(rt,nt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||ot.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&ot.error(t[0]),t},PSEUDO:function(t){var i,r=!t[5]&&t[2];return K.CHILD.test(t[0])?null:(t[3]&&t[4]!==e?t[2]=t[4]:r&&Y.test(r)&&(i=ft(r,!0))&&(i=r.indexOf(")",r.length-i)-r.length)&&(t[0]=t[0].slice(0,i),t[2]=r.slice(0,i)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(rt,nt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=C[t+" "];return e||(e=new RegExp("(^|"+V+")"+t+"("+V+"|$)"))&&C(t,(function(t){return e.test("string"==typeof t.className&&t.className||typeof t.getAttribute!==I&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(r){var n=ot.attr(r,t);return null==n?"!="===e:!e||(n+="","="===e?n===i:"!="===e?n!==i:"^="===e?i&&0===n.indexOf(i):"*="===e?i&&n.indexOf(i)>-1:"$="===e?i&&n.slice(-i.length)===i:"~="===e?(" "+n+" ").indexOf(i)>-1:"|="===e&&(n===i||n.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,r,n){var o="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===r&&0===n?function(t){return!!t.parentNode}:function(e,i,l){var h,c,u,p,d,m,f=o!==s?"nextSibling":"previousSibling",y=e.parentNode,_=a&&e.nodeName.toLowerCase(),g=!l&&!a;if(y){if(o){for(;f;){for(u=e;u=u[f];)if(a?u.nodeName.toLowerCase()===_:1===u.nodeType)return!1;m=f="only"===t&&!m&&"nextSibling"}return!0}if(m=[s?y.firstChild:y.lastChild],s&&g){for(d=(h=(c=y[x]||(y[x]={}))[t]||[])[0]===w&&h[1],p=h[0]===w&&h[2],u=d&&y.childNodes[d];u=++d&&u&&u[f]||(p=d=0)||m.pop();)if(1===u.nodeType&&++p&&u===e){c[t]=[w,d,p];break}}else if(g&&(h=(e[x]||(e[x]={}))[t])&&h[0]===w)p=h[1];else for(;(u=++d&&u&&u[f]||(p=d=0)||m.pop())&&((a?u.nodeName.toLowerCase()!==_:1!==u.nodeType)||!++p||(g&&((u[x]||(u[x]={}))[t]=[w,p]),u!==e)););return(p-=n)===r||p%r==0&&p/r>=0}}},PSEUDO:function(t,e){var i,r=o.pseudos[t]||o.setFilters[t.toLowerCase()]||ot.error("unsupported pseudo: "+t);return r[x]?r(e):r.length>1?(i=[t,t,"",e],o.setFilters.hasOwnProperty(t.toLowerCase())?at((function(t,i){for(var n,o=r(t,e),s=o.length;s--;)t[n=F.call(t,o[s])]=!(i[n]=o[s])})):function(t){return r(t,0,i)}):r}},pseudos:{not:at((function(t){var e=[],i=[],r=l(t.replace(X,"$1"));return r[x]?at((function(t,e,i,n){for(var o,s=r(t,null,n,[]),a=t.length;a--;)(o=s[a])&&(t[a]=!(e[a]=o))})):function(t,n,o){return e[0]=t,r(e,null,o,i),!i.pop()}})),has:at((function(t){return function(e){return ot(t,e).length>0}})),contains:at((function(t){return function(e){return(e.textContent||e.innerText||s(e)).indexOf(t)>-1}})),lang:at((function(t){return q.test(t||"")||ot.error("unsupported lang: "+t),t=t.replace(rt,nt).toLowerCase(),function(e){var i;do{if(i=m?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===d},focus:function(t){return t===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeName>"@"||3===t.nodeType||4===t.nodeType)return!1;return!0},parent:function(t){return!o.pseudos.empty(t)},header:function(t){return et.test(t.nodeName)},input:function(t){return tt.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||e.toLowerCase()===t.type)},first:dt((function(){return[0]})),last:dt((function(t,e){return[e-1]})),eq:dt((function(t,e,i){return[i<0?i+e:i]})),even:dt((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:dt((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:dt((function(t,e,i){for(var r=i<0?i+e:i;--r>=0;)t.push(r);return t})),gt:dt((function(t,e,i){for(var r=i<0?i+e:i;++r<e;)t.push(r);return t}))}},o.pseudos.nth=o.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[i]=ut(i);for(i in{submit:!0,reset:!0})o.pseudos[i]=pt(i);function mt(){}function ft(t,e){var i,r,n,s,a,l,h,c=D[t+" "];if(c)return e?0:c.slice(0);for(a=t,l=[],h=o.preFilter;a;){for(s in i&&!(r=H.exec(a))||(r&&(a=a.slice(r[0].length)||a),l.push(n=[])),i=!1,(r=J.exec(a))&&(i=r.shift(),n.push({value:i,type:r[0].replace(X," ")}),a=a.slice(i.length)),o.filter)!(r=K[s].exec(a))||h[s]&&!(r=h[s](r))||(i=r.shift(),n.push({value:i,type:s,matches:r}),a=a.slice(i.length));if(!i)break}return e?a.length:a?ot.error(t):D(t,l).slice(0)}function yt(t){for(var e=0,i=t.length,r="";e<i;e++)r+=t[e].value;return r}function _t(t,e,i){var r=e.dir,o=i&&"parentNode"===r,s=S++;return e.first?function(e,i,n){for(;e=e[r];)if(1===e.nodeType||o)return t(e,i,n)}:function(e,i,a){var l,h,c,u=w+" "+s;if(a){for(;e=e[r];)if((1===e.nodeType||o)&&t(e,i,a))return!0}else for(;e=e[r];)if(1===e.nodeType||o)if((h=(c=e[x]||(e[x]={}))[r])&&h[0]===u){if(!0===(l=h[1])||l===n)return!0===l}else if((h=c[r]=[u])[1]=t(e,i,a)||n,!0===h[1])return!0}}function gt(t){return t.length>1?function(e,i,r){for(var n=t.length;n--;)if(!t[n](e,i,r))return!1;return!0}:t[0]}function xt(t,e,i,r,n){for(var o,s=[],a=0,l=t.length,h=null!=e;a<l;a++)(o=t[a])&&(i&&!i(o,r,n)||(s.push(o),h&&e.push(a)));return s}function vt(t,e,i,r,n,o){return r&&!r[x]&&(r=vt(r)),n&&!n[x]&&(n=vt(n,o)),at((function(o,s,a,l){var h,c,u,p=[],d=[],m=s.length,f=o||function(t,e,i){for(var r=0,n=e.length;r<n;r++)ot(t,e[r],i);return i}(e||"*",a.nodeType?[a]:a,[]),y=!t||!o&&e?f:xt(f,p,t,a,l),_=i?n||(o?t:m||r)?[]:s:y;if(i&&i(y,_,a,l),r)for(h=xt(_,d),r(h,[],a,l),c=h.length;c--;)(u=h[c])&&(_[d[c]]=!(y[d[c]]=u));if(o){if(n||t){if(n){for(h=[],c=_.length;c--;)(u=_[c])&&h.push(y[c]=u);n(null,_=[],h,l)}for(c=_.length;c--;)(u=_[c])&&(h=n?F.call(o,u):p[c])>-1&&(o[h]=!(s[h]=u))}}else _=xt(_===s?_.splice(m,_.length):_),n?n(null,s,_,l):L.apply(s,_)}))}function bt(t){for(var e,i,r,n=t.length,s=o.relative[t[0].type],a=s||o.relative[" "],l=s?1:0,c=_t((function(t){return t===e}),a,!0),u=_t((function(t){return F.call(e,t)>-1}),a,!0),p=[function(t,i,r){return!s&&(r||i!==h)||((e=i).nodeType?c(t,i,r):u(t,i,r))}];l<n;l++)if(i=o.relative[t[l].type])p=[_t(gt(p),i)];else{if((i=o.filter[t[l].type].apply(null,t[l].matches))[x]){for(r=++l;r<n&&!o.relative[t[r].type];r++);return vt(l>1&&gt(p),l>1&&yt(t.slice(0,l-1).concat({value:" "===t[l-2].type?"*":""})).replace(X,"$1"),i,l<r&&bt(t.slice(l,r)),r<n&&bt(t=t.slice(r)),r<n&&yt(t))}p.push(i)}return gt(p)}mt.prototype=o.filters=o.pseudos,o.setFilters=new mt,l=ot.compile=function(t,e){var i,r=[],s=[],a=T[t+" "];if(!a){for(e||(e=ft(t)),i=e.length;i--;)(a=bt(e[i]))[x]?r.push(a):s.push(a);a=T(t,function(t,e){var i=0,r=e.length>0,s=t.length>0,a=function(a,l,c,u,d){var m,f,y,_=[],g=0,x="0",v=a&&[],b=null!=d,S=h,C=a||s&&o.find.TAG("*",d&&l.parentNode||l),D=w+=null==S?1:Math.random()||.1;for(b&&(h=l!==p&&l,n=i);null!=(m=C[x]);x++){if(s&&m){for(f=0;y=t[f++];)if(y(m,l,c)){u.push(m);break}b&&(w=D,n=++i)}r&&((m=!y&&m)&&g--,a&&v.push(m))}if(g+=x,r&&x!==g){for(f=0;y=e[f++];)y(v,_,l,c);if(a){if(g>0)for(;x--;)v[x]||_[x]||(_[x]=O.call(u));_=xt(_)}L.apply(u,_),b&&!a&&_.length>0&&g+e.length>1&&ot.uniqueSort(u)}return b&&(w=D,h=S),v};return r?at(a):a}(s,r))}return a},r.sortStable=x.split("").sort(E).join("")===x,r.detectDuplicates=A,u(),r.sortDetached=lt((function(t){return 1&t.compareDocumentPosition(p.createElement("div"))})),lt((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||ht("type|href|height|width",(function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),r.attributes&&lt((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||ht("value",(function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),lt((function(t){return null==t.getAttribute("disabled")}))||ht(N,(function(t,e,i){var r;if(!i)return(r=t.getAttributeNode(e))&&r.specified?r.value:!0===t[e]?e.toLowerCase():null})),v.find=ot,v.expr=ot.selectors,v.expr[":"]=v.expr.pseudos,v.unique=ot.uniqueSort,v.text=ot.getText,v.isXMLDoc=ot.isXML,v.contains=ot.contains}(t);var P,B,M,O,R,L,k={};v.Callbacks=function(t){t="string"==typeof t?k[t]||function(t){var e=k[t]={};return v.each(t.match(w)||[],(function(t,i){e[i]=!0})),e}(t):v.extend({},t);var i,r,n,o,s,a,l=[],h=!t.once&&[],c=function(e){for(i=t.memory&&e,r=!0,a=o||0,o=0,s=l.length,n=!0;l&&a<s;a++)if(!1===l[a].apply(e[0],e[1])&&t.stopOnFalse){i=!1;break}n=!1,l&&(h?h.length&&c(h.shift()):i?l=[]:u.disable())},u={add:function(){if(l){var e=l.length;!function e(i){v.each(i,(function(i,r){var n=v.type(r);"function"===n?t.unique&&u.has(r)||l.push(r):r&&r.length&&"string"!==n&&e(r)}))}(arguments),n?s=l.length:i&&(o=e,c(i))}return this},remove:function(){return l&&v.each(arguments,(function(t,e){for(var i;(i=v.inArray(e,l,i))>-1;)l.splice(i,1),n&&(i<=s&&s--,i<=a&&a--)})),this},has:function(t){return t?v.inArray(t,l)>-1:!(!l||!l.length)},empty:function(){return l=[],s=0,this},disable:function(){return l=h=i=e,this},disabled:function(){return!l},lock:function(){return h=e,i||u.disable(),this},locked:function(){return!h},fireWith:function(t,e){return!l||r&&!h||(e=[t,(e=e||[]).slice?e.slice():e],n?h.push(e):c(e)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},v.extend({Deferred:function(t){var e=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],i="pending",r={state:function(){return i},always:function(){return n.done(arguments).fail(arguments),this},then:function(){var t=arguments;return v.Deferred((function(i){v.each(e,(function(e,o){var s=o[0],a=v.isFunction(t[e])&&t[e];n[o[1]]((function(){var t=a&&a.apply(this,arguments);t&&v.isFunction(t.promise)?t.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[s+"With"](this===r?i.promise():this,a?[t]:arguments)}))})),t=null})).promise()},promise:function(t){return null!=t?v.extend(t,r):r}},n={};return r.pipe=r.then,v.each(e,(function(t,o){var s=o[2],a=o[3];r[o[1]]=s.add,a&&s.add((function(){i=a}),e[1^t][2].disable,e[2][2].lock),n[o[0]]=function(){return n[o[0]+"With"](this===n?r:this,arguments),this},n[o[0]+"With"]=s.fireWith})),r.promise(n),t&&t.call(n,n),n},when:function(t){var e,i,r,n=0,o=f.call(arguments),s=o.length,a=1!==s||t&&v.isFunction(t.promise)?s:0,l=1===a?t:v.Deferred(),h=function(t,i,r){return function(n){i[t]=this,r[t]=arguments.length>1?f.call(arguments):n,r===e?l.notifyWith(i,r):--a||l.resolveWith(i,r)}};if(s>1)for(e=new Array(s),i=new Array(s),r=new Array(s);n<s;n++)o[n]&&v.isFunction(o[n].promise)?o[n].promise().done(h(n,r,o)).fail(l.reject).progress(h(n,i,e)):--a;return a||l.resolveWith(r,o),l.promise()}}),v.support=(P={},B=s.createElement("input"),M=s.createDocumentFragment(),O=s.createElement("div"),R=s.createElement("select"),L=R.appendChild(s.createElement("option")),B.type?(B.type="checkbox",P.checkOn=""!==B.value,P.optSelected=L.selected,P.reliableMarginRight=!0,P.boxSizingReliable=!0,P.pixelPosition=!1,B.checked=!0,P.noCloneChecked=B.cloneNode(!0).checked,R.disabled=!0,P.optDisabled=!L.disabled,(B=s.createElement("input")).value="t",B.type="radio",P.radioValue="t"===B.value,B.setAttribute("checked","t"),B.setAttribute("name","t"),M.appendChild(B),P.checkClone=M.cloneNode(!0).cloneNode(!0).lastChild.checked,P.focusinBubbles="onfocusin"in t,O.style.backgroundClip="content-box",O.cloneNode(!0).style.backgroundClip="",P.clearCloneStyle="content-box"===O.style.backgroundClip,v((function(){var e,i,r=s.getElementsByTagName("body")[0];r&&((e=s.createElement("div")).style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",r.appendChild(e).appendChild(O),O.innerHTML="",O.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",v.swap(r,null!=r.style.zoom?{zoom:1}:{},(function(){P.boxSizing=4===O.offsetWidth})),t.getComputedStyle&&(P.pixelPosition="1%"!==(t.getComputedStyle(O,null)||{}).top,P.boxSizingReliable="4px"===(t.getComputedStyle(O,null)||{width:"4px"}).width,(i=O.appendChild(s.createElement("div"))).style.cssText=O.style.cssText="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",i.style.marginRight=i.style.width="0",O.style.width="1px",P.reliableMarginRight=!parseFloat((t.getComputedStyle(i,null)||{}).marginRight)),r.removeChild(e))})),P):P);var F,N,V=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,G=/([A-Z])/g;function U(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=v.expando+Math.random()}function j(t,i,r){var n;if(r===e&&1===t.nodeType)if(n="data-"+i.replace(G,"-$1").toLowerCase(),"string"==typeof(r=t.getAttribute(n))){try{r="true"===r||"false"!==r&&("null"===r?null:+r+""===r?+r:V.test(r)?JSON.parse(r):r)}catch(t){}F.set(t,i,r)}else r=e;return r}U.uid=1,U.accepts=function(t){return!t.nodeType||(1===t.nodeType||9===t.nodeType)},U.prototype={key:function(t){if(!U.accepts(t))return 0;var e={},i=t[this.expando];if(!i){i=U.uid++;try{e[this.expando]={value:i},Object.defineProperties(t,e)}catch(r){e[this.expando]=i,v.extend(t,e)}}return this.cache[i]||(this.cache[i]={}),i},set:function(t,e,i){var r,n=this.key(t),o=this.cache[n];if("string"==typeof e)o[e]=i;else if(v.isEmptyObject(o))v.extend(this.cache[n],e);else for(r in e)o[r]=e[r];return o},get:function(t,i){var r=this.cache[this.key(t)];return i===e?r:r[i]},access:function(t,i,r){var n;return i===e||i&&"string"==typeof i&&r===e?(n=this.get(t,i))!==e?n:this.get(t,v.camelCase(i)):(this.set(t,i,r),r!==e?r:i)},remove:function(t,i){var r,n,o,s=this.key(t),a=this.cache[s];if(i===e)this.cache[s]={};else{v.isArray(i)?n=i.concat(i.map(v.camelCase)):(o=v.camelCase(i),n=i in a?[i,o]:(n=o)in a?[n]:n.match(w)||[]),r=n.length;for(;r--;)delete a[n[r]]}},hasData:function(t){return!v.isEmptyObject(this.cache[t[this.expando]]||{})},discard:function(t){t[this.expando]&&delete this.cache[t[this.expando]]}},F=new U,N=new U,v.extend({acceptData:U.accepts,hasData:function(t){return F.hasData(t)||N.hasData(t)},data:function(t,e,i){return F.access(t,e,i)},removeData:function(t,e){F.remove(t,e)},_data:function(t,e,i){return N.access(t,e,i)},_removeData:function(t,e){N.remove(t,e)}}),v.fn.extend({data:function(t,i){var r,n,o=this[0],s=0,a=null;if(t===e){if(this.length&&(a=F.get(o),1===o.nodeType&&!N.get(o,"hasDataAttrs"))){for(r=o.attributes;s<r.length;s++)0===(n=r[s].name).indexOf("data-")&&(n=v.camelCase(n.slice(5)),j(o,n,a[n]));N.set(o,"hasDataAttrs",!0)}return a}return"object"==typeof t?this.each((function(){F.set(this,t)})):v.access(this,(function(i){var r,n=v.camelCase(t);if(o&&i===e)return(r=F.get(o,t))!==e||(r=F.get(o,n))!==e||(r=j(o,n,e))!==e?r:void 0;this.each((function(){var r=F.get(this,n);F.set(this,n,i),-1!==t.indexOf("-")&&r!==e&&F.set(this,t,i)}))}),null,i,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){F.remove(this,t)}))}}),v.extend({queue:function(t,e,i){var r;if(t)return e=(e||"fx")+"queue",r=N.get(t,e),i&&(!r||v.isArray(i)?r=N.access(t,e,v.makeArray(i)):r.push(i)),r||[]},dequeue:function(t,e){e=e||"fx";var i=v.queue(t,e),r=i.length,n=i.shift(),o=v._queueHooks(t,e);"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===e&&i.unshift("inprogress"),delete o.stop,n.call(t,(function(){v.dequeue(t,e)}),o)),!r&&o&&o.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return N.get(t,i)||N.access(t,i,{empty:v.Callbacks("once memory").add((function(){N.remove(t,[e+"queue",i])}))})}}),v.fn.extend({queue:function(t,i){var r=2;return"string"!=typeof t&&(i=t,t="fx",r--),arguments.length<r?v.queue(this[0],t):i===e?this:this.each((function(){var e=v.queue(this,t,i);v._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&v.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){v.dequeue(this,t)}))},delay:function(t,e){return t=v.fx&&v.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,i){var r=setTimeout(e,t);i.stop=function(){clearTimeout(r)}}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,i){var r,n=1,o=v.Deferred(),s=this,a=this.length,l=function(){--n||o.resolveWith(s,[s])};for("string"!=typeof t&&(i=t,t=e),t=t||"fx";a--;)(r=N.get(s[a],t+"queueHooks"))&&r.empty&&(n++,r.empty.add(l));return l(),o.promise(i)}});var z,X=/[\t\r\n\f]/g,H=/\r/g,J=/^(?:input|select|textarea|button)$/i;v.fn.extend({attr:function(t,e){return v.access(this,v.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){v.removeAttr(this,t)}))},prop:function(t,e){return v.access(this,v.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[v.propFix[t]||t]}))},addClass:function(t){var e,i,r,n,o,s=0,a=this.length,l="string"==typeof t&&t;if(v.isFunction(t))return this.each((function(e){v(this).addClass(t.call(this,e,this.className))}));if(l)for(e=(t||"").match(w)||[];s<a;s++)if(r=1===(i=this[s]).nodeType&&(i.className?(" "+i.className+" ").replace(X," "):" ")){for(o=0;n=e[o++];)r.indexOf(" "+n+" ")<0&&(r+=n+" ");i.className=v.trim(r)}return this},removeClass:function(t){var e,i,r,n,o,s=0,a=this.length,l=0===arguments.length||"string"==typeof t&&t;if(v.isFunction(t))return this.each((function(e){v(this).removeClass(t.call(this,e,this.className))}));if(l)for(e=(t||"").match(w)||[];s<a;s++)if(r=1===(i=this[s]).nodeType&&(i.className?(" "+i.className+" ").replace(X," "):"")){for(o=0;n=e[o++];)for(;r.indexOf(" "+n+" ")>=0;)r=r.replace(" "+n+" "," ");i.className=t?v.trim(r):""}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):v.isFunction(t)?this.each((function(i){v(this).toggleClass(t.call(this,i,this.className,e),e)})):this.each((function(){if("string"===i)for(var e,r=0,o=v(this),s=t.match(w)||[];e=s[r++];)o.hasClass(e)?o.removeClass(e):o.addClass(e);else i!==n&&"boolean"!==i||(this.className&&N.set(this,"__className__",this.className),this.className=this.className||!1===t?"":N.get(this,"__className__")||"")}))},hasClass:function(t){for(var e=" "+t+" ",i=0,r=this.length;i<r;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(X," ").indexOf(e)>=0)return!0;return!1},val:function(t){var i,r,n,o=this[0];return arguments.length?(n=v.isFunction(t),this.each((function(r){var o;1===this.nodeType&&(null==(o=n?t.call(this,r,v(this).val()):t)?o="":"number"==typeof o?o+="":v.isArray(o)&&(o=v.map(o,(function(t){return null==t?"":t+""}))),(i=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()])&&"set"in i&&i.set(this,o,"value")!==e||(this.value=o))}))):o?(i=v.valHooks[o.type]||v.valHooks[o.nodeName.toLowerCase()])&&"get"in i&&(r=i.get(o,"value"))!==e?r:"string"==typeof(r=o.value)?r.replace(H,""):null==r?"":r:void 0}}),v.extend({valHooks:{option:{get:function(t){var e=t.attributes.value;return!e||e.specified?t.value:t.text}},select:{get:function(t){for(var e,i,r=t.options,n=t.selectedIndex,o="select-one"===t.type||n<0,s=o?null:[],a=o?n+1:r.length,l=n<0?a:o?n:0;l<a;l++)if(((i=r[l]).selected||l===n)&&(v.support.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!v.nodeName(i.parentNode,"optgroup"))){if(e=v(i).val(),o)return e;s.push(e)}return s},set:function(t,e){for(var i,r,n=t.options,o=v.makeArray(e),s=n.length;s--;)((r=n[s]).selected=v.inArray(v(r).val(),o)>=0)&&(i=!0);return i||(t.selectedIndex=-1),o}}},attr:function(t,i,r){var o,s,a=t.nodeType;if(t&&3!==a&&8!==a&&2!==a)return typeof t.getAttribute===n?v.prop(t,i,r):(1===a&&v.isXMLDoc(t)||(i=i.toLowerCase(),o=v.attrHooks[i]||(v.expr.match.bool.test(i)?z:undefined)),r===e?o&&"get"in o&&null!==(s=o.get(t,i))?s:null==(s=v.find.attr(t,i))?e:s:null!==r?o&&"set"in o&&(s=o.set(t,r,i))!==e?s:(t.setAttribute(i,r+""),r):void v.removeAttr(t,i))},removeAttr:function(t,e){var i,r,n=0,o=e&&e.match(w);if(o&&1===t.nodeType)for(;i=o[n++];)r=v.propFix[i]||i,v.expr.match.bool.test(i)&&(t[r]=!1),t.removeAttribute(i)},attrHooks:{type:{set:function(t,e){if(!v.support.radioValue&&"radio"===e&&v.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},propFix:{for:"htmlFor",class:"className"},prop:function(t,i,r){var n,o,s=t.nodeType;if(t&&3!==s&&8!==s&&2!==s)return(1!==s||!v.isXMLDoc(t))&&(i=v.propFix[i]||i,o=v.propHooks[i]),r!==e?o&&"set"in o&&(n=o.set(t,r,i))!==e?n:t[i]=r:o&&"get"in o&&null!==(n=o.get(t,i))?n:t[i]},propHooks:{tabIndex:{get:function(t){return t.hasAttribute("tabindex")||J.test(t.nodeName)||t.href?t.tabIndex:-1}}}}),z={set:function(t,e,i){return!1===e?v.removeAttr(t,i):t.setAttribute(i,i),i}},v.each(v.expr.match.bool.source.match(/\w+/g),(function(t,i){var r=v.expr.attrHandle[i]||v.find.attr;v.expr.attrHandle[i]=function(t,i,n){var o=v.expr.attrHandle[i],s=n?e:(v.expr.attrHandle[i]=e)!=r(t,i,n)?i.toLowerCase():null;return v.expr.attrHandle[i]=o,s}})),v.support.optSelected||(v.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null}}),v.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){v.propFix[this.toLowerCase()]=this})),v.each(["radio","checkbox"],(function(){v.valHooks[this]={set:function(t,e){if(v.isArray(e))return t.checked=v.inArray(v(t).val(),e)>=0}},v.support.checkOn||(v.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var W=/^key/,$=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,q=/^([^.]*)(?:\.(.+)|)$/;function K(){return!0}function Z(){return!1}function Q(){try{return s.activeElement}catch(t){}}v.event={global:{},add:function(t,i,r,o,s){var a,l,h,c,u,p,d,m,f,y,_,g=N.get(t);if(g){for(r.handler&&(r=(a=r).handler,s=a.selector),r.guid||(r.guid=v.guid++),(c=g.events)||(c=g.events={}),(l=g.handle)||(l=g.handle=function(t){return typeof v===n||t&&v.event.triggered===t.type?e:v.event.dispatch.apply(l.elem,arguments)},l.elem=t),u=(i=(i||"").match(w)||[""]).length;u--;)f=_=(h=q.exec(i[u])||[])[1],y=(h[2]||"").split(".").sort(),f&&(d=v.event.special[f]||{},f=(s?d.delegateType:d.bindType)||f,d=v.event.special[f]||{},p=v.extend({type:f,origType:_,data:o,handler:r,guid:r.guid,selector:s,needsContext:s&&v.expr.match.needsContext.test(s),namespace:y.join(".")},a),(m=c[f])||((m=c[f]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(t,o,y,l)||t.addEventListener&&t.addEventListener(f,l,!1)),d.add&&(d.add.call(t,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[f]=!0);t=null}},remove:function(t,e,i,r,n){var o,s,a,l,h,c,u,p,d,m,f,y=N.hasData(t)&&N.get(t);if(y&&(l=y.events)){for(h=(e=(e||"").match(w)||[""]).length;h--;)if(d=f=(a=q.exec(e[h])||[])[1],m=(a[2]||"").split(".").sort(),d){for(u=v.event.special[d]||{},p=l[d=(r?u.delegateType:u.bindType)||d]||[],a=a[2]&&new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=p.length;o--;)c=p[o],!n&&f!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,u.remove&&u.remove.call(t,c));s&&!p.length&&(u.teardown&&!1!==u.teardown.call(t,m,y.handle)||v.removeEvent(t,d,y.handle),delete l[d])}else for(d in l)v.event.remove(t,d+e[h],i,r,!0);v.isEmptyObject(l)&&(delete y.handle,N.remove(t,"events"))}},trigger:function(i,r,n,o){var a,l,h,c,u,p,d,m=[n||s],f=g.call(i,"type")?i.type:i,y=g.call(i,"namespace")?i.namespace.split("."):[];if(l=h=n=n||s,3!==n.nodeType&&8!==n.nodeType&&!Y.test(f+v.event.triggered)&&(f.indexOf(".")>=0&&(y=f.split("."),f=y.shift(),y.sort()),u=f.indexOf(":")<0&&"on"+f,(i=i[v.expando]?i:new v.Event(f,"object"==typeof i&&i)).isTrigger=o?2:3,i.namespace=y.join("."),i.namespace_re=i.namespace?new RegExp("(^|\\.)"+y.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,i.result=e,i.target||(i.target=n),r=null==r?[i]:v.makeArray(r,[i]),d=v.event.special[f]||{},o||!d.trigger||!1!==d.trigger.apply(n,r))){if(!o&&!d.noBubble&&!v.isWindow(n)){for(c=d.delegateType||f,Y.test(c+f)||(l=l.parentNode);l;l=l.parentNode)m.push(l),h=l;h===(n.ownerDocument||s)&&m.push(h.defaultView||h.parentWindow||t)}for(a=0;(l=m[a++])&&!i.isPropagationStopped();)i.type=a>1?c:d.bindType||f,(p=(N.get(l,"events")||{})[i.type]&&N.get(l,"handle"))&&p.apply(l,r),(p=u&&l[u])&&v.acceptData(l)&&p.apply&&!1===p.apply(l,r)&&i.preventDefault();return i.type=f,o||i.isDefaultPrevented()||d._default&&!1!==d._default.apply(m.pop(),r)||!v.acceptData(n)||u&&v.isFunction(n[f])&&!v.isWindow(n)&&((h=n[u])&&(n[u]=null),v.event.triggered=f,n[f](),v.event.triggered=e,h&&(n[u]=h)),i.result}},dispatch:function(t){t=v.event.fix(t);var i,r,n,o,s,a,l=f.call(arguments),h=(N.get(this,"events")||{})[t.type]||[],c=v.event.special[t.type]||{};if(l[0]=t,t.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,t)){for(a=v.event.handlers.call(this,t,h),i=0;(o=a[i++])&&!t.isPropagationStopped();)for(t.currentTarget=o.elem,r=0;(s=o.handlers[r++])&&!t.isImmediatePropagationStopped();)t.namespace_re&&!t.namespace_re.test(s.namespace)||(t.handleObj=s,t.data=s.data,(n=((v.event.special[s.origType]||{}).handle||s.handler).apply(o.elem,l))!==e&&!1===(t.result=n)&&(t.preventDefault(),t.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(t,i){var r,n,o,s,a=[],l=i.delegateCount,h=t.target;if(l&&h.nodeType&&(!t.button||"click"!==t.type))for(;h!==this;h=h.parentNode||this)if(!0!==h.disabled||"click"!==t.type){for(n=[],r=0;r<l;r++)n[o=(s=i[r]).selector+" "]===e&&(n[o]=s.needsContext?v(o,this).index(h)>=0:v.find(o,this,null,[h]).length),n[o]&&n.push(s);n.length&&a.push({elem:h,handlers:n})}return l<i.length&&a.push({elem:this,handlers:i.slice(l)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,i){var r,n,o,a=i.button;return null==t.pageX&&null!=i.clientX&&(n=(r=t.target.ownerDocument||s).documentElement,o=r.body,t.pageX=i.clientX+(n&&n.scrollLeft||o&&o.scrollLeft||0)-(n&&n.clientLeft||o&&o.clientLeft||0),t.pageY=i.clientY+(n&&n.scrollTop||o&&o.scrollTop||0)-(n&&n.clientTop||o&&o.clientTop||0)),t.which||a===e||(t.which=1&a?1:2&a?3:4&a?2:0),t}},fix:function(t){if(t[v.expando])return t;var e,i,r,n=t.type,o=t,a=this.fixHooks[n];for(a||(this.fixHooks[n]=a=$.test(n)?this.mouseHooks:W.test(n)?this.keyHooks:{}),r=a.props?this.props.concat(a.props):this.props,t=new v.Event(o),e=r.length;e--;)t[i=r[e]]=o[i];return t.target||(t.target=s),3===t.target.nodeType&&(t.target=t.target.parentNode),a.filter?a.filter(t,o):t},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Q()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Q()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&v.nodeName(this,"input"))return this.click(),!1},_default:function(t){return v.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){t.result!==e&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,i,r){var n=v.extend(new v.Event,i,{type:t,isSimulated:!0,originalEvent:{}});r?v.event.trigger(n,null,e):v.event.dispatch.call(e,n),n.isDefaultPrevented()&&i.preventDefault()}},v.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)},v.Event=function(t,e){if(!(this instanceof v.Event))return new v.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.getPreventDefault&&t.getPreventDefault()?K:Z):this.type=t,e&&v.extend(this,e),this.timeStamp=t&&t.timeStamp||v.now(),this[v.expando]=!0},v.Event.prototype={isDefaultPrevented:Z,isPropagationStopped:Z,isImmediatePropagationStopped:Z,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=K,t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=K,t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()}},v.each({mouseenter:"mouseover",mouseleave:"mouseout"},(function(t,e){v.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,r=t.relatedTarget,n=t.handleObj;return r&&(r===this||v.contains(this,r))||(t.type=n.origType,i=n.handler.apply(this,arguments),t.type=e),i}}})),v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},(function(t,e){var i=0,r=function(t){v.event.simulate(e,t.target,v.event.fix(t),!0)};v.event.special[e]={setup:function(){0==i++&&s.addEventListener(t,r,!0)},teardown:function(){0==--i&&s.removeEventListener(t,r,!0)}}})),v.fn.extend({on:function(t,i,r,n,o){var s,a;if("object"==typeof t){for(a in"string"!=typeof i&&(r=r||i,i=e),t)this.on(a,i,r,t[a],o);return this}if(null==r&&null==n?(n=i,r=i=e):null==n&&("string"==typeof i?(n=r,r=e):(n=r,r=i,i=e)),!1===n)n=Z;else if(!n)return this;return 1===o&&(s=n,n=function(t){return v().off(t),s.apply(this,arguments)},n.guid=s.guid||(s.guid=v.guid++)),this.each((function(){v.event.add(this,t,n,r,i)}))},one:function(t,e,i,r){return this.on(t,e,i,r,1)},off:function(t,i,r){var n,o;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,v(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(o in t)this.off(o,i,t[o]);return this}return!1!==i&&"function"!=typeof i||(r=i,i=e),!1===r&&(r=Z),this.each((function(){v.event.remove(this,t,r,i)}))},trigger:function(t,e){return this.each((function(){v.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return v.event.trigger(t,e,i,!0)}});var tt=/^.[^:#\[\.,]*$/,et=/^(?:parents|prev(?:Until|All))/,it=v.expr.match.needsContext,rt={children:!0,contents:!0,next:!0,prev:!0};function nt(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function ot(t,e,i){if(v.isFunction(e))return v.grep(t,(function(t,r){return!!e.call(t,r,t)!==i}));if(e.nodeType)return v.grep(t,(function(t){return t===e!==i}));if("string"==typeof e){if(tt.test(e))return v.filter(e,t,i);e=v.filter(e,t)}return v.grep(t,(function(t){return y.call(e,t)>=0!==i}))}v.fn.extend({find:function(t){var e,i=[],r=this,n=r.length;if("string"!=typeof t)return this.pushStack(v(t).filter((function(){for(e=0;e<n;e++)if(v.contains(r[e],this))return!0})));for(e=0;e<n;e++)v.find(t,r[e],i);return(i=this.pushStack(n>1?v.unique(i):i)).selector=this.selector?this.selector+" "+t:t,i},has:function(t){var e=v(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(v.contains(this,e[t]))return!0}))},not:function(t){return this.pushStack(ot(this,t||[],!0))},filter:function(t){return this.pushStack(ot(this,t||[],!1))},is:function(t){return!!ot(this,"string"==typeof t&&it.test(t)?v(t):t||[],!1).length},closest:function(t,e){for(var i,r=0,n=this.length,o=[],s=it.test(t)||"string"!=typeof t?v(t,e||this.context):0;r<n;r++)for(i=this[r];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&v.find.matchesSelector(i,t))){i=o.push(i);break}return this.pushStack(o.length>1?v.unique(o):o)},index:function(t){return t?"string"==typeof t?y.call(v(t),this[0]):y.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){var i="string"==typeof t?v(t,e):v.makeArray(t&&t.nodeType?[t]:t),r=v.merge(this.get(),i);return this.pushStack(v.unique(r))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),v.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return v.dir(t,"parentNode")},parentsUntil:function(t,e,i){return v.dir(t,"parentNode",i)},next:function(t){return nt(t,"nextSibling")},prev:function(t){return nt(t,"previousSibling")},nextAll:function(t){return v.dir(t,"nextSibling")},prevAll:function(t){return v.dir(t,"previousSibling")},nextUntil:function(t,e,i){return v.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return v.dir(t,"previousSibling",i)},siblings:function(t){return v.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return v.sibling(t.firstChild)},contents:function(t){return t.contentDocument||v.merge([],t.childNodes)}},(function(t,e){v.fn[t]=function(i,r){var n=v.map(this,e,i);return"Until"!==t.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=v.filter(r,n)),this.length>1&&(rt[t]||v.unique(n),et.test(t)&&n.reverse()),this.pushStack(n)}})),v.extend({filter:function(t,e,i){var r=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===r.nodeType?v.find.matchesSelector(r,t)?[r]:[]:v.find.matches(t,v.grep(e,(function(t){return 1===t.nodeType})))},dir:function(t,i,r){for(var n=[],o=r!==e;(t=t[i])&&9!==t.nodeType;)if(1===t.nodeType){if(o&&v(t).is(r))break;n.push(t)}return n},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}});var st=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,at=/<([\w:]+)/,lt=/<|&#?\w+;/,ht=/<(?:script|style|link)/i,ct=/^(?:checkbox|radio)$/i,ut=/checked\s*(?:[^=]|=\s*.checked.)/i,pt=/^$|\/(?:java|ecma)script/i,dt=/^true\/(.*)/,mt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ft={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function yt(t,e){return v.nodeName(t,"table")&&v.nodeName(1===e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function _t(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function gt(t){var e=dt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function xt(t,e){for(var i=t.length,r=0;r<i;r++)N.set(t[r],"globalEval",!e||N.get(e[r],"globalEval"))}function vt(t,e){var i,r,n,o,s,a,l,h;if(1===e.nodeType){if(N.hasData(t)&&(o=N.access(t),s=N.set(e,o),h=o.events))for(n in delete s.handle,s.events={},h)for(i=0,r=h[n].length;i<r;i++)v.event.add(e,n,h[n][i]);F.hasData(t)&&(a=F.access(t),l=v.extend({},a),F.set(e,l))}}function bt(t,i){var r=t.getElementsByTagName?t.getElementsByTagName(i||"*"):t.querySelectorAll?t.querySelectorAll(i||"*"):[];return i===e||i&&v.nodeName(t,i)?v.merge([t],r):r}function wt(t,e){var i=e.nodeName.toLowerCase();"input"===i&&ct.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}ft.optgroup=ft.option,ft.tbody=ft.tfoot=ft.colgroup=ft.caption=ft.thead,ft.th=ft.td,v.fn.extend({text:function(t){return v.access(this,(function(t){return t===e?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(t))}),null,t,arguments.length)},append:function(){return this.domManip(arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||yt(this,t).appendChild(t)}))},prepend:function(){return this.domManip(arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=yt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return this.domManip(arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return this.domManip(arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},remove:function(t,e){for(var i,r=t?v.filter(t,this):this,n=0;null!=(i=r[n]);n++)e||1!==i.nodeType||v.cleanData(bt(i)),i.parentNode&&(e&&v.contains(i.ownerDocument,i)&&xt(bt(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(v.cleanData(bt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return v.clone(this,t,e)}))},html:function(t){return v.access(this,(function(t){var i=this[0]||{},r=0,n=this.length;if(t===e&&1===i.nodeType)return i.innerHTML;if("string"==typeof t&&!ht.test(t)&&!ft[(at.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(st,"<$1></$2>");try{for(;r<n;r++)1===(i=this[r]||{}).nodeType&&(v.cleanData(bt(i,!1)),i.innerHTML=t);i=0}catch(t){}}i&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=v.map(this,(function(t){return[t.nextSibling,t.parentNode]})),e=0;return this.domManip(arguments,(function(i){var r=t[e++],n=t[e++];n&&(r&&r.parentNode!==n&&(r=this.nextSibling),v(this).remove(),n.insertBefore(i,r))}),!0),e?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e,i){t=d.apply([],t);var r,n,o,s,a,l,h=0,c=this.length,u=this,p=c-1,m=t[0],f=v.isFunction(m);if(f||!(c<=1||"string"!=typeof m||v.support.checkClone)&&ut.test(m))return this.each((function(r){var n=u.eq(r);f&&(t[0]=m.call(this,r,n.html())),n.domManip(t,e,i)}));if(c&&(n=(r=v.buildFragment(t,this[0].ownerDocument,!1,!i&&this)).firstChild,1===r.childNodes.length&&(r=n),n)){for(s=(o=v.map(bt(r,"script"),_t)).length;h<c;h++)a=r,h!==p&&(a=v.clone(a,!0,!0),s&&v.merge(o,bt(a,"script"))),e.call(this[h],a,h);if(s)for(l=o[o.length-1].ownerDocument,v.map(o,gt),h=0;h<s;h++)a=o[h],pt.test(a.type||"")&&!N.access(a,"globalEval")&&v.contains(l,a)&&(a.src?v._evalUrl(a.src):v.globalEval(a.textContent.replace(mt,"")))}return this}}),v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){v.fn[t]=function(t){for(var i,r=[],n=v(t),o=n.length-1,s=0;s<=o;s++)i=s===o?this:this.clone(!0),v(n[s])[e](i),m.apply(r,i.get());return this.pushStack(r)}})),v.extend({clone:function(t,e,i){var r,n,o,s,a=t.cloneNode(!0),l=v.contains(t.ownerDocument,t);if(!(v.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||v.isXMLDoc(t)))for(s=bt(a),r=0,n=(o=bt(t)).length;r<n;r++)wt(o[r],s[r]);if(e)if(i)for(o=o||bt(t),s=s||bt(a),r=0,n=o.length;r<n;r++)vt(o[r],s[r]);else vt(t,a);return(s=bt(a,"script")).length>0&&xt(s,!l&&bt(t,"script")),a},buildFragment:function(t,e,i,r){for(var n,o,s,a,l,h,c=0,u=t.length,p=e.createDocumentFragment(),d=[];c<u;c++)if((n=t[c])||0===n)if("object"===v.type(n))v.merge(d,n.nodeType?[n]:n);else if(lt.test(n)){for(o=o||p.appendChild(e.createElement("div")),s=(at.exec(n)||["",""])[1].toLowerCase(),a=ft[s]||ft._default,o.innerHTML=a[1]+n.replace(st,"<$1></$2>")+a[2],h=a[0];h--;)o=o.lastChild;v.merge(d,o.childNodes),(o=p.firstChild).textContent=""}else d.push(e.createTextNode(n));for(p.textContent="",c=0;n=d[c++];)if((!r||-1===v.inArray(n,r))&&(l=v.contains(n.ownerDocument,n),o=bt(p.appendChild(n),"script"),l&&xt(o),i))for(h=0;n=o[h++];)pt.test(n.type||"")&&i.push(n);return p},cleanData:function(t){for(var i,r,n,o,s,a,l=v.event.special,h=0;(r=t[h])!==e;h++){if(U.accepts(r)&&(s=r[N.expando])&&(i=N.cache[s])){if((n=Object.keys(i.events||{})).length)for(a=0;(o=n[a])!==e;a++)l[o]?v.event.remove(r,o):v.removeEvent(r,o,i.handle);N.cache[s]&&delete N.cache[s]}delete F.cache[r[F.expando]]}},_evalUrl:function(t){return v.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})}}),v.fn.extend({wrapAll:function(t){var e;return v.isFunction(t)?this.each((function(e){v(this).wrapAll(t.call(this,e))})):(this[0]&&(e=v(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this)},wrapInner:function(t){return v.isFunction(t)?this.each((function(e){v(this).wrapInner(t.call(this,e))})):this.each((function(){var e=v(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=v.isFunction(t);return this.each((function(i){v(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(){return this.parent().each((function(){v.nodeName(this,"body")||v(this).replaceWith(this.childNodes)})).end()}});var St,Ct,Dt=/^(none|table(?!-c[ea]).+)/,Tt=/^margin/,At=new RegExp("^("+b+")(.*)$","i"),Et=new RegExp("^("+b+")(?!px)[a-z%]+$","i"),It=new RegExp("^([+-])=("+b+")","i"),Pt={BODY:"block"},Bt={position:"absolute",visibility:"hidden",display:"block"},Mt={letterSpacing:0,fontWeight:400},Ot=["Top","Right","Bottom","Left"],Rt=["Webkit","O","Moz","ms"];function Lt(t,e){if(e in t)return e;for(var i=e.charAt(0).toUpperCase()+e.slice(1),r=e,n=Rt.length;n--;)if((e=Rt[n]+i)in t)return e;return r}function kt(t,e){return t=e||t,"none"===v.css(t,"display")||!v.contains(t.ownerDocument,t)}function Ft(e){return t.getComputedStyle(e,null)}function Nt(t,e){for(var i,r,n,o=[],s=0,a=t.length;s<a;s++)(r=t[s]).style&&(o[s]=N.get(r,"olddisplay"),i=r.style.display,e?(o[s]||"none"!==i||(r.style.display=""),""===r.style.display&&kt(r)&&(o[s]=N.access(r,"olddisplay",jt(r.nodeName)))):o[s]||(n=kt(r),(i&&"none"!==i||!n)&&N.set(r,"olddisplay",n?i:v.css(r,"display"))));for(s=0;s<a;s++)(r=t[s]).style&&(e&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=e?o[s]||"":"none"));return t}function Vt(t,e,i){var r=At.exec(e);return r?Math.max(0,r[1]-(i||0))+(r[2]||"px"):e}function Gt(t,e,i,r,n){for(var o=i===(r?"border":"content")?4:"width"===e?1:0,s=0;o<4;o+=2)"margin"===i&&(s+=v.css(t,i+Ot[o],!0,n)),r?("content"===i&&(s-=v.css(t,"padding"+Ot[o],!0,n)),"margin"!==i&&(s-=v.css(t,"border"+Ot[o]+"Width",!0,n))):(s+=v.css(t,"padding"+Ot[o],!0,n),"padding"!==i&&(s+=v.css(t,"border"+Ot[o]+"Width",!0,n)));return s}function Ut(t,e,i){var r=!0,n="width"===e?t.offsetWidth:t.offsetHeight,o=Ft(t),s=v.support.boxSizing&&"border-box"===v.css(t,"boxSizing",!1,o);if(n<=0||null==n){if(((n=St(t,e,o))<0||null==n)&&(n=t.style[e]),Et.test(n))return n;r=s&&(v.support.boxSizingReliable||n===t.style[e]),n=parseFloat(n)||0}return n+Gt(t,e,i||(s?"border":"content"),r,o)+"px"}function jt(t){var e=s,i=Pt[t];return i||("none"!==(i=zt(t,e))&&i||((e=((Ct=(Ct||v("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(e.documentElement))[0].contentWindow||Ct[0].contentDocument).document).write("<!doctype html><html><body>"),e.close(),i=zt(t,e),Ct.detach()),Pt[t]=i),i}function zt(t,e){var i=v(e.createElement(t)).appendTo(e.body),r=v.css(i[0],"display");return i.remove(),r}v.fn.extend({css:function(t,i){return v.access(this,(function(t,i,r){var n,o,s={},a=0;if(v.isArray(i)){for(n=Ft(t),o=i.length;a<o;a++)s[i[a]]=v.css(t,i[a],!1,n);return s}return r!==e?v.style(t,i,r):v.css(t,i)}),t,i,arguments.length>1)},show:function(){return Nt(this,!0)},hide:function(){return Nt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){kt(this)?v(this).show():v(this).hide()}))}}),v.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=St(t,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(t,i,r,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,s,a,l=v.camelCase(i),h=t.style;if(i=v.cssProps[l]||(v.cssProps[l]=Lt(h,l)),a=v.cssHooks[i]||v.cssHooks[l],r===e)return a&&"get"in a&&(o=a.get(t,!1,n))!==e?o:h[i];"string"===(s=typeof r)&&(o=It.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(v.css(t,i)),s="number"),null==r||"number"===s&&isNaN(r)||("number"!==s||v.cssNumber[l]||(r+="px"),v.support.clearCloneStyle||""!==r||0!==i.indexOf("background")||(h[i]="inherit"),a&&"set"in a&&(r=a.set(t,r,n))===e||(h[i]=r))}},css:function(t,i,r,n){var o,s,a,l=v.camelCase(i);return i=v.cssProps[l]||(v.cssProps[l]=Lt(t.style,l)),(a=v.cssHooks[i]||v.cssHooks[l])&&"get"in a&&(o=a.get(t,!0,r)),o===e&&(o=St(t,i,n)),"normal"===o&&i in Mt&&(o=Mt[i]),""===r||r?(s=parseFloat(o),!0===r||v.isNumeric(s)?s||0:o):o}}),St=function(t,i,r){var n,o,s,a=r||Ft(t),l=a?a.getPropertyValue(i)||a[i]:e,h=t.style;return a&&(""!==l||v.contains(t.ownerDocument,t)||(l=v.style(t,i)),Et.test(l)&&Tt.test(i)&&(n=h.width,o=h.minWidth,s=h.maxWidth,h.minWidth=h.maxWidth=h.width=l,l=a.width,h.width=n,h.minWidth=o,h.maxWidth=s)),l},v.each(["height","width"],(function(t,e){v.cssHooks[e]={get:function(t,i,r){if(i)return 0===t.offsetWidth&&Dt.test(v.css(t,"display"))?v.swap(t,Bt,(function(){return Ut(t,e,r)})):Ut(t,e,r)},set:function(t,i,r){var n=r&&Ft(t);return Vt(0,i,r?Gt(t,e,r,v.support.boxSizing&&"border-box"===v.css(t,"boxSizing",!1,n),n):0)}}})),v((function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(t,e){if(e)return v.swap(t,{display:"inline-block"},St,[t,"marginRight"])}}),!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],(function(t,e){v.cssHooks[e]={get:function(t,i){if(i)return i=St(t,e),Et.test(i)?v(t).position()[e]+"px":i}}}))})),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0},v.expr.filters.visible=function(t){return!v.expr.filters.hidden(t)}),v.each({margin:"",padding:"",border:"Width"},(function(t,e){v.cssHooks[t+e]={expand:function(i){for(var r=0,n={},o="string"==typeof i?i.split(" "):[i];r<4;r++)n[t+Ot[r]+e]=o[r]||o[r-2]||o[0];return n}},Tt.test(t)||(v.cssHooks[t+e].set=Vt)}));var Xt=/%20/g,Ht=/\[\]$/,Jt=/\r?\n/g,Wt=/^(?:submit|button|image|reset|file)$/i,$t=/^(?:input|select|textarea|keygen)/i;function Yt(t,e,i,r){var n;if(v.isArray(e))v.each(e,(function(e,n){i||Ht.test(t)?r(t,n):Yt(t+"["+("object"==typeof n?e:"")+"]",n,i,r)}));else if(i||"object"!==v.type(e))r(t,e);else for(n in e)Yt(t+"["+n+"]",e[n],i,r)}v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=v.prop(this,"elements");return t?v.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!v(this).is(":disabled")&&$t.test(this.nodeName)&&!Wt.test(t)&&(this.checked||!ct.test(t))})).map((function(t,e){var i=v(this).val();return null==i?null:v.isArray(i)?v.map(i,(function(t){return{name:e.name,value:t.replace(Jt,"\r\n")}})):{name:e.name,value:i.replace(Jt,"\r\n")}})).get()}}),v.param=function(t,i){var r,n=[],o=function(t,e){e=v.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(i===e&&(i=v.ajaxSettings&&v.ajaxSettings.traditional),v.isArray(t)||t.jquery&&!v.isPlainObject(t))v.each(t,(function(){o(this.name,this.value)}));else for(r in t)Yt(r,t[r],i,o);return n.join("&").replace(Xt,"+")},v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),(function(t,e){v.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}})),v.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,r){return this.on(e,t,i,r)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}});var qt,Kt,Zt=v.now(),Qt=/\?/,te=/#.*$/,ee=/([?&])_=[^&]*/,ie=/^(.*?):[ \t]*([^\r\n]*)$/gm,re=/^(?:GET|HEAD)$/,ne=/^\/\//,oe=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,se=v.fn.load,ae={},le={},he="*/".concat("*");try{Kt=o.href}catch(t){(Kt=s.createElement("a")).href="",Kt=Kt.href}function ce(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var r,n=0,o=e.toLowerCase().match(w)||[];if(v.isFunction(i))for(;r=o[n++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(i)):(t[r]=t[r]||[]).push(i)}}function ue(t,e,i,r){var n={},o=t===le;function s(a){var l;return n[a]=!0,v.each(t[a]||[],(function(t,a){var h=a(e,i,r);return"string"!=typeof h||o||n[h]?o?!(l=h):void 0:(e.dataTypes.unshift(h),s(h),!1)})),l}return s(e.dataTypes[0])||!n["*"]&&s("*")}function pe(t,i){var r,n,o=v.ajaxSettings.flatOptions||{};for(r in i)i[r]!==e&&((o[r]?t:n||(n={}))[r]=i[r]);return n&&v.extend(!0,t,n),t}qt=oe.exec(Kt.toLowerCase())||[],v.fn.load=function(t,i,r){if("string"!=typeof t&&se)return se.apply(this,arguments);var n,o,s,a=this,l=t.indexOf(" ");return l>=0&&(n=t.slice(l),t=t.slice(0,l)),v.isFunction(i)?(r=i,i=e):i&&"object"==typeof i&&(o="POST"),a.length>0&&v.ajax({url:t,type:o,dataType:"html",data:i}).done((function(t){s=arguments,a.html(n?v("<div>").append(v.parseHTML(t)).find(n):t)})).complete(r&&function(t,e){a.each(r,s||[t.responseText,e,t])}),this},v.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){v.fn[e]=function(t){return this.on(e,t)}})),v.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Kt,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(qt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":he,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?pe(pe(t,v.ajaxSettings),e):pe(v.ajaxSettings,t)},ajaxPrefilter:ce(ae),ajaxTransport:ce(le),ajax:function(t,i){"object"==typeof t&&(i=t,t=e),i=i||{};var r,n,o,s,a,l,h,c,u=v.ajaxSetup({},i),p=u.context||u,d=u.context&&(p.nodeType||p.jquery)?v(p):v.event,m=v.Deferred(),f=v.Callbacks("once memory"),y=u.statusCode||{},_={},g={},x=0,b="canceled",S={readyState:0,getResponseHeader:function(t){var e;if(2===x){if(!s)for(s={};e=ie.exec(o);)s[e[1].toLowerCase()]=e[2];e=s[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===x?o:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return x||(t=g[i]=g[i]||t,_[t]=e),this},overrideMimeType:function(t){return x||(u.mimeType=t),this},statusCode:function(t){var e;if(t)if(x<2)for(e in t)y[e]=[y[e],t[e]];else S.always(t[S.status]);return this},abort:function(t){var e=t||b;return r&&r.abort(e),C(0,e),this}};if(m.promise(S).complete=f.add,S.success=S.done,S.error=S.fail,u.url=((t||u.url||Kt)+"").replace(te,"").replace(ne,qt[1]+"//"),u.type=i.method||i.type||u.method||u.type,u.dataTypes=v.trim(u.dataType||"*").toLowerCase().match(w)||[""],null==u.crossDomain&&(l=oe.exec(u.url.toLowerCase()),u.crossDomain=!(!l||l[1]===qt[1]&&l[2]===qt[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(qt[3]||("http:"===qt[1]?"80":"443")))),u.data&&u.processData&&"string"!=typeof u.data&&(u.data=v.param(u.data,u.traditional)),ue(ae,u,i,S),2===x)return S;for(c in(h=u.global)&&0==v.active++&&v.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!re.test(u.type),n=u.url,u.hasContent||(u.data&&(n=u.url+=(Qt.test(n)?"&":"?")+u.data,delete u.data),!1===u.cache&&(u.url=ee.test(n)?n.replace(ee,"$1_="+Zt++):n+(Qt.test(n)?"&":"?")+"_="+Zt++)),u.ifModified&&(v.lastModified[n]&&S.setRequestHeader("If-Modified-Since",v.lastModified[n]),v.etag[n]&&S.setRequestHeader("If-None-Match",v.etag[n])),(u.data&&u.hasContent&&!1!==u.contentType||i.contentType)&&S.setRequestHeader("Content-Type",u.contentType),S.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+he+"; q=0.01":""):u.accepts["*"]),u.headers)S.setRequestHeader(c,u.headers[c]);if(u.beforeSend&&(!1===u.beforeSend.call(p,S,u)||2===x))return S.abort();for(c in b="abort",{success:1,error:1,complete:1})S[c](u[c]);if(r=ue(le,u,i,S)){S.readyState=1,h&&d.trigger("ajaxSend",[S,u]),u.async&&u.timeout>0&&(a=setTimeout((function(){S.abort("timeout")}),u.timeout));try{x=1,r.send(_,C)}catch(t){if(!(x<2))throw t;C(-1,t)}}else C(-1,"No Transport");function C(t,i,s,l){var c,_,g,b,w,C=i;2!==x&&(x=2,a&&clearTimeout(a),r=e,o=l||"",S.readyState=t>0?4:0,c=t>=200&&t<300||304===t,s&&(b=function(t,i,r){var n,o,s,a,l=t.contents,h=t.dataTypes;for(;"*"===h[0];)h.shift(),n===e&&(n=t.mimeType||i.getResponseHeader("Content-Type"));if(n)for(o in l)if(l[o]&&l[o].test(n)){h.unshift(o);break}if(h[0]in r)s=h[0];else{for(o in r){if(!h[0]||t.converters[o+" "+h[0]]){s=o;break}a||(a=o)}s=s||a}if(s)return s!==h[0]&&h.unshift(s),r[s]}(u,S,s)),b=function(t,e,i,r){var n,o,s,a,l,h={},c=t.dataTypes.slice();if(c[1])for(s in t.converters)h[s.toLowerCase()]=t.converters[s];o=c.shift();for(;o;)if(t.responseFields[o]&&(i[t.responseFields[o]]=e),!l&&r&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(s=h[l+" "+o]||h["* "+o]))for(n in h)if((a=n.split(" "))[1]===o&&(s=h[l+" "+a[0]]||h["* "+a[0]])){!0===s?s=h[n]:!0!==h[n]&&(o=a[0],c.unshift(a[1]));break}if(!0!==s)if(s&&t.throws)e=s(e);else try{e=s(e)}catch(t){return{state:"parsererror",error:s?t:"No conversion from "+l+" to "+o}}}return{state:"success",data:e}}(u,b,S,c),c?(u.ifModified&&((w=S.getResponseHeader("Last-Modified"))&&(v.lastModified[n]=w),(w=S.getResponseHeader("etag"))&&(v.etag[n]=w)),204===t||"HEAD"===u.type?C="nocontent":304===t?C="notmodified":(C=b.state,_=b.data,c=!(g=b.error))):(g=C,!t&&C||(C="error",t<0&&(t=0))),S.status=t,S.statusText=(i||C)+"",c?m.resolveWith(p,[_,C,S]):m.rejectWith(p,[S,C,g]),S.statusCode(y),y=e,h&&d.trigger(c?"ajaxSuccess":"ajaxError",[S,u,c?_:g]),f.fireWith(p,[S,C]),h&&(d.trigger("ajaxComplete",[S,u]),--v.active||v.event.trigger("ajaxStop")))}return S},getJSON:function(t,e,i){return v.get(t,e,i,"json")},getScript:function(t,i){return v.get(t,e,i,"script")}}),v.each(["get","post"],(function(t,i){v[i]=function(t,r,n,o){return v.isFunction(r)&&(o=o||n,n=r,r=e),v.ajax({url:t,type:i,dataType:o,data:r,success:n})}})),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return v.globalEval(t),t}}}),v.ajaxPrefilter("script",(function(t){t.cache===e&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),v.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain)return{send:function(r,n){e=v("<script>").prop({async:!0,charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&n("error"===t.type?404:200,t.type)}),s.head.appendChild(e[0])},abort:function(){i&&i()}}}));var de=[],me=/(=)\?(?=&|$)|\?\?/;v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=de.pop()||v.expando+"_"+Zt++;return this[t]=!0,t}}),v.ajaxPrefilter("json jsonp",(function(i,r,n){var o,s,a,l=!1!==i.jsonp&&(me.test(i.url)?"url":"string"==typeof i.data&&!(i.contentType||"").indexOf("application/x-www-form-urlencoded")&&me.test(i.data)&&"data");if(l||"jsonp"===i.dataTypes[0])return o=i.jsonpCallback=v.isFunction(i.jsonpCallback)?i.jsonpCallback():i.jsonpCallback,l?i[l]=i[l].replace(me,"$1"+o):!1!==i.jsonp&&(i.url+=(Qt.test(i.url)?"&":"?")+i.jsonp+"="+o),i.converters["script json"]=function(){return a||v.error(o+" was not called"),a[0]},i.dataTypes[0]="json",s=t[o],t[o]=function(){a=arguments},n.always((function(){t[o]=s,i[o]&&(i.jsonpCallback=r.jsonpCallback,de.push(o)),a&&v.isFunction(s)&&s(a[0]),a=s=e})),"script"})),v.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(t){}};var fe=v.ajaxSettings.xhr(),ye={0:200,1223:204},_e=0,ge={};t.ActiveXObject&&v(t).on("unload",(function(){for(var t in ge)ge[t]();ge=e})),v.support.cors=!!fe&&"withCredentials"in fe,v.support.ajax=fe=!!fe,v.ajaxTransport((function(t){var i;if(v.support.cors||fe&&!t.crossDomain)return{send:function(r,n){var o,s,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)a[o]=t.xhrFields[o];for(o in t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)a.setRequestHeader(o,r[o]);i=function(t){return function(){i&&(delete ge[s],i=a.onload=a.onerror=null,"abort"===t?a.abort():"error"===t?n(a.status||404,a.statusText):n(ye[a.status]||a.status,a.statusText,"string"==typeof a.responseText?{text:a.responseText}:e,a.getAllResponseHeaders()))}},a.onload=i(),a.onerror=i("error"),i=ge[s=_e++]=i("abort"),a.send(t.hasContent&&t.data||null)},abort:function(){i&&i()}}}));var xe,ve,be=/^(?:toggle|show|hide)$/,we=new RegExp("^(?:([+-])=|)("+b+")([a-z%]*)$","i"),Se=/queueHooks$/,Ce=[function(t,i,r){var n,o,s,a,l,h,c=this,u={},p=t.style,d=t.nodeType&&kt(t),m=N.get(t,"fxshow");r.queue||(null==(l=v._queueHooks(t,"fx")).unqueued&&(l.unqueued=0,h=l.empty.fire,l.empty.fire=function(){l.unqueued||h()}),l.unqueued++,c.always((function(){c.always((function(){l.unqueued--,v.queue(t,"fx").length||l.empty.fire()}))})));1===t.nodeType&&("height"in i||"width"in i)&&(r.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===v.css(t,"display")&&"none"===v.css(t,"float")&&(p.display="inline-block"));r.overflow&&(p.overflow="hidden",c.always((function(){p.overflow=r.overflow[0],p.overflowX=r.overflow[1],p.overflowY=r.overflow[2]})));for(n in i)if(o=i[n],be.exec(o)){if(delete i[n],s=s||"toggle"===o,o===(d?"hide":"show")){if("show"!==o||!m||m[n]===e)continue;d=!0}u[n]=m&&m[n]||v.style(t,n)}if(!v.isEmptyObject(u))for(n in m?"hidden"in m&&(d=m.hidden):m=N.access(t,"fxshow",{}),s&&(m.hidden=!d),d?v(t).show():c.done((function(){v(t).hide()})),c.done((function(){var e;for(e in N.remove(t,"fxshow"),u)v.style(t,e,u[e])})),u)a=Ae(d?m[n]:0,n,c),n in m||(m[n]=a.start,d&&(a.end=a.start,a.start="width"===n||"height"===n?1:0))}],De={"*":[function(t,e){var i=this.createTween(t,e),r=i.cur(),n=we.exec(e),o=n&&n[3]||(v.cssNumber[t]?"":"px"),s=(v.cssNumber[t]||"px"!==o&&+r)&&we.exec(v.css(i.elem,t)),a=1,l=20;if(s&&s[3]!==o){o=o||s[3],n=n||[],s=+r||1;do{s/=a=a||".5",v.style(i.elem,t,s+o)}while(a!==(a=i.cur()/r)&&1!==a&&--l)}return n&&(s=i.start=+s||+r||0,i.unit=o,i.end=n[1]?s+(n[1]+1)*n[2]:+n[2]),i}]};function Te(){return setTimeout((function(){xe=e})),xe=v.now()}function Ae(t,e,i){for(var r,n=(De[e]||[]).concat(De["*"]),o=0,s=n.length;o<s;o++)if(r=n[o].call(i,e,t))return r}function Ee(t,e,i){var r,n,o=0,s=Ce.length,a=v.Deferred().always((function(){delete l.elem})),l=function(){if(n)return!1;for(var e=xe||Te(),i=Math.max(0,h.startTime+h.duration-e),r=1-(i/h.duration||0),o=0,s=h.tweens.length;o<s;o++)h.tweens[o].run(r);return a.notifyWith(t,[h,r,i]),r<1&&s?i:(a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:v.extend({},e),opts:v.extend(!0,{specialEasing:{}},i),originalProperties:e,originalOptions:i,startTime:xe||Te(),duration:i.duration,tweens:[],createTween:function(e,i){var r=v.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(r),r},stop:function(e){var i=0,r=e?h.tweens.length:0;if(n)return this;for(n=!0;i<r;i++)h.tweens[i].run(1);return e?a.resolveWith(t,[h,e]):a.rejectWith(t,[h,e]),this}}),c=h.props;for(!function(t,e){var i,r,n,o,s;for(i in t)if(n=e[r=v.camelCase(i)],o=t[i],v.isArray(o)&&(n=o[1],o=t[i]=o[0]),i!==r&&(t[r]=o,delete t[i]),(s=v.cssHooks[r])&&"expand"in s)for(i in o=s.expand(o),delete t[r],o)i in t||(t[i]=o[i],e[i]=n);else e[r]=n}(c,h.opts.specialEasing);o<s;o++)if(r=Ce[o].call(h,t,c,h.opts))return r;return v.map(c,Ae,h),v.isFunction(h.opts.start)&&h.opts.start.call(t,h),v.fx.timer(v.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function Ie(t,e,i,r,n){return new Ie.prototype.init(t,e,i,r,n)}function Pe(t,e){var i,r={height:t},n=0;for(e=e?1:0;n<4;n+=2-e)r["margin"+(i=Ot[n])]=r["padding"+i]=t;return e&&(r.opacity=r.width=t),r}function Be(t){return v.isWindow(t)?t:9===t.nodeType&&t.defaultView}v.Animation=v.extend(Ee,{tweener:function(t,e){v.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var i,r=0,n=t.length;r<n;r++)i=t[r],De[i]=De[i]||[],De[i].unshift(e)},prefilter:function(t,e){e?Ce.unshift(t):Ce.push(t)}}),v.Tween=Ie,Ie.prototype={constructor:Ie,init:function(t,e,i,r,n,o){this.elem=t,this.prop=i,this.easing=n||"swing",this.options=e,this.start=this.now=this.cur(),this.end=r,this.unit=o||(v.cssNumber[i]?"":"px")},cur:function(){var t=Ie.propHooks[this.prop];return t&&t.get?t.get(this):Ie.propHooks._default.get(this)},run:function(t){var e,i=Ie.propHooks[this.prop];return this.options.duration?this.pos=e=v.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):Ie.propHooks._default.set(this),this}},Ie.prototype.init.prototype=Ie.prototype,Ie.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=v.css(t.elem,t.prop,""))&&"auto"!==e?e:0:t.elem[t.prop]},set:function(t){v.fx.step[t.prop]?v.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[v.cssProps[t.prop]]||v.cssHooks[t.prop])?v.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},Ie.propHooks.scrollTop=Ie.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},v.each(["toggle","show","hide"],(function(t,e){var i=v.fn[e];v.fn[e]=function(t,r,n){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(Pe(e,!0),t,r,n)}})),v.fn.extend({fadeTo:function(t,e,i,r){return this.filter(kt).css("opacity",0).show().end().animate({opacity:e},t,i,r)},animate:function(t,e,i,r){var n=v.isEmptyObject(t),o=v.speed(e,i,r),s=function(){var e=Ee(this,v.extend({},t),o);(n||N.get(this,"finish"))&&e.stop(!0)};return s.finish=s,n||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop:function(t,i,r){var n=function(t){var e=t.stop;delete t.stop,e(r)};return"string"!=typeof t&&(r=i,i=t,t=e),i&&!1!==t&&this.queue(t||"fx",[]),this.each((function(){var e=!0,i=null!=t&&t+"queueHooks",o=v.timers,s=N.get(this);if(i)s[i]&&s[i].stop&&n(s[i]);else for(i in s)s[i]&&s[i].stop&&Se.test(i)&&n(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=t&&o[i].queue!==t||(o[i].anim.stop(r),e=!1,o.splice(i,1));!e&&r||v.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=N.get(this),r=i[t+"queue"],n=i[t+"queueHooks"],o=v.timers,s=r?r.length:0;for(i.finish=!0,v.queue(this,t,[]),n&&n.stop&&n.stop.call(this,!0),e=o.length;e--;)o[e].elem===this&&o[e].queue===t&&(o[e].anim.stop(!0),o.splice(e,1));for(e=0;e<s;e++)r[e]&&r[e].finish&&r[e].finish.call(this);delete i.finish}))}}),v.each({slideDown:Pe("show"),slideUp:Pe("hide"),slideToggle:Pe("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){v.fn[t]=function(t,i,r){return this.animate(e,t,i,r)}})),v.speed=function(t,e,i){var r=t&&"object"==typeof t?v.extend({},t):{complete:i||!i&&e||v.isFunction(t)&&t,duration:t,easing:i&&e||e&&!v.isFunction(e)&&e};return r.duration=v.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default,null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)},r},v.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},v.timers=[],v.fx=Ie.prototype.init,v.fx.tick=function(){var t,i=v.timers,r=0;for(xe=v.now();r<i.length;r++)(t=i[r])()||i[r]!==t||i.splice(r--,1);i.length||v.fx.stop(),xe=e},v.fx.timer=function(t){t()&&v.timers.push(t)&&v.fx.start()},v.fx.interval=13,v.fx.start=function(){ve||(ve=setInterval(v.fx.tick,v.fx.interval))},v.fx.stop=function(){clearInterval(ve),ve=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(t){return v.grep(v.timers,(function(e){return t===e.elem})).length}),v.fn.offset=function(t){if(arguments.length)return t===e?this:this.each((function(e){v.offset.setOffset(this,t,e)}));var i,r,o=this[0],s={top:0,left:0},a=o&&o.ownerDocument;return a?(i=a.documentElement,v.contains(i,o)?(typeof o.getBoundingClientRect!==n&&(s=o.getBoundingClientRect()),r=Be(a),{top:s.top+r.pageYOffset-i.clientTop,left:s.left+r.pageXOffset-i.clientLeft}):s):void 0},v.offset={setOffset:function(t,e,i){var r,n,o,s,a,l,h=v.css(t,"position"),c=v(t),u={};"static"===h&&(t.style.position="relative"),a=c.offset(),o=v.css(t,"top"),l=v.css(t,"left"),("absolute"===h||"fixed"===h)&&(o+l).indexOf("auto")>-1?(s=(r=c.position()).top,n=r.left):(s=parseFloat(o)||0,n=parseFloat(l)||0),v.isFunction(e)&&(e=e.call(t,i,a)),null!=e.top&&(u.top=e.top-a.top+s),null!=e.left&&(u.left=e.left-a.left+n),"using"in e?e.using.call(t,u):c.css(u)}},v.fn.extend({position:function(){if(this[0]){var t,e,i=this[0],r={top:0,left:0};return"fixed"===v.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),v.nodeName(t[0],"html")||(r=t.offset()),r.top+=v.css(t[0],"borderTopWidth",!0),r.left+=v.css(t[0],"borderLeftWidth",!0)),{top:e.top-r.top-v.css(i,"marginTop",!0),left:e.left-r.left-v.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent||a;t&&!v.nodeName(t,"html")&&"static"===v.css(t,"position");)t=t.offsetParent;return t||a}))}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(i,r){var n="pageYOffset"===r;v.fn[i]=function(o){return v.access(this,(function(i,o,s){var a=Be(i);if(s===e)return a?a[r]:i[o];a?a.scrollTo(n?t.pageXOffset:s,n?s:t.pageYOffset):i[o]=s}),i,o,arguments.length,null)}})),v.each({Height:"height",Width:"width"},(function(t,i){v.each({padding:"inner"+t,content:i,"":"outer"+t},(function(r,n){v.fn[n]=function(n,o){var s=arguments.length&&(r||"boolean"!=typeof n),a=r||(!0===n||!0===o?"margin":"border");return v.access(this,(function(i,r,n){var o;return v.isWindow(i)?i.document.documentElement["client"+t]:9===i.nodeType?(o=i.documentElement,Math.max(i.body["scroll"+t],o["scroll"+t],i.body["offset"+t],o["offset"+t],o["client"+t])):n===e?v.css(i,r,a):v.style(i,r,n,a)}),i,s?n:e,s,null)}}))})),v.fn.size=function(){return this.length},v.fn.andSelf=v.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=v:"function"==typeof define&&define.amd&&define("jquery",[],(function(){return v})),"object"==typeof t&&"object"==typeof t.document&&(t.jQuery=t.$=v)}(window),window.Modernizr=function(t,e,i){var r,n,o={},s=e.documentElement,a=e.createElement("modernizr"),l=a.style,h="Webkit Moz O ms",c=h.split(" "),u=h.toLowerCase().split(" "),p={},d=[],m=d.slice,f={}.hasOwnProperty;function y(t){l.cssText=t}function _(t,e){return typeof t===e}for(var g in n=_(f,"undefined")||_(f.call,"undefined")?function(t,e){return e in t&&_(t.constructor.prototype[e],"undefined")}:function(t,e){return f.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var i=m.call(arguments,1),r=function(){if(this instanceof r){var n=function(){};n.prototype=e.prototype;var o=new n,s=e.apply(o,i.concat(m.call(arguments)));return Object(s)===s?s:o}return e.apply(t,i.concat(m.call(arguments)))};return r}),p.canvas=function(){var t=e.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},p.websockets=function(){return"WebSocket"in t||"MozWebSocket"in t},p)n(p,g)&&(r=g.toLowerCase(),o[r]=p[g](),d.push((o[r]?"":"no-")+r));return o.addTest=function(t,e){if("object"==typeof t)for(var r in t)n(t,r)&&o.addTest(r,t[r]);else{if(t=t.toLowerCase(),o[t]!==i)return o;e="function"==typeof e?e():e,s.className+=" "+(e?"":"no-")+t,o[t]=e}return o},y(""),a=null,function(t,e){var i,r,n=t.html5||{},o=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,s=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,a="_html5shiv",l=0,h={};function c(){var t=m.elements;return"string"==typeof t?t.split(" "):t}function u(t){var e=h[t[a]];return e||(e={},l++,t[a]=l,h[l]=e),e}function p(t,i,n){return i||(i=e),r?i.createElement(t):(n||(n=u(i)),(a=n.cache[t]?n.cache[t].cloneNode():s.test(t)?(n.cache[t]=n.createElem(t)).cloneNode():n.createElem(t)).canHaveChildren&&!o.test(t)?n.frag.appendChild(a):a);var a}function d(t){t||(t=e);var n=u(t);return!m.shivCSS||i||n.hasCSS||(n.hasCSS=!!function(t,e){var i=t.createElement("p"),r=t.getElementsByTagName("head")[0]||t.documentElement;return i.innerHTML="x<style>"+e+"</style>",r.insertBefore(i.lastChild,r.firstChild)}(t,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),r||function(t,e){e.cache||(e.cache={},e.createElem=t.createElement,e.createFrag=t.createDocumentFragment,e.frag=e.createFrag()),t.createElement=function(i){return m.shivMethods?p(i,t,e):e.createElem(i)},t.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+c().join().replace(/\w+/g,(function(t){return e.createElem(t),e.frag.createElement(t),'c("'+t+'")'}))+");return n}")(m,e.frag)}(t,n),t}!function(){try{var t=e.createElement("a");t.innerHTML="<xyz></xyz>",i="hidden"in t,r=1==t.childNodes.length||function(){e.createElement("a");var t=e.createDocumentFragment();return void 0===t.cloneNode||void 0===t.createDocumentFragment||void 0===t.createElement}()}catch(t){i=!0,r=!0}}();var m={elements:n.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:!1!==n.shivCSS,supportsUnknownElements:r,shivMethods:!1!==n.shivMethods,type:"default",shivDocument:d,createElement:p,createDocumentFragment:function(t,i){if(t||(t=e),r)return t.createDocumentFragment();for(var n=(i=i||u(t)).frag.cloneNode(),o=0,s=c(),a=s.length;o<a;o++)n.createElement(s[o]);return n}};t.html5=m,d(e)}(this,e),o._version="2.6.2",o._domPrefixes=u,o._cssomPrefixes=c,s.className=s.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+" js "+d.join(" "),o}(this,this.document),function(t,e,i){function r(t){return"[object Function]"==y.call(t)}function n(t){return"string"==typeof t}function o(){}function s(t){return!t||"loaded"==t||"complete"==t||"uninitialized"==t}function a(){var t=_.shift();g=1,t?t.t?m((function(){("c"==t.t?p.injectCss:p.injectJs)(t.s,0,t.a,t.x,t.e,1)}),0):(t(),a()):g=0}function l(t,i,r,n,o,l,h){function c(e){if(!d&&s(u.readyState)&&(x.r=d=1,!g&&a(),u.onload=u.onreadystatechange=null,e))for(var r in"img"!=t&&m((function(){b.removeChild(u)}),50),T[i])T[i].hasOwnProperty(r)&&T[i][r].onload()}h=h||p.errorTimeout;var u=e.createElement(t),d=0,y=0,x={t:r,s:i,e:o,a:l,x:h};1===T[i]&&(y=1,T[i]=[]),"object"==t?u.data=i:(u.src=i,u.type=t),u.width=u.height="0",u.onerror=u.onload=u.onreadystatechange=function(){c.call(this,y)},_.splice(n,0,x),"img"!=t&&(y||2===T[i]?(b.insertBefore(u,v?null:f),m(c,h)):T[i].push(u))}function h(t,e,i,r,o){return g=0,e=e||"j",n(t)?l("c"==e?S:w,t,e,this.i++,i,r,o):(_.splice(this.i++,0,t),1==_.length&&a()),this}function c(){var t=p;return t.loader={load:h,i:0},t}var u,p,d=e.documentElement,m=t.setTimeout,f=e.getElementsByTagName("script")[0],y={}.toString,_=[],g=0,x="MozAppearance"in d.style,v=x&&!!e.createRange().compareNode,b=v?d:f.parentNode,w=(d=t.opera&&"[object Opera]"==y.call(t.opera),d=!!e.attachEvent&&!d,x?"object":d?"script":"img"),S=d?"script":w,C=Array.isArray||function(t){return"[object Array]"==y.call(t)},D=[],T={},A={timeout:function(t,e){return e.length&&(t.timeout=e[0]),t}};p=function(t){function e(t,e,i,n,o){var s=function(t){t=t.split("!");var e,i,r,n=D.length,o=t.pop(),s=t.length;for(o={url:o,origUrl:o,prefixes:t},i=0;i<s;i++)r=t[i].split("="),(e=A[r.shift()])&&(o=e(o,r));for(i=0;i<n;i++)o=D[i](o);return o}(t),a=s.autoCallback;s.url.split(".").pop().split("?").shift(),s.bypass||(e&&(e=r(e)?e:e[t]||e[n]||e[t.split("/").pop().split("?")[0]]),s.instead?s.instead(t,e,i,n,o):(T[s.url]?s.noexec=!0:T[s.url]=1,i.load(s.url,s.forceCSS||!s.forceJS&&"css"==s.url.split(".").pop().split("?").shift()?"c":undefined,s.noexec,s.attrs,s.timeout),(r(e)||r(a))&&i.load((function(){c(),e&&e(s.origUrl,o,n),a&&a(s.origUrl,o,n),T[s.url]=2}))))}function i(t,i){function s(t,o){if(t){if(n(t))o||(u=function(){var t=[].slice.call(arguments);p.apply(this,t),d()}),e(t,u,i,0,h);else if(Object(t)===t)for(l in a=function(){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i}(),t)t.hasOwnProperty(l)&&(!o&&! --a&&(r(u)?u=function(){var t=[].slice.call(arguments);p.apply(this,t),d()}:u[l]=function(t){return function(){var e=[].slice.call(arguments);t&&t.apply(this,e),d()}}(p[l])),e(t[l],u,i,l,h))}else!o&&d()}var a,l,h=!!t.test,c=t.load||t.both,u=t.callback||o,p=u,d=t.complete||o;s(h?t.yep:t.nope,!!c),c&&s(c)}var s,a,l=this.yepnope.loader;if(n(t))e(t,0,l,0);else if(C(t))for(s=0;s<t.length;s++)n(a=t[s])?e(a,0,l,0):C(a)?p(a):Object(a)===a&&i(a,l);else Object(t)===t&&i(t,l)},p.addPrefix=function(t,e){A[t]=e},p.addFilter=function(t){D.push(t)},p.errorTimeout=1e4,null==e.readyState&&e.addEventListener&&(e.readyState="loading",e.addEventListener("DOMContentLoaded",u=function(){e.removeEventListener("DOMContentLoaded",u,0),e.readyState="complete"},0)),t.yepnope=c(),t.yepnope.executeStack=a,t.yepnope.injectJs=function(t,i,r,n,l,h){var c,u,d=e.createElement("script");n=n||p.errorTimeout;for(u in d.src=t,r)d.setAttribute(u,r[u]);i=h?a:i||o,d.onreadystatechange=d.onload=function(){!c&&s(d.readyState)&&(c=1,i(),d.onload=d.onreadystatechange=null)},m((function(){c||(c=1,i(1))}),n),l?d.onload():f.parentNode.insertBefore(d,f)},t.yepnope.injectCss=function(t,i,r,n,s,l){var h;n=e.createElement("link"),i=l?a:i||o;for(h in n.href=t,n.rel="stylesheet",n.type="text/css",r)n.setAttribute(h,r[h]);s||(f.parentNode.insertBefore(n,f),m(i,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("cookies",(function(){if(navigator.cookieEnabled)return!0;document.cookie="cookietest=1";var t=-1!=document.cookie.indexOf("cookietest=");return document.cookie="cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT",t})),tagproConfig={},tagpro={version:"3.2.1",socket:null,players:null,chat:null,playerId:null,teamNames:null,score:null,state:null,sound:null,zoom:1,zooming:0,serverPort:null,serverHost:null,viewport:{followPlayer:!0,centerLock:!1,source:{x:0,y:0}},TILE_SIZE:40,kongregate:!1,states:{ACTIVE:1,ENDED:2,COUNTDOWN:3,INACTIVE:4,OVERTIME:5,EXITED:6},settings:{ui:{allChat:!0,teamChat:!0,groupChat:!0,systemChat:!0,tutorialChat:!1,spectatorInfo:!0,performanceInfo:!0,names:!0,teamNames:"always",degrees:!0,flairs:!0,matchState:!0}},keys:{left:[37,65,97],up:[38,87,119],right:[39,68,100],down:[40,83,115],space:[32],mark:[191],honk:[16],chatToTeam:[222,84],chatToGroup:[186,71,103],chatToAll:[13],chatAsMod:[77],chatAsMonitor:[219,160,82],sendChat:[13],cancelChat:[27],nickCompleteChat:[9],showOptions:[27],zoomOut:[173,189,109],zoomIn:[61,187,107],resetZoom:[90],centerZoom:[67],specNext:[81],specPrev:[87],specRedFC:[65],specBlueFC:[83],toggleAutoJoin:[32]},ping:{current:0,history:[],avg:0},host:document.location.host,gameEndsAt:null,disableControls:0,spectator:!1,spectators:0,spectatorGlobalSounds:[],movement:[],joinGame:function(t){location.href=t},api:{redrawBackground:function(){console.error("The redrawBackground function has been deprecated.")}},events:{register:function(t){for(var e in t)tagpro.events[e]||(tagpro.events[e]=[]),eventFunc={},eventFunc[e]=t[e],tagpro.events[e].push(eventFunc)}},resourcesLoaded:!1,_readyCallbacks:[],_afterReadyCallbacks:[],ready:function(t){tagpro.resourcesLoaded?t():tagpro._readyCallbacks.push(t)}},tagpro.ready.after=function(t){tagpro.resourcesLoaded?t():tagpro._afterReadyCallbacks.push(t)},$(document).ready((function(){var t=null;try{t=JSON.parse(localStorage.getItem("key_mapping"))}catch(t){console.log("KEY CONFIG ERROR:",t)}if(t){var e=function(e){return[t.primary[e],t.secondary[e]]};tagpro.keys.left=e("left"),tagpro.keys.right=e("right"),tagpro.keys.up=e("up"),tagpro.keys.down=e("down"),tagpro.keys.space=e("space"),tagpro.keys.mark=e("mark"),tagpro.keys.honk=e("honk");for(var i=["left","right","up","down","space","mark","honk"].map((function(t){return tagpro.keys[t]})).flat(),r=["chatToTeam","chatToGroup","chatToAll","sendChat","cancelChat","nickCompleteChat","showOptions"],n=0;n<r.length;n++)tagpro.keys[r[n]]=tagpro.keys[r[n]].filter((function(t){return!i.includes(t)}))}function o(t,e){var i=$.cookie(t);$.removeCookie(t);var r=null==$.cookie(t);(null==i||r)&&$.cookie(t,i||e,{expires:36500,path:"/",domain:tagproConfig.cookieHost})}if(tagproConfig.replay&&(tagpro.keys.left=[37],tagpro.keys.up=[38],tagpro.keys.right=[39],tagpro.keys.down=[40]),o("music","false"),o("sound","true"),o("disableParticles","false"),o("forceCanvasRenderer","false"),o("disableViewportScaling","true"),o("disableTutorialChat","false"),o("tileRespawnWarnings","blink"),o("disableNextPupIndicators","false"),o("indicatorAlpha",.35),o("disableShaders","false"),$(".js-copyright-date").text((new Date).getFullYear()),"/kongregate"!=window.location.pathname&&"/auth/link-accounts/close"!=window.location.pathname&&(tagpro.kongregate=!!$.cookie("kongregate"),!tagproConfig.isHomeServer&&window.self===window.top)){if($.removeCookie("kongregate",{domain:tagproConfig.cookieHost}),$.removeCookie("kongregate-username",{domain:tagproConfig.cookieHost}),$.removeCookie("kongregate-token",{domain:tagproConfig.cookieHost}),$.removeCookie("kongregate-userId",{domain:tagproConfig.cookieHost}),tagpro.kongregate)return document.location.href="/logout";tagpro.kongregate=!1}if("/kongregate"!=window.location.pathname&&tagpro.kongregate){var s=["tagpro.gg","koalabeast.com","localhost","jukejuice.com","127.0.0.1"];$("a").each((function(){var t=$(this),e=t.attr("href");if(e){e=e.toLowerCase();var i=!s.some((function(t){return e.indexOf(t)>-1}));i&&"http"!=e.substr(0,4)&&(i=!1),t.hasClass("ensureExternal")&&(i=!0),i&&t.attr("target","_parent")}}))}(function(){try{return window.self!==window.top}catch(t){return!0}})()&&$("#login-btn").attr("target","_blank"),$.when(window.textureLoaded||!0).then((()=>setTimeout((()=>{var t=$("#loadingMessage"),e=$("#assets img"),i=0;e.each((function(){$(this).prop("crossOrigin","Anonymous").attr("src",$(this).attr("src"))})),setTimeout((function(){tagpro.resourcesLoaded||e.not("[data-load]").each((function(){t.append($("<div></div>").css({"font-weight":"normal","font-size":"50%"}).text($(this).attr("id")+"..."))}))}),1e4);var r=function(){e.each((function(){var t=$(this)[0];t.loaded||t.complete&&t.naturalWidth>0&&(t.loaded=!0,i++)})),i<e.length?setTimeout(r,0):(tagpro.resourcesLoaded=!0,tagpro._readyCallbacks.forEach((function(t){t()})),tagpro._readyCallbacks=[],tagpro._afterReadyCallbacks.forEach((function(t){t()})),tagpro._afterReadyCallbacks=[])};r()}),0))),$(".header .nav .group-indicator, .header .nav .stream-indicator, .signup-indicator").bind("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",(function(){this.classList.remove("js-animate"),this.offsetWidth=this.offsetWidth,this.classList.add("js-animate")})).addClass("js-animate"),$(".header .nav .mobile-menu-toggle").click((function(){$(".header .nav").toggleClass("mobile-expanded").find("li").slideToggle()})),window.onerror=function(){$(".js-console-error").length||(message="We are seeing some odd errors. This could have something to do with your TagPro addons and scripts. You might need to disable them until they are updated by the author.",tagpro.helpers.displayError(message).find(".msg").addClass("js-console-error"))}})),$(document).keydown((function(t){if(8==t.keyCode){var e=t.target.nodeName.toLowerCase();"input"!=e&&"textarea"!=e&&t.preventDefault()}})),tagpro.helpers={pad:function(t,e){t=t.toString();var i=(e=e.toString())+t,r=e.length>t.length?e.length:t.length;return i.substr(i.length-r)},timeFromSeconds:function(t,e){null==e&&(e=!1);var i=tagpro.helpers.pad;t=parseFloat(t);var r=parseInt(t/3600),n=t%60,o=i(parseInt(t/60)%60,"00")+":"+i(n,"00");return(!e||r>0)&&(o=i(r,"00")+":"+o),o},rebaseToCDN:function(t){return"/"==t.charAt(0)&&"/"!=t.charAt(1)?"//"+tagproConfig.cdn+t:t},displayError:function(t){var e=$("<div></div>").addClass("col-md-8 col-md-offset-2"),i=$("<div></div>").addClass("msg msg-warning").css("margin-bottom",20);return i.text(t),e.append(i),$("body:not(.game-page) > .container > .row").first().prepend(e),e}},$(window).on("load",restoreFocus()),$(document).ready((function(){$(document).find("#viewport").click((function(){setTimeout(restoreFocus(),100)}))})),tagpro.sendPingStatistics=function(){},function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?t(require("jquery")):t(jQuery)}((function(t){var e=/\+/g;function i(t){return o.raw?t:encodeURIComponent(t)}function r(t){return i(o.json?JSON.stringify(t):String(t))}function n(i,r){var n=o.raw?i:function(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(e," ")),o.json?JSON.parse(t):t}catch(t){}}(i);return t.isFunction(r)?r(n):n}var o=t.cookie=function(e,s,a){if(arguments.length>1&&!t.isFunction(s)){if("number"==typeof(a=t.extend({},o.defaults,a)).expires){var l=a.expires,h=a.expires=new Date;h.setTime(+h+864e5*l)}return document.cookie=[i(e),"=",r(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}for(var c,u=e?void 0:{},p=document.cookie?document.cookie.split("; "):[],d=0,m=p.length;d<m;d++){var f=p[d].split("="),y=(c=f.shift(),o.raw?c:decodeURIComponent(c)),_=f.join("=");if(e&&e===y){u=n(_,s);break}e||void 0===(_=n(_))||(u[y]=_)}return u};o.defaults={},t.removeCookie=function(e,i){return void 0!==t.cookie(e)&&(t.cookie(e,"",t.extend({},i,{expires:-1})),!t.cookie(e))}})),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(t){"use strict";var e=jQuery.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||e[0]>2)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 3")}(),function(t){"use strict";function e(e,r){return this.each((function(){var n=t(this),o=n.data("bs.modal"),s=t.extend({},i.DEFAULTS,n.data(),"object"==typeof e&&e);o||n.data("bs.modal",o=new i(this,s)),"string"==typeof e?o[e](r):s.show&&o.show(r)}))}var i=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy((function(){this.$element.trigger("loaded.bs.modal")}),this))};i.VERSION="3.3.6",i.TRANSITION_DURATION=300,i.BACKDROP_TRANSITION_DURATION=150,i.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},i.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},i.prototype.show=function(e){var r=this,n=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",(function(){r.$element.one("mouseup.dismiss.bs.modal",(function(e){t(e.target).is(r.$element)&&(r.ignoreBackdropClick=!0)}))})),this.backdrop((function(){var n=t.support.transition&&r.$element.hasClass("fade");r.$element.parent().length||r.$element.appendTo(r.$body),r.$element.show().scrollTop(0),r.adjustDialog(),n&&r.$element[0].offsetWidth,r.$element.addClass("in"),r.enforceFocus();var o=t.Event("shown.bs.modal",{relatedTarget:e});n?r.$dialog.one("bsTransitionEnd",(function(){r.$element.trigger("focus").trigger(o)})).emulateTransitionEnd(i.TRANSITION_DURATION):r.$element.trigger("focus").trigger(o)})))},i.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(i.TRANSITION_DURATION):this.hideModal())},i.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy((function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")}),this))},i.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy((function(t){27==t.which&&this.hide()}),this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},i.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},i.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop((function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")}))},i.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},i.prototype.backdrop=function(e){var r=this,n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=t.support.transition&&n;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+n).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy((function(t){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))}),this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;o?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){r.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(i.BACKDROP_TRANSITION_DURATION):s()}else e&&e()},i.prototype.handleUpdate=function(){this.adjustDialog()},i.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},i.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},i.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},i.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},i.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},i.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var r=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=i,t.fn.modal.noConflict=function(){return t.fn.modal=r,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',(function(i){var r=t(this),n=r.attr("href"),o=t(r.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),s=o.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(n)&&n},o.data(),r.data());r.is("a")&&i.preventDefault(),o.one("show.bs.modal",(function(t){t.isDefaultPrevented()||o.one("hidden.bs.modal",(function(){r.is(":visible")&&r.trigger("focus")}))})),e.call(o,s,this)}))}(jQuery),$(document).ready((function(){window.EventSource&&(0!==$("#flair-log").length&&new window.EventSource("/flairlog").addEventListener("flair",(function(t){var e=JSON.parse(t.data),i="special"===e.type?"received":"earned",r=$("#flair-log");if(!r.find("#"+e.id).length){var n=e.flairs.map((function(t){return"<span class='flair "+t.className+"' style='background-position: "+t.x+"px "+t.y+"px;'></span>"})).join(""),o="<div class='flair-log-entry' id='"+e.id+"'><a href='/profile/"+e.user+"'>"+(e.username.replace(/./gm,(function(t){return t.match(/[a-z0-9\s]+/i)?t:"&#"+t.charCodeAt(0)+";"}))+"</a> has ")+i+" "+n+" for "+e.reason+"</div>";$entries=r.find(".flair-log-entry"),$entries.length>=3?$entries.last().fadeOut("slow",(function(){$(this).remove(),$(o).hide().prependTo(r).fadeIn("slow")})):$(o).hide().prependTo(r).fadeIn("slow")}})))}));var Stats=function(){var t=Date.now(),e=t,i=0,r=1/0,n=0,o=0,s=1/0,a=0,l=0,h=0,c=document.createElement("div");c.id="stats",c.addEventListener("mousedown",(function(t){t.preventDefault(),g(++h%2)}),!1),c.style.cssText="width:80px;opacity:0.9;cursor:pointer";var u=document.createElement("div");u.id="fps",u.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",c.appendChild(u);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",p.innerHTML="FPS",u.appendChild(p);var d=document.createElement("div");for(d.id="fpsGraph",d.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",u.appendChild(d);74>d.children.length;){var m=document.createElement("span");m.style.cssText="width:1px;height:30px;float:left;background-color:#113",d.appendChild(m)}var f=document.createElement("div");f.id="ms",f.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",c.appendChild(f);var y=document.createElement("div");y.id="msText",y.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",y.innerHTML="MS",f.appendChild(y);var _=document.createElement("div");for(_.id="msGraph",_.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",f.appendChild(_);74>_.children.length;)(m=document.createElement("span")).style.cssText="width:1px;height:30px;float:left;background-color:#131",_.appendChild(m);var g=function(t){switch(h=t){case 0:u.style.display="block",f.style.display="none";break;case 1:u.style.display="none",f.style.display="block"}};return{REVISION:12,domElement:c,setMode:g,begin:function(){t=Date.now()},end:function(){var h=Date.now();i=h-t,r=Math.min(r,i),n=Math.max(n,i),y.textContent=i+" MS ("+r+"-"+n+")";var c=Math.min(30,30-i/200*30);return _.appendChild(_.firstChild).style.height=c+"px",l++,h>e+1e3&&(o=Math.round(1e3*l/(h-e)),s=Math.min(s,o),a=Math.max(a,o),p.textContent=o+" FPS ("+s+"-"+a+")",c=Math.min(30,30-o/100*30),d.appendChild(d.firstChild).style.height=c+"px",e=h,l=0),h},update:function(){t=this.end()}}};"object"==typeof module&&(module.exports=Stats),$(document).ready((function(){$("html").hasClass("no-cookies")&&(location.href="/cookies")}));var Sprite=function(t,e,i,r){var n={};this.createAnimation=function(t,e,i){return n[t]=new Sprite.Animation(e,i),n[t]},this.createInstance=function(o){return{start:(new Date).getTime(),animation:o,draw:function(i,r,o){var s=n[this.animation],a=Math.floor(((new Date).getTime()-this.start)%(s.frames.length*s.time)/s.time);i.drawImage(t,40*s.frames[a],40*s.y,e,e,r,o,e,e)},drawFloor:i||!1,redrawFloor:r||!1}}};Sprite.Animation=function(t,e){this.y=t,this.time=e,this.frames=[],this.createFrame=function(t){this.frames.push(t)}},$(document).ready((function(){tagpro.oldPingTest={showAll:!0},tagpro.oldPingTest.run=function(t){var e=$("a.js-server"),i=0,r=function(){++i>=e.length&&t&&t()};e.each((function(){var t=$(this),i=io.connect("ws://"+t.attr("data-host")+":80",{transports:["websocket"]}),n=setTimeout((function(){t.find(".stats").text("error getting stats.").end(),tagpro.pingTest.showAll&&t.removeClass("js-hide"),r()}),5e3);i.on("connect",(function(){var o=(new Date).getTime();i.emit("stats",{},(function(i){i.ping=(new Date).getTime()-o,clearTimeout(n),t.attr("data-ping",i.ping).find(".stats").text("Ping: "+i.ping+", Players: "+i.players+(i.playerCapacity?"/"+i.playerCapacity:"")),tagpro.pingTest.showAll||e.addClass("js-hide"),$("a.js-server").not(t).each((function(e){var r=$(this);if(tagpro.pingTest.showAll&&t.removeClass("js-hide"),i.ping<parseInt(r.attr("data-ping")))return t.insertBefore(r),!1})),tagpro.pingTest.showAll||$("a.js-server").eq(0).removeClass("js-hide"),r()}))}))}))},tagpro.pingTest={showAll:!0},tagpro.pingTest.run=function(t){var e=tagpro.pingTestServers,i=[],r=function(r,n){i.push({id:r.id,ping:n}),i.length===e.length&&(i=i.sort((function(t,e){return t.ping-e.ping})),t(i))};e.forEach((function(t){var e=io.connect(t.host,{transports:["websocket"]});e.on("connect_error",(function(){r(t,9999)})),e.on("connect",(function(){var i=Date.now(),n=9999,o=0,s=function(){0===++o&&(e.disconnect(),r(t,n))},a=function(){o--;var t=setTimeout(s,5e3);e.emit("pingg",{},(function(e){clearTimeout(t);var r=Date.now()-i+10*Math.random();n=Math.min(n,r),s()}))};a(),a(),a()}))}))}})),function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EventEmitter3=t()}((function(){return function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[s]={exports:{}};e[s][0].call(c.exports,(function(t){return n(e[s][1][t]||t)}),c,c.exports,t,e,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e,i){"use strict";var r=Object.prototype.hasOwnProperty,n="~";function o(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function a(t,e,i,r,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new s(i,r||t,o),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function l(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function h(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),h.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)r.call(t,e)&&i.push(n?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},h.prototype.listeners=function(t){var e=n?n+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,s=new Array(o);r<o;r++)s[r]=i[r].fn;return s},h.prototype.listenerCount=function(t){var e=n?n+t:t,i=this._events[e];return i?i.fn?1:i.length:0},h.prototype.emit=function(t,e,i,r,o,s){var a=n?n+t:t;if(!this._events[a])return!1;var l,h=this._events[a],c=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),c){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,i),!0;case 4:return h.fn.call(h.context,e,i,r),!0;case 5:return h.fn.call(h.context,e,i,r,o),!0;case 6:return h.fn.call(h.context,e,i,r,o,s),!0}for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];h.fn.apply(h.context,l)}else for(var u,p=h.length,d=0;d<p;d++)switch(h[d].once&&this.removeListener(t,h[d].fn,void 0,!0),c){case 1:h[d].fn.call(h[d].context);break;case 2:h[d].fn.call(h[d].context,e);break;case 3:h[d].fn.call(h[d].context,e,i);break;case 4:h[d].fn.call(h[d].context,e,i,r);break;default:if(!l)for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];h[d].fn.apply(h[d].context,l)}return!0},h.prototype.on=function(t,e,i){return a(this,t,e,i,!1)},h.prototype.once=function(t,e,i){return a(this,t,e,i,!0)},h.prototype.removeListener=function(t,e,i,r){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return l(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||r&&!s.once||i&&s.context!==i||l(this,o);else{for(var a=0,h=[],c=s.length;a<c;a++)(s[a].fn!==e||r&&!s[a].once||i&&s[a].context!==i)&&h.push(s[a]);h.length?this._events[o]=1===h.length?h[0]:h:l(this,o)}return this},h.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&l(this,e)):(this._events=new o,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=n,h.EventEmitter=h,void 0!==e&&(e.exports=h)},{}]},{},[1])(1)})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).idb={})}(this,(function(t){"use strict";let e,i;const r=new WeakMap,n=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap;let l={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return n.get(t);if("objectStoreNames"===e)return t.objectStoreNames||o.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return u(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function h(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),u(r.get(this))}:function(...e){return u(t.apply(p(this),e))}:function(e,...i){const r=t.call(p(this),e,...i);return o.set(r,e.sort?e.sort():[e]),u(r)}}function c(t){return"function"==typeof t?h(t):(t instanceof IDBTransaction&&function(t){if(n.has(t))return;const e=new Promise(((e,i)=>{const r=()=>{t.removeEventListener("complete",n),t.removeEventListener("error",o),t.removeEventListener("abort",o)},n=()=>{e(),r()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",n),t.addEventListener("error",o),t.addEventListener("abort",o)}));n.set(t,e)}(t),i=t,(e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>i instanceof t))?new Proxy(t,l):t);var i}function u(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,i)=>{const r=()=>{t.removeEventListener("success",n),t.removeEventListener("error",o)},n=()=>{e(u(t.result)),r()},o=()=>{i(t.error),r()};t.addEventListener("success",n),t.addEventListener("error",o)}));return e.then((e=>{e instanceof IDBCursor&&r.set(e,t)})).catch((()=>{})),a.set(e,t),e}(t);if(s.has(t))return s.get(t);const e=c(t);return e!==t&&(s.set(t,e),a.set(e,t)),e}const p=t=>a.get(t),d=["get","getKey","getAll","getAllKeys","count"],m=["put","add","delete","clear"],f=new Map;function y(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(f.get(e))return f.get(e);const i=e.replace(/FromIndex$/,""),r=e!==i,n=m.includes(i);if(!(i in(r?IDBIndex:IDBObjectStore).prototype)||!n&&!d.includes(i))return;const o=async function(t,...e){const o=this.transaction(t,n?"readwrite":"readonly");let s=o.store;return r&&(s=s.index(e.shift())),(await Promise.all([s[i](...e),n&&o.done]))[0]};return f.set(e,o),o}l=(t=>({...t,get:(e,i,r)=>y(e,i)||t.get(e,i,r),has:(e,i)=>!!y(e,i)||t.has(e,i)}))(l),t.deleteDB=function(t,{blocked:e}={}){const i=indexedDB.deleteDatabase(t);return e&&i.addEventListener("blocked",(t=>e(t.oldVersion,t))),u(i).then((()=>{}))},t.openDB=function(t,e,{blocked:i,upgrade:r,blocking:n,terminated:o}={}){const s=indexedDB.open(t,e),a=u(s);return r&&s.addEventListener("upgradeneeded",(t=>{r(u(s.result),t.oldVersion,t.newVersion,u(s.transaction),t)})),i&&s.addEventListener("blocked",(t=>i(t.oldVersion,t.newVersion,t))),a.then((t=>{o&&t.addEventListener("close",(()=>o())),n&&t.addEventListener("versionchange",(t=>n(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a},t.unwrap=p,t.wrap=u}));class EventedWorker extends Worker{events;constructor(t){super(t),this.events=new EventEmitter3,this.addEventListener("message",(t=>{const[e,...i]=t.data;this.events.emit(e,...i)}))}on(t,e){this.events.on(t,e)}emit(t,e){this.postMessage([t,e])}}class BackgroundPlayer extends EventEmitter3{worker;seeking=!1;constructor(t){super(),this.worker=new EventedWorker(t),this.worker.on("packet",((t,e,...i)=>{this.seeking&&this.emit("replayTime",{time:t}),this.emit(e,...i)})),this.worker.on("end",(()=>this.emit("replayEnd"))),this.worker.on("seekFinished",(t=>{this.emit("replaySeekFinished",{to:t}),this.seeking=!1}))}load(t){this.worker.emit("load",t)}play(){this.worker.emit("play")}seek(t){this.seeking=!0,this.worker.emit("seek",t)}pause(){this.worker.emit("pause")}}class PacketDataPlayer{packets;callback;seekCallback;doneCallback;currentIndex;currentTime=0;paused=!1;pauseControl;startedAt;constructor(t,e,i,r){this.packets=t,this.callback=e,this.seekCallback=i,this.doneCallback=r||(()=>{}),this.currentIndex=0,this.pauseControl={pause:!1}}seek(t){const e={ts:0,time:0,state:0};for(let i=0;i<this.packets.length;i++){const r=this.packets[i],n=this.packets[i+1];if("time"===r[1]&&(e.ts=r[0],e.time=r[2].time,e.state=r[2].state),this.callback(r[0],r[1],r[2]),n&&n[0]>t){const t=r[0]-e.ts,n=5===e.state?e.time+t:e.time-t;this.callback(r[0],"time",{time:n,state:e.state}),this.currentTime=r[0],this.startedAt=performance.now()-this.currentTime,this.currentIndex=i+1;break}}this.seekCallback(this.currentTime)}async play(){this.paused?(this.paused=!1,this.startedAt=performance.now()-this.currentTime):this.startedAt=performance.now();const t=this.pauseControl;for(;;){const e=this.packets[this.currentIndex];if(!e){this.pause(),this.doneCallback();break}this.currentTime=performance.now()-this.startedAt;const i=e[0]-this.currentTime;if(i>0&&await new Promise((t=>setTimeout(t,i))),t.pause)break;this.callback(e[0],e[1],e[2]),this.currentIndex++}}pause(){this.paused=!0,this.pauseControl.pause=!0,this.pauseControl={pause:!1}}}class FakeSocket{player;constructor(t){this.player=t}on(t,e){this.player.on(t,e)}once(t,e){this.player.once(t,e)}emit(t,e){}listeners(t){return this.player.listeners(t)}prependListener(t,e){this.listeners(t).unshift(e)}removeListener(t,e){this.player.removeListener(t,e)}get io(){return{engine:{transport:{polling:!1}}}}}const replayIO={tagpro:{},socket:null,name:"",parseRecording(t){let e=t.split("\n").filter((t=>t.trim().length>0)).map((t=>JSON.parse(t)));e.forEach((t=>{if(!(Array.isArray(t)&&Number.isInteger(t[0])&&t[1].match(/^[a-z]/i)))throw 1}));for(let t=0;t<e.length-1;t++){let i=e[t][0];e[t+1][0]-i>1e3&&e.splice(t+1,0,[i+1e3,"no-op"])}let i={packets:e},r=e.findIndex((t=>"end"===t[1])),n=e[r]||e[e.length-1];if(i.firstTimePacket=e.find((t=>"time"===t[1])),i.startPacket=e.find((t=>"time"===t[1]&&t[2].state===tagpro.states.ACTIVE)),i.overtimePacket=e.find((t=>"time"===t[1]&&t[2].state===tagpro.states.OVERTIME)),!i.firstTimePacket)throw 1;i.initialState=i.firstTimePacket[2].state,i.minTS=i.firstTimePacket[0],i.maxTS=n[0],i.maxTSSeek=i.maxTS-i.maxTS%1e3,replayIO.tagpro.replayData=i},parseTimeline(){let t=replayIO.tagpro.replayData.packets,e=[],i={team1:[],team2:[],modevents:[]};t.forEach((t=>{let r=t[0],n=t[1],o=t[2];if("p"===n){o=o.u||o;for(const t of o){let n=t.id;e[n]||(e[n]=Object.assign({},t),i[n]=[],i[n].push([r,"joined"]));for(const[o,s]of Object.entries(t)){if(["name","auth","team"].includes(o)){if(s===e[n][o])continue;i[n].push([r,o,s])}if(o.startsWith("s-")||(e[n][o]=s),["s-captures","s-tags","s-grabs","s-drops","s-pops","s-powerups"].includes(o)){if(0===s)continue;if(s===e[n][o])continue;if(i[n].push([r,o]),"s-captures"===o){let t=e[n].team;i["team"+t].push([r,o])}e[n][o]=s}}}}else"playerLeft"===n?i[o].push([r,"left"]):"mark"===n?i[o].push([r,"s-marks"]):"modevent"===n&&i.modevents.push([r,o])})),replayIO.tagpro.replayData.timeline=i},injectEventAssets(){let t=replayIO.tagpro.replayData.packets.find((t=>"clientInfo"===t[1])),e=t&&t[2];if(!e)return;const i=t=>`//${tagproConfig.cdn}${tagproConfig.cacheBuster}${t}`;for(const t of e.eventScripts||[])$.getScript(i(t));for(const t of e.eventGraphics||[]){let e=t.id,r=t.src,n=$("<img>").addClass("asset").attr("id",e).attr("src",r.includes(":")?r:i(r));$("#assets").append(n)}for(const[t,r]of Object.entries(e.eventTextures||{})){$("#assets").find(`#${t}`).attr("src",i(r));let e=$("<img>").addClass("asset").attr("id",t).attr("src",i(r)).attr("data-event-asset","true");$("#assets").append(e)}for(const t of e.eventSounds||[]){let e=t.id,r=t.src,n=$("<audio></audio>").attr("id",e).attr("preload","auto");for(const t of["mp3","m4a","ogg"]){let e=$("<source>").attr("src",i(`${r}.${t}`)).attr("type",`audio/${t}`);n.append(e)}$("#assets").find(`#${e}`).remove(),$("#assets").append(n)}Array.isArray(e.eventMusic)&&e.eventMusic.length&&(tagproConfig.eventMusic=e.eventMusic),e.eventSplats&&$("#splats").attr("src",i(e.eventSplats))},async init(){if(!tagproConfig.replay)return void replayLoaded.resolve();try{localStorage.removeItem("recording"),localStorage.removeItem("recordingName"),localStorage.removeItem("recordingKey")}catch(t){}const t="active-replay",e="active-replay";let i=await idb.openDB("tagpro-game-history",1,{upgrade:e=>e.createObjectStore(t)}),r=await i.get(t,e),n=r?.key;if(tagproConfig.replayKey!==n){if("upload"===tagproConfig.replayKey)return alert("You haven't uploaded a game file. Please return to the Game History page and click Upload."),void window.close();try{let n="/history/gameFile?key="+tagproConfig.replayKey,o=await fetch(n);if(!o.ok){let t="Failed to download game file: "+(o.headers.get("X-Replay-Error")||[o.status,o.statusText].join(" "));return alert(t),void window.close()}let s=o.headers.get("X-Replay-Filename");r={recording:await o.text(),name:s,key:tagproConfig.replayKey},await i.put(t,r,e)}catch(t){return alert("Unable to download game file. Error: "+t+"\n\nPlease wait a few minutes and try again. If this error persists, contact us on Discord or Reddit for assistance."),void window.close()}}replayIO.tagpro.replayPlayer=new BackgroundPlayer("/game/replayWorker.js"),replayIO.socket=new FakeSocket(replayIO.tagpro.replayPlayer),replayIO.name=r.name;let o=r.recording;await i.close();try{replayIO.parseRecording(o),replayIO.parseTimeline(),replayIO.injectEventAssets()}catch(t){return alert("This file does not appear to contain a valid recording."),void window.close()}replayLoaded.resolve()},connect:()=>(Object.assign(tagpro,replayIO.tagpro),$("#gameSocket").text(replayIO.name),tagpro.replayPlayer.load(tagpro.replayData.packets),tagpro.replayPlayer.play(),replayIO.socket)};window.replayIO=replayIO,window.replayLoaded=$.Deferred(),$(document).ready((()=>replayIO.init())),tagpro.createSocket=function(){tagproConfig.replay&&(window.io=window.replayIO);var t=io.connect(tagproConfig.gameSocket||document.location.href+"?r="+Math.round(1e7*Math.random()),{reconnect:!1,transports:["websocket"]});tagpro.rawSocket=t;var e=t.emit.bind(t);return t.emit=function(t,i){"p"===t&&void 0===i.id&&(i.c*=Math.round(1.2+(new Date).getUTCDay())),e(t,i)},{on:function(e,i){var r=function(){try{i.apply(this,arguments)}catch(i){console.error("Unhandled socket.io on() error. Mod makers, handle your errors!"),console.error(i),t.removeListener(e,r)}};t.on(e,r)},once:function(e,i){t.once(e,i)},emit:function(e,i){t.emit(e,i)}}},tagpro.createJoinerSocket=function(t){!0!==t&&(t=!1),tagpro.group&&tagpro.group.socket&&(tagpro.group.socket.playerLocation="joining");var e,i=Math.round(1e7*Math.random()),r=io.connect("/games/find",{transports:["websocket"],query:{r:i}}),n=[];tagpro.rawJoinerSocket=r,$("#settings .btn.js-send-settings").click((function(){regions=tagpro.helpers.getRegions(),r.connected||($("#message").text("Connecting"),$("#subMessage").text(""),clearTimeout(e),r.connect()),tagpro.helpers.saveRegions(),r.emit("settings",{regions:regions,gameModes:[]})})),$("#settings .btn.js-mod-spectate").click((function(){tagpro.disconnectJoinerSocket(),tagpro.socket.emit("modSpectate")})),r.on("ready",(function(){$("#spinner").show(),regions=tagpro.helpers.getRegions(),r.emit("settings",{regions:regions,gameModes:[]}),r.emit("spectate",t)})),r.on("settings",(function(t,e,i){tagpro.helpers.setAllRegions(!1),t.regions.forEach((function(t){tagpro.helpers.setRegion(t,!0)})),e&&($("#settings .title").text("Group's Settings"),$("#settings .js-send-settings").hide(),$("#settings .js-region-cookie").prop("disabled",!0),$("#settings .js-region-cookie").prop("indeterminate",!0),$("#region_auto").parent().hide()),e||($("#region_auto").parent().show(),$("#settings .js-region-cookie").prop("indeterminate",!1),$("#settings .js-region-cookie").prop("disabled",!1),$("#settings .js-send-settings").show(),$("#settings .title").text("Settings")),$("#settings").show(),$("#joiner").show()})),r.on("ServerList",(function(t){tagpro.pingTestServers=t,tagpro.pingTest.showAll=!1,tagpro.pingTest.run((function(t){n=t,r&&r.connected&&r.emit("pings",n)}))})),r.on("WaitingForMembers",(function(t){var e=Math.round(t/1e3);$("#message").text("Waiting on your group "+e)})),r.on("TrollControl",(function(t){var e=Math.round(t/1e3);$("#message").text("Your ip has been flagged, waiting "+e),$("#flagged").show()})),r.on("WaitForEligibility",(function(t){var e=Math.round(t/1e3);$("#message").text("Waiting for game eligibility "+e)})),r.on("CreatingWorld",(function(){$("#message").text("Creating a new game")})),r.on("Full",(function(t){if(t.considering)return $("#message").text("Considering Servers:"),void $("#subMessage").html(t.considering.join("<br />"));$("#message").text("Wow! All games are full. Waiting")})),r.on("Disabled",(function(){$("#message").html("Sorry, this is a map testing server. <br> Joining is disabled."),$(".spinner").addClass("disable")})),r.on("VPN",(function(){document.location.href="/vpn"})),r.on("Banned",(function(){document.location.href="/banned"})),r.on("FoundWorld",(function(e){r.disconnect(),timeout=1e3,t||(timeout=0),e.spectate?$("#message").text("Spectating game"):$("#message").text("Joining game"),tagpro.joinGameTimer=setTimeout((function(){tagproConfig&&tagproConfig.gameServer===e.s&&tagproConfig.gameId===e.g&&!1===e.spectate||(document.location.href=e.url)}),timeout)})),r.on("SendToPage",(function(t){r.disconnect(),timeout=1e3,t.reason?$("#message").text(t.reason):$("#message").text("A problem occurred"),tagpro.joinGameTimer=setTimeout((function(){document.location.href=t.url}),timeout)})),r.on("GroupLeaderNotInTheJoiner",(function(t){r.disconnect(),$("#message").text("The Group Leader is not in the joiner. Back to group"),setTimeout((function(){document.location.href="/groups/"+t.groupId}),2e3)})),r.on("disconnect",(function(){$("#spinner").hide(),e=setTimeout((function(){$("#message").text("Lost connection")}),5e3)}))},tagpro.disconnectJoinerSocket=function(){tagpro.joinGameTimer&&clearTimeout(tagpro.joinGameTimer),tagpro.rawJoinerSocket&&(tagpro.rawJoinerSocket.removeAllListeners("disconnect"),tagpro.rawJoinerSocket.disconnect()),$("#joiner").hide()},tagpro.group={socket:null},$(document).ready((function(){var t=$("#groupId").val();if(t&&"null"!=t){var e=io.connect("/groups/"+t,{transports:["websocket"],query:{r:Math.floor(1e6*Math.random())}});e.playerLocation=null,tagpro.group.socket=e,setTimeout((function t(){setTimeout(t,3e4),e.connected&&e.emit("touch",e.playerLocation)}),3e3)}})),$(document).ready((()=>{if(!tagproConfig.replay)return;const _setTimeout=window.setTimeout,_clearTimeout=window.clearTimeout;class PauseableTimer{onExecute;handler;remaining;args;start;originalId;timerId;constructor(t,e,i,...r){this.onExecute=t,this.handler=e,this.remaining=i,this.args=r,this.resume()}pause(){_clearTimeout(this.timerId),this.timerId=null,this.remaining-=Date.now()-this.start}resume(){const handler=()=>{this.handler instanceof Function?this.handler(...this.args):eval(this.handler),this.onExecute(this)};this.start=Date.now(),this.timerId&&_clearTimeout(this.timerId),this.timerId=_setTimeout(handler.bind(this),this.remaining),this.originalId??=this.timerId}shift(t){this.pause(),this.remaining=t<0?0:Math.max(this.remaining-t,0),this.resume()}}let timers={},timeBase=0;window.setTimeout=(t,e,...i)=>{if((e||0)<=10)return _setTimeout(t,e,...i);{const r=new PauseableTimer((t=>delete timers[t.originalId]),t,e+timeBase,...i),n=r.timerId;return timers[n]=r,n}},window.clearTimeout=t=>{if(t&&t in timers){const e=timers[t].timerId;e&&_clearTimeout(e),delete timers[t]}else _clearTimeout(t)},tagpro.pauseableTimeouts={pauseAll:()=>Object.values(timers).forEach((t=>t.pause())),resumeAll:()=>Object.values(timers).forEach((t=>t.resume())),shiftAll:t=>Object.values(timers).forEach((e=>e.shift(t))),setBase:t=>timeBase=t}})),tagpro.ready((function(){var t,e,r=tagpro.createSocket(),n={},o={},s=null,a=null,h=1;function c(){var t=document.getElementById("viewport"),e=40*tagpro.map.length/t.width,i=40*tagpro.map[0].length/t.height;tagpro.zoom=Math.max(e,i)}function u(t,e,i){var r=Math.abs(i);(null==t.lastSync[e]||r>t.lastSync[e])&&(t[e]=i>0,t.lastSync[e]=r,n[a]===t&&r>_&&(_=r))}function p(t){for(baseMap=[],subMap=[],i=0;i<t.length;i++)for(baseMap[i]=[],subMap[i]=[],j=0;j<t[0].length;j++)baseMap[i][j]=e(t[i][j]),subMap[i][j]=[];for(i=0;i<=t.length;i++)for(j=0;j<=t[0].length;j++)n(i,j);return subMap;function e(t){var e=[3,0,4,2];if("1"==t)return[1,1,1,1];if("1"==Math.floor(t)){for(offset=Number((t+"").substr(-1))-1;offset>0;offset--)e.unshift(e.pop());return e}return[0,0,0,0]}function r(t,e,i){subMap[t]&&(subMap[t][e]&&(subMap[t][e][0]=i[0]),subMap[t][e-1]&&(subMap[t][e-1][3]=i[3])),subMap[t-1]&&(subMap[t-1][e]&&(subMap[t-1][e][1]=i[1]),subMap[t-1][e-1]&&(subMap[t-1][e-1][2]=i[2]))}function n(t,e){var i=function(t,e){return quadArray=[0,0,0,0],baseMap[t]&&(baseMap[t][e]&&(quadArray[0]=baseMap[t][e][0]),baseMap[t][e-1]&&(quadArray[3]=baseMap[t][e-1][3])),baseMap[t-1]&&(baseMap[t-1][e]&&(quadArray[1]=baseMap[t-1][e][1]),baseMap[t-1][e-1]&&(quadArray[2]=baseMap[t-1][e-1][2])),quadArray}(t,e),n=0,o=[],s=!(1!=i[3]&&2!=i[3]&&3!=i[3]||1!=i[0]&&2!=i[0]&&4!=i[0]),a=s;if(i[0]+i[1]+i[2]+i[3]==0)return r(t,e,i);if(!(1!=i[0]&&2!=i[0]||1!=i[1]&&2!=i[1]||1!=i[2]&&2!=i[2]||1!=i[3]&&2!=i[3])){for(k=0;k<4;k++){var h=2==i[k]?"d":"";i[k]="1."+(k+1)+"00"+h}return r(t,e,i)}for(k=0;k<4;k++){var c=i[k];0==c?m(!s,2):1==c||2==c?m(s,2):3==c?(m(!s,1),m(s,1)):4==c&&(m(s,1),m(!s,1))}for(a?o.push(o.shift()):s&&o.push(0),k=0;k<o.length;k+=2)for(l=0;l<4;l++){var u=(o[k]+6*l)%8,p=(o[k+1]+6*l)%8;if(u<p&&(u<2||2==p||1==p)||u>p&&(p>0||u<2)){var d=2==i[l]?"d":"";i[l]="1."+(l+1)+o[k]+o[k+1]+d}}function m(t,e){t||(o.push(n),s=!s),n+=e}r(t,e,i)}}function d(t,e,i,r){if(i){var n=t.volume+e;return n>1&&(n=1),n<0&&(n=0),t.volume=n,void(t.rampTimeout=setTimeout((function(){d(t,e,i-1,r)}),10))}r&&r()}tagpro.socket=r,tagpro.mapTestingServer=!1,tagpro.joinerSocket=null,tagpro.teamNames={},tagpro.players=n,tagpro.objects=o,tagpro.chat={},tagpro.playerId=null,tagpro.personalMutes={},tagpro.score={},tagpro.state=1,tagpro.sendKeyPress=g,tagpro.group.socket&&(tagpro.group.socket.playerLocation="game"),r.on("id",(function(t){a=t,tagpro.playerId=a,tagpro.viewport.centerLock||(tagpro.viewport.followPlayer=!0)})),r.on("mapTestingServer",(function(t){t.mapTestingServer&&(tagpro.mapTestingServer=!0)})),window.addEventListener("focus",(function(){t&&(clearInterval(t),t=null,document.title=e)})),r.on("settings",(function(t){tagpro.settings=t,r.emit("loaded",{container:window.self!=window.top})})),r.on("tips",(function(t){t=!!t,$("#tutorialButton").text(t?"Disable Tips":"Enable Tips")})),r.on("teamNames",(function(t){tagpro.teamNames=t})),r.on("gameId",(function(t){tagproConfig.replay||(urlQuery="?gameid="+t,window.history.pushState("","",urlQuery))})),r.on("clientInfo",(function(t){})),r.on("spectator",(function(i){var r=tagpro.spectator;tagpro.spectator=i.type;var n=i.joiner||!1;n&&!tagpro.rawJoinerSocket&&tagpro.createJoinerSocket(),tagpro.disconnectJoinerSocket&&!n&&tagpro.disconnectJoinerSocket(),tagpro.spectator||(tagpro.zoom=1,tagpro.viewport.centerLock=!1,tagpro.viewport.followPlayer=!0),tagpro.spectator&&!r&&(tagpro.viewport.centerLock=!0,tagpro.viewport.followPlayer=!1,c()),function(i){var r,n=i.toUpperCase();r=!1===document.hidden?"*** "+n+" *** "+i:"*** "+n+" *** "+n+" *** "+n+" *** "+i,t&&clearInterval(t);var o=function(){document.title=String.fromCodePoint(8203)+r.substring(0,i.length)};o(),e=i,t=setInterval((function(){r=r.substring(1),o(),r.length===i.length&&(clearInterval(t),t=null)}),100)}(tagpro.spectator?"Spectating TagPro":"Playing TagPro"),$("#favicon").attr("href",tagpro.spectator?"/favicon_spectating.ico":"/favicon_playing.ico")})),r.on("spectators",(function(t){tagpro.spectators=t})),setTimeout((function(){null==a&&(location.href="/")}),1e4),r.on("p",(function(t){for(var e=t.t||null,i=0,r=(t=t.u||t).length;i!=r;i++){var o=t[i],s=n[o.id];s||(n[(s=o).id]=s,s.lastSync={},s.pressing={});var a=!1,l=!1;for(var h in tagpro.group.socket&&tagpro.playerId&&o.id==tagpro.playerId&&o.hasOwnProperty("name")&&tagpro.group.socket.emit("name",o.name),o)"up"!=h&&"down"!=h&&"left"!=h&&"right"!=h?(null==e||null==s.lastSync[h]||e>s.lastSync[h])&&(s[h]=o[h],e&&(s.lastSync[h]=e),"rx"!=h&&"ry"!=h&&"lx"!=h&&"ly"!=h&&"a"!=h&&"den"!=h&&"dead"!=h&&"draw"!=h||(a=!0),"dead"!=h&&"draw"!=h&&"directSet"!=h||(l=!0),!s.sprites||"name"!=h&&"auth"!=h||tagpro.renderer.drawName(s,!0)):u(s,h,o[h]);(l||a)&&tagpro.world&&tagpro.world.syncPlayer(s,l)}})),r.on("object",(function(t){o[t.id]||(o[t.id]=t);var e=o[t.id],i=!1,r=!1;for(var n in t)e[n]=t[n],"rx"!=n&&"ry"!=n&&"lx"!=n&&"ly"!=n&&"a"!=n&&"draw"!=n||(i=!0),"draw"==n&&(r=!0);i&&tagpro.world.syncObject(e,r)})),r.on("playerLeft",(function(t){2!=h&&(tagpro.world.destoryPlayer(t),tagpro.renderer.destroyPlayer(tagpro.players[t]),delete n[t])})),r.on("map",(function(t){s=t.tiles,tagpro.map=s,tagpro.wallMap=p(s),tagpro.floorMap=function(t){for(var e=[0,2,11,12,17,18,23],i=[],r=0;r<t.length;r++){i[r]=[];for(var n=0;n<t[0].length;n++)i[r][n]=-1}for(r=0;r<t.length;r++)for(n=0;n<t[0].length;n++)-1==i[r][n]&&tagpro.tiles[t[r][n]]&&tagpro.tiles[t[r][n]].drawFloor&&o(r,n);function o(r,n){for(var o,s=!0,a=[r,n],l=[],h={};a.length>0;){var c=a.shift(),u=a.shift();if(!h[c+","+u]){h[c+","+u]=!0;var p=t[c]&&t[c][u]||0;if(-1!=e.indexOf(p))o=void 0!==o&&o!=p?2:p;else{var d=tagpro.tiles[t[c][u]];d&&d.drawFloor&&(d.redrawFloor&&(s=!1),(Array.isArray(d.drawFloor)?d.drawFloor:[{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}]).forEach((function(e){var i=c+e.x,r=u+e.y;t[i]&&t[i][r]&&tagpro.tiles[t[i][r]]&&Array.isArray(tagpro.tiles[t[i][r]].drawFloor)&&!tagpro.tiles[t[i][r]].drawFloor.some((function(t){return t.x==-e.x&&t.y==-e.y}))||(a.push(i),a.push(r))})),l.push(c),l.push(u))}}}for(void 0!==o&&(o||s)||(o=2);l.length>0;)c=l.shift(),u=l.shift(),i[c][u]=o}return i}(s),tagpro.map.splats=t.splats,t.info&&$("div#mapInfo").removeClass("hide").text("Map: "+(t.info.name||"Untitled")+" by "+(t.info.author||"Unknown")),tagproConfig.replay&&(tagpro.replayData.map=JSON.parse(JSON.stringify(s)),tagproConfig.replaySettings&&tagpro.replayPlayer.emit("settings",tagproConfig.replaySettings))})),r.on("time",(function(t){5===t.state?tagpro.overtimeStartedAt=(new Date).getTime()-t.time:tagpro.gameEndsAt=new Date((new Date).getTime()+t.time),3===tagpro.state&&1===(t.state||1)?tagpro.playSound("cheering"):1===tagpro.state&&t.state,tagpro.state=t.state||1})),tagpro.playSound=function(t,e){if(tagpro.sound){var i=$("audio#"+t).get(0);if(i&&i.play)if(i.volume=e||1,i.volume*=tagpro.volumeCoefficient,0==e)i.pause(),i.currentTime=0;else{if($(i).attr("data-ramp")){i.rampTimeout&&clearTimeout(i.rampTimeout);var r=i.volume;i.volume=0;d(i,.01,Math.ceil(Math.abs((r-i.volume)/.01)))}i.play()}}},tagpro.stopSound=function(t){var e=$("audio#"+t).get(0);if(e&&e.pause&&$(e).attr("data-ramp")){e.rampTimeout&&clearTimeout(e.rampTimeout);var i=Math.ceil(Math.abs((0-e.volume)/-.01));d(e,-.01,i,(function(){e.pause(),e.currentTime=0}))}},r.on("sound",(function(t){if(tagpro.viewport.followPlayer)tagpro.playSound(t.s,t.v);else{switch(t.s){case"cheering":case"sigh":tagpro.playSound("cheering",1);break;case"drop":case"friendlydrop":tagpro.playSound("friendlydrop",1);break;case"alert":case"friendlyalert":tagpro.playSound("friendlyalert",.5)}tagpro.spectatorGlobalSounds.includes(t.s)&&tagpro.playSound(t.s,1)}})),r.on("stopSound",(function(t){tagpro.stopSound(t)})),r.on("score",(function(t){tagpro.score=t}));var m=!1,f="";r.on("full",(function(){m=!0,location.href="/games/find?r="+(new Date).getTime()})),r.on("private",(function(t){m=!0,t&&t.groupId?location.href="/groups/"+t.groupId:location.href="/?err=private"})),r.on("banned",(function(){m=!0,location.href="/banned"})),r.on("vpn",(function(){m=!0,location.href="/vpn"})),r.on("duplicate",(function(){m=!0,location.href="/?err=duplicate"})),r.on("disconnectReason",(function(t){f=t})),r.on("disconnect",(function(t){f=f||t,tagpro.group.socket&&tagpro.group.socket.redirecting||2==h||m||(location.href=y?"/groups/"+y:"/?err="+f)})),r.on("end",(function(t){if(h=2,tagpro.state=2,t.winner,tagpro.winner=t.winner,tagpro.showOptions(),E&&!tagpro.spectator){var e=$("#mapRatingContainer"),i=$("#mapRating");e.show(),i.val()&&I%10!=0||(i.addClass("shake").addClass("shake-slow").addClass("shake-constant"),setTimeout((function(){i.removeClass("shake").removeClass("shake-slow").removeClass("shake-constant")}),1500))}if($("div.news").fadeIn(),!tagproConfig.replay){var r=25e3;"waiting"===tagpro.spectator&&(r=2e4),setTimeout((function(){"moderating"===tagpro.spectator?location.href="/":t.groupId?location.href="/groups/"+t.groupId:tagpro.mapTestingServer?location.href="/":location.href="/games/find?r="+(new Date).getTime()}),r),tagpro.sendPingStatistics()}}));var y=null;r.on("groupId",(function(t){t&&(y=t,tagproConfig.replay||$("#exit").attr("href","/groups/"+y))}));var _=1;function g(t,e){var i;i=e?"keyup":"keydown";var o=n[a];if(o&&(!o.pressing[t]&&"keydown"==i||o.pressing[t]&&"keyup"==i)){var s=_++;o.pressing[t]=!e,r.emit(i,{k:t,t:s}),tagpro.ping.avg&&setTimeout((function(){u(o,t,s)}),tagpro.ping.avg/2)}}function x(t,e){return tagpro.keys[t].includes(e.keyCode)}function v(t,e){return t.find((t=>(tagpro.keys[t]||[t]).includes(e.keyCode)))}$(document).keydown((function(t){if(tagpro.disableControls)return;if(x("resetZoom",t))return void(1===tagpro.zoom?c():tagpro.zoom=1);if(x("mark",t))return void r.emit("mark");if(tagpro.spectator)return function(t){let e=v(S,t);if(e){let t=b[e];return tagproConfig.replay?tagpro.replayActions[t]():r.emit(t),void(tagpro.viewport.centerLock=!1)}if(x("zoomOut",t))return void(tagpro.zooming=.025);if(x("zoomIn",t))return void(tagpro.zooming=-.025);if(x("centerZoom",t))return tagpro.viewport.followPlayer=!tagpro.viewport.followPlayer,void(tagpro.viewport.centerLock=!tagpro.viewport.followPlayer);if(x("toggleAutoJoin",t))return void r.emit("join")}(t);let e=v(["left","up","right","down","space"],t);e&&(t.preventDefault(),g(e),tagpro.events.keyDown&&tagpro.events.keyDown.forEach((function(t){t.keyDown(e)})))})),$(document).keyup((function(t){if(v(["zoomIn","zoomOut"],t))return void(tagpro.zooming=0);if(tagpro.disableControls)return;if(tagpro.spectator)return function(t){if(!tagproConfig.replay)return;let e=v(C,t);if(e){let t=w[e];return void tagpro.replayActions[t]()}}(t);let e=v(["left","up","right","down","space"],t);if(e){t.preventDefault();var i=n[a];if(i&&i.pressing[e]){var o=_++;i.pressing[e]=!1,r.emit("keyup",{k:e,t:o}),tagpro.ping.avg&&setTimeout((function(){u(i,e,-o)}),tagpro.ping.avg/2)}}})),zoomValues=[1,20/15,20/12,2,2.5,20/6,4],zoomCursor=0;const b={specNext:"next",specPrev:"prev",specRedFC:"redflagcarrier",specBlueFC:"blueflagcarrier"},w={left:"back",right:"forward",space:"playpause"},S=Object.keys(b),C=Object.keys(w);r.on("updatePersonalMute",(function(t){tagpro.personalMutes[t.player]=t.personalMuted}));var D=!1;tagpro.showOptions=function(){if(D)return;D=!0;var t=$("div#options");let e=tagpro.players[tagpro.playerId]&&tagpro.players[tagpro.playerId].name||"";t.find("#name").val(e);var i=function(){var e=t.find("tbody.stats"),r=e.find("tr.template"),o=[];for(var s in e.find("tr").not(".template").remove(),n)o.push(n[s]);if(o.sort((function(t,e){return e.score-t.score})),tagpro.events.sortPlayers&&tagpro.events.sortPlayers.forEach((function(t){t.sortPlayers(o)})),o.forEach((function(t){var i=r.clone().data("model",t).removeClass("template").appendTo(e).find("td");i.eq(0).find(".scoreName").text(t.name).addClass(1==t.team?"team-red":"team-blue").end().find(".scoreAuth").html(t.auth?"&#x2713;":"").end().find(".isPersonalMuted").html(tagpro.personalMutes[t.id]?"&#128263;":"&#128264;").end(),i.eq(1).text(t.score),i.eq(2).text(t["s-tags"]),i.eq(3).text(t["s-pops"]),i.eq(4).text(t["s-grabs"]),i.eq(5).text(t["s-drops"]),i.eq(6).text(tagpro.helpers.timeFromSeconds(t["s-hold"],!0)),i.eq(7).text(t["s-captures"]),i.eq(8).text(tagpro.helpers.timeFromSeconds(t["s-prevent"],!0)),i.eq(9).text(t["s-returns"]),i.eq(10).text(t["s-support"]),i.eq(11).text(t["s-powerups"]),i.eq(12).text(0==t.points?"-":t.points),i.find("span.kick").attr("data-id",t.id),i.find("span.isPersonalMuted").attr("data-id",t.id)})),tagpro.events.modifyScoreColumns&&tagpro.events.modifyScoreColumns.forEach((function(t){$("#options > table:first tbody").find("tr:gt(0)").empty(),t.modifyScoreColumns(o,r,e)})),tagpro.musicPlayer.current){var a="Music: "+(tagpro.musicPlayer.current.name||"Untitled");tagpro.musicPlayer.current.author&&(a=a+" by "+tagpro.musicPlayer.current.author),$("div#musicInfo").removeClass("hide").text(a)}else $("div#musicInfo").addClass("hide");D&&setTimeout(i,1e3),tagpro.events.modifyScoreUI&&tagpro.events.modifyScoreUI.forEach((function(t){t.modifyScoreUI($("#options > table:first"))}))};D&&i(),t.show()};var T=$("div#kick");$("#switchButton").click((function(t){t.preventDefault(),r.emit("switch")})),$("#tutorialButton").click((function(t){t.preventDefault();var e="Enable Tips"===$(this).text();$.cookie("disableTutorialChat",!e,{expires:36500,path:"/",domain:tagproConfig.cookieHost}),r.emit("tips",e),tagpro.settings.ui.tutorialChat=e})),$(window).keydown((function(t){27==t.which&&t.preventDefault()})),$(document).keyup((function(t){if(t.preventDefault(),x("showOptions",t))if(T.is(":visible"))T.hide(),D=!1,$("div#options").hide();else{if(!D)return void tagpro.showOptions();D=!1,$("div#options").hide(),$("#name").blur()}}));var A=function(){r.emit("name",$(this).val())};$("#name").keyup(A).change(A).keydown((function(t){v([37,38,39,40],t)?t.preventDefault():t.stopPropagation()})),$("select#mapRating").change((function(){var t=parseInt($(this).val());t>1||t<-1||r.emit("mapRating",t)}));var E=!1,I=0;r.on("mapRating",(function(t){$("select#mapRating").val(t.rating),E=!0,I=t.plays})),$("select#preferredServer").change((function(){r.emit("preferredServer",$(this).val())})),r.on("preferredServer",(function(t){$("select#preferredServer").val(t)}));var P=$("div#sendToPreferred"),B=null;r.on("sendPreferred",(function(t){P.find("span#preferredServer").text(t.name).end().css({left:$(document.body).width()/2-T.width()/2,top:$(document.body).height()/2-T.height()/2}).show();var e=8,i=$("span#countdown"),r=function(){e--,i.text(e),e>0?B=setTimeout(r,1e3):document.location=t.url+"games/find/?preferred=true"};r()})),$("a#sendToPreferredCancel").click((function(t){t.preventDefault(),P.hide(),clearTimeout(B),$("select#preferredServer").val(""),r.emit("preferredServer","")}));var M=[],O=0,R=0,L=0;setInterval((function(){var t=(new Date).getTime(),e={sent:t,id:O++,time:null,lost:!1};M.push(e),r.emit("p",{id:e.id,c:tagpro.ping.avg,l:tagpro.ping.loss}),R++,M.length>5&&M.shift();var i=0,n=0;M.forEach((function(e){if(!e.lost)return e.time>=1e3||null==e.time&&t-e.sent>=1e3?(e.lost=!0,void L++):void(null!=e.time&&(i++,n+=e.time))})),tagpro.ping.avg=Math.round(n/i)||0,tagpro.ping.current=tagpro.ping.avg,tagpro.ping.loss=L/R}),2e3),r.on("pr",(function(t){var e=(new Date).getTime(),i=M.filter((function(e){return e.id==t&&!e.lost}));i&&i.length&&((i=i[0]).time=e-i.sent)})),window.addEventListener("beforeunload",(function(){m=!0}))})),tagpro.ready((function(){var t,e={width:0,height:0},i={x:0,y:0},r=!1,n=!1;function o(t,e,i,r){return tagpro.ui.sprites[i]=tagpro.tiles.draw(t,e,r,30,30),tagpro.ui.flags.push(tagpro.ui.sprites[i]),tagpro.ui.sprites[i]}function s(t,e){var i=new PIXI.Container;function r(e){var r=0,n=e%2==0?22:0;r+=22*Math.floor((e-1)/2),tagpro.tiles.draw(i,t,{x:r,y:n},20,20,.5)}for(var n=1;n<=e;)r(n++);return i}setTimeout((function(){$("#loadingMessage").fadeOut(100),$("#viewportDiv").fadeIn(250),$("#viewport").fadeIn(250,(function(){tagpro.chat.resize()}))}),0),tagpro.ui={redFlagTaken:!1,blueFlagTaken:!1,yellowFlagTakenByRed:!1,yellowFlagTakenByBlue:!1,enabled:!0,sprites:{},redPotatoTaken:!1,bluePotatoTaken:!1,yellowPotatoTakenByRed:!1,yellowPotatoTakenByBlue:!1,flags:[]},tagpro.ui.center=i,tagpro.ui.size=e,tagpro.ui.resize=function(t,r){e.width=t,e.height=r,i.x=t/2,i.y=r/2,tagpro.ui.alignUI()},tagpro.ui.scoreXOffset=0,tagpro.ui.alignUI=function(){if(tagpro.ui.sprites){var t=tagpro.ui.sprites;if([!!t.redScore,!!t.blueScore,!!tagpro.ui.sprites.timer,!!t.performanceInfo,tagpro.ui.flags.length>0,!!t.xhr].every((function(t){return!!t}))){var e=2*i.y;tagpro.ui.sprites.redScore.x=i.x-80-tagpro.ui.scoreXOffset,tagpro.ui.sprites.redScore.y=e-80,tagpro.ui.sprites.blueScore.x=i.x+80+tagpro.ui.scoreXOffset,tagpro.ui.sprites.blueScore.y=e-80,tagpro.ui.sprites.timer.x=i.x,tagpro.ui.sprites.timer.y=e-50,tagpro.ui.sprites.performanceInfo.x=10,tagpro.ui.sprites.performanceInfo.y=10,tagpro.ui.sprites.xhr.x=i.x-tagpro.ui.sprites.xhr.width/2,tagpro.ui.sprites.xhr.y=10;for(var r=0;r<tagpro.ui.flags.length;r++){var n=tagpro.ui.flags[r];n.x=i.x+n.xOffset,n.y=e+n.yOffset}}else setTimeout(tagpro.ui.alignUI,1e3)}else setTimeout(tagpro.ui.alignUI,1e3)},tagpro.ui.scores=function(){var t="",e="",i="always"==tagpro.settings.ui.teamNames||"spectating"==tagpro.settings.ui.teamNames&&1==tagpro.spectator;i&&"Red"!==tagpro.teamNames.redTeamName&&(t=tagpro.teamNames.redTeamName+" - "),i&&"Blue"!==tagpro.teamNames.blueTeamName&&(e=" - "+tagpro.teamNames.blueTeamName);var r=t+(tagpro.score.r?tagpro.score.r.toString():"0"),n=(tagpro.score.b?tagpro.score.b.toString():"0")+e;tagpro.ui.sprites.redScore?(tagpro.ui.sprites.redScore.text=r,tagpro.ui.sprites.blueScore.text=n):(tagpro.ui.sprites.redScore=new PIXI.Text(r,{fill:"#FF0000",fontFamily:"Arial",fontSize:"40pt",fontWeight:"bold"}),tagpro.ui.sprites.blueScore=new PIXI.Text(n,{fill:"#0000FF",fontFamily:"Arial",fontSize:"40pt",fontWeight:"bold"}),tagpro.ui.sprites.redScore.alpha=.5,tagpro.ui.sprites.blueScore.alpha=.5,tagpro.ui.sprites.redScore.anchor.x=1,tagpro.ui.sprites.blueScore.anchor.x=0,tagpro.renderer.layers.ui.addChild(tagpro.ui.sprites.redScore),tagpro.renderer.layers.ui.addChild(tagpro.ui.sprites.blueScore))},tagpro.ui.updateFlags=function(t,e,i){tagpro.ui.sprites.redFlag||function(t,e,i){function r(t,r,n,o){return{tile:t,name:r,drawPos:{x:e.x+n,y:o|i.height-40},xOffset:n,yOffset:-40|o}}for(var n=[r("redflag","redFlag",110),r("blueflag","blueFlag",-110),r("yellowflag","yellowFlagTakenByRed",-80),r("yellowflag","yellowFlagTakenByBlue",80),r("redpotato","redPotatoTaken",110),r("bluepotato","bluePotatoTaken",-110),r("yellowpotato","yellowPotatoTakenByRed",-80),r("yellowpotato","yellowPotatoTakenByBlue",80)],s=0;s<n.length;s++){var a=n[s],l=o(t,a.tile,a.name,a.drawPos);l.xOffset=a.xOffset,l.yOffset=a.yOffset,l.anchor.x=.5}}(t,e,i);for(var r=[["redFlag","redFlagTaken"],["blueFlag","blueFlagTaken"],["yellowFlagTakenByRed",null],["yellowFlagTakenByBlue",null],["redPotatoTaken",null],["bluePotatoTaken",null],["yellowPotatoTakenByRed",null],["yellowPotatoTakenByBlue",null]],n=0;n<r.length;n++){var s,a=r[n],l=tagpro.ui.sprites[a[0]];s=a[1]?!!tagpro.ui[a[1]]:!!tagpro.ui[a[0]],l.visible=s}t.globalAlpha=1},tagpro.ui.timer=function(t,e,i,r){tagpro.replayUpdateTimer&&tagpro.replayUpdateTimer();var n=tagpro.ui.sprites.timer;n||((n=tagpro.ui.sprites.timer=new PIXI.Text("",{fill:"#FFFFFF",strokeThickness:4,stroke:"#000000",fontFamily:"Arial",fontSize:"30pt",fontWeight:"bold"})).alpha=.5,n.anchor.x=.5,t.addChild(tagpro.ui.sprites.timer)),n.text=r,n.visible=!!tagpro.settings.ui.matchState};var a=-1,l=-1,h=-1,c=-1;tagpro.ui.updatePlayerIndicators=function(){tagpro.ui.sprites.playerIndicators||(tagpro.ui.sprites.playerIndicators=new PIXI.Container);var t=0,e=0;for(var i in tagpro.players)tagpro.players.hasOwnProperty(i)&&(1==tagpro.players[i].team?t++:e++);var r=$("#viewport"),n=r.width(),o=r.height();if(t!=a||e!=l||n!=h||o!=c){a=t,l=e,h=n,c=o;var u=s("redball",t);u.x=n/2-120-u.width,u.y=o-70;var p=s("blueball",e);p.x=n/2+120,p.y=o-70,tagpro.renderer.layers.ui.addChild(tagpro.ui.sprites.playerIndicators),tagpro.ui.sprites.playerIndicators.removeChildren(),tagpro.ui.sprites.playerIndicators.addChild(u),tagpro.ui.sprites.playerIndicators.addChild(p)}},tagpro.ui.spectatorInfo=function(t,e){var i=tagpro.ui.sprites.spectatorInfo1,r=tagpro.ui.sprites.spectatorInfo2;tagpro.spectator&&!tagproConfig.replay?(i||(i=tagpro.ui.sprites.spectatorInfo1=tagpro.renderer.prettyText("You are spectating"),t.addChild(i),i.y=10,i.anchor.x=.5,i.alpha=.6),i.x=e.x,r&&tagpro.spectator==tagpro.ui.lastSpectatorValue||(r&&t.removeChild(r),r=tagpro.ui.sprites.spectatorInfo2=tagpro.renderer.prettyText("auto-join is "+("waiting"==tagpro.spectator?"on":"off")),t.addChild(r),r.y=25,r.anchor.x=.5,r.alpha=.6,tagpro.ui.lastSpectatorValue=tagpro.spectator),r.x=e.x):(i&&t.removeChild(i),r&&t.removeChild(r))},tagpro.ui.performanceInfo=function(t,e,i,r){var n,o;tagproConfig.replay&&(tagpro.ping.avg="N/A",r=0),tagpro.ui.sprites.performanceInfo||(tagpro.ui.xhrStartTime=performance.now(),tagpro.ui.sprites.performanceInfo=tagpro.renderer.prettyText(""),tagpro.ui.sprites.xhr=tagpro.renderer.prettyText(""),tagpro.ui.sprites.xhr.tint=16711680,tagpro.renderer.layers.ui.addChild(tagpro.ui.sprites.performanceInfo),tagpro.renderer.layers.ui.addChild(tagpro.ui.sprites.xhr)),n=tagpro.ui.sprites.performanceInfo,o=tagpro.ui.sprites.xhr;var s=!!tagpro.settings.ui.performanceInfo;if(n.visible=s,o.visible=performance.now()-tagpro.ui.xhrStartTime>1e3&&!!tagpro.rawSocket.io.engine.transport.polling,s){var a="FPS: "+Math.round(tagpro.fps)+", Ping: "+tagpro.ping.avg+(r?", Loss: "+r+"%":"");tagpro.rawSocket.io.engine.transport.polling&&(o.text="XHR Mode, this will be laggy! Check your firewall!"),n.text=a}},tagpro.ui.largeAlert=function(t,e,i,r,n){var o=tagpro.renderer.largeText(r,n);return o.x=Math.round(e.x-o.width/2),o.y=100,t.addChild(o),o};var u="";function p(){tagpro.renderer.layers.ui.debug||function(){tagpro.renderer.layers.ui.debug={};var t=tagpro.renderer.renderer.type==PIXI.WEBGL_RENDERER?"WebGL":"Canvas",e=tagpro.renderer.prettyText("Engine Type: "+t);e.x=10,e.y=100,tagpro.renderer.layers.ui.debug.engineType=e,tagpro.renderer.layers.ui.addChild(e);var i=tagpro.renderer.prettyText("");i.x=10,i.y=120,tagpro.renderer.layers.ui.debug.childCount=i,tagpro.renderer.layers.ui.addChild(i);var r=tagpro.renderer.prettyText("Particles: "+!tagpro.renderer.options.disableParticles);r.x=10,r.y=140,tagpro.renderer.layers.ui.debug.particles=r,tagpro.renderer.layers.ui.addChild(r);var n=tagpro.renderer.prettyText("Scaling: "+!tagpro.renderer.options.disableViewportScaling);n.x=10,n.y=160,tagpro.renderer.layers.ui.debug.viewport=n,tagpro.renderer.layers.ui.addChild(n);var o=tagpro.renderer.prettyText("");o.x=10,o.y=180,tagpro.renderer.layers.ui.debug.position=o,tagpro.renderer.layers.ui.addChild(o);var s=tagpro.renderer.prettyText("");s.x=10,s.y=200,tagpro.renderer.layers.ui.debug.realPosition=s,tagpro.renderer.layers.ui.addChild(s)}();var t=function(){var t=0;function e(i){if(i.visible){t+=1;for(var r=0;r<i.children.length;r++){e(i.children[r])}}}return e(tagpro.renderer.stage),t}(),e="Sprite Count: "+t;tagpro.renderer.layers.ui.debug.childCount.text=e;var i=tagpro.playerId;if(i){var r=tagpro.players[i],n="X: "+r.x+", Y: "+r.y;tagpro.renderer.layers.ui.debug.position.text=n;var o="RX: "+r.rx+", RY: "+r.ry;tagpro.renderer.layers.ui.debug.realPosition.text=o}}function d(t){for(var e in tagpro.players)tagpro.players.hasOwnProperty(e)&&tagpro.players[e].team==t&&tagpro.renderer.animateFlairWin(tagpro.players[e])}setInterval((function(){if(!tagpro.replayPaused)if(tagpro.gameEndsAt&&!tagpro.overtimeStartedAt){var r=tagpro.gameEndsAt-(new Date).getTime();3===tagpro.state&&(r+=1e3);var n="00"+Math.floor(r/6e4),o="00"+Math.floor(r%6e4/1e3),s=n.substr(n.length-2,2)+":"+o.substr(o.length-2,2);2===tagpro.state&&(s=u),t&&tagpro.ui.timer(t,i,e,s),"00:03"===s&&s!==u&&2!==tagpro.state&&tagpro.playSound("countdown",1),u=s}else if(tagpro.overtimeStartedAt){var a=(new Date).getTime()-tagpro.overtimeStartedAt;n="00"+Math.floor(a/6e4),o="00"+Math.floor(a%6e4/1e3),s=n.substr(n.length-2,2)+":"+o.substr(o.length-2,2);2===tagpro.state&&(s=u),t&&tagpro.ui.timer(t,i,e,s),u=s}}),100),tagpro.ui.update=function(){if(tagpro.ui.enabled&&(t||(t=tagpro.renderer.layers.ui),tagpro.settings.ui.spectatorInfo&&tagpro.ui.spectatorInfo(t,i),tagpro.renderer.debug&&p(),tagpro.settings.ui.matchState)){tagpro.ui.scores(t,i,e),tagpro.ui.updateFlags(tagpro.renderer.layers.ui,i,e),tagpro.ui.updatePlayerIndicators();var o=Math.floor(100*(tagpro.ping.loss||0));if(tagpro.ui.performanceInfo(t,i,e,o),tagpro.ui.alignUI(),tagpro.events.afterUpdateUI&&tagpro.events.afterUpdateUI.forEach((function(t){t.afterUpdateUI()})),2==tagpro.state)r||("red"==tagpro.winner?(tagpro.ui.largeAlert(t,i,e,(tagpro.teamNames.redTeamName||"Blue")+" Wins!","#ff0000"),r=!0,d(1)):"blue"==tagpro.winner?(tagpro.ui.largeAlert(t,i,e,(tagpro.teamNames.blueTeamName||"Red")+" Wins!","#0000ff"),r=!0,d(2)):"tie"==tagpro.winner?(tagpro.ui.largeAlert(t,i,e,"It's a tie!"),r=!0):(tagpro.ui.largeAlert(t,i,e,tagpro.winner),r=!0));else if(3==tagpro.state&&!n){var s=tagpro.ui.largeAlert(t,i,e,"Match Begins Soon..."),a=function(){3!=tagpro.state?(t.removeChild(s),s.visible=!1):setTimeout(a,20)};setTimeout(a,20),n=!0}}}})),tagpro.ready((function(){if(tagproConfig.replay)return void(tagpro.kick={player:()=>0,clickBall:()=>0});var t=$("div#kick");tagpro.kick={player:function(e){t.attr("data-id",e.id).find("#kickPlayer").text(" "+e.name).end().find("#kickSelect").prop("selectedIndex",0).end().find("#personalMuteButton").text(tagpro.personalMutes[e.id]?"Remove Personal Mute":"Apply Personal Mute").end().css({left:($(window).width()-t.width())/2,top:($(window).height()-t.height())/2}).show()},clickBall:function(t){var e=t.pageX-$canvas.offset().left,i=t.pageY-$canvas.offset().top,r=null,n=-1;for(var o in tagpro.players){var s=tagpro.players[o],a=tagpro.helpers.toLockedPos({x:s.x,y:s.y}),l=a.x+20,h=a.y+20,c=Math.pow(l-e,2)+Math.pow(h-i,2);(null===r||c<n)&&(r=s,n=c)}r&&n<Math.pow(40,2)&&tagpro.kick.player(r)}},$("tbody.stats").on("click","span.kick",(function(t){t.preventDefault();var e=tagpro.players[parseInt($(this).attr("data-id"))];tagpro.kick.player(e)}));var e=function(e,i){e.preventDefault(),0!==parseInt($("#kickSelect").val())&&tagpro.socket.emit("kick",{playerId:parseInt(t.attr("data-id")),reason:parseInt($("#kickSelect").val()),monitorKick:i}),t.hide()};$("#kickButton").click(e),$("#kickButtonMonitor").click((function(t){e(t,!0)})),$("#muteButton").click((function(e){e.preventDefault(),t.hide(),tagpro.socket.emit("mute",{playerId:parseInt(t.attr("data-id"))})}));const i=t=>{tagpro.personalMutes[t]?tagpro.socket.emit("removePersonalMute",{playerId:t}):tagpro.socket.emit("applyPersonalMute",{playerId:t})};$("#personalMuteButton").click((function(e){e.preventDefault(),t.hide();let r=parseInt(t.attr("data-id"));i(r)})),$("tbody.stats").on("click","span.isPersonalMuted",(function(t){t.preventDefault();let e=parseInt($(this).attr("data-id"));i(e)})),$("#kickCancelButton").click((function(e){e.preventDefault(),t.hide()}))})),tagpro.ready((function(){var t=!1,e=!1,i=!1,r=!1,n=!1,o=$("div#chatHistory"),s=$("input#chat"),a=$("canvas"),l=a.offset(),h=a.get(0).height,c=tagpro.socket,u="",p="",d="#FFB5BD",m="#CFCFFF",f="#E7E700",y="#FF0000",_="#00B900",g="#00B7A5",x="#FFFFFF";$(document).keydown((function(o){var a="true"===$("#privateGame").val(),l="true"===$("#isMod").val(),h="true"===$("#isMonitor").val(),u=-1!=tagpro.keys.chatToTeam.indexOf(o.keyCode),p=-1!=tagpro.keys.chatToGroup.indexOf(o.keyCode)&&tagpro.group.socket,y=-1!=tagpro.keys.chatToAll.indexOf(o.keyCode),v=l&&tagpro.keys.chatAsMod&&-1!=tagpro.keys.chatAsMod.indexOf(o.keyCode),b=h&&!a&&tagpro.keys.chatAsMonitor&&-1!=tagpro.keys.chatAsMonitor.indexOf(o.keyCode);if((u||p||y||v||b)&&!t){if($("#name").is(":focus"))return;!function(o,a,l,h){t=!0,tagpro.disableControls=!1,e=o,i=a,r=l,n=h;var c=tagpro.players[tagpro.playerId],u=o&&c&&1===c.team?d:o&&c&&2===c.team?m:a?f:h?g:l?_:x;s.val("").css("color",u).css("border-color",u).show().focus()}(u,p,v,b),o.preventDefault()}else-1!=tagpro.keys.sendChat.indexOf(o.keyCode)&&t&&function(){var t=s.val();if(S(),t.length>70||""==t)return void w();i?tagpro.group.socket&&tagpro.group.socket.emit("chat",t):c.emit("chat",{toAll:!e,asMod:r,asMonitor:n,message:t});w()}()}));var v=$("<div><span class='auth'>&#10004</span><span class='name'></span><span class='message'></span></div>");function b(t){var e=tagpro.settings.ui||{allChat:!0,teamChat:!0,groupChat:!0,systemChat:!0};if("number"!=typeof t.to||t.to==tagpro.playerId){if(!t.mod&&!t.monitor){if(!e.allChat&&"all"==t.to&&t.from)return;if(!e.teamChat&&"team"==t.to)return;if(!e.groupChat&&"group"==t.to)return;if(!(e.systemChat||"all"!=t.to&&"number"!=typeof t.to||t.from))return}var i=null,r=null,n=v.clone();"number"==typeof t.from?(i=tagpro.players[t.from],n.data("player",i)):"string"==typeof t.from&&(i={name:t.from,auth:!1}),i&&i.auth||n.children(".auth").remove(),i?(i.team?r=1==i.team?d:m:"group"==t.to?r=f:"ADMIN_GLOBAL_BROADCAST"==t.from?(r=y,i.name="ANNOUNCEMENT"):t.monitor?r=g:t.mod&&(r=_),n.children(".name").css({color:r}).text(i.name)):n.children(".name").remove();var s=r;"all"!=t.to&&"number"!=typeof t.to||(s=t.c||null),"group"!=t.to||t.from||(s=f),"mods"==t.to&&(s=_);var a=n.children(".message").css({color:s});if(t.links){var l=t.message.replace(/(\b(https?|):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,'<a href="$1" target="_blank">$1</a>');a.html(l).end()}else a.text(t.message).end();o.append(n).scrollTop(o.get(0).scrollHeight),setTimeout((function(){n.remove()}),2e4)}}function w(){t=!1,tagpro.disableControls=!1,s.hide()}function S(){u="",p=""}c.on("chat",b),tagpro.group.socket&&tagpro.group.socket.on("chat",b),s.keydown((function(t){if([37,38,39,40].indexOf(t.keyCode)>=0&&t.preventDefault(),tagpro.keys.nickCompleteChat.indexOf(t.keyCode)>-1)return t.preventDefault(),function(){var t=s.val(),e=Object.keys(tagpro.players).map((function(t){return tagpro.players[t].name})).sort((function(t,e){return t>e}));if(u.length){var i=t.lastIndexOf(u);i+u.length===t.length&&(t=t.substr(0,i),t+=p);var r=e.indexOf(u.trim());r>-1&&(e=r+1===e.length?e:e.slice(r+1))}var n=t.split(" "),o=n[n.length-1];if(n.length){var a=o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),l=new RegExp("^"+a+".*","i"),h=o;e.some((function(t){return!!l.test(t)&&(h=t+" ",!0)})),u=h,p=o,n[n.length-1]=h,s.val(n.join(" "))}}();tagpro.keys.cancelChat.indexOf(t.keyCode)>-1&&w(),[37,38,39,40].indexOf(t.keyCode)<0&&-1==tagpro.keys.sendChat.indexOf(t.keyCode)&&t.stopPropagation(),S()})),tagpro.chat.resize=function(){l=a.offset(),h=a.get(0).height,s.css({left:l.left+10,top:l.top+h-40}),o.css({left:l.left+10,top:l.top+h-o.outerHeight()-50})},o.on("click","div",(function(){var t=$(this).data("player");t&&tagpro.kick.player(t)}))}));var overrideableAssets={speedpad:"img#speedpad",speedpadRed:"img#speedpadred",speedpadBlue:"img#speedpadblue",portal:"img#portal",portalRed:"img#portalred",portalBlue:"img#portalblue",tiles:"img#tiles",splats:"img#splats",gravityWell:"img#gravityWell"};function generateId(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<16;i++)t+=e.charAt(Math.floor(62*Math.random()));return t}function createTiles(){var t=!!$.cookie("disableShaders");tagpro.createPngTiles(overrideableAssets),tagproConfig.enableShaders&&!t&&tagpro.createShaderTiles(overrideableAssets)}tagpro.loadAssets=function(t){var e=function(t){$(document).ready((function(){$("#assets").append(t)}))};for(var i in t){var r="img#"+i+"[data-event-asset=true]";if($(r).size())overrideableAssets[i]=r;else{var n=t[i],o=generateId(),s=new Image;s.crossOrigin=!0,s.src=n,s.id=o,s.className="asset",overrideableAssets[i]="img#"+o,e(s)}}tagpro.loadAssets=function(){console.log("tagpro.loadAssets has already been called. Ignoring second invocation.")}},tagpro.ready(createTiles),tagpro.createPngTiles=function(t){const e=$.cookie("tileRespawnWarnings")||"blink",i="true"===$.cookie("disableNextPupIndicators"),r=$.cookie("indicatorAlpha")||.35;var n={};function o(t,e,i,r,o){n[e]||(n[e]=new PIXI.BaseTexture(t));var s=n[e];return function(t,e,i,r,n){var o=[],s=(new PIXI.Rectangle(0,0,e.width,e.height),function(t){var i=new PIXI.Rectangle(r*t,0,r,r);o.push(new PIXI.Texture(e,i))});if(i)s(t-1);else if(n)s(0),s(t-1);else for(var a=0;a<t-1;a++)s(a);return o}(s.width/r,s,i,r,o)}function s(t,e,i,r,n){i=i||40;var s=function(t){var e=new PIXI.extras.AnimatedSprite(t);return e.playing=!0,e}(o($(t).get(0),t,e,i,r));return r&&(s.blink=!0),n&&(s.alpha=n),s}function a(t,i){return"blink"===e?s(t,!1,null,!0,.5):"alpha"===e?s(t,!1,null,!1,.35):i}function l(t,n,o,s,a,l){return"blink"===e?{x:t,y:n,drawFloor:!0,redrawFloor:!0,dynamic:!0,alpha:.5,blink:!0,frameTiles:o}:"alpha"===e?{x:t,y:n,drawFloor:!0,redrawFloor:!0,dynamic:!0,alpha:.35,blink:!1}:l&&!i?{x:t,y:n,drawFloor:!0,redrawFloor:!0,dynamic:!0,alpha:r,blink:!1}:{x:s,y:a,drawFloor:!0,redrawFloor:!0,dynamic:!0}}function h(t,e,n,o){return i?{x:n,y:o,drawFloor:!0,redrawFloor:!0,dynamic:!0}:{x:t,y:e,drawFloor:!0,redrawFloor:!0,dynamic:!0,alpha:r,blink:!1}}var c=s(t.speedpad),u=s(t.speedpad,!0),p=a(t.speedpad,u),d=s(t.speedpadRed),m=s(t.speedpadRed,!0),f=a(t.speedpadRed,m),y=s(t.speedpadBlue),_=s(t.speedpadBlue,!0),g=a(t.speedpadBlue,_),x=s(t.portal),v=s(t.portal,!0),b=a(t.portal,v),w=s(t.portalRed),S=s(t.portalRed,!0),C=a(t.portalRed,S),D=s(t.portalBlue),T=s(t.portalBlue,!0),A=a(t.portalBlue,T);tagpro.tiles={1:{},1.1:{drawFloor:[{x:1,y:0},{x:0,y:-1}]},1.2:{drawFloor:[{x:1,y:0},{x:0,y:1}]},1.3:{drawFloor:[{x:-1,y:0},{x:0,y:1}]},1.4:{drawFloor:[{x:-1,y:0},{x:0,y:-1}]},2:{x:13,y:4},16:{x:13,y:1,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},yellowflag:{x:13,y:1,isFlag:!0,dynamic:!0},16.1:{x:13,y:2,drawFloor:!0,redrawFloor:!0,dynamic:!0},3:{x:14,y:1,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},redflag:{x:14,y:1,isFlag:!0,dynamic:!0},3.1:{x:14,y:2,drawFloor:!0,redrawFloor:!0,dynamic:!0},4:{x:15,y:1,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},blueflag:{x:15,y:1,isFlag:!0,dynamic:!0},4.1:{x:15,y:2,drawFloor:!0,redrawFloor:!0,dynamic:!0},5:c,5.1:u,5.11:p,14:d,14.1:m,14.11:f,15:y,15.1:_,15.11:g,6:{x:12,y:8,drawFloor:!0,redrawFloor:!0,dynamic:!0},6.1:{x:12,y:4,drawFloor:!0,redrawFloor:!0,dynamic:!0},6.11:l(12,4,[6.1,6],12,8,!0),6.12:h(12,4,12,8),grip:{x:12,y:4,dynamic:!0},6.2:{x:12,y:5,drawFloor:!0,redrawFloor:!0,dynamic:!0},6.21:l(12,5,[6.2,6],12,8,!0),6.22:h(12,5,12,8),bomb:{x:12,y:5,dynamic:!0},6.3:{x:12,y:6,drawFloor:!0,redrawFloor:!0,dynamic:!0},6.31:l(12,6,[6.3,6],12,8,!0),6.32:h(12,6,12,8),tagpro:{x:12,y:6,dynamic:!0},6.4:{x:12,y:7,drawFloor:!0,redrawFloor:!0,dynamic:!0},6.41:l(12,7,[6.4,6],12,8,!0),6.42:h(12,7,12,8),speed:{x:12,y:7,dynamic:!0},17:{x:14,y:5,dynamic:!0},18:{x:15,y:5,dynamic:!0},7:{x:12,y:0,drawFloor:!0,redrawFloor:!1,dynamic:!0},21:{x:14,y:6,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},yellowpotato:{x:14,y:6,isFlag:!0,dynamic:!0},21.1:{x:15,y:6,drawFloor:!0,redrawFloor:!0,dynamic:!0},19:{x:14,y:7,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},redpotato:{x:14,y:7,isFlag:!0,dynamic:!0},19.1:{x:15,y:7,drawFloor:!0,redrawFloor:!0,dynamic:!0},20:{x:14,y:8,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},bluepotato:{x:14,y:8,isFlag:!0,dynamic:!0},20.1:{x:15,y:8,drawFloor:!0,redrawFloor:!0,dynamic:!0},22:{x:0,y:0,drawFloor:!0,source:"gravityWell",dynamic:!0},redball:{x:14,y:0},blueball:{x:15,y:0},8:{x:13,y:6,drawFloor:!0,redrawFloor:!1,dynamic:!0},9:{x:12,y:3,dynamic:!0},9.1:{x:13,y:3,dynamic:!0},9.2:{x:14,y:3,dynamic:!0},9.3:{x:15,y:3,dynamic:!0},10:{x:12,y:1,drawFloor:!0,redrawFloor:!0,dynamic:!0},10.1:{x:12,y:2,drawFloor:!0,redrawFloor:!0,dynamic:!0},10.11:l(12,1,[10,10.1],12,2),11:{x:14,y:4},12:{x:15,y:4},23:{x:13,y:5},marsball:{x:12,y:9,size:80,keep:!0},13:x,13.1:v,13.11:b,24:w,24.1:S,24.11:C,25:D,25.1:T,25.11:A,"1.310":{x:10.5,y:7.5,size:20},"1.410":{x:11,y:7.5,size:20},"1.110":{x:11,y:8,size:20},"1.210":{x:10.5,y:8,size:20},"1.310d":{x:.5,y:3.5,size:20},"1.410d":{x:1,y:3.5,size:20},"1.210d":{x:.5,y:4,size:20},1.321:{x:4.5,y:9.5,size:20},1.421:{x:5,y:9.5,size:20},1.121:{x:5,y:10,size:20},1.221:{x:4.5,y:10,size:20},"1.321d":{x:1.5,y:2.5,size:20},"1.421d":{x:2,y:2.5,size:20},"1.221d":{x:1.5,y:3,size:20},1.332:{x:6.5,y:9.5,size:20},1.432:{x:7,y:9.5,size:20},1.132:{x:7,y:10,size:20},1.232:{x:6.5,y:10,size:20},"1.332d":{x:9.5,y:2.5,size:20},"1.432d":{x:10,y:2.5,size:20},"1.132d":{x:10,y:3,size:20},1.343:{x:.5,y:7.5,size:20},1.443:{x:1,y:7.5,size:20},1.143:{x:1,y:8,size:20},1.243:{x:.5,y:8,size:20},"1.343d":{x:10.5,y:3.5,size:20},"1.443d":{x:11,y:3.5,size:20},"1.143d":{x:11,y:4,size:20},1.354:{x:1.5,y:6.5,size:20},1.454:{x:2,y:6.5,size:20},1.154:{x:2,y:7,size:20},1.254:{x:1.5,y:7,size:20},"1.454d":{x:9,y:1.5,size:20},"1.154d":{x:9,y:2,size:20},"1.254d":{x:8.5,y:2,size:20},1.365:{x:6.5,y:8.5,size:20},1.465:{x:7,y:8.5,size:20},1.165:{x:7,y:9,size:20},1.265:{x:6.5,y:9,size:20},"1.465d":{x:11,y:1.5,size:20},"1.165d":{x:11,y:2,size:20},"1.265d":{x:10.5,y:2,size:20},1.376:{x:4.5,y:8.5,size:20},1.476:{x:5,y:8.5,size:20},1.176:{x:5,y:9,size:20},1.276:{x:4.5,y:9,size:20},"1.376d":{x:.5,y:1.5,size:20},"1.176d":{x:1,y:2,size:20},"1.276d":{x:.5,y:2,size:20},1.307:{x:9.5,y:6.5,size:20},1.407:{x:10,y:6.5,size:20},1.107:{x:10,y:7,size:20},1.207:{x:9.5,y:7,size:20},"1.307d":{x:2.5,y:1.5,size:20},"1.107d":{x:3,y:2,size:20},"1.207d":{x:2.5,y:2,size:20},"1.320":{x:1.5,y:7.5,size:20},"1.420":{x:2,y:7.5,size:20},"1.220":{x:1.5,y:8,size:20},"1.320d":{x:10.5,y:.5,size:20},"1.420d":{x:11,y:.5,size:20},"1.220d":{x:10.5,y:1,size:20},1.331:{x:5.5,y:6.5,size:20},1.431:{x:6,y:6.5,size:20},1.131:{x:6,y:7,size:20},1.231:{x:5.5,y:7,size:20},"1.331d":{x:5.5,y:.5,size:20},"1.431d":{x:6,y:.5,size:20},1.342:{x:9.5,y:7.5,size:20},1.442:{x:10,y:7.5,size:20},1.142:{x:10,y:8,size:20},"1.342d":{x:.5,y:.5,size:20},"1.442d":{x:1,y:.5,size:20},"1.142d":{x:1,y:1,size:20},1.353:{x:4.5,y:5.5,size:20},1.453:{x:5,y:5.5,size:20},1.153:{x:5,y:6,size:20},1.253:{x:4.5,y:6,size:20},"1.453d":{x:7,y:1.5,size:20},"1.153d":{x:7,y:2,size:20},1.464:{x:4,y:9.5,size:20},1.164:{x:4,y:10,size:20},1.264:{x:3.5,y:10,size:20},"1.464d":{x:2,y:3.5,size:20},"1.164d":{x:2,y:4,size:20},"1.264d":{x:1.5,y:4,size:20},1.375:{x:5.5,y:2.5,size:20},1.475:{x:6,y:2.5,size:20},1.175:{x:6,y:4,size:20},1.275:{x:5.5,y:4,size:20},"1.175d":{x:6,y:3,size:20},"1.275d":{x:5.5,y:3,size:20},1.306:{x:7.5,y:9.5,size:20},1.106:{x:8,y:10,size:20},1.206:{x:7.5,y:10,size:20},"1.306d":{x:9.5,y:3.5,size:20},"1.106d":{x:10,y:4,size:20},"1.206d":{x:9.5,y:4,size:20},1.317:{x:6.5,y:5.5,size:20},1.417:{x:7,y:5.5,size:20},1.117:{x:7,y:6,size:20},1.217:{x:6.5,y:6,size:20},"1.317d":{x:4.5,y:1.5,size:20},"1.217d":{x:4.5,y:2,size:20},1.327:{x:7.5,y:8.5,size:20},1.427:{x:8,y:8.5,size:20},1.101:{x:4,y:5,size:20},1.227:{x:7.5,y:9,size:20},"1.327d":{x:8.5,y:3.5,size:20},"1.227d":{x:8.5,y:4,size:20},"1.330":{x:8.5,y:7.5,size:20},"1.430":{x:9,y:7.5,size:20},1.112:{x:2,y:0,size:20},"1.230":{x:8.5,y:8,size:20},"1.330d":{x:3.5,y:.5,size:20},"1.430d":{x:4,y:.5,size:20},1.341:{x:2.5,y:7.5,size:20},1.441:{x:3,y:7.5,size:20},1.141:{x:3,y:8,size:20},1.223:{x:9.5,y:0,size:20},"1.341d":{x:7.5,y:.5,size:20},"1.441d":{x:8,y:.5,size:20},1.352:{x:3.5,y:8.5,size:20},1.452:{x:4,y:8.5,size:20},1.152:{x:4,y:9,size:20},1.234:{x:7.5,y:5,size:20},"1.452d":{x:3,y:3.5,size:20},"1.152d":{x:3,y:4,size:20},1.345:{x:7.5,y:6.5,size:20},1.463:{x:10,y:8.5,size:20},1.163:{x:10,y:9,size:20},1.263:{x:9.5,y:9,size:20},"1.463d":{x:2,y:.5,size:20},"1.163d":{x:2,y:1,size:20},1.356:{x:6.5,y:7.5,size:20},1.474:{x:9,y:9.5,size:20},1.174:{x:9,y:10,size:20},1.274:{x:8.5,y:10,size:20},"1.174d":{x:10,y:5,size:20},"1.274d":{x:9.5,y:5,size:20},1.305:{x:2.5,y:9.5,size:20},1.467:{x:5,y:7.5,size:20},1.105:{x:3,y:10,size:20},1.205:{x:2.5,y:10,size:20},"1.105d":{x:2,y:5,size:20},"1.205d":{x:1.5,y:5,size:20},1.316:{x:1.5,y:8.5,size:20},"1.470":{x:4,y:6.5,size:20},1.116:{x:2,y:9,size:20},1.216:{x:1.5,y:9,size:20},"1.316d":{x:9.5,y:.5,size:20},"1.216d":{x:9.5,y:1,size:20},1.337:{x:10.5,y:9.5,size:20},1.437:{x:11,y:9.5,size:20},1.102:{x:0,y:7,size:20},1.237:{x:10.5,y:10,size:20},"1.337d":{x:10.5,y:4.5,size:20},"1.102d":{x:0,y:0,size:20},"1.340":{x:8.5,y:10.5,size:20},"1.440":{x:9,y:10.5,size:20},1.113:{x:6,y:8,size:20},1.213:{x:5.5,y:8,size:20},"1.340d":{x:3.5,y:2.5,size:20},"1.440d":{x:8,y:2.5,size:20},1.351:{x:.5,y:9.5,size:20},1.451:{x:1,y:9.5,size:20},1.151:{x:1,y:10,size:20},1.224:{x:11.5,y:7,size:20},"1.224d":{x:11.5,y:0,size:20},"1.451d":{x:1,y:4.5,size:20},1.335:{x:11.5,y:8.5,size:20},1.462:{x:0,y:5.5,size:20},1.162:{x:0,y:5,size:20},1.235:{x:11.5,y:9,size:20},"1.462d":{x:0,y:4.5,size:20},"1.162d":{x:0,y:6,size:20},1.346:{x:11.5,y:7.5,size:20},1.473:{x:8,y:6.5,size:20},1.173:{x:8,y:7,size:20},1.273:{x:7.5,y:7,size:20},"1.346d":{x:2.5,y:4.5,size:20},"1.173d":{x:9,y:3,size:20},1.357:{x:5.5,y:10.5,size:20},1.457:{x:6,y:10.5,size:20},1.104:{x:6,y:5,size:20},1.204:{x:5.5,y:5,size:20},"1.104d":{x:7,y:5,size:20},"1.204d":{x:4.5,y:5,size:20},1.315:{x:3.5,y:6.5,size:20},"1.460":{x:0,y:7.5,size:20},1.115:{x:4,y:7,size:20},1.215:{x:3.5,y:7,size:20},"1.460d":{x:9,y:4.5,size:20},"1.215d":{x:2.5,y:3,size:20},1.326:{x:11.5,y:5.5,size:20},1.471:{x:0,y:8.5,size:20},1.171:{x:0,y:9,size:20},1.226:{x:11.5,y:5,size:20},"1.326d":{x:11.5,y:4.5,size:20},"1.226d":{x:11.5,y:6,size:20},1.347:{x:9.5,y:10.5,size:20},1.447:{x:10,y:10.5,size:20},1.103:{x:9,y:6,size:20},1.203:{x:8.5,y:6,size:20},"1.347d":{x:3.5,y:1.5,size:20},"1.103d":{x:4,y:1,size:20},"1.350":{x:1.5,y:10.5,size:20},"1.450":{x:2,y:10.5,size:20},1.114:{x:3,y:6,size:20},1.214:{x:2.5,y:6,size:20},"1.214d":{x:7.5,y:1,size:20},"1.450d":{x:8,y:1.5,size:20},1.325:{x:4.5,y:7.5,size:20},1.461:{x:4,y:3.5,size:20},1.161:{x:4,y:4,size:20},1.225:{x:4.5,y:8,size:20},"1.225d":{x:8.5,y:5,size:20},"1.461d":{x:8,y:4.5,size:20},1.336:{x:7.5,y:3.5,size:20},1.472:{x:7,y:7.5,size:20},1.172:{x:7,y:8,size:20},1.236:{x:7.5,y:4,size:20},"1.336d":{x:3.5,y:4.5,size:20},"1.172d":{x:3,y:5,size:20},"1.300":{x:5.5,y:5.5,size:20},"1.400":{x:6,y:5.5,size:20},"1.100":{x:6,y:6,size:20},"1.200":{x:5.5,y:6,size:20},"1.300d":{x:5.5,y:8.5,size:20},"1.400d":{x:6,y:8.5,size:20},"1.100d":{x:6,y:10,size:20},"1.200d":{x:5.5,y:10,size:20}},tagpro.tiles.tileCanvases={};var E=$(t.tiles);tagpro.tiles.image=E[0],tagpro.tiles.images={gravityWell:$(t.gravityWell)[0]},tagpro.events.defineCustomTiles&&tagpro.events.defineCustomTiles.forEach((function(t){t.defineCustomTiles(tagpro.tiles)}));var I=[];tagpro.tiles.createAnimation=s,tagpro.tiles.drawNext=function(){for(;I.length;)I.pop()()},this.firstLoad=!1,tagpro.tiles.drawWithZoom=function(t,e,i,r,n,o){return tagpro.tiles.draw(t,e,i,r,n,o,!0)},tagpro.tiles.getTexture=function(t,e,i){if(!PIXI.utils.TextureCache[t]){e||(e=tagpro.tiles[t]),i||(i=e.spread||0);var r=e.source?tagpro.tiles.images[e.source]:tagpro.tiles.image,n=document.createElement("canvas");n.width=e.size||40,n.height=e.size||40;var o=n.getContext("2d"),s=40*e.x-i,a=40*e.y-i,l=(e.size||40)+2*i;o.drawImage(r,s,a,l,l,0,0,l,l),PIXI.utils.TextureCache[t]=PIXI.Texture.fromCanvas(n)}return PIXI.utils.TextureCache[t]},tagpro.tiles.draw=function(t,e,i,r,n,o,s){var a=tagpro.tiles[e];if(a&&!a.draw){var l=a.spread||0,h=(a.size,a.size,function(){var h=tagpro.tiles.getTexture(e,a,l),c=new PIXI.Sprite(h);return c.position.x=i.x,c.position.y=i.y,c.width=r||40,c.height=n||40,c.alpha=a.alpha||o||1,s?t.addChildAt(c,0):t.addChild(c),c});if(!l)return h();I.push(h),i={x:i.x,y:i.y}}},tagpro.tiles.animations={},tagpro.tiles.drawLayers=function(t,e,i,r,n){var o=tagpro.tiles[tagpro.map[e][i]];if(o){var s=o instanceof PIXI.extras.AnimatedSprite;tagpro.tiles.draw(t,{x:1,y:0},r),tagpro.floorMap[e][i]&&(tagpro.tiles.draw(t,tagpro.floorMap[e][i],r),a()),s?(tagpro.tiles.draw(t,2,r),a()):1==Math.floor(tagpro.map[e][i])?(tagpro.tiles.draw(t,tagpro.wallMap[e][i][0],r,20,20),tagpro.tiles.draw(t,tagpro.wallMap[e][i][1],{x:r.x+20,y:r.y},20,20),tagpro.tiles.draw(t,tagpro.wallMap[e][i][2],{x:r.x+20,y:r.y+20},20,20),tagpro.tiles.draw(t,tagpro.wallMap[e][i][3],{x:r.x,y:r.y+20},20,20)):o.dynamic||(tagpro.tiles.draw(t,tagpro.map[e][i],r),a())}function a(){tagpro.events.drawCustomBackground&&tagpro.events.drawCustomBackground.forEach((function(e){e.drawCustomBackground(r,t)}))}},function(){var e=$(t.splats).get(0),i=new PIXI.BaseTexture(e),r=i.width/120,n=function(t,e){var r=new PIXI.Rectangle(120*t,120*e,120,120);return new PIXI.Texture(i,r)};tagpro.tiles.splats={red:[],blue:[]};for(var o=0;o<r-1;o++)tagpro.tiles.splats.red.push(n(o,0)),tagpro.tiles.splats.blue.push(n(o,1))}()},window.textureLoaded=$.Deferred(),$.when($.ready,window.replayLoaded||!0).then((function(){var t=JSON.parse($.trim($("#textures").text()));if(!t)try{t=JSON.parse($.cookie("textures"))}catch(t){}if(t){var e={};["tiles","speedpad","speedpadRed","speedpadBlue","portal","portalRed","portalBlue","splats","gravityWell"].forEach((function(i){t[i]&&(e[i]=tagpro.helpers.rebaseToCDN(t[i]))})),tagpro.loadAssets(e)}textureLoaded.resolve()}));var PIXI=function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(t,e){return t(e={exports:{}},e.exports),e.exports}var r=i((function(t,i){!function(t){var e=t.Promise,r=e&&"resolve"in e&&"reject"in e&&"all"in e&&"race"in e&&function(){var t;return new e((function(e){t=e})),"function"==typeof t}();i?(i.Promise=r?e:S,i.Polyfill=S):r||(t.Promise=S);var n="pending",o="sealed",s="fulfilled",a="rejected",l=function(){};function h(t){return"[object Array]"===Object.prototype.toString.call(t)}var c,u="undefined"!=typeof setImmediate?setImmediate:setTimeout,p=[];function d(){for(var t=0;t<p.length;t++)p[t][0](p[t][1]);p=[],c=!1}function m(t,e){p.push([t,e]),c||(c=!0,u(d,0))}function f(t){var e=t.owner,i=e.state_,r=e.data_,n=t[i],o=t.then;if("function"==typeof n){i=s;try{r=n(r)}catch(t){x(o,t)}}y(o,r)||(i===s&&_(o,r),i===a&&x(o,r))}function y(t,e){var i;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var r=e.then;if("function"==typeof r)return r.call(e,(function(r){i||(i=!0,e!==r?_(t,r):g(t,r))}),(function(e){i||(i=!0,x(t,e))})),!0}}catch(e){return i||x(t,e),!0}return!1}function _(t,e){t!==e&&y(t,e)||g(t,e)}function g(t,e){t.state_===n&&(t.state_=o,t.data_=e,m(b,t))}function x(t,e){t.state_===n&&(t.state_=o,t.data_=e,m(w,t))}function v(t){var e=t.then_;t.then_=void 0;for(var i=0;i<e.length;i++)f(e[i])}function b(t){t.state_=s,v(t)}function w(t){t.state_=a,v(t)}function S(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof S==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(t,e){function i(t){x(e,t)}try{t((function(t){_(e,t)}),i)}catch(t){i(t)}}(t,this)}S.prototype={constructor:S,state_:n,then_:null,data_:void 0,then:function(t,e){var i={owner:this,then:new this.constructor(l),fulfilled:t,rejected:e};return this.state_===s||this.state_===a?m(f,i):this.then_.push(i),i.then},catch:function(t){return this.then(null,t)}},S.all=function(t){if(!h(t))throw new TypeError("You must pass an array to Promise.all().");return new this((function(e,i){var r=[],n=0;function o(t){return n++,function(i){r[t]=i,--n||e(r)}}for(var s,a=0;a<t.length;a++)(s=t[a])&&"function"==typeof s.then?s.then(o(a),i):r[a]=s;n||e(r)}))},S.race=function(t){if(!h(t))throw new TypeError("You must pass an array to Promise.race().");return new this((function(e,i){for(var r,n=0;n<t.length;n++)(r=t[n])&&"function"==typeof r.then?r.then(e,i):e(r)}))},S.resolve=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this((function(e){e(t)}))},S.reject=function(t){return new this((function(e,i){i(t)}))}}("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:e)})),n=(r.Promise,r.Polyfill),o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;var l=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,r,n=arguments,l=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),h=1;h<arguments.length;h++){for(var c in i=Object(n[h]))s.call(i,c)&&(l[c]=i[c]);if(o){r=o(i);for(var u=0;u<r.length;u++)a.call(i,r[u])&&(l[r[u]]=i[r[u]])}}return l};window.Promise||(window.Promise=n),Object.assign||(Object.assign=l);if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!window.performance||!window.performance.now){var h=Date.now();window.performance||(window.performance={}),window.performance.now=function(){return Date.now()-h}}for(var c=Date.now(),u=["ms","moz","webkit","o"],p=0;p<u.length&&!window.requestAnimationFrame;++p){var d=u[p];window.requestAnimationFrame=window[d+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d+"CancelAnimationFrame"]||window[d+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),i=16+c-e;return i<0&&(i=0),c=e,window.setTimeout((function(){c=Date.now(),t(performance.now())}),i)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array);var m=/iPhone/i,f=/iPod/i,y=/iPad/i,_=/\biOS-universal(?:.+)Mac\b/i,g=/\bAndroid(?:.+)Mobile\b/i,x=/Android/i,v=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,b=/Silk/i,w=/Windows Phone/i,S=/\bWindows(?:.+)ARM\b/i,C=/BlackBerry/i,D=/BB10/i,T=/Opera Mini/i,A=/\b(CriOS|Chrome)(?:.+)Mobile/i,E=/Mobile(?:.+)Firefox\b/i,I=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};var P=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,r=i.split("[FBAN");void 0!==r[1]&&(i=r[0]),void 0!==(r=i.split("Twitter"))[1]&&(i=r[0]);var n=function(t){return function(e){return e.test(t)}}(i),o={apple:{phone:n(m)&&!n(w),ipod:n(f),tablet:!n(m)&&(n(y)||I(e))&&!n(w),universal:n(_),device:(n(m)||n(f)||n(y)||n(_)||I(e))&&!n(w)},amazon:{phone:n(v),tablet:!n(v)&&n(b),device:n(v)||n(b)},android:{phone:!n(w)&&n(v)||!n(w)&&n(g),tablet:!n(w)&&!n(v)&&!n(g)&&(n(b)||n(x)),device:!n(w)&&(n(v)||n(b)||n(g)||n(x))||n(/\bokhttp\b/i)},windows:{phone:n(w),tablet:n(S),device:n(w)||n(S)},other:{blackberry:n(C),blackberry10:n(D),opera:n(T),firefox:n(E),chrome:n(A),device:n(C)||n(D)||n(T)||n(E)||n(A)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}(window.navigator);var B={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:function(t){var e=!0;if(P.tablet||P.phone){var i;if(P.apple.device)if(i=navigator.userAgent.match(/OS (\d+)_(\d+)?/))parseInt(i[1],10)<11&&(e=!1);if(P.android.device)if(i=navigator.userAgent.match(/Android\s([0-9.]*)/))parseInt(i[1],10)<7&&(e=!1)}return e?t:4}(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:P.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:!P.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},M=i((function(t){var e=Object.prototype.hasOwnProperty,i="~";function r(){}function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function o(t,e,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new n(r,o||t,s),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,r,n=[];if(0===this._eventsCount)return n;for(r in t=this._events)e.call(t,r)&&n.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=i?i+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,s=new Array(o);n<o;n++)s[n]=r[n].fn;return s},a.prototype.listenerCount=function(t){var e=i?i+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,n,o,s){var a=arguments,l=i?i+t:t;if(!this._events[l])return!1;var h,c,u=this._events[l],p=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),p){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,r),!0;case 4:return u.fn.call(u.context,e,r,n),!0;case 5:return u.fn.call(u.context,e,r,n,o),!0;case 6:return u.fn.call(u.context,e,r,n,o,s),!0}for(c=1,h=new Array(p-1);c<p;c++)h[c-1]=a[c];u.fn.apply(u.context,h)}else{var d,m=u.length;for(c=0;c<m;c++)switch(u[c].once&&this.removeListener(t,u[c].fn,void 0,!0),p){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,e);break;case 3:u[c].fn.call(u[c].context,e,r);break;case 4:u[c].fn.call(u[c].context,e,r,n);break;default:if(!h)for(d=1,h=new Array(p-1);d<p;d++)h[d-1]=a[d];u[c].fn.apply(u[c].context,h)}}return!0},a.prototype.on=function(t,e,i){return o(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return o(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,r,n){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||n&&!a.once||r&&a.context!==r||s(this,o);else{for(var l=0,h=[],c=a.length;l<c;l++)(a[l].fn!==e||n&&!a[l].once||r&&a[l].context!==r)&&h.push(a[l]);h.length?this._events[o]=1===h.length?h[0]:h:s(this,o)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&s(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a})),O=L,R=L;function L(t,e,i){i=i||2;var r,n,o,s,a,l,h,c=e&&e.length,u=c?e[0]*i:t.length,p=k(t,0,u,i,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(t,e,i,r){var n,o,s,a=[];for(n=0,o=e.length;n<o;n++)(s=k(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(W(s));for(a.sort(z),n=0;n<a.length;n++)i=F(i=X(a[n],i),i.next);return i}(t,e,p,i)),t.length>80*i){r=o=t[0],n=s=t[1];for(var m=i;m<u;m+=i)(a=t[m])<r&&(r=a),(l=t[m+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);h=0!==(h=Math.max(o-r,s-n))?1/h:0}return N(p,d,i,r,n,h),d}function k(t,e,i,r,n){var o,s;if(n===st(t,e,i,r)>0)for(o=e;o<i;o+=r)s=rt(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=rt(o,t[o],t[o+1],s);return s&&K(s,s.next)&&(nt(s),s=s.next),s}function F(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!K(r,r.next)&&0!==q(r.prev,r,r.next))r=r.next;else{if(nt(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function N(t,e,i,r,n,o,s){if(t){!s&&o&&function(t,e,i,r){var n=t;do{null===n.z&&(n.z=J(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,l,h=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<h&&(a++,r=r.nextZ);e++);for(l=h;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,h*=2}while(s>1)}(n)}(t,r,n,o);for(var a,l,h=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?G(t,r,n,o):V(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),nt(t),t=l.next,h=l.next;else if((t=l)===h){s?1===s?N(t=U(F(t),e,i),e,i,r,n,o,2):2===s&&j(t,e,i,r,n,o):N(F(t),e,i,r,n,o,1);break}}}function V(t){var e=t.prev,i=t,r=t.next;if(q(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if($(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&q(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function G(t,e,i,r){var n=t.prev,o=t,s=t.next;if(q(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,h=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,u=J(a,l,e,i,r),p=J(h,c,e,i,r),d=t.prevZ,m=t.nextZ;d&&d.z>=u&&m&&m.z<=p;){if(d!==t.prev&&d!==t.next&&$(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&q(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,m!==t.prev&&m!==t.next&&$(n.x,n.y,o.x,o.y,s.x,s.y,m.x,m.y)&&q(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&$(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&q(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=p;){if(m!==t.prev&&m!==t.next&&$(n.x,n.y,o.x,o.y,s.x,s.y,m.x,m.y)&&q(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function U(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!K(n,o)&&Z(n,r,r.next,o)&&et(n,o)&&et(o,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(o.i/i),nt(r),nt(r.next),r=t=o),r=r.next}while(r!==t);return F(r)}function j(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Y(s,a)){var l=it(s,a);return s=F(s,s.next),l=F(l,l.next),N(s,e,i,r,n,o),void N(l,e,i,r,n,o)}a=a.next}s=s.next}while(s!==t)}function z(t,e){return t.x-e.x}function X(t,e){var i=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===s)return i;var l,h=i,c=i.x,u=i.y,p=1/0;r=i;do{n>=r.x&&r.x>=c&&n!==r.x&&$(o<u?n:s,o,c,u,o<u?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),et(r,t)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&H(i,r)))&&(i=r,p=l)),r=r.next}while(r!==h);return i}(t,e);if(!i)return e;var r=it(i,t),n=F(i,i.next);return F(r,r.next),e===i?n:e}function H(t,e){return q(t.prev,t,e.prev)<0&&q(e.next,t,t.next)<0}function J(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function W(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function $(t,e,i,r,n,o,s,a){return(n-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(i-s)*(e-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function Y(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Z(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(et(t,e)&&et(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(q(t.prev,t,e.prev)||q(t,e.prev,e))||K(t,e)&&q(t.prev,t,t.next)>0&&q(e.prev,e,e.next)>0)}function q(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function K(t,e){return t.x===e.x&&t.y===e.y}function Z(t,e,i,r){var n=tt(q(t,e,i)),o=tt(q(t,e,r)),s=tt(q(i,r,t)),a=tt(q(i,r,e));return n!==o&&s!==a||(!(0!==n||!Q(t,i,e))||(!(0!==o||!Q(t,r,e))||(!(0!==s||!Q(i,t,r))||!(0!==a||!Q(i,e,r)))))}function Q(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function tt(t){return t>0?1:t<0?-1:0}function et(t,e){return q(t.prev,t,t.next)<0?q(t,e,t.next)>=0&&q(t,t.prev,e)>=0:q(t,e,t.prev)<0||q(t,t.next,e)<0}function it(t,e){var i=new ot(t.i,t.x,t.y),r=new ot(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function rt(t,e,i,r){var n=new ot(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function nt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ot(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function st(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}L.deviation=function(t,e,i,r){var n=e&&e.length,o=n?e[0]*i:t.length,s=Math.abs(st(t,0,o,i));if(n)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,c=a<l-1?e[a+1]*i:t.length;s-=Math.abs(st(t,h,c,i))}var u=0;for(a=0;a<r.length;a+=3){var p=r[a]*i,d=r[a+1]*i,m=r[a+2]*i;u+=Math.abs((t[p]-t[m])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[m+1]-t[p+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},L.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i},O.default=R;var at=i((function(t,i){!function(r){var n=i&&!i.nodeType&&i,o=t&&!t.nodeType&&t,s="object"==typeof e&&e;s.global!==s&&s.window!==s&&s.self!==s||(r=s);var a,l,h=2147483647,c=36,u=1,p=26,d=38,m=700,f=72,y=128,_="-",g=/^xn--/,x=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=c-u,S=Math.floor,C=String.fromCharCode;function D(t){throw RangeError(b[t])}function T(t,e){for(var i=t.length,r=[];i--;)r[i]=e(t[i]);return r}function A(t,e){var i=t.split("@"),r="";return i.length>1&&(r=i[0]+"@",t=i[1]),r+T((t=t.replace(v,".")).split("."),e).join(".")}function E(t){for(var e,i,r=[],n=0,o=t.length;n<o;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<o?56320==(64512&(i=t.charCodeAt(n++)))?r.push(((1023&e)<<10)+(1023&i)+65536):(r.push(e),n--):r.push(e);return r}function I(t){return T(t,(function(t){var e="";return t>65535&&(e+=C((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=C(t)})).join("")}function P(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function B(t,e,i){var r=0;for(t=i?S(t/m):t>>1,t+=S(t/e);t>w*p>>1;r+=c)t=S(t/w);return S(r+(w+1)*t/(t+d))}function M(t){var e,i,r,n,o,s,a,l,d,m,g,x=[],v=t.length,b=0,w=y,C=f;for((i=t.lastIndexOf(_))<0&&(i=0),r=0;r<i;++r)t.charCodeAt(r)>=128&&D("not-basic"),x.push(t.charCodeAt(r));for(n=i>0?i+1:0;n<v;){for(o=b,s=1,a=c;n>=v&&D("invalid-input"),((l=(g=t.charCodeAt(n++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:c)>=c||l>S((h-b)/s))&&D("overflow"),b+=l*s,!(l<(d=a<=C?u:a>=C+p?p:a-C));a+=c)s>S(h/(m=c-d))&&D("overflow"),s*=m;C=B(b-o,e=x.length+1,0==o),S(b/e)>h-w&&D("overflow"),w+=S(b/e),b%=e,x.splice(b++,0,w)}return I(x)}function O(t){var e,i,r,n,o,s,a,l,d,m,g,x,v,b,w,T=[];for(x=(t=E(t)).length,e=y,i=0,o=f,s=0;s<x;++s)(g=t[s])<128&&T.push(C(g));for(r=n=T.length,n&&T.push(_);r<x;){for(a=h,s=0;s<x;++s)(g=t[s])>=e&&g<a&&(a=g);for(a-e>S((h-i)/(v=r+1))&&D("overflow"),i+=(a-e)*v,e=a,s=0;s<x;++s)if((g=t[s])<e&&++i>h&&D("overflow"),g==e){for(l=i,d=c;!(l<(m=d<=o?u:d>=o+p?p:d-o));d+=c)w=l-m,b=c-m,T.push(C(P(m+w%b,0))),l=S(w/b);T.push(C(P(l,0))),o=B(i,v,r==n),i=0,++r}++i,++e}return T.join("")}if(a={version:"1.3.2",ucs2:{decode:E,encode:I},decode:M,encode:O,toASCII:function(t){return A(t,(function(t){return x.test(t)?"xn--"+O(t):t}))},toUnicode:function(t){return A(t,(function(t){return g.test(t)?M(t.slice(4).toLowerCase()):t}))}},n&&o)if(t.exports==n)o.exports=a;else for(l in a)a.hasOwnProperty(l)&&(n[l]=a[l]);else r.punycode=a}(e)})),lt={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};lt.isString,lt.isObject,lt.isNull,lt.isNullOrUndefined;function ht(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var ct=function(t,e,i,r){e=e||"&",i=i||"=";var n={};if("string"!=typeof t||0===t.length)return n;var o=/\+/g;t=t.split(e);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var l=0;l<a;++l){var h,c,u,p,d=t[l].replace(o,"%20"),m=d.indexOf(i);m>=0?(h=d.substr(0,m),c=d.substr(m+1)):(h=d,c=""),u=decodeURIComponent(h),p=decodeURIComponent(c),ht(n,u)?Array.isArray(n[u])?n[u].push(p):n[u]=[n[u],p]:n[u]=p}return n},ut=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},pt=function(t,e,i,r){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(r){var n=encodeURIComponent(ut(r))+i;return Array.isArray(t[r])?t[r].map((function(t){return n+encodeURIComponent(ut(t))})).join(e):n+encodeURIComponent(ut(t[r]))})).join(e):r?encodeURIComponent(ut(r))+i+encodeURIComponent(ut(t)):""},dt=i((function(t,e){e.decode=e.parse=ct,e.encode=e.stringify=pt})),mt=(dt.decode,dt.parse,dt.encode,dt.stringify,Mt),ft=function(t,e){return Mt(t,!1,!0).resolve(e)},yt=function(t,e){if(!t)return e;return Mt(t,!1,!0).resolveObject(e)},_t=function(t){lt.isString(t)&&(t=Mt(t));if(!(t instanceof xt))return xt.prototype.format.call(t);return t.format()},gt=xt;function xt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var vt=/^([a-z0-9.+-]+:)/i,bt=/:[0-9]*$/,wt=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,St=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Ct=["'"].concat(St),Dt=["%","/","?",";","#"].concat(Ct),Tt=["/","?","#"],At=/^[+a-z0-9A-Z_-]{0,63}$/,Et=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,It={javascript:!0,"javascript:":!0},Pt={javascript:!0,"javascript:":!0},Bt={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Mt(t,e,i){if(t&&lt.isObject(t)&&t instanceof xt)return t;var r=new xt;return r.parse(t,e,i),r}xt.prototype.parse=function(t,e,i){if(!lt.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),n=-1!==r&&r<t.indexOf("#")?"?":"#",o=t.split(n);o[0]=o[0].replace(/\\/g,"/");var s=t=o.join(n);if(s=s.trim(),!i&&1===t.split("#").length){var a=wt.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?dt.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=vt.exec(s);if(l){var h=(l=l[0]).toLowerCase();this.protocol=h,s=s.substr(l.length)}if(i||l||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var c="//"===s.substr(0,2);!c||l&&Pt[l]||(s=s.substr(2),this.slashes=!0)}if(!Pt[l]&&(c||l&&!Bt[l])){for(var u,p,d=-1,m=0;m<Tt.length;m++){-1!==(f=s.indexOf(Tt[m]))&&(-1===d||f<d)&&(d=f)}-1!==(p=-1===d?s.lastIndexOf("@"):s.lastIndexOf("@",d))&&(u=s.slice(0,p),s=s.slice(p+1),this.auth=decodeURIComponent(u)),d=-1;for(m=0;m<Dt.length;m++){var f;-1!==(f=s.indexOf(Dt[m]))&&(-1===d||f<d)&&(d=f)}-1===d&&(d=s.length),this.host=s.slice(0,d),s=s.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!y)for(var _=this.hostname.split(/\./),g=(m=0,_.length);m<g;m++){var x=_[m];if(x&&!x.match(At)){for(var v="",b=0,w=x.length;b<w;b++)x.charCodeAt(b)>127?v+="x":v+=x[b];if(!v.match(At)){var S=_.slice(0,m),C=_.slice(m+1),D=x.match(Et);D&&(S.push(D[1]),C.unshift(D[2])),C.length&&(s="/"+C.join(".")+s),this.hostname=S.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=at.toASCII(this.hostname));var T=this.port?":"+this.port:"",A=this.hostname||"";this.host=A+T,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!It[h])for(m=0,g=Ct.length;m<g;m++){var E=Ct[m];if(-1!==s.indexOf(E)){var I=encodeURIComponent(E);I===E&&(I=escape(E)),s=s.split(E).join(I)}}var P=s.indexOf("#");-1!==P&&(this.hash=s.substr(P),s=s.slice(0,P));var B=s.indexOf("?");if(-1!==B?(this.search=s.substr(B),this.query=s.substr(B+1),e&&(this.query=dt.parse(this.query)),s=s.slice(0,B)):e&&(this.search="",this.query={}),s&&(this.pathname=s),Bt[h]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){T=this.pathname||"";var M=this.search||"";this.path=T+M}return this.href=this.format(),this},xt.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",n=!1,o="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&lt.isObject(this.query)&&Object.keys(this.query).length&&(o=dt.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Bt[e])&&!1!==n?(n="//"+(n||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):n||(n=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+n+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(s=s.replace("#","%23"))+r},xt.prototype.resolve=function(t){return this.resolveObject(Mt(t,!1,!0)).format()},xt.prototype.resolveObject=function(t){if(lt.isString(t)){var e=new xt;e.parse(t,!1,!0),t=e}for(var i=new xt,r=Object.keys(this),n=0;n<r.length;n++){var o=r[n];i[o]=this[o]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var l=s[a];"protocol"!==l&&(i[l]=t[l])}return Bt[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!Bt[t.protocol]){for(var h=Object.keys(t),c=0;c<h.length;c++){var u=h[c];i[u]=t[u]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||Pt[t.protocol])i.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var d=i.pathname||"",m=i.search||"";i.path=d+m}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var f=i.pathname&&"/"===i.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),_=y||f||i.host&&t.pathname,g=_,x=i.pathname&&i.pathname.split("/")||[],v=(p=t.pathname&&t.pathname.split("/")||[],i.protocol&&!Bt[i.protocol]);if(v&&(i.hostname="",i.port=null,i.host&&(""===x[0]?x[0]=i.host:x.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),_=_&&(""===p[0]||""===x[0])),y)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,x=p;else if(p.length)x||(x=[]),x.pop(),x=x.concat(p),i.search=t.search,i.query=t.query;else if(!lt.isNullOrUndefined(t.search)){if(v)i.hostname=i.host=x.shift(),(D=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=D.shift(),i.host=i.hostname=D.shift());return i.search=t.search,i.query=t.query,lt.isNull(i.pathname)&&lt.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!x.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var b=x.slice(-1)[0],w=(i.host||t.host||x.length>1)&&("."===b||".."===b)||""===b,S=0,C=x.length;C>=0;C--)"."===(b=x[C])?x.splice(C,1):".."===b?(x.splice(C,1),S++):S&&(x.splice(C,1),S--);if(!_&&!g)for(;S--;S)x.unshift("..");!_||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),w&&"/"!==x.join("/").substr(-1)&&x.push("");var D,T=""===x[0]||x[0]&&"/"===x[0].charAt(0);v&&(i.hostname=i.host=T?"":x.length?x.shift():"",(D=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=D.shift(),i.host=i.hostname=D.shift()));return(_=_||i.host&&x.length)&&!T&&x.unshift(""),x.length?i.pathname=x.join("/"):(i.pathname=null,i.path=null),lt.isNull(i.pathname)&&lt.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},xt.prototype.parseHost=function(){var t=this.host,e=bt.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var Ot={parse:mt,resolve:ft,resolveObject:yt,format:_t,Url:gt};!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(t.ENV||(t.ENV={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(t.RENDERER_TYPE||(t.RENDERER_TYPE={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(t.BUFFER_BITS||(t.BUFFER_BITS={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(t.BLEND_MODES||(t.BLEND_MODES={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(t.DRAW_MODES||(t.DRAW_MODES={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(t.FORMATS||(t.FORMATS={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(t.TARGETS||(t.TARGETS={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(t.TYPES||(t.TYPES={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(t.SCALE_MODES||(t.SCALE_MODES={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(t.WRAP_MODES||(t.WRAP_MODES={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON"}(t.MIPMAP_MODES||(t.MIPMAP_MODES={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(t.ALPHA_MODES||(t.ALPHA_MODES={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(t.CLEAR_MODES||(t.CLEAR_MODES={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(t.GC_MODES||(t.GC_MODES={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(t.PRECISION||(t.PRECISION={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(t.MASK_TYPES||(t.MASK_TYPES={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(t.MSAA_QUALITY||(t.MSAA_QUALITY={})),B.RETINA_PREFIX=/@([0-9\.]+)x/,B.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var Rt,Lt=!1,kt="5.3.12";function Ft(t){var e;if(!Lt){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["\n %c %c %c PixiJS "+kt+" - âœ° "+t+" âœ°  %c  %c  http://www.pixijs.com/  %c %c â™¥%câ™¥%câ™¥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=window.console).log.apply(e,i)}else window.console&&window.console.log("PixiJS "+kt+" - "+t+" - http://www.pixijs.com/");Lt=!0}}function Nt(){return void 0===Rt&&(Rt=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:B.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!i||!i.getContextAttributes().stencil);if(i){var n=i.getExtension("WEBGL_lose_context");n&&n.loseContext()}return i=null,r}catch(t){return!1}}()),Rt}function Vt(t,e){return void 0===e&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function Gt(t){var e=t.toString(16);return"#"+(e="000000".substr(0,6-e.length)+e)}function Ut(t){return"string"==typeof t&&"#"===t[0]&&(t=t.substr(1)),parseInt(t,16)}function jt(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)}var zt=function(){for(var e=[],i=[],r=0;r<32;r++)e[r]=r,i[r]=r;e[t.BLEND_MODES.NORMAL_NPM]=t.BLEND_MODES.NORMAL,e[t.BLEND_MODES.ADD_NPM]=t.BLEND_MODES.ADD,e[t.BLEND_MODES.SCREEN_NPM]=t.BLEND_MODES.SCREEN,i[t.BLEND_MODES.NORMAL]=t.BLEND_MODES.NORMAL_NPM,i[t.BLEND_MODES.ADD]=t.BLEND_MODES.ADD_NPM,i[t.BLEND_MODES.SCREEN]=t.BLEND_MODES.SCREEN_NPM;var n=[];return n.push(i),n.push(e),n}();function Xt(t,e){return zt[e?1:0][t]}function Ht(t,e,i,r){return i=i||new Float32Array(4),r||void 0===r?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e):(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=e,i}function Jt(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var i=t>>16&255,r=t>>8&255,n=255&t;return(255*e<<24)+((i=i*e+.5|0)<<16)+((r=r*e+.5|0)<<8)+(n=n*e+.5|0)}function Wt(t,e,i,r){return(i=i||new Float32Array(4))[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(255&t)/255,(r||void 0===r)&&(i[0]*=e,i[1]*=e,i[2]*=e),i[3]=e,i}function $t(t,e){void 0===e&&(e=null);var i=6*t;if((e=e||new Uint16Array(i)).length!==i)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+i);for(var r=0,n=0;r<i;r+=6,n+=4)e[r+0]=n+0,e[r+1]=n+1,e[r+2]=n+2,e[r+3]=n+0,e[r+4]=n+2,e[r+5]=n+3;return e}function Yt(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var qt={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function Kt(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Zt(t){return!(t&t-1||!t)}function Qt(t){var e=(t>65535?1:0)<<4,i=((t>>>=e)>255?1:0)<<3;return e|=i,e|=i=((t>>>=i)>15?1:0)<<2,(e|=i=((t>>>=i)>3?1:0)<<1)|(t>>>=i)>>1}function te(t,e,i){var r,n=t.length;if(!(e>=n||0===i)){var o=n-(i=e+i>n?n-e:i);for(r=e;r<o;++r)t[r]=t[r+i];t.length=o}}function ee(t){return 0===t?0:t<0?-1:1}var ie=0;function re(){return++ie}var ne={};function oe(t,e,i){if(void 0===i&&(i=3),!ne[e]){var r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(r=r.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(r))),ne[e]=!0}}var se={},ae=Object.create(null),le=Object.create(null);var he=function(){function t(t,e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||B.RESOLUTION,this.resize(t,e)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t},enumerable:!1,configurable:!0}),t}();function ce(t){var e,i,r,n=t.width,o=t.height,s=t.getContext("2d"),a=s.getImageData(0,0,n,o).data,l=a.length,h={top:null,left:null,right:null,bottom:null},c=null;for(e=0;e<l;e+=4)0!==a[e+3]&&(i=e/4%n,r=~~(e/4/n),null===h.top&&(h.top=r),(null===h.left||i<h.left)&&(h.left=i),(null===h.right||h.right<i)&&(h.right=i+1),(null===h.bottom||h.bottom<r)&&(h.bottom=r));return null!==h.top&&(n=h.right-h.left,o=h.bottom-h.top+1,c=s.getImageData(h.left,h.top,n,o)),{height:o,width:n,data:c}}var ue,pe=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function de(t,e){if(void 0===e&&(e=window.location),0===t.indexOf("data:"))return"";e=e||window.location,ue||(ue=document.createElement("a")),ue.href=t;var i=mt(ue.href),r=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&r&&i.protocol===e.protocol?"":"anonymous"}function me(t,e){var i=B.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):void 0!==e?e:1}var fe,ye={BaseTextureCache:le,CanvasRenderTarget:he,DATA_URI:pe,ProgramCache:se,TextureCache:ae,clearTextureCache:function(){var t;for(t in ae)delete ae[t];for(t in le)delete le[t]},correctBlendMode:Xt,createIndicesForQuads:$t,decomposeDataUri:function(t){var e=pe.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}},deprecation:oe,destroyTextureCache:function(){var t;for(t in ae)ae[t].destroy();for(t in le)le[t].destroy()},determineCrossOrigin:de,getBufferType:Yt,getResolutionOfUrl:me,hex2rgb:Vt,hex2string:Gt,interleaveTypedArrays:function(t,e){for(var i=0,r=0,n={},o=0;o<t.length;o++)r+=e[o],i+=t[o].length;var s=new ArrayBuffer(4*i),a=null,l=0;for(o=0;o<t.length;o++){var h=e[o],c=t[o],u=Yt(c);n[u]||(n[u]=new qt[u](s)),a=n[u];for(var p=0;p<c.length;p++){a[(p/h|0)*r+l+p%h]=c[p]}l+=h}return new Float32Array(s)},isPow2:Zt,isWebGLSupported:Nt,log2:Qt,nextPow2:Kt,premultiplyBlendMode:zt,premultiplyRgba:Ht,premultiplyTint:Jt,premultiplyTintToRgba:Wt,removeItems:te,rgb2hex:jt,sayHello:Ft,sign:ee,skipHello:function(){Lt=!0},string2hex:Ut,trimCanvas:ce,uid:re,isMobile:P,EventEmitter:M,earcut:O,url:Ot},_e=2*Math.PI,ge=180/Math.PI,xe=Math.PI/180;(fe=t.SHAPES||(t.SHAPES={}))[fe.POLY=0]="POLY",fe[fe.RECT=1]="RECT",fe[fe.CIRC=2]="CIRC",fe[fe.ELIP=3]="ELIP",fe[fe.RREC=4]="RREC";var ve=function(){function e(e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this.x=Number(e),this.y=Number(i),this.width=Number(r),this.height=Number(n),this.type=t.SHAPES.RECT}return Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(e,"EMPTY",{get:function(){return new e(0,0,0,0)},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},e.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},e.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},e.prototype.fit=function(t){var e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(n-r,0),this},e.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this},e.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=n-r,this},e}(),be=function(){function e(e,i,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=e,this.y=i,this.radius=r,this.type=t.SHAPES.CIRC}return e.prototype.clone=function(){return new e(this.x,this.y,this.radius)},e.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.radius*this.radius,r=this.x-t,n=this.y-e;return(r*=r)+(n*=n)<=i},e.prototype.getBounds=function(){return new ve(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},e}(),we=function(){function e(e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this.x=e,this.y=i,this.width=r,this.height=n,this.type=t.SHAPES.ELIP}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,r=(e-this.y)/this.height;return(i*=i)+(r*=r)<=1},e.prototype.getBounds=function(){return new ve(this.x-this.width,this.y-this.height,this.width,this.height)},e}(),Se=function(){function e(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];var n=Array.isArray(i[0])?i[0]:i;if("number"!=typeof n[0]){for(var o=[],s=0,a=n.length;s<a;s++)o.push(n[s].x,n[s].y);n=o}this.points=n,this.type=t.SHAPES.POLY,this.closeStroke=!0}return e.prototype.clone=function(){var t=new e(this.points.slice());return t.closeStroke=this.closeStroke,t},e.prototype.contains=function(t,e){for(var i=!1,r=this.points.length/2,n=0,o=r-1;n<r;o=n++){var s=this.points[2*n],a=this.points[2*n+1],l=this.points[2*o],h=this.points[2*o+1];a>e!=h>e&&t<(e-a)/(h-a)*(l-s)+s&&(i=!i)}return i},e}(),Ce=function(){function e(e,i,r,n,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=20),this.x=e,this.y=i,this.width=r,this.height=n,this.radius=o,this.type=t.SHAPES.RREC}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height,this.radius)},e.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var i=t-(this.x+this.radius),r=e-(this.y+this.radius),n=this.radius*this.radius;if(i*i+r*r<=n)return!0;if((i=t-(this.x+this.width-this.radius))*i+r*r<=n)return!0;if(i*i+(r=e-(this.y+this.height-this.radius))*r<=n)return!0;if((i=t-(this.x+this.radius))*i+r*r<=n)return!0}return!1},e}(),De=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t}(),Te=function(){function t(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),this._x=i,this._y=r,this.cb=t,this.scope=e}return t.prototype.clone=function(e,i){return void 0===e&&(e=this.cb),void 0===i&&(i=this.scope),new t(e,i,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),Ae=function(){function t(t,e,i,r,n,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=o}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,i,r,n,o){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},t.prototype.apply=function(t,e){e=e||new De;var i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new De;var i=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return e.x=this.d*i*r+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*n+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,o=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this},t.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this},t.prototype.setTransform=function(t,e,i,r,n,o,s,a,l){return this.a=Math.cos(s+l)*n,this.b=Math.sin(s+l)*n,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,i=this.b,r=this.c,n=this.d,o=-Math.atan2(-r,n),s=Math.atan2(i,e),a=Math.abs(o+s);return a<1e-5||Math.abs(_e-a)<1e-5?(t.rotation=s,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=s),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx,t.position.y=this.ty,t},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,o=t*r-e*i;return this.a=r/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(t*this.ty-e*n)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),Ee=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ie=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Pe=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Be=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Me=[],Oe=[],Re=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];Me.push(e);for(var i=0;i<16;i++)for(var r=Re(Ee[t]*Ee[i]+Pe[t]*Ie[i]),n=Re(Ie[t]*Ee[i]+Be[t]*Ie[i]),o=Re(Ee[t]*Pe[i]+Pe[t]*Be[i]),s=Re(Ie[t]*Pe[i]+Be[t]*Be[i]),a=0;a<16;a++)if(Ee[a]===r&&Ie[a]===n&&Pe[a]===o&&Be[a]===s){e.push(a);break}}for(t=0;t<16;t++){var l=new Ae;l.set(Ee[t],Ie[t],Pe[t],Be[t],0,0),Oe.push(l)}}();var Le={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return Ee[t]},uY:function(t){return Ie[t]},vX:function(t){return Pe[t]},vY:function(t){return Be[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return Me[t][e]},sub:function(t,e){return Me[t][Le.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?Le.S:Le.N:2*Math.abs(e)<=Math.abs(t)?t>0?Le.E:Le.W:e>0?t>0?Le.SE:Le.SW:t>0?Le.NE:Le.NW},matrixAppendRotationInv:function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=Oe[Le.inv(e)];n.tx=i,n.ty=r,t.append(n)}},ke=function(){function t(){this.worldTransform=new Ae,this.localTransform=new Ae,this.position=new Te(this.onChange,this,0,0),this.scale=new Te(this.onChange,this,1,1),this.pivot=new Te(this.onChange,this,0,0),this.skew=new Te(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,r=this.worldTransform;r.a=e.a*i.a+e.b*i.c,r.b=e.a*i.b+e.b*i.d,r.c=e.c*i.a+e.d*i.c,r.d=e.c*i.b+e.d*i.d,r.tx=e.tx*i.a+e.ty*i.c+i.tx,r.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t,t}();B.SORTABLE_CHILDREN=!1;var Fe=function(){function t(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?ve.EMPTY:((t=t||new ve(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addQuad=function(t){var e=this.minX,i=this.minY,r=this.maxX,n=this.maxY,o=t[0],s=t[1];e=o<e?o:e,i=s<i?s:i,r=o>r?o:r,n=s>n?s:n,e=(o=t[2])<e?o:e,i=(s=t[3])<i?s:i,r=o>r?o:r,n=s>n?s:n,e=(o=t[4])<e?o:e,i=(s=t[5])<i?s:i,r=o>r?o:r,n=s>n?s:n,e=(o=t[6])<e?o:e,i=(s=t[7])<i?s:i,r=o>r?o:r,n=s>n?s:n,this.minX=e,this.minY=i,this.maxX=r,this.maxY=n},t.prototype.addFrame=function(t,e,i,r,n){this.addFrameMatrix(t.worldTransform,e,i,r,n)},t.prototype.addFrameMatrix=function(t,e,i,r,n){var o=t.a,s=t.b,a=t.c,l=t.d,h=t.tx,c=t.ty,u=this.minX,p=this.minY,d=this.maxX,m=this.maxY,f=o*e+a*i+h,y=s*e+l*i+c;u=f<u?f:u,p=y<p?y:p,d=f>d?f:d,m=y>m?y:m,u=(f=o*r+a*i+h)<u?f:u,p=(y=s*r+l*i+c)<p?y:p,d=f>d?f:d,m=y>m?y:m,u=(f=o*e+a*n+h)<u?f:u,p=(y=s*e+l*n+c)<p?y:p,d=f>d?f:d,m=y>m?y:m,u=(f=o*r+a*n+h)<u?f:u,p=(y=s*r+l*n+c)<p?y:p,d=f>d?f:d,m=y>m?y:m,this.minX=u,this.minY=p,this.maxX=d,this.maxY=m},t.prototype.addVertexData=function(t,e,i){for(var r=this.minX,n=this.minY,o=this.maxX,s=this.maxY,a=e;a<i;a+=2){var l=t[a],h=t[a+1];r=l<r?l:r,n=h<n?h:n,o=l>o?l:o,s=h>s?h:s}this.minX=r,this.minY=n,this.maxX=o,this.maxY=s},t.prototype.addVertices=function(t,e,i,r){this.addVerticesMatrix(t.worldTransform,e,i,r)},t.prototype.addVerticesMatrix=function(t,e,i,r,n,o){void 0===n&&(n=0),void 0===o&&(o=n);for(var s=t.a,a=t.b,l=t.c,h=t.d,c=t.tx,u=t.ty,p=this.minX,d=this.minY,m=this.maxX,f=this.maxY,y=i;y<r;y+=2){var _=e[y],g=e[y+1],x=s*_+l*g+c,v=h*g+a*_+u;p=Math.min(p,x-n),m=Math.max(m,x+n),d=Math.min(d,v-o),f=Math.max(f,v+o)}this.minX=p,this.minY=d,this.maxX=m,this.maxY=f},t.prototype.addBounds=function(t){var e=this.minX,i=this.minY,r=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>n?t.maxY:n},t.prototype.addBoundsMask=function(t,e){var i=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=n&&r<=o){var s=this.minX,a=this.minY,l=this.maxX,h=this.maxY;this.minX=i<s?i:s,this.minY=r<a?r:a,this.maxX=n>l?n:l,this.maxY=o>h?o:h}},t.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},t.prototype.addBoundsArea=function(t,e){var i=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=n&&r<=o){var s=this.minX,a=this.minY,l=this.maxX,h=this.maxY;this.minX=i<s?i:s,this.minY=r<a?r:a,this.maxX=n>l?n:l,this.maxY=o>h?o:h}},t.prototype.pad=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},t.prototype.addFramePad=function(t,e,i,r,n,o){t-=n,e-=o,i+=n,r+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r},t}(),Ne=function(t,e){return Ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Ne(t,e)};function Ve(t,e){function i(){this.constructor=t}Ne(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Ge=function(t){function e(){var e=t.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new ke,e.alpha=1,e.visible=!0,e.renderable=!0,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new Fe,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return Ve(e,t),e.mixin=function(t){for(var i=Object.keys(t),r=0;r<i.length;++r){var n=i[r];Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t,n))}},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new ve),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new ve),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Fe);var e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var r=this._bounds,n=this._boundsID;this._bounds=this._localBounds;var o=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-n,o},e.prototype.toGlobal=function(t,e,i){return void 0===i&&(i=!1),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,i,r){return e&&(t=e.toGlobal(t,i,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,i,r,n,o,s,a,l){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===l&&(l=0),this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=r||1,this.rotation=n,this.skew.x=o,this.skew.y=s,this.pivot.x=a,this.pivot.y=l,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Ue),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*ge},set:function(t){this.transform.rotation=t*xe},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){var e;this._mask&&((e=this._mask.maskObject||this._mask).renderable=!0,e.isMask=!1);(this._mask=t,this._mask)&&((e=this._mask.maskObject||this._mask).renderable=!1,e.isMask=!0)},enumerable:!1,configurable:!0}),e}(M),Ue=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sortDirty=null,e}return Ve(e,t),e}(Ge);function je(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}Ge.prototype.displayObjectUpdateTransform=Ge.prototype.updateTransform;var ze=function(t){function e(){var e=t.call(this)||this;return e.children=[],e.sortableChildren=B.SORTABLE_CHILDREN,e.sortDirty=!1,e}return Ve(e,t),e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];if(e.length>1)for(var r=0;r<e.length;r++)this.addChild(e[r]);else{var n=e[0];n.parent&&n.parent.removeChild(n),n.parent=this,this.sortDirty=!0,n.transform._parentID=-1,this.children.push(n),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",n,this,this.children.length-1),n.emit("added",this)}return e[0]},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);this.children[i]=e,this.children[r]=t,this.onChildrenChange(i<r?i:r)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var i=this.getChildIndex(t);te(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];if(e.length>1)for(var r=0;r<e.length;r++)this.removeChild(e[r]);else{var n=e[0],o=this.children.indexOf(n);if(-1===o)return null;n.parent=null,n.transform._parentID=-1,te(this.children,o,1),this._boundsID++,this.onChildrenChange(o),n.emit("removed",this),this.emit("childRemoved",n,this,o)}return e[0]},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,te(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var i,r=t,n=e-r;if(n>0&&n<=e){i=this.children.splice(r,n);for(var o=0;o<i.length;++o)i[o].parent=null,i[o].transform&&(i[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(o=0;o<i.length;++o)i[o].emit("removed",this),this.emit("childRemoved",i[o],this,o);return i}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,i=this.children.length;e<i;++e){var r=this.children[e];r._lastSortedIndex=e,t||0===r.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(je),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var i=this.children[t];i.visible&&i.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var i=e._mask.maskObject||e._mask;i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(e,i){void 0===i&&(i=!1);var r=t.prototype.getLocalBounds.call(this,e);if(!i)for(var n=0,o=this.children.length;n<o;++n){var s=this.children[n];s.visible&&s.updateTransform()}return r},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var r=0;r<e.length;r++)e[r].enabled&&this._enabledFilters.push(e[r]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}i&&t.mask.push(this,this._mask),this._render(t);r=0;for(var n=this.children.length;r<n;r++)this.children[r].render(t);t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var i="boolean"==typeof e?e:e&&e.children,r=this.removeChildren(0,this.children.length);if(i)for(var n=0;n<r.length;++n)r[n].destroy(e)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},enumerable:!1,configurable:!0}),e}(Ge);ze.prototype.containerUpdateTransform=ze.prototype.updateTransform;var Xe={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Ge.mixin(Xe);var He,Je=100,We=function(){function t(t){this._hookDiv=null,(P.tablet||P.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width=Je+"px",e.style.height=Je+"px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._isActive=!1,this._isMobileAccessibility=!1,this.androidUpdateCount=0,this.androidUpdateFrequency=500,window.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessability for this content",e.addEventListener("focus",(function(){t._isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e},t.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},t.prototype.activate=function(){this._isActive||(this._isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},t.prototype.deactivate=function(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}},t.prototype.update=function(){var t=performance.now();if(!(P.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),i=this.renderer.resolution,r=e.width/this.renderer.width*i,n=e.height/this.renderer.height*i,o=this.div;o.style.left=e.left+"px",o.style.top=e.top+"px",o.style.width=this.renderer.width+"px",o.style.height=this.renderer.height+"px";for(var s=0;s<this.children.length;s++){var a=this.children[s];if(a.renderId!==this.renderId)a._accessibleActive=!1,te(this.children,s,1),this.div.removeChild(a._accessibleDiv),this.pool.push(a._accessibleDiv),a._accessibleDiv=null,s--;else{o=a._accessibleDiv;var l=a.hitArea,h=a.worldTransform;a.hitArea?(o.style.left=(h.tx+l.x*h.a)*r+"px",o.style.top=(h.ty+l.y*h.d)*n+"px",o.style.width=l.width*h.a*r+"px",o.style.height=l.height*h.d*n+"px"):(l=a.getBounds(),this.capHitArea(l),o.style.left=l.x*r+"px",o.style.top=l.y*n+"px",o.style.width=l.width*r+"px",o.style.height=l.height*n+"px",o.title!==a.accessibleTitle&&null!==a.accessibleTitle&&(o.title=a.accessibleTitle),o.getAttribute("aria-label")!==a.accessibleHint&&null!==a.accessibleHint&&o.setAttribute("aria-label",a.accessibleHint)),a.accessibleTitle===o.title&&a.tabIndex===o.tabIndex||(o.title=a.accessibleTitle,o.tabIndex=a.tabIndex,this.debug&&this.updateDebugHTML(o))}}this.renderId++}},t.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width=Je+"px",e.style.height=Je+"px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData),e.dispatchEvent(t.target.displayObject,"pointertap",e.eventData),e.dispatchEvent(t.target.displayObject,"tap",e.eventData)},t.prototype._onFocus=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},t.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},t.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},t.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},t.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}();B.TARGET_FPMS=.06,(He=t.UPDATE_PRIORITY||(t.UPDATE_PRIORITY={}))[He.INTERACTION=50]="INTERACTION",He[He.HIGH=25]="HIGH",He[He.NORMAL=0]="NORMAL",He[He.LOW=-25]="LOW",He[He.UTILITY=-50]="UTILITY";var $e=function(){function t(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=0),void 0===r&&(r=!1),this.fn=t,this.context=e,this.priority=i,this.once=r,this.next=null,this.previous=null,this._destroyed=!1}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),Ye=function(){function e(){var t=this;this._head=new $e(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/B.TARGET_FPMS,this.elapsedMS=1/B.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return e.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},e.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},e.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},e.prototype.add=function(e,i,r){return void 0===r&&(r=t.UPDATE_PRIORITY.NORMAL),this._addListener(new $e(e,i,r))},e.prototype.addOnce=function(e,i,r){return void 0===r&&(r=t.UPDATE_PRIORITY.NORMAL),this._addListener(new $e(e,i,r,!0))},e.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this},e.prototype.remove=function(t,e){for(var i=this._head.next;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(e.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},e.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},e.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},e.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*B.TARGET_FPMS;for(var r=this._head,n=r.next;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(e.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,B.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"shared",{get:function(){if(!e._shared){var t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared},enumerable:!1,configurable:!0}),Object.defineProperty(e,"system",{get:function(){if(!e._system){var t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system},enumerable:!1,configurable:!0}),e}(),qe=function(){function e(){}return e.init=function(e){var i=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,t.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){i._ticker.stop()},this.start=function(){i._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Ye.shared:new Ye,e.autoStart&&this.start()},e.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},e}(),Ke=function(){function t(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new De,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(t.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),t.prototype.getLocalPosition=function(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)},t.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},t}(),Ze=function(t,e){return Ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Ze(t,e)};var Qe=function(){function t(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},t.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},t}(),ti=function(){function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},Object.defineProperty(t.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return this._flags===t.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"over",{get:function(){return 0!=(this._flags&t.FLAGS.OVER)},set:function(e){this._doSet(t.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightDown",{get:function(){return 0!=(this._flags&t.FLAGS.RIGHT_DOWN)},set:function(e){this._doSet(t.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftDown",{get:function(){return 0!=(this._flags&t.FLAGS.LEFT_DOWN)},set:function(e){this._doSet(t.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),t.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),t}(),ei=function(){function t(){this._tempPoint=new De}return t.prototype.recursiveFindHit=function(t,e,i,r,n){if(!e||!e.visible)return!1;var o=t.data.global,s=!1,a=n=e.interactive||n,l=!0;if(e.hitArea?(r&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?s=!0:(r=!1,l=!1)),a=!1):e._mask&&r&&(e._mask.containsPoint&&e._mask.containsPoint(o)||(r=!1)),l&&e.interactiveChildren&&e.children)for(var h=e.children,c=h.length-1;c>=0;c--){var u=h[c],p=this.recursiveFindHit(t,u,i,r,a);if(p){if(!u.parent)continue;a=!1,p&&(t.target&&(r=!1),s=!0)}}return n&&(r&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(s=!0),e.interactive&&(s&&!t.target&&(t.target=e),i&&i(t,e,!!s))),s},t.prototype.findHit=function(t,e,i,r){this.recursiveFindHit(t,e,i,r,!1)},t}(),ii={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};Ge.mixin(ii);var ri={target:null,data:{global:null}},ni=function(e){function i(t,i){var r=e.call(this)||this;return i=i||{},r.renderer=t,r.autoPreventDefault=void 0===i.autoPreventDefault||i.autoPreventDefault,r.interactionFrequency=i.interactionFrequency||10,r.mouse=new Ke,r.mouse.identifier=1,r.mouse.global.set(-999999),r.activeInteractionData={},r.activeInteractionData[1]=r.mouse,r.interactionDataPool=[],r.eventData=new Qe,r.interactionDOMElement=null,r.moveWhenInside=!1,r.eventsAdded=!1,r.tickerAdded=!1,r.mouseOverRenderer=!1,r.supportsTouchEvents="ontouchstart"in window,r.supportsPointerEvents=!!window.PointerEvent,r.onPointerUp=r.onPointerUp.bind(r),r.processPointerUp=r.processPointerUp.bind(r),r.onPointerCancel=r.onPointerCancel.bind(r),r.processPointerCancel=r.processPointerCancel.bind(r),r.onPointerDown=r.onPointerDown.bind(r),r.processPointerDown=r.processPointerDown.bind(r),r.onPointerMove=r.onPointerMove.bind(r),r.processPointerMove=r.processPointerMove.bind(r),r.onPointerOut=r.onPointerOut.bind(r),r.processPointerOverOut=r.processPointerOverOut.bind(r),r.onPointerOver=r.onPointerOver.bind(r),r.cursorStyles={default:"inherit",pointer:"pointer"},r.currentCursorMode=null,r.cursor=null,r.resolution=1,r.delayedEvents=[],r.search=new ei,r._tempDisplayObject=new Ue,r._useSystemTicker=void 0===i.useSystemTicker||i.useSystemTicker,r.setTargetElement(r.renderer.view,r.renderer.resolution),r}return function(t,e){function i(){this.constructor=t}Ze(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(i,e),Object.defineProperty(i.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),i.prototype.hitTest=function(t,e){return ri.target=null,ri.data.global=t,e||(e=this.lastObjectRendered),this.processInteractive(ri,e,null,!0),ri.target},i.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},i.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(Ye.system.add(this.tickerUpdate,this,t.UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},i.prototype.removeTickerListener=function(){this.tickerAdded&&(Ye.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},i.prototype.addEvents=function(){if(!this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0}},i.prototype.removeEvents=function(){if(this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1}},i.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},i.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var i=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(i,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},i.prototype.setCursorMode=function(t){if(t=t||"default",this.currentCursorMode!==t){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch(typeof e){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},i.prototype.dispatchEvent=function(t,e,i){i.stopPropagationHint&&t!==i.stopsPropagatingAt||(i.currentTarget=t,i.type=e,t.emit(e,i),t[e]&&t[e](i))},i.prototype.delayDispatchEvent=function(t,e,i){this.delayedEvents.push({displayObject:t,eventString:e,eventData:i})},i.prototype.mapPositionToPoint=function(t,e,i){var r;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var n=1/this.resolution;t.x=(e-r.left)*(this.interactionDOMElement.width/r.width)*n,t.y=(i-r.top)*(this.interactionDOMElement.height/r.height)*n},i.prototype.processInteractive=function(t,e,i,r){var n=this.search.findHit(t,e,i,r),o=this.delayedEvents;if(!o.length)return n;t.stopPropagationHint=!1;var s=o.length;this.delayedEvents=[];for(var a=0;a<s;a++){var l=o[a],h=l.displayObject,c=l.eventString,u=l.eventData;u.stopsPropagatingAt===h&&(u.stopPropagationHint=!0),this.dispatchEvent(h,c,u)}return n},i.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var i=e.length,r=0;r<i;r++){var n=e[r],o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);if(s.data.originalEvent=t,this.processInteractive(s,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",s),"touch"===n.pointerType)this.emit("touchstart",s);else if("mouse"===n.pointerType||"pen"===n.pointerType){var a=2===n.button;this.emit(a?"rightdown":"mousedown",this.eventData)}}}},i.prototype.processPointerDown=function(t,e,i){var r=t.data,n=t.data.identifier;if(i)if(e.trackedPointers[n]||(e.trackedPointers[n]=new ti(n)),this.dispatchEvent(e,"pointerdown",t),"touch"===r.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===r.pointerType||"pen"===r.pointerType){var o=2===r.button;o?e.trackedPointers[n].rightDown=!0:e.trackedPointers[n].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},i.prototype.onPointerComplete=function(t,e,i){for(var r=this.normalizeToPointerData(t),n=r.length,o=t.target!==this.interactionDOMElement?"outside":"",s=0;s<n;s++){var a=r[s],l=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,l);if(h.data.originalEvent=t,this.processInteractive(h,this.lastObjectRendered,i,e||!o),this.emit(e?"pointercancel":"pointerup"+o,h),"mouse"===a.pointerType||"pen"===a.pointerType){var c=2===a.button;this.emit(c?"rightup"+o:"mouseup"+o,h)}else"touch"===a.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,h),this.releaseInteractionDataForPointerId(a.pointerId))}},i.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},i.prototype.processPointerCancel=function(t,e){var i=t.data,r=t.data.identifier;void 0!==e.trackedPointers[r]&&(delete e.trackedPointers[r],this.dispatchEvent(e,"pointercancel",t),"touch"===i.pointerType&&this.dispatchEvent(e,"touchcancel",t))},i.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},i.prototype.processPointerUp=function(t,e,i){var r=t.data,n=t.data.identifier,o=e.trackedPointers[n],s="touch"===r.pointerType,a="mouse"===r.pointerType||"pen"===r.pointerType,l=!1;if(a){var h=2===r.button,c=ti.FLAGS,u=h?c.RIGHT_DOWN:c.LEFT_DOWN,p=void 0!==o&&o.flags&u;i?(this.dispatchEvent(e,h?"rightup":"mouseup",t),p&&(this.dispatchEvent(e,h?"rightclick":"click",t),l=!0)):p&&this.dispatchEvent(e,h?"rightupoutside":"mouseupoutside",t),o&&(h?o.rightDown=!1:o.leftDown=!1)}i?(this.dispatchEvent(e,"pointerup",t),s&&this.dispatchEvent(e,"touchend",t),o&&(a&&!l||this.dispatchEvent(e,"pointertap",t),s&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),s&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[n]},i.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this._didMove=!0,this.cursor=null);for(var i=e.length,r=0;r<i;r++){var n=e[r],o=this.getInteractionDataForPointerId(n),s=this.configureInteractionEventForDOMEvent(this.eventData,n,o);s.data.originalEvent=t,this.processInteractive(s,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",s),"touch"===n.pointerType&&this.emit("touchmove",s),"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.emit("mousemove",s)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},i.prototype.processPointerMove=function(t,e,i){var r=t.data,n="touch"===r.pointerType,o="mouse"===r.pointerType||"pen"===r.pointerType;o&&this.processPointerOverOut(t,e,i),this.moveWhenInside&&!i||(this.dispatchEvent(e,"pointermove",t),n&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},i.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var i=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,i);r.data.originalEvent=e,this.processInteractive(r,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",r),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",r):this.releaseInteractionDataForPointerId(i.identifier)}},i.prototype.processPointerOverOut=function(t,e,i){var r=t.data,n=t.data.identifier,o="mouse"===r.pointerType||"pen"===r.pointerType,s=e.trackedPointers[n];i&&!s&&(s=e.trackedPointers[n]=new ti(n)),void 0!==s&&(i&&this.mouseOverRenderer?(s.over||(s.over=!0,this.delayDispatchEvent(e,"pointerover",t),o&&this.delayDispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):s.over&&(s.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),s.none&&delete e.trackedPointers[n]))},i.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],i=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,i);r.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",r),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",r)},i.prototype.getInteractionDataForPointerId=function(t){var e,i=t.pointerId;return 1===i||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[i]?e=this.activeInteractionData[i]:((e=this.interactionDataPool.pop()||new Ke).identifier=i,this.activeInteractionData[i]=e),e.copyEvent(t),e},i.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},i.prototype.configureInteractionEventForDOMEvent=function(t,e,i){return t.data=i,this.mapPositionToPoint(i.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=i.global.x,e.globalY=i.global.y),i.originalEvent=e,t.reset(),t},i.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var i=0,r=t.changedTouches.length;i<r;i++){var n=t.changedTouches[i];void 0===n.button&&(n.button=t.touches.length?1:0),void 0===n.buttons&&(n.buttons=t.touches.length?1:0),void 0===n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===n.width&&(n.width=n.radiusX||1),void 0===n.height&&(n.height=n.radiusY||1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="touch"),void 0===n.pointerId&&(n.pointerId=n.identifier||0),void 0===n.pressure&&(n.pressure=n.force||.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),void 0===n.layerX&&(n.layerX=n.offsetX=n.clientX),void 0===n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,e.push(n)}else if(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent)e.push(t);else{var o=t;void 0===o.isPrimary&&(o.isPrimary=!0),void 0===o.width&&(o.width=1),void 0===o.height&&(o.height=1),void 0===o.tiltX&&(o.tiltX=0),void 0===o.tiltY&&(o.tiltY=0),void 0===o.pointerType&&(o.pointerType="mouse"),void 0===o.pointerId&&(o.pointerId=1),void 0===o.pressure&&(o.pressure=.5),void 0===o.twist&&(o.twist=0),void 0===o.tangentialPressure&&(o.tangentialPressure=0),o.isNormalized=!0,e.push(o)}return e},i.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},i}(M),oi=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,i,r,n,o,s,a){if(arguments.length>8)throw new Error("max arguments reached");var l=this.name,h=this.items;this._aliasCount++;for(var c=0,u=h.length;c<u;c++)h[c][l](t,e,i,r,n,o,s,a);return h===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}();Object.defineProperties(oi.prototype,{dispatch:{value:oi.prototype.emit},run:{value:oi.prototype.emit}}),B.PREFER_ENV=P.any?t.ENV.WEBGL:t.ENV.WEBGL2,B.STRICT_TEXTURE_CACHE=!1;var si=[];function ai(t,e){if(!t)return null;var i="";if("string"==typeof t){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(i=r[1].toLowerCase())}for(var n=si.length-1;n>=0;--n){var o=si[n];if(o.test&&o.test(t,i))return new o(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var li=function(t,e){return li=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},li(t,e)};function hi(t,e){function i(){this.constructor=t}li(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var ci=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new oi("setRealSize"),this.onUpdate=new oi("update"),this.onError=new oi("onError")}return t.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},t.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(t,e,i){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(t,e){return!1},t}(),ui=function(e){function i(t,i){var r=this,n=i||{},o=n.width,s=n.height;if(!o||!s)throw new Error("BufferResource width or height invalid");return(r=e.call(this,o,s)||this).data=t,r}return hi(i,e),i.prototype.upload=function(e,i,r){var n=e.gl;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===t.ALPHA_MODES.UNPACK),r.width===i.width&&r.height===i.height?n.texSubImage2D(i.target,0,0,0,i.width,i.height,i.format,i.type,this.data):(r.width=i.width,r.height=i.height,n.texImage2D(i.target,0,r.internalFormat,i.width,i.height,0,i.format,r.type,this.data)),!0},i.prototype.dispose=function(){this.data=null},i.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},i}(ci),pi={scaleMode:t.SCALE_MODES.NEAREST,format:t.FORMATS.RGBA,alphaMode:t.ALPHA_MODES.NPM},di=function(e){function i(i,r){void 0===i&&(i=null),void 0===r&&(r=null);var n=e.call(this)||this,o=(r=r||{}).alphaMode,s=r.mipmap,a=r.anisotropicLevel,l=r.scaleMode,h=r.width,c=r.height,u=r.wrapMode,p=r.format,d=r.type,m=r.target,f=r.resolution,y=r.resourceOptions;return!i||i instanceof ci||((i=ai(i,y)).internal=!0),n.width=h||0,n.height=c||0,n.resolution=f||B.RESOLUTION,n.mipmap=void 0!==s?s:B.MIPMAP_TEXTURES,n.anisotropicLevel=void 0!==a?a:B.ANISOTROPIC_LEVEL,n.wrapMode=u||B.WRAP_MODE,n.scaleMode=void 0!==l?l:B.SCALE_MODE,n.format=p||t.FORMATS.RGBA,n.type=d||t.TYPES.UNSIGNED_BYTE,n.target=m||t.TARGETS.TEXTURE_2D,n.alphaMode=void 0!==o?o:t.ALPHA_MODES.UNPACK,void 0!==r.premultiplyAlpha&&(n.premultiplyAlpha=r.premultiplyAlpha),n.uid=re(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=h>0&&c>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(i),n}return hi(i,e),Object.defineProperty(i.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),i.prototype.setStyle=function(t,e){var i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this},i.prototype.setSize=function(t,e,i){return this.resolution=i||this.resolution,this.width=t,this.height=e,this._refreshPOT(),this.update(),this},i.prototype.setRealSize=function(t,e,i){return this.resolution=i||this.resolution,this.width=t/this.resolution,this.height=e/this.resolution,this._refreshPOT(),this.update(),this},i.prototype._refreshPOT=function(){this.isPowerOfTwo=Zt(this.realWidth)&&Zt(this.realHeight)},i.prototype.setResolution=function(t){var e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=this.width*e/t,this.height=this.height*e/t,this.emit("update",this)),this._refreshPOT()),this},i.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},i.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},i.prototype.onError=function(t){this.emit("error",this,t)},i.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete le[this.cacheId],delete ae[this.cacheId],this.cacheId=null),this.dispose(),i.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},i.prototype.dispose=function(){this.emit("dispose",this)},i.prototype.castToBaseTexture=function(){return this},i.from=function(t,e,r){void 0===r&&(r=B.STRICT_TEXTURE_CACHE);var n="string"==typeof t,o=null;n?o=t:(t._pixiId||(t._pixiId="pixiid_"+re()),o=t._pixiId);var s=le[o];if(n&&r&&!s)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return s||((s=new i(t,e)).cacheId=o,i.addToCache(s,o)),s},i.fromBuffer=function(e,r,n,o){e=e||new Float32Array(r*n*4);var s=new ui(e,{width:r,height:n}),a=e instanceof Float32Array?t.TYPES.FLOAT:t.TYPES.UNSIGNED_BYTE;return new i(s,Object.assign(pi,o||{width:r,height:n,type:a}))},i.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),le[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),le[e]=t)},i.removeFromCache=function(t){if("string"==typeof t){var e=le[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete le[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)delete le[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},i._globalBatch=0,i}(M),mi=function(t){function e(e,i){var r=this,n=i||{},o=n.width,s=n.height;(r=t.call(this,o,s)||this).items=[],r.itemDirtyIds=[];for(var a=0;a<e;a++){var l=new di;r.items.push(l),r.itemDirtyIds.push(-2)}return r.length=e,r._load=null,r.baseTexture=null,r}return hi(e,t),e.prototype.initFromArray=function(t,e){for(var i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof ci?this.addResourceAt(t[i],i):this.addResourceAt(ai(t[i],e),i))},e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=e,this.items[i].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map((function(t){return t.resource})).filter((function(t){return t})).map((function(t){return t.load()}));return this._load=Promise.all(e).then((function(){var e=t.items[0],i=e.realWidth,r=e.realHeight;return t.resize(i,r),Promise.resolve(t)})),this._load},e}(ci),fi=function(e){function i(t,i){var r,n,o=this,s=i||{},a=s.width,l=s.height;return Array.isArray(t)?(r=t,n=t.length):n=t,o=e.call(this,n,{width:a,height:l})||this,r&&o.initFromArray(r,i),o}return hi(i,e),i.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},i.prototype.bind=function(i){e.prototype.bind.call(this,i),i.target=t.TARGETS.TEXTURE_2D_ARRAY},i.prototype.upload=function(t,e,i){var r=this,n=r.length,o=r.itemDirtyIds,s=r.items,a=t.gl;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,e.format,this._width,this._height,n,0,e.format,e.type,null);for(var l=0;l<n;l++){var h=s[l];o[l]<h.dirtyId&&(o[l]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,e.format,e.type,h.resource.source))}return!0},i}(mi),yi=function(e){function i(t){var i=this,r=t,n=r.naturalWidth||r.videoWidth||r.width,o=r.naturalHeight||r.videoHeight||r.height;return(i=e.call(this,n,o)||this).source=t,i.noSubImage=!1,i}return hi(i,e),i.crossOrigin=function(t,e,i){void 0===i&&0!==e.indexOf("data:")?t.crossOrigin=de(e):!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous")},i.prototype.upload=function(e,i,r,n){var o=e.gl,s=i.realWidth,a=i.realHeight;return n=n||this.source,o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===t.ALPHA_MODES.UNPACK),this.noSubImage||i.target!==o.TEXTURE_2D||r.width!==s||r.height!==a?(r.width=s,r.height=a,o.texImage2D(i.target,0,i.format,i.format,i.type,n)):o.texSubImage2D(o.TEXTURE_2D,0,0,0,i.format,i.type,n),!0},i.prototype.update=function(){if(!this.destroyed){var t=this.source,i=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(i,r),e.prototype.update.call(this)}},i.prototype.dispose=function(){this.source=null},i}(ci),_i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return hi(e,t),e.test=function(t){var e=window.OffscreenCanvas;return!!(e&&t instanceof e)||t instanceof HTMLCanvasElement},e}(yi),gi=function(e){function i(r,n){var o=this,s=n||{},a=s.width,l=s.height,h=s.autoLoad,c=s.linkBaseTexture;if(r&&r.length!==i.SIDES)throw new Error("Invalid length. Got "+r.length+", expected 6");o=e.call(this,6,{width:a,height:l})||this;for(var u=0;u<i.SIDES;u++)o.items[u].target=t.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+u;return o.linkBaseTexture=!1!==c,r&&o.initFromArray(r,n),!1!==h&&o.load(),o}return hi(i,e),i.prototype.bind=function(i){e.prototype.bind.call(this,i),i.target=t.TARGETS.TEXTURE_CUBE_MAP},i.prototype.addBaseTextureAt=function(e,i,r){if(void 0===r&&(r=this.linkBaseTexture),!this.items[i])throw new Error("Index "+i+" is out of bounds");if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,i)}else e.target=t.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+i,e.parentTextureArray=this.baseTexture,this.items[i]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[i]=e,this},i.prototype.upload=function(t,e,r){for(var n=this.itemDirtyIds,o=0;o<i.SIDES;o++){var s=this.items[o];n[o]<s.dirtyId&&(s.valid&&s.resource?(s.resource.upload(t,s,r),n[o]=s.dirtyId):n[o]<-1&&(t.gl.texImage2D(s.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),n[o]=-1))}return!0},i.test=function(t){return Array.isArray(t)&&t.length===i.SIDES},i.SIDES=6,i}(mi),xi=function(e){function i(t,i){var r=this;if(i=i||{},!(t instanceof HTMLImageElement)){var n=new Image;yi.crossOrigin(n,t,i.crossorigin),n.src=t,t=n}return r=e.call(this,t)||this,!t.complete&&r._width&&r._height&&(r._width=0,r._height=0),r.url=t.src,r._process=null,r.preserveBitmap=!1,r.createBitmap=(void 0!==i.createBitmap?i.createBitmap:B.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,r.alphaMode="number"==typeof i.alphaMode?i.alphaMode:null,void 0!==i.premultiplyAlpha&&(r.premultiplyAlpha=i.premultiplyAlpha),r.bitmap=null,r._load=null,!1!==i.autoLoad&&r.load(),r}return hi(i,e),i.prototype.load=function(t){var e=this;return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((function(t,i){var r=e.source;e.url=r.src;var n=function(){e.destroyed||(r.onload=null,r.onerror=null,e.resize(r.width,r.height),e._load=null,e.createBitmap?t(e.process()):t(e))};r.complete&&r.src?n():(r.onload=n,r.onerror=function(t){i(t),e.onError.emit(t)})}))),this._load},i.prototype.process=function(){var e=this,i=this.source;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(i,0,0,i.width,i.height,{premultiplyAlpha:this.alphaMode===t.ALPHA_MODES.UNPACK?"premultiply":"none"}).then((function(t){return e.destroyed?Promise.reject():(e.bitmap=t,e.update(),e._process=null,Promise.resolve(e))})),this._process):Promise.resolve(this)},i.prototype.upload=function(t,i,r){if("number"==typeof this.alphaMode&&(i.alphaMode=this.alphaMode),!this.createBitmap)return e.prototype.upload.call(this,t,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(e.prototype.upload.call(this,t,i,r,this.bitmap),!this.preserveBitmap){var n=!0,o=i._glTextures;for(var s in o){var a=o[s];if(a!==r&&a.dirtyId!==i.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},i.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,e.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},i.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},i}(yi),vi=function(t){function e(e,i){var r=this;return i=i||{},(r=t.call(this,document.createElement("canvas"))||this)._width=0,r._height=0,r.svg=e,r.scale=i.scale||1,r._overrideWidth=i.width,r._overrideHeight=i.height,r._resolve=null,r._crossorigin=i.crossorigin,r._load=null,!1!==i.autoLoad&&r.load(),r}return hi(e,t),e.prototype.load=function(){var t=this;return this._load||(this._load=new Promise((function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}))),this._load},e.prototype._loadSvg=function(){var t=this,e=new Image;yi.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=function(i){t._resolve&&(e.onerror=null,t.onError.emit(i))},e.onload=function(){if(t._resolve){var i=e.width,r=e.height;if(!i||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var n=i*t.scale,o=r*t.scale;(t._overrideWidth||t._overrideHeight)&&(n=t._overrideWidth||t._overrideHeight/r*i,o=t._overrideHeight||t._overrideWidth/i*r),n=Math.round(n),o=Math.round(o);var s=t.source;s.width=n,s.height=o,s._pixiId="canvas_"+re(),s.getContext("2d").drawImage(e,0,0,i,r,0,0,n,o),t._resolve(),t._resolve=null}}},e.getSize=function(t){var i=e.SVG_SIZE.exec(t),r={};return i&&(r[i[1]]=Math.round(parseFloat(i[3])),r[i[5]]=Math.round(parseFloat(i[7]))),r},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,e){return"svg"===e||"string"==typeof t&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||"string"==typeof t&&0===t.indexOf("<svg")},e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(yi),bi=function(t){function e(i,r){var n=this;if(r=r||{},!(i instanceof HTMLVideoElement)){var o=document.createElement("video");o.setAttribute("preload","auto"),o.setAttribute("webkit-playsinline",""),o.setAttribute("playsinline",""),"string"==typeof i&&(i=[i]);var s=i[0].src||i[0];yi.crossOrigin(o,s,r.crossorigin);for(var a=0;a<i.length;++a){var l=document.createElement("source"),h=i[a],c=h.src,u=h.mime,p=(c=c||i[a]).split("?").shift().toLowerCase(),d=p.substr(p.lastIndexOf(".")+1);u=u||e.MIME_TYPES[d]||"video/"+d,l.src=c,l.type=u,o.appendChild(l)}i=o}return(n=t.call(this,i)||this).noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=r.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=!1!==r.autoPlay,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),!1!==r.autoLoad&&n.load(),n}return hi(e,t),e.prototype.update=function(e){if(void 0===e&&(e=0),!this.destroyed){var i=Ye.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((function(i){t.valid?i(t):(t._resolve=i,e.load())})),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ye.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Ye.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&Ye.shared.remove(this.update,this);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ye.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ye.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,i){return t instanceof HTMLVideoElement||e.TYPES.indexOf(i)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(yi),wi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return hi(e,t),e.test=function(t){return!!window.createImageBitmap&&t instanceof ImageBitmap},e}(yi);si.push(xi,wi,_i,bi,vi,ui,gi,fi);var Si={Resource:ci,BaseImageResource:yi,INSTALLED:si,autoDetectResource:ai,AbstractMultiResource:mi,ArrayResource:fi,BufferResource:ui,CanvasResource:_i,CubeResource:gi,ImageResource:xi,SVGResource:vi,VideoResource:bi,ImageBitmapResource:wi},Ci=function(){function t(t){this.renderer=t}return t.prototype.destroy=function(){this.renderer=null},t}(),Di=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return hi(i,e),i.prototype.upload=function(e,i,r){var n=e.gl;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===t.ALPHA_MODES.UNPACK),r.width===i.width&&r.height===i.height?n.texSubImage2D(i.target,0,0,0,i.width,i.height,i.format,i.type,this.data):(r.width=i.width,r.height=i.height,n.texImage2D(i.target,0,1===e.context.webGLVersion?n.DEPTH_COMPONENT:n.DEPTH_COMPONENT16,i.width,i.height,0,i.format,i.type,this.data)),!0},i}(ui),Ti=function(){function e(e,i){this.width=Math.ceil(e||100),this.height=Math.ceil(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new oi("disposeFramebuffer"),this.multisample=t.MSAA_QUALITY.NONE}return Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),e.prototype.addColorTexture=function(e,i){return void 0===e&&(e=0),this.colorTextures[e]=i||new di(null,{scaleMode:t.SCALE_MODES.NEAREST,resolution:1,mipmap:t.MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},e.prototype.addDepthTexture=function(e){return this.depthTexture=e||new di(new Di(null,{width:this.width,height:this.height}),{scaleMode:t.SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:t.MIPMAP_MODES.OFF,format:t.FORMATS.DEPTH_COMPONENT,type:t.TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},e.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},e.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},e.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var r=this.colorTextures[i],n=r.resolution;r.setSize(t/n,e/n)}if(this.depthTexture){n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,e/n)}}},e.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},e.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},e}(),Ai=function(t){function e(e){var i=this;"number"==typeof e&&(e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]});i=t.call(this,null,e)||this;var r=e||{},n=r.width,o=r.height;return i.mipmap=0,i.width=Math.ceil(n)||100,i.height=Math.ceil(o)||100,i.valid=!0,i.clearColor=[0,0,0,0],i.framebuffer=new Ti(i.width*i.resolution,i.height*i.resolution).addColorTexture(0,i),i.maskStack=[],i.filterStack=[{}],i}return hi(e,t),e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this.framebuffer.resize(t*this.resolution,e*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(di),Ei=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(t,e,i){var r=e.width,n=e.height;if(i){var o=t.width/2/r,s=t.height/2/n,a=t.x/r+o,l=t.y/n+s;i=Le.add(i,Le.NW),this.x0=a+o*Le.uX(i),this.y0=l+s*Le.uY(i),i=Le.add(i,2),this.x1=a+o*Le.uX(i),this.y1=l+s*Le.uY(i),i=Le.add(i,2),this.x2=a+o*Le.uX(i),this.y2=l+s*Le.uY(i),i=Le.add(i,2),this.x3=a+o*Le.uX(i),this.y3=l+s*Le.uY(i)}else this.x0=t.x/r,this.y0=t.y/n,this.x1=(t.x+t.width)/r,this.y1=t.y/n,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/n,this.x3=t.x/r,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t}(),Ii=new Ei,Pi=function(t){function e(i,r,n,o,s,a){var l=t.call(this)||this;if(l.noFrame=!1,r||(l.noFrame=!0,r=new ve(0,0,1,1)),i instanceof e&&(i=i.baseTexture),l.baseTexture=i,l._frame=r,l.trim=o,l.valid=!1,l._uvs=Ii,l.uvMatrix=null,l.orig=n||r,l._rotate=Number(s||0),!0===s)l._rotate=2;else if(l._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return l.defaultAnchor=a?new De(a.x,a.y):new De(0,0),l._updateID=0,l.textureCacheIds=[],i.valid?l.noFrame?i.valid&&l.onBaseTextureUpdated(i):l.frame=r:i.once("loaded",l.onBaseTextureUpdated,l),l.noFrame&&i.on("update",l.onBaseTextureUpdated,l),l}return hi(e,t),e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var i=this.baseTexture;i&&i.url&&ae[i.url]&&e.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame.clone(),this.orig.clone(),this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor)},e.prototype.updateUvs=function(){this._uvs===Ii&&(this._uvs=new Ei),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,i,r){void 0===i&&(i={}),void 0===r&&(r=B.STRICT_TEXTURE_CACHE);var n="string"==typeof t,o=null;n?o=t:(t._pixiId||(t._pixiId="pixiid_"+re()),o=t._pixiId);var s=ae[o];if(n&&r&&!s)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return s||(i.resolution||(i.resolution=me(t)),(s=new e(new di(t,i))).baseTexture.cacheId=o,di.addToCache(s.baseTexture,o),e.addToCache(s,o)),s},e.fromURL=function(t,i){var r=Object.assign({autoLoad:!1},null==i?void 0:i.resourceOptions),n=e.from(t,Object.assign({resourceOptions:r},i),!1),o=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):o.load().then((function(){return Promise.resolve(n)}))},e.fromBuffer=function(t,i,r,n){return new e(di.fromBuffer(t,i,r,n))},e.fromLoader=function(t,i,r){var n=new xi(t);n.url=i;var o=new e(new di(n,{scaleMode:B.SCALE_MODE,resolution:me(i)}));return r||(r=i),di.addToCache(o.baseTexture,r),e.addToCache(o,r),r!==i&&(di.addToCache(o.baseTexture,i),e.addToCache(o,i)),o},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),ae[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),ae[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=ae[t];if(e){var i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete ae[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)ae[t.textureCacheIds[r]]===t&&delete ae[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,i=t.y,r=t.width,n=t.height,o=e+r>this.baseTexture.width,s=i+n>this.baseTexture.height;if(o||s){var a=o&&s?"and":"or",l="X: "+e+" + "+r+" = "+(e+r)+" > "+this.baseTexture.width,h="Y: "+i+" + "+n+" = "+(i+n)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+l+" "+a+" "+h)}this.valid=r&&n&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},e}(M);function Bi(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}Pi.EMPTY=new Pi(new di),Bi(Pi.EMPTY),Bi(Pi.EMPTY.baseTexture),Pi.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new Pi(new di(new _i(t)))}(),Bi(Pi.WHITE),Bi(Pi.WHITE.baseTexture);var Mi=function(t){function e(e,i){var r=this,n=null;if(!(e instanceof Ai)){var o=arguments[1],s=arguments[2],a=arguments[3],l=arguments[4];console.warn("Please use RenderTexture.create("+o+", "+s+") instead of the ctor directly."),n=arguments[0],i=null,e=new Ai({width:o,height:s,scaleMode:a,resolution:l})}return(r=t.call(this,e,i)||this).legacyRenderer=n,r.valid=!0,r.filterFrame=null,r.filterPoolKey=null,r.updateUvs(),r}return hi(e,t),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e,i){void 0===i&&(i=!0),t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,i&&this.baseTexture.resize(t,e),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){return"number"==typeof t&&(t={width:t,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new e(new Ai(t))},e}(Pi),Oi=function(){function t(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return t.prototype.createTexture=function(t,e){var i=new Ai(Object.assign({width:t,height:e,resolution:1},this.textureOptions));return new Mi(i)},t.prototype.getOptimalTexture=function(e,i,r){void 0===r&&(r=1);var n=t.SCREEN_KEY;e*=r,i*=r,this.enableFullScreen&&e===this._pixelsWidth&&i===this._pixelsHeight||(n=(65535&(e=Kt(e)))<<16|65535&(i=Kt(i))),this.texturePool[n]||(this.texturePool[n]=[]);var o=this.texturePool[n].pop();return o||(o=this.createTexture(e,i)),o.filterPoolKey=n,o.setResolution(r),o},t.prototype.getFilterTexture=function(t,e){var i=this.getOptimalTexture(t.width,t.height,e||t.resolution);return i.filterFrame=t.filterFrame,i},t.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},t.prototype.returnFilterTexture=function(t){this.returnTexture(t)},t.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var i=this.texturePool[e];if(i)for(var r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}},t.prototype.setScreenSize=function(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){var i=t.SCREEN_KEY,r=this.texturePool[i];if(this.enableFullScreen=e.width>0&&e.height>0,r)for(var n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[i]=[],this._pixelsWidth=e.width,this._pixelsHeight=e.height}},t.SCREEN_KEY="screen",t}(),Ri=function(){function t(t,e,i,r,n,o,s){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===r&&(r=5126),this.buffer=t,this.size=e,this.normalized=i,this.type=r,this.stride=n,this.start=o,this.instance=s}return t.prototype.destroy=function(){this.buffer=null},t.from=function(e,i,r,n,o){return new t(e,i,r,n,o)},t}(),Li=0,ki=function(){function t(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=Li++,this.disposeRunner=new oi("disposeBuffer")}return t.prototype.update=function(t){this.data=t||this.data,this._updateID++},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.data=null},t.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)},t}();function Fi(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var Ni={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};var Vi={5126:4,5123:2,5121:1},Gi=0,Ui={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},ji=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Gi++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new oi("disposeGeometry"),this.refCount=0}return t.prototype.addAttribute=function(t,e,i,r,n,o,s,a){if(void 0===i&&(i=0),void 0===r&&(r=!1),void 0===a&&(a=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof ki||(e instanceof Array&&(e=new Float32Array(e)),e=new ki(e));var l=t.split("|");if(l.length>1){for(var h=0;h<l.length;h++)this.addAttribute(l[h],e,i,r,n);return this}var c=this.buffers.indexOf(e);return-1===c&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new Ri(c,i,r,n,o,s,a),this.instanced=this.instanced||a,this},t.prototype.getAttribute=function(t){return this.attributes[t]},t.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},t.prototype.addIndex=function(t){return t instanceof ki||(t instanceof Array&&(t=new Uint16Array(t)),t=new ki(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},t.prototype.getIndex=function(){return this.indexBuffer},t.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],i=[],r=new ki;for(t in this.attributes){var n=this.attributes[t],o=this.buffers[n.buffer];e.push(o.data),i.push(n.size*Vi[n.type]/4),n.buffer=0}for(r.data=function(t,e){for(var i=0,r=0,n={},o=0;o<t.length;o++)r+=e[o],i+=t[o].length;var s=new ArrayBuffer(4*i),a=null,l=0;for(o=0;o<t.length;o++){var h=e[o],c=t[o],u=Fi(c);n[u]||(n[u]=new Ni[u](s)),a=n[u];for(var p=0;p<c.length;p++)a[(p/h|0)*r+l+p%h]=c[p];l+=h}return new Float32Array(s)}(e,i),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},t.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},t.prototype.clone=function(){for(var e=new t,i=0;i<this.buffers.length;i++)e.buffers[i]=new ki(this.buffers[i].data.slice(0));for(var i in this.attributes){var r=this.attributes[i];e.attributes[i]=new Ri(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.index=!0),e},t.merge=function(e){for(var i,r=new t,n=[],o=[],s=[],a=0;a<e.length;a++){i=e[a];for(var l=0;l<i.buffers.length;l++)o[l]=o[l]||0,o[l]+=i.buffers[l].data.length,s[l]=0}for(a=0;a<i.buffers.length;a++)n[a]=new(Ui[Fi(i.buffers[a].data)])(o[a]),r.buffers[a]=new ki(n[a]);for(a=0;a<e.length;a++){i=e[a];for(l=0;l<i.buffers.length;l++)n[l].set(i.buffers[l].data,s[l]),s[l]+=i.buffers[l].data.length}if(r.attributes=i.attributes,i.indexBuffer){r.indexBuffer=r.buffers[i.buffers.indexOf(i.indexBuffer)],r.indexBuffer.index=!0;var h=0,c=0,u=0,p=0;for(a=0;a<i.buffers.length;a++)if(i.buffers[a]!==i.indexBuffer){p=a;break}for(var a in i.attributes){var d=i.attributes[a];(0|d.buffer)===p&&(c+=d.size*Vi[d.type]/4)}for(a=0;a<e.length;a++){var m=e[a].indexBuffer.data;for(l=0;l<m.length;l++)r.indexBuffer.data[l+u]+=h;h+=i.buffers[p].data.length/c,u+=m.length}}return r},t}(),zi=function(t){function e(){var e=t.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return hi(e,t),e}(ji),Xi=function(t){function e(){var e=t.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new ki(e.vertices),e.uvBuffer=new ki(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return hi(e,t),e.prototype.map=function(t,e){var i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+e.width/t.width,this.uvs[3]=r,this.uvs[4]=i+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=i,this.uvs[7]=r+e.height/t.height,i=e.x,r=e.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+e.width,this.vertices[3]=r,this.vertices[4]=i+e.width,this.vertices[5]=r+e.height,this.vertices[6]=i,this.vertices[7]=r+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(ji),Hi=0,Ji=function(){function t(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Hi++,this.static=!!e}return t.prototype.update=function(){this.dirtyId++},t.prototype.add=function(e,i,r){this.uniforms[e]=new t(i,r)},t.from=function(e,i){return new t(e,i)},t}(),Wi=function(){function t(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new ve,this.destinationFrame=new ve,this.filters=[]}return t.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},t}(),$i=function(e){function i(t){var i=e.call(this,t)||this;return i.defaultFilterStack=[{}],i.texturePool=new Oi,i.texturePool.setScreenSize(t.view),i.statePool=[],i.quad=new zi,i.quadUv=new Xi,i.tempRect=new ve,i.activeState={},i.globalUniforms=new Ji({outputFrame:i.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),i.forceClear=!1,i.useMaxPadding=!1,i}return hi(i,e),i.prototype.push=function(t,e){for(var i=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new Wi,o=e[0].resolution,s=e[0].padding,a=e[0].autoFit,l=e[0].legacy,h=1;h<e.length;h++){var c=e[h];o=Math.min(o,c.resolution),s=this.useMaxPadding?Math.max(s,c.padding):s+c.padding,a=a&&c.autoFit,l=l||c.legacy}1===r.length&&(this.defaultFilterStack[0].renderTexture=i.renderTexture.current),r.push(n),n.resolution=o,n.legacy=l,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(s),a&&n.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),n.sourceFrame.ceil(o),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,o),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;var u=this.tempRect;u.width=n.sourceFrame.width,u.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,i.renderTexture.bind(n.renderTexture,n.sourceFrame,u),i.renderTexture.clear()},i.prototype.pop=function(){var e=this.defaultFilterStack,i=e.pop(),r=i.filters;this.activeState=i;var n=this.globalUniforms.uniforms;n.outputFrame=i.sourceFrame,n.resolution=i.resolution;var o=n.inputSize,s=n.inputPixel,a=n.inputClamp;if(o[0]=i.destinationFrame.width,o[1]=i.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],s[0]=o[0]*i.resolution,s[1]=o[1]*i.resolution,s[2]=1/s[0],s[3]=1/s[1],a[0]=.5*s[2],a[1]=.5*s[3],a[2]=i.sourceFrame.width*o[2]-.5*s[2],a[3]=i.sourceFrame.height*o[3]-.5*s[3],i.legacy){var l=n.filterArea;l[0]=i.destinationFrame.width,l[1]=i.destinationFrame.height,l[2]=i.sourceFrame.x,l[3]=i.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var h=e[e.length-1];if(i.renderTexture.framebuffer.multisample>1&&this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,i.renderTexture,h.renderTexture,t.CLEAR_MODES.BLEND,i),this.returnFilterTexture(i.renderTexture);else{var c=i.renderTexture,u=this.getOptimalFilterTexture(c.width,c.height,i.resolution);u.filterFrame=c.filterFrame;var p=0;for(p=0;p<r.length-1;++p){r[p].apply(this,c,u,t.CLEAR_MODES.CLEAR,i);var d=c;c=u,u=d}r[p].apply(this,c,h.renderTexture,t.CLEAR_MODES.BLEND,i),this.returnFilterTexture(c),this.returnFilterTexture(u)}i.clear(),this.statePool.push(i)},i.prototype.bindAndClear=function(e,i){if(void 0===i&&(i=t.CLEAR_MODES.CLEAR),e&&e.filterFrame){var r=this.tempRect;r.width=e.filterFrame.width,r.height=e.filterFrame.height,this.renderer.renderTexture.bind(e,e.filterFrame,r)}else this.renderer.renderTexture.bind(e);"boolean"==typeof i&&(i=i?t.CLEAR_MODES.CLEAR:t.CLEAR_MODES.BLEND,oe("5.2.1","Use CLEAR_MODES when using clear applyFilter option")),(i===t.CLEAR_MODES.CLEAR||i===t.CLEAR_MODES.BLIT&&this.forceClear)&&this.renderer.renderTexture.clear()},i.prototype.applyFilter=function(e,i,r,n){var o=this.renderer;this.bindAndClear(r,n),e.uniforms.uSampler=i,e.uniforms.filterGlobals=this.globalUniforms,o.state.set(e.state),o.shader.bind(e),e.legacy?(this.quadUv.map(i._frame,i.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(t.DRAW_MODES.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(t.DRAW_MODES.TRIANGLE_STRIP))},i.prototype.calculateSpriteMatrix=function(t,e){var i=this.activeState,r=i.sourceFrame,n=i.destinationFrame,o=e._texture.orig,s=t.set(n.width,0,0,n.height,r.x,r.y),a=e.worldTransform.copyTo(Ae.TEMP_MATRIX);return a.invert(),s.prepend(a),s.scale(1/o.width,1/o.height),s.translate(e.anchor.x,e.anchor.y),s},i.prototype.destroy=function(){this.texturePool.clear(!1)},i.prototype.getOptimalFilterTexture=function(t,e,i){return void 0===i&&(i=1),this.texturePool.getOptimalTexture(t,e,i)},i.prototype.getFilterTexture=function(t,e){if("number"==typeof t){var i=t;t=e,e=i}t=t||this.activeState.renderTexture;var r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution);return r.filterFrame=t.filterFrame,r},i.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},i.prototype.emptyPool=function(){this.texturePool.clear(!0)},i.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},i}(Ci),Yi=function(){function t(t){this.renderer=t}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(t){},t}(),qi=function(t){function e(e){var i=t.call(this,e)||this;return i.emptyRenderer=new Yi(e),i.currentRenderer=i.emptyRenderer,i}return hi(e,t),e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,e){for(var i=this.renderer.texture.boundTextures,r=e-1;r>=0;--r)t[r]=i[r]||null,t[r]&&(t[r]._batchLocation=r)},e.prototype.boundArray=function(t,e,i,r){for(var n=t.elements,o=t.ids,s=t.count,a=0,l=0;l<s;l++){var h=n[l],c=h._batchLocation;if(c>=0&&c<r&&e[c]===h)o[l]=c;else for(;a<r;){var u=e[a];if(!u||u._batchEnabled!==i||u._batchLocation!==a){o[l]=a,h._batchLocation=a,e[a]=h;break}a++}}},e}(Ci),Ki=0,Zi=function(e){function i(t){var i=e.call(this,t)||this;return i.webGLVersion=1,i.extensions={},i.supports={uint32Indices:!1},i.handleContextLost=i.handleContextLost.bind(i),i.handleContextRestored=i.handleContextRestored.bind(i),t.view.addEventListener("webglcontextlost",i.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",i.handleContextRestored,!1),i}return hi(i,e),Object.defineProperty(i.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),i.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Ki++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},i.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Ki++,this.renderer.runners.contextChange.emit(t)},i.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},i.prototype.createContext=function(e,i){var r;if(B.PREFER_ENV>=t.ENV.WEBGL2&&(r=e.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,!(r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl},i.prototype.getExtensions=function(){var t=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:t.getExtension("EXT_color_buffer_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear")})},i.prototype.handleContextLost=function(t){t.preventDefault()},i.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},i.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},i.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},i.prototype.validateContext=function(t){var e=t.getContextAttributes(),i="WebGL2RenderingContext"in window&&t instanceof window.WebGL2RenderingContext;i&&(this.webGLVersion=2),e.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var r=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},i}(Ci),Qi=function(e){this.framebuffer=e,this.stencil=null,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.multisample=t.MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null},tr=new ve,er=function(e){function i(t){var i=e.call(this,t)||this;return i.managedFramebuffers=[],i.unknownFramebuffer=new Ti(10,10),i.msaaSamples=null,i}return hi(i,e),i.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ve,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;B.PREFER_ENV===t.ENV.WEBGL_LEGACY&&(i=null,r=null),i?e.drawBuffers=function(t){return i.drawBuffersWEBGL(t)}:(this.hasMRT=!1,e.drawBuffers=function(){}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)},i.prototype.bind=function(t,e){var i=this.gl;if(t){var r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,r.framebuffer)),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var n=0;n<t.colorTextures.length;n++){var o=t.colorTextures[n];this.renderer.texture.unbind(o.parentTextureArray||o)}t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},i.prototype.setViewport=function(t,e,i,r){var n=this.viewport;n.width===i&&n.height===r&&n.x===t&&n.y===e||(n.x=t,n.y=e,n.width=i,n.height=r,this.gl.viewport(t,e,i,r))},Object.defineProperty(i.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),i.prototype.clear=function(e,i,r,n,o){void 0===o&&(o=t.BUFFER_BITS.COLOR|t.BUFFER_BITS.DEPTH);var s=this.gl;s.clearColor(e,i,r,n),s.clear(o)},i.prototype.initFramebuffer=function(t){var e=this.gl,i=new Qi(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i},i.prototype.resizeFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));for(var r=t.colorTextures,n=0;n<r.length;n++)this.renderer.texture.bind(r[n],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},i.prototype.updateFramebuffer=function(t){var e=this.gl,i=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures.length;e.drawBuffers||(r=Math.min(r,1)),i.multisample>1&&(i.msaaBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.RGBA8,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,i.msaaBuffer));for(var n=[],o=0;o<r;o++)if(!(0===o&&i.multisample>1)){var s=t.colorTextures[o],a=s.parentTextureArray||s;this.renderer.texture.bind(a,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,s.target,a._glTextures[this.CONTEXT_UID].texture,0),n.push(e.COLOR_ATTACHMENT0+o)}if((n.length>1&&e.drawBuffers(n),t.depthTexture)&&this.writeDepthTexture){var l=t.depthTexture;this.renderer.texture.bind(l,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,0)}i.stencil||!t.stencil&&!t.depth||(i.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),t.depthTexture||e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,i.stencil))},i.prototype.detectSamples=function(e){var i=this.msaaSamples,r=t.MSAA_QUALITY.NONE;if(e<=1||null===i)return r;for(var n=0;n<i.length;n++)if(i[n]<=e){r=i[n];break}return 1===r&&(r=t.MSAA_QUALITY.NONE),r},i.prototype.blit=function(t,e,i){var r=this,n=r.current,o=r.renderer,s=r.gl,a=r.CONTEXT_UID;if(2===o.context.webGLVersion&&n){var l=n.glFramebuffers[a];if(l){if(!t){if(l.multisample<=1)return;l.blitFramebuffer||(l.blitFramebuffer=new Ti(n.width,n.height),l.blitFramebuffer.addColorTexture(0,n.colorTextures[0])),(t=l.blitFramebuffer).width=n.width,t.height=n.height}e||((e=tr).width=n.width,e.height=n.height),i||(i=e);var h=e.width===i.width&&e.height===i.height;this.bind(t),s.bindFramebuffer(s.READ_FRAMEBUFFER,l.framebuffer),s.blitFramebuffer(e.x,e.y,e.width,e.height,i.x,i.y,i.width,i.height,s.COLOR_BUFFER_BIT,h?s.NEAREST:s.LINEAR)}}},i.prototype.disposeFramebuffer=function(t,e){var i=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(i){delete t.glFramebuffers[this.CONTEXT_UID];var n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(i.framebuffer),i.stencil&&r.deleteRenderbuffer(i.stencil))}},i.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)},i.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.enableStencil();var i=t.width,r=t.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,i,r),e.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}}},i.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new ve},i}(Ci),ir=function(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},rr={5126:4,5123:2,5121:1},nr=function(e){function i(t){var i=e.call(this,t)||this;return i._activeGeometry=null,i._activeVao=null,i.hasVao=!0,i.hasInstance=!0,i.canUseUInt32ElementIndex=!1,i.managedGeometries={},i.managedBuffers={},i}return hi(i,e),i.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==i.webGLVersion){var r=this.renderer.context.extensions.vertexArrayObject;B.PREFER_ENV===t.ENV.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=function(){return r.createVertexArrayOES()},e.bindVertexArray=function(t){return r.bindVertexArrayOES(t)},e.deleteVertexArray=function(t){return r.deleteVertexArrayOES(t)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})}if(2!==i.webGLVersion){var n=e.getExtension("ANGLE_instanced_arrays");n?(e.vertexAttribDivisor=function(t,e){return n.vertexAttribDivisorANGLE(t,e)},e.drawElementsInstanced=function(t,e,i,r,o){return n.drawElementsInstancedANGLE(t,e,i,r,o)},e.drawArraysInstanced=function(t,e,i,r){return n.drawArraysInstancedANGLE(t,e,i,r)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===i.webGLVersion||!!i.extensions.uint32ElementIndex},i.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var i=this.gl,r=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);var o=r[e.program.id]||this.initGeometryVao(t,e.program,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()},i.prototype.reset=function(){this.unbind()},i.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.gl,i=0;i<t.buffers.length;i++){var r=t.buffers[i],n=r._glBuffers[this.CONTEXT_UID];if(r._updateID!==n.updateID){n.updateID=r._updateID;var o=r.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(e.bindBuffer(o,n.buffer),this._boundBuffer=n,n.byteLength>=r.data.byteLength)e.bufferSubData(o,0,r.data);else{var s=r.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=r.data.byteLength,e.bufferData(o,r.data,s)}}}},i.prototype.checkCompatibility=function(t,e){var i=t.attributes,r=e.attributeData;for(var n in r)if(!i[n])throw new Error('shader and geometry incompatible, geometry missing the "'+n+'" attribute')},i.prototype.getSignature=function(t,e){var i=t.attributes,r=e.attributeData,n=["g",t.id];for(var o in i)r[o]&&n.push(o);return n.join("-")},i.prototype.initGeometryVao=function(t,e,i){void 0===i&&(i=!0),this.checkCompatibility(t,e);var r=this.gl,n=this.CONTEXT_UID,o=this.getSignature(t,e),s=t.glVertexArrayObjects[this.CONTEXT_UID],a=s[o];if(a)return s[e.id]=a,a;var l=t.buffers,h=t.attributes,c={},u={};for(var p in l)c[p]=0,u[p]=0;for(var p in h)!h[p].size&&e.attributeData[p]?h[p].size=e.attributeData[p].size:h[p].size||console.warn("PIXI Geometry attribute '"+p+"' size cannot be determined (likely the bound shader does not have the attribute)"),c[h[p].buffer]+=h[p].size*rr[h[p].type];for(var p in h){var d=h[p],m=d.size;void 0===d.stride&&(c[d.buffer]===m*rr[d.type]?d.stride=0:d.stride=c[d.buffer]),void 0===d.start&&(d.start=u[d.buffer],u[d.buffer]+=m*rr[d.type])}a=r.createVertexArray(),r.bindVertexArray(a);for(var f=0;f<l.length;f++){var y=l[f];y._glBuffers[n]||(y._glBuffers[n]=new ir(r.createBuffer()),this.managedBuffers[y.id]=y,y.disposeRunner.add(this)),i&&y._glBuffers[n].refCount++}return this.activateVao(t,e),this._activeVao=a,s[e.id]=a,s[o]=a,a},i.prototype.disposeBuffer=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),i&&(e||r.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},i.prototype.disposeGeometry=function(t,e){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var i=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,n=t.buffers;if(t.disposeRunner.remove(this),i){for(var o=0;o<n.length;o++){var s=n[o]._glBuffers[this.CONTEXT_UID];s.refCount--,0!==s.refCount||e||this.disposeBuffer(n[o],e)}if(!e)for(var a in i)if("g"===a[0]){var l=i[a];this._activeVao===l&&this.unbind(),r.deleteVertexArray(l)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},i.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t);e=Object.keys(this.managedBuffers);for(i=0;i<e.length;i++)this.disposeBuffer(this.managedBuffers[e[i]],t)},i.prototype.activateVao=function(t,e){var i=this.gl,r=this.CONTEXT_UID,n=t.buffers,o=t.attributes;t.indexBuffer&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[r].buffer);var s=null;for(var a in o){var l=o[a],h=n[l.buffer]._glBuffers[r];if(e.attributeData[a]){s!==h&&(i.bindBuffer(i.ARRAY_BUFFER,h.buffer),s=h);var c=e.attributeData[a].location;if(i.enableVertexAttribArray(c),i.vertexAttribPointer(c,l.size,l.type||i.FLOAT,l.normalized,l.stride,l.start),l.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(c,1)}}}},i.prototype.draw=function(t,e,i,r){var n=this.gl,o=this._activeGeometry;if(o.indexBuffer){var s=o.indexBuffer.data.BYTES_PER_ELEMENT,a=2===s?n.UNSIGNED_SHORT:n.UNSIGNED_INT;2===s||4===s&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,a,(i||0)*s,r||1):n.drawElements(t,e||o.indexBuffer.data.length,a,(i||0)*s):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,i,e||o.getSize(),r||1):n.drawArrays(t,i,e||o.getSize());return this},i.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},i}(Ci),or=function(){function e(e){void 0===e&&(e=null),this.type=t.MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return e.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=t.MASK_TYPES.NONE,this.autoDetect=!0),this._target=null},e.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},e}();function sr(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}function ar(t,e,i,r){var n=sr(t,t.VERTEX_SHADER,e),o=sr(t,t.FRAGMENT_SHADER,i),s=t.createProgram();if(t.attachShader(s,n),t.attachShader(s,o),r)for(var a in r)t.bindAttribLocation(s,r[a],a);return t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||(console.warn(e),console.error(t.getShaderInfoLog(n))),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.warn(i),console.error(t.getShaderInfoLog(o))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(s,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(s)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(s)),t.deleteProgram(s),s=null),t.deleteShader(n),t.deleteShader(o),s}function lr(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e}function hr(t,e){switch(t){case"float":case"int":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return lr(2*e);case"bvec3":return lr(3*e);case"bvec4":return lr(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var cr,ur={},pr=ur;function dr(){if(pr===ur||pr&&pr.isContextLost()){var e=document.createElement("canvas"),i=void 0;B.PREFER_ENV>=t.ENV.WEBGL2&&(i=e.getContext("webgl2",{})),i||((i=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}))?i.getExtension("WEBGL_draw_buffers"):i=null),pr=i}return pr}function mr(e,i,r){if("precision"!==e.substring(0,9)){var n=i;return i===t.PRECISION.HIGH&&r!==t.PRECISION.HIGH&&(n=t.PRECISION.MEDIUM),"precision "+n+" float;\n"+e}return r!==t.PRECISION.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}var fr={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function yr(t){return fr[t]}var _r=null,gr={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function xr(t,e){if(!_r){var i=Object.keys(gr);_r={};for(var r=0;r<i.length;++r){var n=i[r];_r[t[n]]=gr[n]}}return _r[e]}var vr=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],br={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},wr={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var Sr,Cr=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Dr(t){for(var e="",i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+="if(test == "+i+".0){}");return e}function Tr(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=e.createShader(e.FRAGMENT_SHADER);;){var r=Cr.replace(/%forloop%/gi,Dr(t));if(e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}var Ar=0,Er={},Ir=function(){function e(i,r,n){void 0===n&&(n="pixi-shader"),this.id=Ar++,this.vertexSrc=i||e.defaultVertexSrc,this.fragmentSrc=r||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),Er[n]?(Er[n]++,n+="-"+Er[n]):Er[n]=1,this.vertexSrc="#define SHADER_NAME "+n+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+n+"\n"+this.fragmentSrc,this.vertexSrc=mr(this.vertexSrc,B.PRECISION_VERTEX,t.PRECISION.HIGH),this.fragmentSrc=mr(this.fragmentSrc,B.PRECISION_FRAGMENT,function(){if(!cr){cr=t.PRECISION.MEDIUM;var e=dr();if(e&&e.getShaderPrecisionFormat){var i=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);cr=i.precision?t.PRECISION.HIGH:t.PRECISION.MEDIUM}}return cr}())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}return e.prototype.extractData=function(t,e){var i=dr();if(i){var r=ar(i,t,e);this.attributeData=this.getAttributeData(r,i),this.uniformData=this.getUniformData(r,i),i.deleteProgram(r)}else this.uniformData={},this.attributeData={}},e.prototype.getAttributeData=function(t,e){for(var i={},r=[],n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<n;o++){var s=e.getActiveAttrib(t,o),a=xr(e,s.type),l={type:a,name:s.name,size:yr(a),location:0};i[s.name]=l,r.push(l)}r.sort((function(t,e){return t.name>e.name?1:-1}));for(o=0;o<r.length;o++)r[o].location=o;return i},e.prototype.getUniformData=function(t,e){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<r;n++){var o=e.getActiveUniform(t,n),s=o.name.replace(/\[.*?\]$/,""),a=o.name.match(/\[.*?\]$/),l=xr(e,o.type);i[s]={type:l,size:o.size,isArray:a,value:hr(l,o.size)}}return i},Object.defineProperty(e,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),e.from=function(t,i,r){var n=t+i,o=se[n];return o||(se[n]=o=new e(t,i,r)),o},e}(),Pr=function(){function t(t,e){for(var i in this.program=t,this.uniformGroup=e?e instanceof Ji?e:new Ji(e):new Ji({}),t.uniformData)this.uniformGroup.uniforms[i]instanceof Array&&(this.uniformGroup.uniforms[i]=new Float32Array(this.uniformGroup.uniforms[i]))}return t.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var i in e.uniforms){var r=e.uniforms[i];if(r.group&&this.checkUniformExists(t,r))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,i,r){return new t(Ir.from(e,i),r)},t}(),Br=function(){function e(){this.data=0,this.blendMode=t.BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0}return Object.defineProperty(e.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(t){!!(1&this.data)!==t&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(t){!!(2&this.data)!==t&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(t){!!(4&this.data)!==t&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(t){!!(8&this.data)!==t&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(t){!!(16&this.data)!==t&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==t.BLEND_MODES.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),e.for2d=function(){var t=new e;return t.depthTest=!1,t.blend=!0,t},e}(),Mr=function(t){function e(i,r,n){var o=this,s=Ir.from(i||e.defaultVertexSrc,r||e.defaultFragmentSrc);return(o=t.call(this,s,n)||this).padding=0,o.resolution=B.FILTER_RESOLUTION,o.enabled=!0,o.autoFit=!0,o.legacy=!!o.program.attributeData.aTextureCoord,o.state=new Br,o}return hi(e,t),e.prototype.apply=function(t,e,i,r,n){t.applyFilter(this,e,i,r)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),e}(Pr),Or=new Ae,Rr=function(){function t(t,e){this._texture=t,this.mapCoord=new Ae,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var i=this.mapCoord,r=0;r<t.length;r+=2){var n=t[r],o=t[r+1];e[r]=n*i.a+o*i.c+i.tx,e[r+1]=n*i.b+o*i.d+i.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var r=e.orig,n=e.trim;n&&(Or.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Or));var o=e.baseTexture,s=this.uClampFrame,a=this.clampMargin/o.resolution,l=this.clampOffset;return s[0]=(e._frame.x+a+l)/o.width,s[1]=(e._frame.y+a+l)/o.height,s[2]=(e._frame.x+e._frame.width-a+l)/o.width,s[3]=(e._frame.y+e._frame.height-a+l)/o.height,this.uClampOffset[0]=l/o.realWidth,this.uClampOffset[1]=l/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0},t}(),Lr=function(t){function e(e){var i=this,r=new Ae;return i=t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n")||this,e.renderable=!1,i.maskSprite=e,i.maskMatrix=r,i}return hi(e,t),e.prototype.apply=function(t,e,i,r){var n=this.maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Rr(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,r))},e}(Mr),kr=function(e){function i(t){var i=e.call(this,t)||this;return i.enableScissor=!1,i.alphaMaskPool=[],i.maskDataPool=[],i.maskStack=[],i.alphaMaskIndex=0,i}return hi(i,e),i.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},i.prototype.push=function(e,i){var r=i;if(!r.isMaskData){var n=this.maskDataPool.pop()||new or;n.pooled=!0,n.maskObject=i,r=n}switch(r.autoDetect&&this.detect(r),r.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),r._target=e,r.type){case t.MASK_TYPES.SCISSOR:this.maskStack.push(r),this.renderer.scissor.push(r);break;case t.MASK_TYPES.STENCIL:this.maskStack.push(r),this.renderer.stencil.push(r);break;case t.MASK_TYPES.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r),this.maskStack.push(r)}},i.prototype.pop=function(e){var i=this.maskStack.pop();if(i&&i._target===e){switch(i.type){case t.MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case t.MASK_TYPES.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case t.MASK_TYPES.SPRITE:this.popSpriteMask()}i.reset(),i.pooled&&this.maskDataPool.push(i)}},i.prototype.detect=function(e){var i=e.maskObject;if(i.isSprite)e.type=t.MASK_TYPES.SPRITE;else if(e.type=t.MASK_TYPES.STENCIL,this.enableScissor&&i.isFastRect&&i.isFastRect()){var r=i.worldTransform,n=Math.atan2(r.b,r.a),o=Math.atan2(r.d,r.c);n=Math.round(n*(180/Math.PI)*100),o=((o=Math.round(o*(180/Math.PI)*100)-n)%18e3+18e3)%18e3,0===(n=(n%9e3+9e3)%9e3)&&9e3===o&&(e.type=t.MASK_TYPES.SCISSOR)}},i.prototype.pushSpriteMask=function(t){var e=t.maskObject,i=t._target,r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new Lr(e)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=e;var n=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,r),i.filterArea=n,this.alphaMaskIndex++},i.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},i}(Ci),Fr=function(t){function e(e){var i=t.call(this,e)||this;return i.maskStack=[],i.glConst=0,i}return hi(e,t),e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var e=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var r=this.getStackLength();r!==i&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.maskStack=null},e}(Ci),Nr=function(t){function e(e){var i=t.call(this,e)||this;return i.glConst=WebGLRenderingContext.SCISSOR_TEST,i}return hi(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var i=t._scissorRect,r=e.getBounds(!0),n=this.renderer.gl;e.renderable=!1,i?r.fit(i):n.enable(n.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=r,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,i=this.renderer.projection,r=i.transform,n=i.sourceFrame,o=i.destinationFrame,s=e?e.resolution:this.renderer.resolution,a=(t.x-n.x)*s+o.x,l=(t.y-n.y)*s+o.y,h=t.width*s,c=t.height*s;r&&(a+=r.tx*s,l+=r.ty*s),e||(l=this.renderer.height-c-l),this.renderer.gl.scissor(a,l,h,c)},e}(Fr),Vr=function(t){function e(e){var i=t.call(this,e)||this;return i.glConst=WebGLRenderingContext.STENCIL_TEST,i}return hi(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,i=this.renderer.gl,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),i.enable(i.STENCIL_TEST)),t._stencilCounter++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,r,this._getBitwiseMask()),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e}(Fr),Gr=function(t){function e(e){var i=t.call(this,e)||this;return i.destinationFrame=null,i.sourceFrame=null,i.defaultFrame=null,i.projectionMatrix=new Ae,i.transform=null,i}return hi(e,t),e.prototype.update=function(t,e,i,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);var n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,e,i,r){var n=this.projectionMatrix,o=r?-1:1;n.identity(),n.a=1/e.width*2,n.d=o*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-o-e.y*n.d},e.prototype.setTransform=function(t){},e}(Ci),Ur=new ve,jr=new ve,zr=new ve,Xr=function(t){function e(e){var i=t.call(this,e)||this;return i.clearColor=e._backgroundColorRgba,i.defaultMaskStack=[],i.current=null,i.sourceFrame=new ve,i.destinationFrame=new ve,i}return hi(e,t),e.prototype.bind=function(t,e,i){void 0===t&&(t=null);var r,n,o,s=this.renderer;this.current=t,t?(o=(r=t.baseTexture).resolution,e||(Ur.width=t.frame.width,Ur.height=t.frame.height,e=Ur),i||(jr.x=t.frame.x,jr.y=t.frame.y,jr.width=e.width,jr.height=e.height,i=jr),n=r.framebuffer):(o=s.resolution,e||(Ur.width=s.screen.width,Ur.height=s.screen.height,e=Ur),i||((i=Ur).width=e.width,i.height=e.height)),zr.x=i.x*o,zr.y=i.y*o,zr.width=i.width*o,zr.height=i.height*o,this.renderer.framebuffer.bind(n,zr),this.renderer.projection.update(i,e,o,!n),t?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)},e.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor,this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e)},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e}(Ci),Hr=function(){},Jr=function(){function t(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},t}(),Wr=0,$r={textureCount:0},Yr=function(t){function e(e){var i=t.call(this,e)||this;return i.destroyed=!1,i.systemCheck(),i.gl=null,i.shader=null,i.program=null,i.cache={},i.id=Wr++,i}return hi(e,t),e.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof Sr)return Sr;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");Sr=!0===t({a:"b"},"a","b")}catch(t){Sr=!1}return Sr}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),e||($r.textureCount=0,this.syncUniformGroup(t.uniformGroup,$r)),r},e.prototype.setUniforms=function(t){var e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t,e){var i=this.getglProgram();t.static&&t.dirtyId===i.uniformGroups[t.id]||(i.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))},e.prototype.syncUniforms=function(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)},e.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData);return this.cache[e]||(this.cache[e]=function(t,e){var i=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(var r in t.uniforms){var n=e[r];if(n){for(var o=t.uniforms[r],s=!1,a=0;a<vr.length;a++)if(vr[a].test(n,o)){i.push(vr[a].code(r,o)),s=!0;break}if(!s){var l=(1===n.size?br:wr)[n.type].replace("location",'ud["'+r+'"].location');i.push('\n            cv = ud["'+r+'"].value;\n            v = uv["'+r+'"];\n            '+l+";")}}else t.uniforms[r].group&&i.push('\n                    renderer.shader.syncUniformGroup(uv["'+r+'"], syncData);\n                ')}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,e){var i=t.uniforms,r=[];for(var n in i)r.push(n),e[n]&&r.push(e[n].type);return r.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateShader=function(t){var e=this.gl,i=t.program,r={};for(var n in i.attributeData)r[n]=i.attributeData[n].location;var o=ar(e,i.vertexSrc,i.fragmentSrc,r),s={};for(var n in i.uniformData){var a=i.uniformData[n];s[n]={location:e.getUniformLocation(o,n),value:hr(a.type,a.size)}}var l=new Jr(o,s);return i.glPrograms[this.renderer.CONTEXT_UID]=l,l},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e}(Ci);var qr=function(e){function i(i){var r=e.call(this,i)||this;return r.gl=null,r.stateId=0,r.polygonOffset=0,r.blendMode=t.BLEND_MODES.NONE,r._blendEq=!1,r.map=[],r.map[0]=r.setBlend,r.map[1]=r.setOffset,r.map[2]=r.setCullFace,r.map[3]=r.setDepthTest,r.map[4]=r.setFrontFace,r.checks=[],r.defaultState=new Br,r.defaultState.blend=!0,r}return hi(i,e),i.prototype.contextChange=function(e){this.gl=e,this.blendModes=function(e,i){return void 0===i&&(i=[]),i[t.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.ADD]=[e.ONE,e.ONE],i[t.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.NONE]=[0,0],i[t.BLEND_MODES.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],i[t.BLEND_MODES.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.SRC_IN]=[e.DST_ALPHA,e.ZERO],i[t.BLEND_MODES.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],i[t.BLEND_MODES.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],i[t.BLEND_MODES.DST_IN]=[e.ZERO,e.SRC_ALPHA],i[t.BLEND_MODES.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],i[t.BLEND_MODES.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],i[t.BLEND_MODES.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],i}(e),this.set(this.defaultState),this.reset()},i.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,i=0;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,t)},i.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},i.prototype.setBlend=function(t){this.updateCheck(i.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},i.prototype.setOffset=function(t){this.updateCheck(i.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},i.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},i.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},i.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},i.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},i.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},i.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},i.prototype.updateCheck=function(t,e){var i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)},i.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},i.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},i}(Ci),Kr=function(e){function i(t){var i=e.call(this,t)||this;return i.count=0,i.checkCount=0,i.maxIdle=B.GC_MAX_IDLE,i.checkCountMax=B.GC_MAX_CHECK_COUNT,i.mode=B.GC_MODE,i}return hi(i,e),i.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==t.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},i.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,i=!1,r=0;r<e.length;r++){var n=e[r];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[r]=null,i=!0)}if(i){var o=0;for(r=0;r<e.length;r++)null!==e[r]&&(e[o++]=e[r]);e.length=o}},i.prototype.unload=function(t){var e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(var r=t.children.length-1;r>=0;r--)this.unload(t.children[r])},i}(Ci),Zr=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},Qr=function(e){function i(t){var i=e.call(this,t)||this;return i.boundTextures=[],i.currentLocation=-1,i.managedTextures=[],i._unknownBoundTextures=!1,i.unknownTexture=new di,i}return hi(i,e),i.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var i=0;i<e;i++)this.boundTextures[i]=null;this.emptyTextures={};var r=new Zr(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Zr(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(i=0;i<this.boundTextures.length;i++)this.bind(null,i)},i.prototype.bind=function(t,e){void 0===e&&(e=0);var i=this.gl;if(t){if((t=t.castToBaseTexture()).parentTextureArray)return;if(t.valid){t.touched=this.renderer.textureGC.count;var r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null},i.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},i.prototype.unbind=function(t){var e=this.gl,i=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<i.length;r++)i[r]===this.unknownTexture&&this.bind(null,r)}for(r=0;r<i.length;r++)i[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[r]=null)},i.prototype.initTexture=function(t){var e=new Zr(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},i.prototype.initTextureType=function(e,i){if(i.internalFormat=e.format,i.type=e.type,2===this.webGLVersion){var r=this.renderer.gl;e.type===r.FLOAT&&e.format===r.RGBA&&(i.internalFormat=r.RGBA32F),e.type===t.TYPES.HALF_FLOAT&&(i.type=r.HALF_FLOAT),i.type===r.HALF_FLOAT&&e.format===r.RGBA&&(i.internalFormat=r.RGBA16F)}},i.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var i=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(i,t,e));else{var r=t.realWidth,n=t.realHeight,o=i.gl;(e.width!==r||e.height!==n||e.dirtyId<0)&&(e.width=r,e.height=n,o.texImage2D(t.target,0,e.internalFormat,r,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},i.prototype.destroyTexture=function(t,e){var i=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var r=this.managedTextures.indexOf(t);-1!==r&&te(this.managedTextures,r,1)}},i.prototype.updateTextureStyle=function(e){var i=e._glTextures[this.CONTEXT_UID];i&&(e.mipmap!==t.MIPMAP_MODES.POW2&&2===this.webGLVersion||e.isPowerOfTwo?i.mipmap=e.mipmap>=1:i.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?i.wrapMode=e.wrapMode:i.wrapMode=t.WRAP_MODES.CLAMP,e.resource&&e.resource.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)},i.prototype.setStyle=function(e,i){var r=this.gl;if(i.mipmap&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,i.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===t.SCALE_MODES.LINEAR){var o=Math.min(e.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST)},i}(Ci),tn={FilterSystem:$i,BatchSystem:qi,ContextSystem:Zi,FramebufferSystem:er,GeometrySystem:nr,MaskSystem:kr,ScissorSystem:Nr,StencilSystem:Vr,ProjectionSystem:Gr,RenderTextureSystem:Xr,ShaderSystem:Yr,StateSystem:qr,TextureGCSystem:Kr,TextureSystem:Qr},en=new Ae,rn=function(e){function i(i,r){void 0===i&&(i=t.RENDERER_TYPE.UNKNOWN);var n=e.call(this)||this;return(r=Object.assign({},B.RENDER_OPTIONS,r)).roundPixels&&(B.ROUND_PIXELS=r.roundPixels,oe("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),n.options=r,n.type=i,n.screen=new ve(0,0,r.width,r.height),n.view=r.view||document.createElement("canvas"),n.resolution=r.resolution||B.RESOLUTION,n.transparent=r.transparent,n.autoDensity=r.autoDensity||r.autoResize||!1,n.preserveDrawingBuffer=r.preserveDrawingBuffer,n.clearBeforeRender=r.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,0],n._backgroundColorString="#000000",n.backgroundColor=r.backgroundColor||n._backgroundColor,n._lastObjectRendered=null,n.plugins={},n}return hi(i,e),i.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(i.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),i.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=e+"px"),this.emit("resize",t,e)},i.prototype.generateTexture=function(t,e,i,r){0===(r=r||t.getLocalBounds(null,!0)).width&&(r.width=1),0===r.height&&(r.height=1);var n=Mi.create({width:0|r.width,height:0|r.height,scaleMode:e,resolution:i});return en.tx=-r.x,en.ty=-r.y,this.render(t,n,!1,en,!!t.parent),n},i.prototype.destroy=function(e){for(var i in this.plugins)this.plugins[i].destroy(),this.plugins[i]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var r=this;r.plugins=null,r.type=t.RENDERER_TYPE.UNKNOWN,r.view=null,r.screen=null,r._tempDisplayObjectParent=null,r.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(i.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=Gt(t),Vt(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),i}(M),nn=function(e){function i(r){var n=e.call(this,t.RENDERER_TYPE.WEBGL,r)||this;return r=n.options,n.gl=null,n.CONTEXT_UID=0,n.runners={destroy:new oi("destroy"),contextChange:new oi("contextChange"),reset:new oi("reset"),update:new oi("update"),postrender:new oi("postrender"),prerender:new oi("prerender"),resize:new oi("resize")},n.globalUniforms=new Ji({projectionMatrix:new Ae},!0),n.addSystem(kr,"mask").addSystem(Zi,"context").addSystem(qr,"state").addSystem(Yr,"shader").addSystem(Qr,"texture").addSystem(nr,"geometry").addSystem(er,"framebuffer").addSystem(Nr,"scissor").addSystem(Vr,"stencil").addSystem(Gr,"projection").addSystem(Kr,"textureGC").addSystem($i,"filter").addSystem(Xr,"renderTexture").addSystem(qi,"batch"),n.initPlugins(i.__plugins),r.context?n.context.initFromContext(r.context):n.context.initFromOptions({alpha:!!n.transparent,antialias:r.antialias,premultipliedAlpha:n.transparent&&"notMultiplied"!==n.transparent,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer,powerPreference:n.options.powerPreference}),n.renderingToScreen=!0,Ft(2===n.context.webGLVersion?"WebGL 2":"WebGL 1"),n.resize(n.options.width,n.options.height),n}return hi(i,e),i.create=function(t){if(Nt())return new i(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},i.prototype.addSystem=function(t,e){e||(e=t.name);var i=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var r in this[e]=i,this.runners)this.runners[r].add(i);return this},i.prototype.render=function(t,e,i,r,n){if(this.renderingToScreen=!e,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=r,!this.context.isLost){if(e||(this._lastObjectRendered=t),!n){var o=t.enableTempParent();t.updateTransform(),t.disableTempParent(o)}this.renderTexture.bind(e),this.batch.currentRenderer.start(),(void 0!==i?i:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),e&&e.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},i.prototype.resize=function(t,i){e.prototype.resize.call(this,t,i),this.runners.resize.emit(t,i)},i.prototype.reset=function(){return this.runners.reset.emit(),this},i.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},i.prototype.destroy=function(t){for(var i in this.runners.destroy.emit(),this.runners)this.runners[i].destroy();e.prototype.destroy.call(this,t),this.gl=null},i.registerPlugin=function(t,e){i.__plugins=i.__plugins||{},i.__plugins[t]=e},i}(rn);function on(t){return nn.create(t)}var sn="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",an="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",ln=function(){this.texArray=null,this.blend=0,this.type=t.DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null},hn=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},t}(),cn=function(){function t(t){this.rawBinaryData=new ArrayBuffer(t),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(t){return this[t+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},t}(),un=function(e){function i(t){var i=e.call(this,t)||this;return i.shaderGenerator=null,i.geometryClass=null,i.vertexSize=null,i.state=Br.for2d(),i.size=4*B.SPRITE_BATCH_SIZE,i._vertexCount=0,i._indexCount=0,i._bufferedElements=[],i._bufferedTextures=[],i._bufferSize=0,i._shader=null,i._packedGeometries=[],i._packedGeometryPoolSize=2,i._flushId=0,i._aBuffers={},i._iBuffers={},i.MAX_TEXTURES=1,i.renderer.on("prerender",i.onPrerender,i),t.runners.contextChange.add(i),i._dcIndex=0,i._aIndex=0,i._iIndex=0,i._attributeBuffer=null,i._indexBuffer=null,i._tempBoundTextures=[],i}return hi(i,e),i.prototype.contextChange=function(){var e=this.renderer.gl;B.PREFER_ENV===t.ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),B.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=Tr(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()},i.prototype.initFlushBuffers=function(){for(var t=i._drawCallPool,e=i._textureArrayPool,r=this.size/4,n=Math.floor(r/this.MAX_TEXTURES)+1;t.length<r;)t.push(new ln);for(;e.length<n;)e.push(new hn);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},i.prototype.onPrerender=function(){this._flushId=0},i.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},i.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,e=this.MAX_TEXTURES,r=i._textureArrayPool,n=this.renderer.batch,o=this._tempBoundTextures,s=this.renderer.textureGC.count,a=++di._globalBatch,l=0,h=r[0],c=0;n.copyBoundTextures(o,e);for(var u=0;u<this._bufferSize;++u){var p=t[u];t[u]=null,p._batchEnabled!==a&&(h.count>=e&&(n.boundArray(h,o,a,e),this.buildDrawCalls(h,c,u),c=u,h=r[++l],++a),p._batchEnabled=a,p.touched=s,h.elements[h.count++]=p)}h.count>0&&(n.boundArray(h,o,a,e),this.buildDrawCalls(h,c,this._bufferSize),++l,++a);for(u=0;u<o.length;u++)o[u]=null;di._globalBatch=a},i.prototype.buildDrawCalls=function(t,e,r){var n=this,o=n._bufferedElements,s=n._attributeBuffer,a=n._indexBuffer,l=n.vertexSize,h=i._drawCallPool,c=this._dcIndex,u=this._aIndex,p=this._iIndex,d=h[c];d.start=this._iIndex,d.texArray=t;for(var m=e;m<r;++m){var f=o[m],y=f._texture.baseTexture,_=zt[y.alphaMode?1:0][f.blendMode];o[m]=null,e<m&&d.blend!==_&&(d.size=p-d.start,e=m,(d=h[++c]).texArray=t,d.start=p),this.packInterleavedGeometry(f,s,a,u,p),u+=f.vertexData.length/2*l,p+=f.indices.length,d.blend=_}e<r&&(d.size=p-d.start,++c),this._dcIndex=c,this._aIndex=u,this._iIndex=p},i.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0},i.prototype.updateGeometry=function(){var t=this,e=t._packedGeometries,i=t._attributeBuffer,r=t._indexBuffer;B.CAN_UPLOAD_SAME_BUFFER?(e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(i.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},i.prototype.drawBatches=function(){for(var t=this._dcIndex,e=this.renderer,r=e.gl,n=e.state,o=i._drawCallPool,s=null,a=0;a<t;a++){var l=o[a],h=l.texArray,c=l.type,u=l.size,p=l.start,d=l.blend;s!==h&&(s=h,this.bindAndClearTexArray(h)),this.state.blendMode=d,n.set(this.state),r.drawElements(c,u,r.UNSIGNED_SHORT,2*p)}},i.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},i.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),B.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},i.prototype.stop=function(){this.flush()},i.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),e.prototype.destroy.call(this)},i.prototype.getAttributeBuffer=function(t){var e=Kt(Math.ceil(t/8)),i=Qt(e),r=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);var n=this._aBuffers[r];return n||(this._aBuffers[r]=n=new cn(r*this.vertexSize*4)),n},i.prototype.getIndexBuffer=function(t){var e=Kt(Math.ceil(t/12)),i=Qt(e),r=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);var n=this._iBuffers[i];return n||(this._iBuffers[i]=n=new Uint16Array(r)),n},i.prototype.packInterleavedGeometry=function(t,e,i,r,n){for(var o=e.uint32View,s=e.float32View,a=r/this.vertexSize,l=t.uvs,h=t.indices,c=t.vertexData,u=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),d=p<1&&t._texture.baseTexture.alphaMode?Jt(t._tintRGB,p):t._tintRGB+(255*p<<24),m=0;m<c.length;m+=2)s[r++]=c[m],s[r++]=c[m+1],s[r++]=l[m],s[r++]=l[m+1],o[r++]=d,s[r++]=u;for(m=0;m<h.length;m++)i[n++]=a+h[m]},i._drawCallPool=[],i._textureArrayPool=[],i}(Yi),pn=function(){function t(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=Ji.from({uSamplers:e},!0);var r=this.fragTemplate;r=(r=r.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ir(this.vertexSrc,r)}var n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ae,default:this.defaultGroupCache[t]};return new Pr(this.programCache[t],n)},t.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+="if(vTextureId < "+i+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",e+="\n}";return e+="\n",e+="\n"},t}(),dn=function(e){function i(i){void 0===i&&(i=!1);var r=e.call(this)||this;return r._buffer=new ki(null,i,!1),r._indexBuffer=new ki(null,i,!0),r.addAttribute("aVertexPosition",r._buffer,2,!1,t.TYPES.FLOAT).addAttribute("aTextureCoord",r._buffer,2,!1,t.TYPES.FLOAT).addAttribute("aColor",r._buffer,4,!0,t.TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",r._buffer,1,!0,t.TYPES.FLOAT).addIndex(r._indexBuffer),r}return hi(i,e),i}(ji),mn="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",fn="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",yn=function(){function t(){}return t.create=function(t){var e=Object.assign({vertex:mn,fragment:fn,geometryClass:dn,vertexSize:6},t),i=e.vertex,r=e.fragment,n=e.vertexSize,o=e.geometryClass;return function(t){function e(e){var s=t.call(this,e)||this;return s.shaderGenerator=new pn(i,r),s.geometryClass=o,s.vertexSize=n,s}return hi(e,t),e}(un)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return mn},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return fn},enumerable:!1,configurable:!0}),t}(),_n=yn.create(),gn=function(){function t(e){var i=this;e=Object.assign({forceCanvas:!1},e),this.renderer=on(e),this.stage=new ze,t._plugins.forEach((function(t){t.init.call(i,e)}))}return t.registerPlugin=function(e){t._plugins.push(e)},t.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(e,i){var r=this,n=t._plugins.slice(0);n.reverse(),n.forEach((function(t){t.destroy.call(r)})),this.stage.destroy(i),this.stage=null,this.renderer.destroy(e),this.renderer=null},t}();gn._plugins=[];var xn=function(){function t(){}return t.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){window.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(window.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){e._resizeTo&&(e.cancelResize(),e._resizeId=requestAnimationFrame((function(){return e.resize()})))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(e._resizeTo){var t,i;if(e.cancelResize(),e._resizeTo===window)t=window.innerWidth,i=window.innerHeight;else{var r=e._resizeTo;t=r.clientWidth,i=r.clientHeight}e.renderer.resize(t,i)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},t.destroy=function(){window.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},t}();gn.registerPlugin(xn);var vn=new ve,bn=function(){function t(t){this.renderer=t,t.extract=this}return t.prototype.image=function(t,e,i){var r=new Image;return r.src=this.base64(t,e,i),r},t.prototype.base64=function(t,e,i){return this.canvas(t).toDataURL(e,i)},t.prototype.canvas=function(e){var i,r,n,o=this.renderer,s=!1,a=!1;e&&(e instanceof Mi?n=e:(n=this.renderer.generateTexture(e),a=!0)),n?(i=n.baseTexture.resolution,r=n.frame,s=!1,o.renderTexture.bind(n)):(i=this.renderer.resolution,s=!0,(r=vn).width=this.renderer.width,r.height=this.renderer.height,o.renderTexture.bind(null));var l=Math.floor(r.width*i+1e-4),h=Math.floor(r.height*i+1e-4),c=new he(l,h,1),u=new Uint8Array(4*l*h),p=o.gl;p.readPixels(r.x*i,r.y*i,l,h,p.RGBA,p.UNSIGNED_BYTE,u);var d=c.context.getImageData(0,0,l,h);if(t.arrayPostDivide(u,d.data),c.context.putImageData(d,0,0),s){var m=new he(c.width,c.height,1);m.context.scale(1,-1),m.context.drawImage(c.canvas,0,-h),c.destroy(),c=m}return a&&n.destroy(!0),c.canvas},t.prototype.pixels=function(e){var i,r,n,o=this.renderer,s=!1;e&&(e instanceof Mi?n=e:(n=this.renderer.generateTexture(e),s=!0)),n?(i=n.baseTexture.resolution,r=n.frame,o.renderTexture.bind(n)):(i=o.resolution,(r=vn).width=o.width,r.height=o.height,o.renderTexture.bind(null));var a=r.width*i,l=r.height*i,h=new Uint8Array(4*a*l),c=o.gl;return c.readPixels(r.x*i,r.y*i,a,l,c.RGBA,c.UNSIGNED_BYTE,h),s&&n.destroy(!0),t.arrayPostDivide(h,h),h},t.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},t.arrayPostDivide=function(t,e){for(var i=0;i<t.length;i+=4){var r=e[i+3]=t[i+3];0!==r?(e[i]=Math.round(Math.min(255*t[i]/r,255)),e[i+1]=Math.round(Math.min(255*t[i+1]/r,255)),e[i+2]=Math.round(Math.min(255*t[i+2]/r,255))):(e[i]=t[i],e[i+1]=t[i+1],e[i+2]=t[i+2])}},t}(),wn=function(t,e){if(void 0===e&&(e={}),t){for(var i={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?))?((((?:[^?#/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@/]*@)([^:/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#/]*\.[^?#/.]+(?:[?#]|$)))*\/?)?([^?#/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=i.parser[e.strictMode?"strict":"loose"].exec(t),n={},o=14;o--;)n[i.key[o]]=r[o]||"";return n[i.q.name]={},n[i.key[12]].replace(i.q.parser,(function(t,e,r){e&&(n[i.q.name][e]=r)})),n}},Sn=i((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(e,i,n){void 0===i&&(i=!1),r(this,t),this._fn=e,this._once=i,this._thisArg=n,this._next=this._prev=this._owner=null}return i(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function o(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var s=function(){function t(){r(this,t),this._head=this._tail=void 0}return i(t,[{key:"handlers",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=this._head;if(t)return!!e;for(var i=[];e;)i.push(e),e=e._next;return i}},{key:"has",value:function(t){if(!(t instanceof n))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=arguments,e=this._head;if(!e)return!1;for(;e;)e._once&&this.detach(e),e._fn.apply(e._thisArg,t),e=e._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return o(this,new n(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return o(this,new n(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof n))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this||(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null),this}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();s.MiniSignalBinding=n,e.default=s,t.exports=e.default})),Cn=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(Sn);function Dn(){}function Tn(t,e,i,r){var n=0,o=t.length;!function s(a){a||n===o?i&&i(a):r?setTimeout((function(){e(t[n++],s)}),1):e(t[n++],s)}()}function An(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}function En(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var i=0,r={_tasks:[],concurrency:e,saturated:Dn,unsaturated:Dn,buffer:e/4,empty:Dn,drain:Dn,error:Dn,started:!1,paused:!1,push:function(t,e){n(t,!1,e)},kill:function(){i=0,r.drain=Dn,r.started=!1,r._tasks=[]},unshift:function(t,e){n(t,!0,e)},process:function(){for(;!r.paused&&i<r.concurrency&&r._tasks.length;){var e=r._tasks.shift();0===r._tasks.length&&r.empty(),(i+=1)===r.concurrency&&r.saturated(),t(e.data,An(o(e)))}},length:function(){return r._tasks.length},running:function(){return i},idle:function(){return r._tasks.length+i===0},pause:function(){!0!==r.paused&&(r.paused=!0)},resume:function(){if(!1!==r.paused){r.paused=!1;for(var t=1;t<=r.concurrency;t++)r.process()}}};function n(t,e,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");if(r.started=!0,null==t&&r.idle())setTimeout((function(){return r.drain()}),1);else{var n={data:t,callback:"function"==typeof i?i:Dn};e?r._tasks.unshift(n):r._tasks.push(n),setTimeout((function(){return r.process()}),1)}}function o(t){return function(){i-=1,t.callback.apply(t,arguments),null!=arguments[0]&&r.error(arguments[0],t.data),i<=r.concurrency-r.buffer&&r.unsaturated(),r.idle()&&r.drain(),r.process()}}return r}var In={};function Pn(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bn(t,e,i){return e&&Pn(t.prototype,e),i&&Pn(t,i),t}var Mn=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),On=null;function Rn(){}var Ln=function(){function t(e,i,r){if("string"!=typeof e||"string"!=typeof i)throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===i.indexOf("data:")),this.name=e,this.url=i,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===r.crossOrigin?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=Rn,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Cn,this.onProgress=new Cn,this.onComplete=new Cn,this.onAfterMiddleware=new Cn}t.setExtensionLoadType=function(e,i){kn(t._loadTypeMap,e,i)},t.setExtensionXhrType=function(e,i){kn(t._xhrTypeMap,e,i)};var e=t.prototype;return e.complete=function(){this._clearEvents(),this._finish()},e.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(e){var i=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout((function(){return e(i)}),1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:Mn&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e._hasFlag=function(t){return 0!=(this._flags&t)},e._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(t,this.url[i],Array.isArray(e)?e[i]:e));else{var r=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(r)?r[0]:r))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},e._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},e._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){return t.send()}),1)},e._createSource=function(t,e,i){i||(i=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=i,r},e._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},e._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var t=this.xhr;this.abort(Fn(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e._xhrOnTimeout=function(){var t=this.xhr;this.abort(Fn(t)+" Request timed out.")},e._xhrOnAbort=function(){var t=this.xhr;this.abort(Fn(t)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var e=this.xhr,i="",r=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(i=e.responseText),0===r&&(i.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=200:1223===r&&(r=204),2===(r/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=i,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(i),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var n=new DOMParser;this.data=n.parseFromString(i,"text/xml")}else{var o=document.createElement("div");o.innerHTML=i,this.data=o}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||i;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},e._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";e=e||window.location,On||(On=document.createElement("a")),On.href=t;var i=!(t=wn(On.href,{strictMode:!0})).port&&""===e.port||t.port===e.port,r=t.protocol?t.protocol+":":"";return t.host===e.hostname&&i&&r===e.protocol?"":"anonymous"},e._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},e._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var i=t.indexOf("/");e=t.substring(i+1,t.indexOf(";",i))}else{var r=t.indexOf("?"),n=t.indexOf("#"),o=Math.min(r>-1?r:t.length,n>-1?n:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},e._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},Bn(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function kn(t,e,i){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=i)}function Fn(t){return t.toString().replace("object ","")}Ln.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},Ln.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},Ln.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},Ln.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},Ln._loadTypeMap={gif:Ln.LOAD_TYPE.IMAGE,png:Ln.LOAD_TYPE.IMAGE,bmp:Ln.LOAD_TYPE.IMAGE,jpg:Ln.LOAD_TYPE.IMAGE,jpeg:Ln.LOAD_TYPE.IMAGE,tif:Ln.LOAD_TYPE.IMAGE,tiff:Ln.LOAD_TYPE.IMAGE,webp:Ln.LOAD_TYPE.IMAGE,tga:Ln.LOAD_TYPE.IMAGE,svg:Ln.LOAD_TYPE.IMAGE,"svg+xml":Ln.LOAD_TYPE.IMAGE,mp3:Ln.LOAD_TYPE.AUDIO,ogg:Ln.LOAD_TYPE.AUDIO,wav:Ln.LOAD_TYPE.AUDIO,mp4:Ln.LOAD_TYPE.VIDEO,webm:Ln.LOAD_TYPE.VIDEO},Ln._xhrTypeMap={xhtml:Ln.XHR_RESPONSE_TYPE.DOCUMENT,html:Ln.XHR_RESPONSE_TYPE.DOCUMENT,htm:Ln.XHR_RESPONSE_TYPE.DOCUMENT,xml:Ln.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Ln.XHR_RESPONSE_TYPE.DOCUMENT,svg:Ln.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Ln.XHR_RESPONSE_TYPE.DOCUMENT,gif:Ln.XHR_RESPONSE_TYPE.BLOB,png:Ln.XHR_RESPONSE_TYPE.BLOB,bmp:Ln.XHR_RESPONSE_TYPE.BLOB,jpg:Ln.XHR_RESPONSE_TYPE.BLOB,jpeg:Ln.XHR_RESPONSE_TYPE.BLOB,tif:Ln.XHR_RESPONSE_TYPE.BLOB,tiff:Ln.XHR_RESPONSE_TYPE.BLOB,webp:Ln.XHR_RESPONSE_TYPE.BLOB,tga:Ln.XHR_RESPONSE_TYPE.BLOB,json:Ln.XHR_RESPONSE_TYPE.JSON,text:Ln.XHR_RESPONSE_TYPE.TEXT,txt:Ln.XHR_RESPONSE_TYPE.TEXT,ttf:Ln.XHR_RESPONSE_TYPE.BUFFER,otf:Ln.XHR_RESPONSE_TYPE.BUFFER},Ln.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var Nn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var Vn=window.URL||window.webkitURL;var Gn={caching:function(t,e){var i=this;In[t.url]?(t.data=In[t.url],t.complete()):t.onComplete.once((function(){return In[i.url]=i.data})),e()},parsing:function(t,e){if(t.data){if(t.xhr&&t.xhrType===Ln.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var i=Vn.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=i,t.type=Ln.TYPE.IMAGE,void(t.data.onload=function(){Vn.revokeObjectURL(i),t.data.onload=null,e()})}}else{var r=t.xhr.getResponseHeader("content-type");if(r&&0===r.indexOf("image"))return t.data=new Image,t.data.src="data:"+r+";base64,"+function(t){for(var e="",i=0;i<t.length;){for(var r=[0,0,0],n=[0,0,0,0],o=0;o<r.length;++o)i<t.length?r[o]=255&t.charCodeAt(i++):r[o]=0;switch(n[0]=r[0]>>2,n[1]=(3&r[0])<<4|r[1]>>4,n[2]=(15&r[1])<<2|r[2]>>6,n[3]=63&r[2],i-(t.length-1)){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64}for(var s=0;s<n.length;++s)e+=Nn.charAt(n[s])}return e}(t.xhr.responseText),t.type=Ln.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}},Un=/(#[\w-]+)?$/,jn=function(){function t(e,i){var r=this;void 0===e&&(e=""),void 0===i&&(i=10),this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return r._loadResource(t,e)},this._queue=En(this._boundLoadResource,i),this._queue.pause(),this.resources={},this.onProgress=new Cn,this.onError=new Cn,this.onLoad=new Cn,this.onStart=new Cn,this.onComplete=new Cn;for(var n=0;n<t._defaultBeforeMiddleware.length;++n)this.pre(t._defaultBeforeMiddleware[n]);for(var o=0;o<t._defaultAfterMiddleware.length;++o)this.use(t._defaultAfterMiddleware[o])}var e=t.prototype;return e.add=function(t,e,i,r){if(Array.isArray(t)){for(var n=0;n<t.length;++n)this.add(t[n]);return this}if("object"==typeof t&&(r=e||t.callback||t.onComplete,i=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(r=i,i=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof i&&(r=i,i=null),this.loading&&(!i||!i.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new Ln(t,e,i),"function"==typeof r&&this.resources[t].onAfterMiddleware.once(r),this.loading){for(var o=i.parentResource,s=[],a=0;a<o.children.length;++a)o.children[a].isComplete||s.push(o.children[a]);var l=o.progressChunk*(s.length+1)/(s.length+2);o.children.push(this.resources[t]),o.progressChunk=l;for(var h=0;h<s.length;++h)s[h].progressChunk=l;this.resources[t].progressChunk=l}return this._queue.push(this.resources[t]),this},e.pre=function(t){return this._beforeMiddleware.push(t),this},e.use=function(t){return this._afterMiddleware.push(t),this},e.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},e.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(t){var e,i=wn(t,{strictMode:!0});if(e=i.protocol||!i.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var r=Un.exec(e)[0];-1!==(e=e.substr(0,e.length-r.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=r}return e},e._loadResource=function(t,e){var i=this;t._dequeue=e,Tn(this._beforeMiddleware,(function(e,r){e.call(i,t,(function(){r(t.isComplete?{}:null)}))}),(function(){t.isComplete?i._onLoad(t):(t._onLoadBinding=t.onComplete.once(i._onLoad,i),t.load())}),!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),Tn(this._afterMiddleware,(function(i,r){i.call(e,t,r)}),(function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()}),!0)},Bn(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();jn._defaultBeforeMiddleware=[],jn._defaultAfterMiddleware=[],jn.pre=function(t){return jn._defaultBeforeMiddleware.push(t),jn},jn.use=function(t){return jn._defaultAfterMiddleware.push(t),jn};var zn=Ln,Xn=function(t,e){return Xn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Xn(t,e)};var Hn=function(){function t(){}return t.use=function(t,e){t.data&&t.type===Ln.TYPE.IMAGE&&(t.texture=Pi.fromLoader(t.data,t.url,t.name)),e()},t}(),Jn=function(t){function e(i,r){for(var n=t.call(this,i,r)||this,o=0;o<e._plugins.length;++o){var s=e._plugins[o],a=s.pre,l=s.use;a&&n.pre(a),l&&n.use(l)}return n._protected=!1,n}return function(t,e){function i(){this.constructor=t}Xn(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(e,"shared",{get:function(){var t=e._shared;return t||((t=new e)._protected=!0,e._shared=t),t},enumerable:!1,configurable:!0}),e.registerPlugin=function(t){return e._plugins.push(t),t.add&&t.add(),e},e._plugins=[],e}(jn);Jn.registerPlugin({use:Gn.parsing}),Jn.registerPlugin(Hn);var Wn=function(){function t(){}return t.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?Jn.shared:new Jn},t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t}(),$n=function(t,e){return $n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},$n(t,e)};function Yn(t,e){function i(){this.constructor=t}$n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var qn,Kn,Zn=function(e){function i(i,r,n,o){void 0===i&&(i=1500),void 0===n&&(n=16384),void 0===o&&(o=!1);var s=e.call(this)||this;return n>16384&&(n=16384),s._properties=[!1,!0,!1,!1,!1],s._maxSize=i,s._batchSize=n,s._buffers=null,s._bufferUpdateIDs=[],s._updateID=0,s.interactiveChildren=!1,s.blendMode=t.BLEND_MODES.NORMAL,s.autoResize=o,s.roundPixels=!0,s.baseTexture=null,s.setProperties(r),s._tint=0,s.tintRgb=new Float32Array(4),s.tint=16777215,s}return Yn(i,e),i.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},i.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(i.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,Vt(t,this.tintRgb)},enumerable:!1,configurable:!0}),i.prototype.render=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(function(){return e.onChildrenChange(0)}))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},i.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},i.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},i.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},i}(ze),Qn=function(){function e(e,i,r){this.geometry=new ji,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<e.length;++n){var o=e[n];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||t.TYPES.FLOAT,offset:o.offset},i[n]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return e.prototype.initBuffers=function(){var e=this.geometry,i=0;this.indexBuffer=new ki($t(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){(a=this.dynamicProperties[r]).offset=i,i+=a.size,this.dynamicStride+=a.size}var n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new ki(this.dynamicData,!1,!1);var o=0;this.staticStride=0;for(r=0;r<this.staticProperties.length;++r){(a=this.staticProperties[r]).offset=o,o+=a.size,this.staticStride+=a.size}var s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new ki(this.staticData,!0,!1);for(r=0;r<this.dynamicProperties.length;++r){var a=this.dynamicProperties[r];e.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===t.TYPES.UNSIGNED_BYTE,a.type,4*this.dynamicStride,4*a.offset)}for(r=0;r<this.staticProperties.length;++r){a=this.staticProperties[r];e.addAttribute(a.attributeName,this.staticBuffer,0,a.type===t.TYPES.UNSIGNED_BYTE,a.type,4*this.staticStride,4*a.offset)}},e.prototype.uploadDynamic=function(e,i,r){for(var n=0;n<this.dynamicProperties.length;n++){var o=this.dynamicProperties[n];o.uploadFunction(e,i,r,o.type===t.TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++},e.prototype.uploadStatic=function(e,i,r){for(var n=0;n<this.staticProperties.length;n++){var o=this.staticProperties[n];o.uploadFunction(e,i,r,o.type===t.TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++},e.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},e}(),to=function(e){function i(i){var r=e.call(this,i)||this;return r.shader=null,r.properties=null,r.tempMatrix=new Ae,r.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:r.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:r.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:r.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:r.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:t.TYPES.UNSIGNED_BYTE,uploadFunction:r.uploadTint,offset:0}],r.shader=Pr.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),r.state=Br.for2d(),r}return Yn(i,e),i.prototype.render=function(t){var e=t.children,i=t._maxSize,r=t._batchSize,n=this.renderer,o=e.length;if(0!==o){o>i&&!t.autoResize&&(o=i);var s=t._buffers;s||(s=t._buffers=this.generateBuffers(t));var a=e[0]._texture.baseTexture;this.state.blendMode=Xt(t.blendMode,a.alphaMode),n.state.set(this.state);var l=n.gl,h=t.worldTransform.copyTo(this.tempMatrix);h.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=h.toArray(!0),this.shader.uniforms.uColor=Ht(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,a.alphaMode),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);for(var c=!1,u=0,p=0;u<o;u+=r,p+=1){var d=o-u;d>r&&(d=r),p>=s.length&&s.push(this._generateOneMoreBuffer(t));var m=s[p];m.uploadDynamic(e,u,d);var f=t._bufferUpdateIDs[p]||0;(c=c||m._updateID<f)&&(m._updateID=t._updateID,m.uploadStatic(e,u,d)),n.geometry.bind(m.geometry),l.drawElements(l.TRIANGLES,6*d,l.UNSIGNED_SHORT,0)}}},i.prototype.generateBuffers=function(t){for(var e=[],i=t._maxSize,r=t._batchSize,n=t._properties,o=0;o<i;o+=r)e.push(new Qn(this.properties,n,r));return e},i.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,i=t._properties;return new Qn(this.properties,i,e)},i.prototype.uploadVertices=function(t,e,i,r,n,o){for(var s=0,a=0,l=0,h=0,c=0;c<i;++c){var u=t[e+c],p=u._texture,d=u.scale.x,m=u.scale.y,f=p.trim,y=p.orig;f?(s=(a=f.x-u.anchor.x*y.width)+f.width,l=(h=f.y-u.anchor.y*y.height)+f.height):(s=y.width*(1-u.anchor.x),a=y.width*-u.anchor.x,l=y.height*(1-u.anchor.y),h=y.height*-u.anchor.y),r[o]=a*d,r[o+1]=h*m,r[o+n]=s*d,r[o+n+1]=h*m,r[o+2*n]=s*d,r[o+2*n+1]=l*m,r[o+3*n]=a*d,r[o+3*n+1]=l*m,o+=4*n}},i.prototype.uploadPosition=function(t,e,i,r,n,o){for(var s=0;s<i;s++){var a=t[e+s].position;r[o]=a.x,r[o+1]=a.y,r[o+n]=a.x,r[o+n+1]=a.y,r[o+2*n]=a.x,r[o+2*n+1]=a.y,r[o+3*n]=a.x,r[o+3*n+1]=a.y,o+=4*n}},i.prototype.uploadRotation=function(t,e,i,r,n,o){for(var s=0;s<i;s++){var a=t[e+s].rotation;r[o]=a,r[o+n]=a,r[o+2*n]=a,r[o+3*n]=a,o+=4*n}},i.prototype.uploadUvs=function(t,e,i,r,n,o){for(var s=0;s<i;++s){var a=t[e+s]._texture._uvs;a?(r[o]=a.x0,r[o+1]=a.y0,r[o+n]=a.x1,r[o+n+1]=a.y1,r[o+2*n]=a.x2,r[o+2*n+1]=a.y2,r[o+3*n]=a.x3,r[o+3*n+1]=a.y3,o+=4*n):(r[o]=0,r[o+1]=0,r[o+n]=0,r[o+n+1]=0,r[o+2*n]=0,r[o+2*n+1]=0,r[o+3*n]=0,r[o+3*n+1]=0,o+=4*n)}},i.prototype.uploadTint=function(t,e,i,r,n,o){for(var s=0;s<i;++s){var a=t[e+s],l=a._texture.baseTexture.alphaMode>0,h=a.alpha,c=h<1&&l?Jt(a._tintRGB,h):a._tintRGB+(255*h<<24);r[o]=c,r[o+n]=c,r[o+2*n]=c,r[o+3*n]=c,o+=4*n}},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},i}(Yi);(qn=t.LINE_JOIN||(t.LINE_JOIN={})).MITER="miter",qn.BEVEL="bevel",qn.ROUND="round",(Kn=t.LINE_CAP||(t.LINE_CAP={})).BUTT="butt",Kn.ROUND="round",Kn.SQUARE="square";var eo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||isNaN(t))return e;var i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}},io=function(){function t(){this.color=16777215,this.alpha=1,this.texture=Pi.WHITE,this.matrix=null,this.visible=!1,this.reset()}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},t.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Pi.WHITE,this.matrix=null,this.visible=!1},t.prototype.destroy=function(){this.texture=null,this.matrix=null},t}(),ro=function(t,e){return ro=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},ro(t,e)};function no(t,e){function i(){this.constructor=t}ro(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var oo={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var i=t.points,r=t.holes,n=e.points,o=e.indices;if(i.length>=6){for(var s=[],a=0;a<r.length;a++){var l=r[a];s.push(i.length/2),i=i.concat(l.points)}var h=O(i,s,2);if(!h)return;var c=n.length/2;for(a=0;a<h.length;a+=3)o.push(h[a]+c),o.push(h[a+1]+c),o.push(h[a+2]+c);for(a=0;a<i.length;a++)n.push(i[a])}}},so={build:function(e){var i,r,n=e.shape,o=e.points,s=n.x,a=n.y;if(o.length=0,e.type===t.SHAPES.CIRC)i=n.radius,r=n.radius;else{var l=e.shape;i=l.width,r=l.height}if(0!==i&&0!==r){var h=Math.floor(30*Math.sqrt(n.radius))||Math.floor(15*Math.sqrt(i+r));h/=2.3;for(var c=2*Math.PI/h,u=0;u<h-.5;u++)o.push(s+Math.sin(-c*u)*i,a+Math.cos(-c*u)*r);o.push(o[0],o[1])}},triangulate:function(t,e){var i=t.points,r=e.points,n=e.indices,o=r.length/2,s=o,a=t.shape,l=t.matrix,h=a.x,c=a.y;r.push(t.matrix?l.a*h+l.c*c+l.tx:h,t.matrix?l.b*h+l.d*c+l.ty:c);for(var u=0;u<i.length;u+=2)r.push(i[u],i[u+1]),n.push(o++,s,o)}},ao={build:function(t){var e=t.shape,i=e.x,r=e.y,n=e.width,o=e.height,s=t.points;s.length=0,s.push(i,r,i+n,r,i+n,r+o,i,r+o)},triangulate:function(t,e){var i=t.points,r=e.points,n=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}};function lo(t,e,i){return t+(e-t)*i}function ho(t,e,i,r,n,o,s){void 0===s&&(s=[]);for(var a=s,l=0,h=0,c=0,u=0,p=0,d=0,m=0,f=0;m<=20;++m)l=lo(t,i,f=m/20),h=lo(e,r,f),c=lo(i,n,f),u=lo(r,o,f),p=lo(l,c,f),d=lo(h,u,f),a.push(p,d);return a}var co={build:function(t){var e=t.shape,i=t.points,r=e.x,n=e.y,o=e.width,s=e.height,a=Math.max(0,Math.min(e.radius,Math.min(o,s)/2));i.length=0,a?(ho(r,n+a,r,n,r+a,n,i),ho(r+o-a,n,r+o,n,r+o,n+a,i),ho(r+o,n+s-a,r+o,n+s,r+o-a,n+s,i),ho(r+a,n+s,r,n+s,r,n+s-a,i)):i.push(r,n,r+o,n,r+o,n+s,r,n+s)},triangulate:function(t,e){for(var i=t.points,r=e.points,n=e.indices,o=r.length/2,s=O(i,null,2),a=0,l=s.length;a<l;a+=3)n.push(s[a]+o),n.push(s[a+1]+o),n.push(s[a+2]+o);for(a=0,l=i.length;a<l;a++)r.push(i[a],i[++a])}};function uo(t,e,i,r,n,o,s,a){var l,h;s?(l=r,h=-i):(l=-r,h=i);var c=t-i*n+l,u=e-r*n+h,p=t+i*o+l,d=e+r*o+h;return a.push(c,u),a.push(p,d),2}function po(t,e,i,r,n,o,s,a){var l=i-t,h=r-e,c=Math.atan2(l,h),u=Math.atan2(n-t,o-e);a&&c<u?c+=2*Math.PI:!a&&c>u&&(u+=2*Math.PI);var p=c,d=u-c,m=Math.abs(d),f=Math.sqrt(l*l+h*h),y=1+(15*m*Math.sqrt(f)/Math.PI>>0),_=d/y;if(p+=_,a){s.push(t,e),s.push(i,r);for(var g=1,x=p;g<y;g++,x+=_)s.push(t,e),s.push(t+Math.sin(x)*f,e+Math.cos(x)*f);s.push(t,e),s.push(n,o)}else{s.push(i,r),s.push(t,e);for(g=1,x=p;g<y;g++,x+=_)s.push(t+Math.sin(x)*f,e+Math.cos(x)*f),s.push(t,e);s.push(n,o),s.push(t,e)}return 2*y}function mo(e,i){e.lineStyle.native?function(e,i){var r=0,n=e.shape,o=e.points||n.points,s=n.type!==t.SHAPES.POLY||n.closeStroke;if(0!==o.length){var a=i.points,l=i.indices,h=o.length/2,c=a.length/2,u=c;for(a.push(o[0],o[1]),r=1;r<h;r++)a.push(o[2*r],o[2*r+1]),l.push(u,u+1),u++;s&&l.push(u,c)}}(e,i):function(e,i){var r=e.shape,n=e.points||r.points.slice(),o=i.closePointEps;if(0!==n.length){var s=e.lineStyle,a=new De(n[0],n[1]),l=new De(n[n.length-2],n[n.length-1]),h=r.type!==t.SHAPES.POLY||r.closeStroke,c=Math.abs(a.x-l.x)<o&&Math.abs(a.y-l.y)<o;if(h){n=n.slice(),c&&(n.pop(),n.pop(),l.set(n[n.length-2],n[n.length-1]));var u=.5*(a.x+l.x),p=.5*(l.y+a.y);n.unshift(u,p),n.push(u,p)}var d=i.points,m=n.length/2,f=n.length,y=d.length/2,_=s.width/2,g=_*_,x=s.miterLimit*s.miterLimit,v=n[0],b=n[1],w=n[2],S=n[3],C=0,D=0,T=-(b-S),A=v-w,E=0,I=0,P=Math.sqrt(T*T+A*A);T/=P,A/=P,T*=_,A*=_;var B=s.alignment,M=2*(1-B),O=2*B;h||(s.cap===t.LINE_CAP.ROUND?f+=po(v-T*(M-O)*.5,b-A*(M-O)*.5,v-T*M,b-A*M,v+T*O,b+A*O,d,!0)+2:s.cap===t.LINE_CAP.SQUARE&&(f+=uo(v,b,T,A,M,O,!0,d))),d.push(v-T*M,b-A*M),d.push(v+T*O,b+A*O);for(var R=1;R<m-1;++R){v=n[2*(R-1)],b=n[2*(R-1)+1],w=n[2*R],S=n[2*R+1],C=n[2*(R+1)],D=n[2*(R+1)+1],T=-(b-S),A=v-w,T/=P=Math.sqrt(T*T+A*A),A/=P,T*=_,A*=_,E=-(S-D),I=w-C,E/=P=Math.sqrt(E*E+I*I),I/=P,E*=_,I*=_;var L=w-v,k=b-S,F=w-C,N=D-S,V=k*F-N*L,G=V<0;if(Math.abs(V)<.1)d.push(w-T*M,S-A*M),d.push(w+T*O,S+A*O);else{var U=(-T+v)*(-A+S)-(-T+w)*(-A+b),j=(-E+C)*(-I+S)-(-E+w)*(-I+D),z=(L*j-F*U)/V,X=(N*U-k*j)/V,H=(z-w)*(z-w)+(X-S)*(X-S),J=w+(z-w)*M,W=S+(X-S)*M,$=w-(z-w)*O,Y=S-(X-S)*O,q=G?M:O;H<=Math.min(L*L+k*k,F*F+N*N)+q*q*g?s.join===t.LINE_JOIN.BEVEL||H/g>x?(G?(d.push(J,W),d.push(w+T*O,S+A*O),d.push(J,W),d.push(w+E*O,S+I*O)):(d.push(w-T*M,S-A*M),d.push($,Y),d.push(w-E*M,S-I*M),d.push($,Y)),f+=2):s.join===t.LINE_JOIN.ROUND?G?(d.push(J,W),d.push(w+T*O,S+A*O),f+=po(w,S,w+T*O,S+A*O,w+E*O,S+I*O,d,!0)+4,d.push(J,W),d.push(w+E*O,S+I*O)):(d.push(w-T*M,S-A*M),d.push($,Y),f+=po(w,S,w-T*M,S-A*M,w-E*M,S-I*M,d,!1)+4,d.push(w-E*M,S-I*M),d.push($,Y)):(d.push(J,W),d.push($,Y)):(d.push(w-T*M,S-A*M),d.push(w+T*O,S+A*O),s.join===t.LINE_JOIN.BEVEL||H/g>x||(s.join===t.LINE_JOIN.ROUND?f+=G?po(w,S,w+T*O,S+A*O,w+E*O,S+I*O,d,!0)+2:po(w,S,w-T*M,S-A*M,w-E*M,S-I*M,d,!1)+2:(G?(d.push($,Y),d.push($,Y)):(d.push(J,W),d.push(J,W)),f+=2)),d.push(w-E*M,S-I*M),d.push(w+E*O,S+I*O),f+=2)}}v=n[2*(m-2)],b=n[2*(m-2)+1],w=n[2*(m-1)],T=-(b-(S=n[2*(m-1)+1])),A=v-w,T/=P=Math.sqrt(T*T+A*A),A/=P,T*=_,A*=_,d.push(w-T*M,S-A*M),d.push(w+T*O,S+A*O),h||(s.cap===t.LINE_CAP.ROUND?f+=po(w-T*(M-O)*.5,S-A*(M-O)*.5,w-T*M,S-A*M,w+T*O,S+A*O,d,!1)+2:s.cap===t.LINE_CAP.SQUARE&&(f+=uo(w,S,T,A,M,O,!1,d)));var K=i.indices,Z=eo.epsilon*eo.epsilon;for(R=y;R<f+y-2;++R)v=d[2*R],b=d[2*R+1],w=d[2*(R+1)],S=d[2*(R+1)+1],C=d[2*(R+2)],D=d[2*(R+2)+1],Math.abs(v*(S-D)+w*(D-b)+C*(b-S))<Z||K.push(R,R+1,R+2)}}(e,i)}var fo,yo=function(t){function e(e,i,r,n,o,s){void 0===s&&(s=0);o=o||n/2;for(var a=-1*Math.PI/2+s,l=2*r,h=_e/l,c=[],u=0;u<l;u++){var p=u%2?o:n,d=u*h+a;c.push(e+p*Math.cos(d),i+p*Math.sin(d))}return t.call(this,c)||this}return no(e,t),e}(Se),_o=function(){function t(){}return t.curveTo=function(t,e,i,r,n,o){var s=o[o.length-2],a=o[o.length-1]-e,l=s-t,h=r-e,c=i-t,u=Math.abs(a*c-l*h);if(u<1e-8||0===n)return o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e),null;var p=a*a+l*l,d=h*h+c*c,m=a*h+l*c,f=n*Math.sqrt(p)/u,y=n*Math.sqrt(d)/u,_=f*m/p,g=y*m/d,x=f*c+y*l,v=f*h+y*a,b=l*(y+_),w=a*(y+_),S=c*(f+g),C=h*(f+g);return{cx:x+t,cy:v+e,radius:n,startAngle:Math.atan2(w-v,b-x),endAngle:Math.atan2(C-v,S-x),anticlockwise:l*h>c*a}},t.arc=function(t,e,i,r,n,o,s,a,l){for(var h=s-o,c=eo._segmentsCount(Math.abs(h)*n,40*Math.ceil(Math.abs(h)/_e)),u=h/(2*c),p=2*u,d=Math.cos(u),m=Math.sin(u),f=c-1,y=f%1/f,_=0;_<=f;++_){var g=u+o+p*(_+y*_),x=Math.cos(g),v=-Math.sin(g);l.push((d*x+m*v)*n+i,(d*-v+m*x)*n+r)}},t}(),go=function(){function t(){}return t.curveLength=function(t,e,i,r,n,o,s,a){for(var l=0,h=0,c=0,u=0,p=0,d=0,m=0,f=0,y=0,_=0,g=0,x=t,v=e,b=1;b<=10;++b)_=x-(f=(m=(d=(p=1-(h=b/10))*p)*p)*t+3*d*h*i+3*p*(c=h*h)*n+(u=c*h)*s),g=v-(y=m*e+3*d*h*r+3*p*c*o+u*a),x=f,v=y,l+=Math.sqrt(_*_+g*g);return l},t.curveTo=function(e,i,r,n,o,s,a){var l=a[a.length-2],h=a[a.length-1];a.length-=2;var c=eo._segmentsCount(t.curveLength(l,h,e,i,r,n,o,s)),u=0,p=0,d=0,m=0,f=0;a.push(l,h);for(var y=1,_=0;y<=c;++y)d=(p=(u=1-(_=y/c))*u)*u,f=(m=_*_)*_,a.push(d*l+3*p*_*e+3*u*m*r+f*o,d*h+3*p*_*i+3*u*m*n+f*s)},t}(),xo=function(){function t(){}return t.curveLength=function(t,e,i,r,n,o){var s=t-2*i+n,a=e-2*r+o,l=2*i-2*t,h=2*r-2*e,c=4*(s*s+a*a),u=4*(s*l+a*h),p=l*l+h*h,d=2*Math.sqrt(c+u+p),m=Math.sqrt(c),f=2*c*m,y=2*Math.sqrt(p),_=u/m;return(f*d+m*u*(d-y)+(4*p*c-u*u)*Math.log((2*m+_+d)/(_+y)))/(4*f)},t.curveTo=function(e,i,r,n,o){for(var s=o[o.length-2],a=o[o.length-1],l=eo._segmentsCount(t.curveLength(s,a,e,i,r,n)),h=0,c=0,u=1;u<=l;++u){var p=u/l;h=s+(e-s)*p,c=a+(i-a)*p,o.push(h+(e+(r-e)*p-h)*p,c+(i+(n-i)*p-c)*p)}},t}(),vo=function(){function t(){this.reset()}return t.prototype.begin=function(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i},t.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},t.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},t}(),bo=((fo={})[t.SHAPES.POLY]=oo,fo[t.SHAPES.CIRC]=so,fo[t.SHAPES.ELIP]=so,fo[t.SHAPES.RECT]=ao,fo[t.SHAPES.RREC]=co,fo),wo=[],So=[],Co={buildPoly:oo,buildCircle:so,buildRectangle:ao,buildRoundedRectangle:co,FILL_COMMANDS:bo,BATCH_POOL:wo,DRAW_CALL_POOL:So,buildLine:mo,Star:yo,ArcUtils:_o,BezierUtils:go,QuadraticUtils:xo,BatchPart:vo},Do=function(){function t(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=r,this.type=t.type,this.points=[],this.holes=[]}return t.prototype.clone=function(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)},t.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},t}(),To=new De,Ao=new Fe,Eo=function(e){function i(){var t=e.call(this)||this;return t.uvsFloat32=null,t.indicesUint16=null,t.points=[],t.colors=[],t.uvs=[],t.indices=[],t.textureIds=[],t.graphicsData=[],t.dirty=0,t.batchDirty=-1,t.cacheDirty=-1,t.clearDirty=0,t.drawCalls=[],t.batches=[],t.shapeIndex=0,t._bounds=new Fe,t.boundsDirty=-1,t.boundsPadding=0,t.batchable=!1,t.indicesUint16=null,t.uvsFloat32=null,t.closePointEps=1e-4,t}return no(i,e),Object.defineProperty(i.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),i.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),So.push(this.drawCalls[t]);this.drawCalls.length=0;for(t=0;t<this.batches.length;t++){var e=this.batches[t];e.reset(),wo.push(e)}this.batches.length=0},i.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},i.prototype.drawShape=function(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null);var n=new Do(t,e,i,r);return this.graphicsData.push(n),this.dirty++,this},i.prototype.drawHole=function(t,e){if(void 0===e&&(e=null),!this.graphicsData.length)return null;var i=new Do(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=r.lineStyle,r.holes.push(i),this.dirty++,this},i.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},i.prototype.containsPoint=function(t){for(var e=this.graphicsData,i=0;i<e.length;++i){var r=e[i];if(r.fillStyle.visible&&(r.shape&&(r.matrix?r.matrix.applyInverse(t,To):To.copyFrom(t),r.shape.contains(To.x,To.y)))){var n=!1;if(r.holes)for(var o=0;o<r.holes.length;o++){if(r.holes[o].shape.contains(To.x,To.y)){n=!0;break}}if(!n)return!0}}return!1},i.prototype.updateBatches=function(e){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var i=this.uvs,r=this.graphicsData,n=null,o=null;this.batches.length>0&&(o=(n=this.batches[this.batches.length-1]).style);for(var s=this.shapeIndex;s<r.length;s++){this.shapeIndex++;var a=r[s],l=a.fillStyle,h=a.lineStyle;bo[a.type].build(a),a.matrix&&this.transformPoints(a.points,a.matrix);for(var c=0;c<2;c++){var u=0===c?l:h;if(u.visible){var p=u.texture.baseTexture,d=this.indices.length,m=this.points.length/2;p.wrapMode=t.WRAP_MODES.REPEAT,0===c?this.processFill(a):this.processLine(a);var f=this.points.length/2-m;0!==f&&(n&&!this._compareStyles(o,u)&&(n.end(d,m),n=null),n||((n=wo.pop()||new vo).begin(u,d,m),this.batches.push(n),o=u),this.addUvs(this.points,i,u.texture,m,f,u.matrix))}}}var y=this.indices.length,_=this.points.length/2;if(n&&n.end(y,_),0!==this.batches.length){if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var g=_>65535&&e;this.indicesUint16=g?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}else this.batchable=!0}}else this.batchable=!0},i.prototype._compareStyles=function(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))},i.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var i=this.graphicsData[t],r=i.fillStyle,n=i.lineStyle;if(r&&!r.texture.baseTexture.valid)return!1;if(n&&!n.texture.baseTexture.valid)return!1}return!0},i.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,i=t.length;e<i;e++)for(var r=t[e],n=0;n<r.size;n++){var o=r.start+n;this.indicesUint16[o]=this.indicesUint16[o]-r.attribStart}},i.prototype.isBatchable=function(){if(this.points.length>131070)return!1;for(var t=this.batches,e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*i.BATCHABLE_SIZE},i.prototype.buildDrawCalls=function(){for(var e=++di._globalBatch,i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),So.push(this.drawCalls[i]);this.drawCalls.length=0;var r=this.colors,n=this.textureIds,o=So.pop();o||((o=new ln).texArray=new hn),o.texArray.count=0,o.start=0,o.size=0,o.type=t.DRAW_MODES.TRIANGLES;var s=0,a=null,l=0,h=!1,c=t.DRAW_MODES.TRIANGLES,u=0;this.drawCalls.push(o);for(i=0;i<this.batches.length;i++){var p=this.batches[i],d=p.style,m=d.texture.baseTexture;h!==!!d.native&&(c=(h=!!d.native)?t.DRAW_MODES.LINES:t.DRAW_MODES.TRIANGLES,a=null,s=8,e++),a!==m&&(a=m,m._batchEnabled!==e&&(8===s&&(e++,s=0,o.size>0&&((o=So.pop())||((o=new ln).texArray=new hn),this.drawCalls.push(o)),o.start=u,o.size=0,o.texArray.count=0,o.type=c),m.touched=1,m._batchEnabled=e,m._batchLocation=s,m.wrapMode=10497,o.texArray.elements[o.texArray.count++]=m,s++)),o.size+=p.size,u+=p.size,l=m._batchLocation,this.addColors(r,d.color,d.alpha,p.attribSize,p.attribStart),this.addTextureIds(n,l,p.attribSize,p.attribStart)}di._globalBatch=e,this.packAttributes()},i.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,i=this.colors,r=this.textureIds,n=new ArrayBuffer(3*t.length*4),o=new Float32Array(n),s=new Uint32Array(n),a=0,l=0;l<t.length/2;l++)o[a++]=t[2*l],o[a++]=t[2*l+1],o[a++]=e[2*l],o[a++]=e[2*l+1],s[a++]=i[l],o[a++]=r[l];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)},i.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),oo.triangulate(t,this)):bo[t.type].triangulate(t,this)},i.prototype.processLine=function(t){mo(t,this);for(var e=0;e<t.holes.length;e++)mo(t.holes[e],this)},i.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var i=t[e];bo[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}},i.prototype.calculateBounds=function(){var e=this._bounds,i=Ao,r=Ae.IDENTITY;this._bounds.clear(),i.clear();for(var n=0;n<this.graphicsData.length;n++){var o=this.graphicsData[n],s=o.shape,a=o.type,l=o.lineStyle,h=o.matrix||Ae.IDENTITY,c=0;if(l&&l.visible){var u=l.alignment;c=l.width,a===t.SHAPES.POLY?c*=.5+Math.abs(.5-u):c*=Math.max(0,u)}if(r!==h&&(i.isEmpty()||(e.addBoundsMatrix(i,r),i.clear()),r=h),a===t.SHAPES.RECT||a===t.SHAPES.RREC){var p=s;i.addFramePad(p.x,p.y,p.x+p.width,p.y+p.height,c,c)}else if(a===t.SHAPES.CIRC){var d=s;i.addFramePad(d.x,d.y,d.x,d.y,d.radius+c,d.radius+c)}else if(a===t.SHAPES.ELIP){var m=s;i.addFramePad(m.x,m.y,m.x,m.y,m.width+c,m.height+c)}else{var f=s;e.addVerticesMatrix(r,f.points,0,f.points.length,c,c)}}i.isEmpty()||e.addBoundsMatrix(i,r),e.pad(this.boundsPadding,this.boundsPadding)},i.prototype.transformPoints=function(t,e){for(var i=0;i<t.length/2;i++){var r=t[2*i],n=t[2*i+1];t[2*i]=e.a*r+e.c*n+e.tx,t[2*i+1]=e.b*r+e.d*n+e.ty}},i.prototype.addColors=function(t,e,i,r,n){void 0===n&&(n=0);var o=Jt((e>>16)+(65280&e)+((255&e)<<16),i);t.length=Math.max(t.length,n+r);for(var s=0;s<r;s++)t[n+s]=o},i.prototype.addTextureIds=function(t,e,i,r){void 0===r&&(r=0),t.length=Math.max(t.length,r+i);for(var n=0;n<i;n++)t[r+n]=e},i.prototype.addUvs=function(t,e,i,r,n,o){void 0===o&&(o=null);for(var s=0,a=e.length,l=i.frame;s<n;){var h=t[2*(r+s)],c=t[2*(r+s)+1];if(o){var u=o.a*h+o.c*c+o.tx;c=o.b*h+o.d*c+o.ty,h=u}s++,e.push(h/l.width,c/l.height)}var p=i.baseTexture;(l.width<p.width||l.height<p.height)&&this.adjustUvs(e,i,a,n)},i.prototype.adjustUvs=function(t,e,i,r){for(var n=e.baseTexture,o=1e-6,s=i+2*r,a=e.frame,l=a.width/n.width,h=a.height/n.height,c=a.x/a.width,u=a.y/a.height,p=Math.floor(t[i]+o),d=Math.floor(t[i+1]+o),m=i+2;m<s;m+=2)p=Math.min(p,Math.floor(t[m]+o)),d=Math.min(d,Math.floor(t[m+1]+o));c-=p,u-=d;for(m=i;m<s;m+=2)t[m]=(t[m]+c)*l,t[m+1]=(t[m+1]+u)*h},i.BATCHABLE_SIZE=100,i}(dn),Io=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.width=0,i.alignment=.5,i.native=!1,i.cap=t.LINE_CAP.BUTT,i.join=t.LINE_JOIN.MITER,i.miterLimit=10,i}return no(i,e),i.prototype.clone=function(){var t=new i;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},i.prototype.reset=function(){e.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},i}(io),Po=new Float32Array(3),Bo={},Mo=function(e){function i(i){void 0===i&&(i=null);var r=e.call(this)||this;return r._geometry=i||new Eo,r._geometry.refCount++,r.shader=null,r.state=Br.for2d(),r._fillStyle=new io,r._lineStyle=new Io,r._matrix=null,r._holeMode=!1,r.currentPath=null,r.batches=[],r.batchTint=-1,r.batchDirty=-1,r.vertexData=null,r.pluginName="batch",r._transformID=-1,r.tint=16777215,r.blendMode=t.BLEND_MODES.NORMAL,r}return no(i,e),Object.defineProperty(i.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),i.prototype.clone=function(){return this.finishPoly(),new i(this._geometry)},Object.defineProperty(i.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),i.prototype.lineStyle=function(t){if(void 0===t&&(t=null),"number"==typeof t){var e=arguments;t={width:e[0]||0,color:e[1]||0,alpha:void 0!==e[2]?e[2]:1,alignment:void 0!==e[3]?e[3]:.5,native:!!e[4]}}return this.lineTextureStyle(t)},i.prototype.lineTextureStyle=function(e){if("number"==typeof e){oe("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var i=arguments;e={width:i[0],texture:i[1],color:i[2],alpha:i[3],matrix:i[4],alignment:i[5],native:i[6]},Object.keys(e).forEach((function(t){return void 0===e[t]&&delete e[t]}))}e=Object.assign({width:0,texture:Pi.WHITE,color:e&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:t.LINE_CAP.BUTT,join:t.LINE_JOIN.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();var r=e.width>0&&e.alpha>0;return r?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:r},e)):this._lineStyle.reset(),this},i.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Se,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Se,this.currentPath.closeStroke=!1},i.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},i.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},i.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var i=this.currentPath.points,r=i[i.length-2],n=i[i.length-1];return r===t&&n===e||i.push(t,e),this},i.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},i.prototype.quadraticCurveTo=function(t,e,i,r){this._initCurve();var n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),xo.curveTo(t,e,i,r,n),this},i.prototype.bezierCurveTo=function(t,e,i,r,n,o){return this._initCurve(),go.curveTo(t,e,i,r,n,o,this.currentPath.points),this},i.prototype.arcTo=function(t,e,i,r,n){this._initCurve(t,e);var o=this.currentPath.points,s=_o.curveTo(t,e,i,r,n,o);if(s){var a=s.cx,l=s.cy,h=s.radius,c=s.startAngle,u=s.endAngle,p=s.anticlockwise;this.arc(a,l,h,c,u,p)}return this},i.prototype.arc=function(t,e,i,r,n,o){if(void 0===o&&(o=!1),r===n)return this;if(!o&&n<=r?n+=_e:o&&r<=n&&(r+=_e),0===n-r)return this;var s=t+Math.cos(r)*i,a=e+Math.sin(r)*i,l=this._geometry.closePointEps,h=this.currentPath?this.currentPath.points:null;if(h){var c=Math.abs(h[h.length-2]-s),u=Math.abs(h[h.length-1]-a);c<l&&u<l||h.push(s,a)}else this.moveTo(s,a),h=this.currentPath.points;return _o.arc(s,a,t,e,i,r,n,o,h),this},i.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:Pi.WHITE,color:t,alpha:e})},i.prototype.beginTextureFill=function(t){if(t instanceof Pi){oe("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var e=arguments;t={texture:e[0],color:e[1],alpha:e[2],matrix:e[3]},Object.keys(t).forEach((function(e){return void 0===t[e]&&delete t[e]}))}t=Object.assign({texture:Pi.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this},i.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},i.prototype.drawRect=function(t,e,i,r){return this.drawShape(new ve(t,e,i,r))},i.prototype.drawRoundedRect=function(t,e,i,r,n){return this.drawShape(new Ce(t,e,i,r,n))},i.prototype.drawCircle=function(t,e,i){return this.drawShape(new be(t,e,i))},i.prototype.drawEllipse=function(t,e,i,r){return this.drawShape(new we(t,e,i,r))},i.prototype.drawPolygon=function(){for(var t,e=arguments,i=[],r=0;r<arguments.length;r++)i[r]=e[r];var n=!0,o=i[0];o.points?(n=o.closeStroke,t=o.points):t=Array.isArray(i[0])?i[0]:i;var s=new Se(t);return s.closeStroke=n,this.drawShape(s),this},i.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},i.prototype.drawStar=function(t,e,i,r,n,o){return void 0===o&&(o=0),this.drawPolygon(new yo(t,e,i,r,n,o))},i.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},i.prototype.isFastRect=function(){var e=this._geometry.graphicsData;return 1===e.length&&e[0].shape.type===t.SHAPES.RECT&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)},i.prototype._render=function(t){this.finishPoly();var e=this._geometry,i=t.context.supports.uint32Indices;e.updateBatches(i),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},i.prototype._populateBatches=function(){var t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(var r=0;r<i;r++){var n=t.batches[r],o=n.style.color,s=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),l={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*n.start,n.size),uvs:a,_batchRGB:Vt(o),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=l}},i.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,i=this.batches.length;e<i;e++){var r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}},i.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),i=this._geometry,r=this.tint,n=this.worldAlpha,o=e.uniforms,s=i.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(r>>16&255)/255*n,o.tint[1]=(r>>8&255)/255*n,o.tint[2]=(255&r)/255*n,o.tint[3]=n,t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(var a=0,l=s.length;a<l;a++)this._renderDrawCallDirect(t,i.drawCalls[a])},i.prototype._renderDrawCallDirect=function(t,e){for(var i=e.texArray,r=e.type,n=e.size,o=e.start,s=i.count,a=0;a<s;a++)t.texture.bind(i.elements[a],a);t.geometry.draw(r,n,o)},i.prototype._resolveDirectShader=function(t){var e=this.shader,i=this.pluginName;if(!e){if(!Bo[i]){for(var r=t.plugins.batch.MAX_TEXTURES,n=new Int32Array(r),o=0;o<r;o++)n[o]=o;var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ae,default:Ji.from({uSamplers:n},!0)},a=t.plugins[i]._shader.program;Bo[i]=new Pr(a,s)}e=Bo[i]}return e},i.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var e=t.bounds,i=e.minX,r=e.minY,n=e.maxX,o=e.maxY;this._bounds.addFrame(this.transform,i,r,n,o)}},i.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,i._TEMP_POINT),this._geometry.containsPoint(i._TEMP_POINT)},i.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=Vt(this.tint,Po),e=0;e<this.batches.length;e++){var i=this.batches[e],r=i._batchRGB,n=(t[0]*r[0]*255<<16)+(t[1]*r[1]*255<<8)+(0|t[2]*r[2]*255);i._tintRGB=(n>>16)+(65280&n)+((255&n)<<16)}}},i.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var e=this.transform.worldTransform,i=e.a,r=e.b,n=e.c,o=e.d,s=e.tx,a=e.ty,l=this._geometry.points,h=this.vertexData,c=0,u=0;u<l.length;u+=2){var p=l[u],d=l[u+1];h[c++]=i*p+n*d+s,h[c++]=o*d+r*p+a}}},i.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},i.prototype.setMatrix=function(t){return this._matrix=t,this},i.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},i.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},i.prototype.destroy=function(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,e.prototype.destroy.call(this,t)},i._TEMP_POINT=new De,i}(ze),Oo=function(t,e){return Oo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Oo(t,e)};var Ro,Lo=new De,ko=new Uint16Array([0,1,2,0,2,3]),Fo=function(e){function i(i){var r=e.call(this)||this;return r._anchor=new Te(r._onAnchorUpdate,r,i?i.defaultAnchor.x:0,i?i.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=t.BLEND_MODES.NORMAL,r._cachedTint=16777215,r.uvs=null,r.texture=i||Pi.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.indices=ko,r.pluginName="batch",r.isSprite=!0,r._roundPixels=B.ROUND_PIXELS,r}return function(t,e){function i(){this.constructor=t}Oo(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(i,e),i.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=ee(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=ee(this.scale.y)*this._height/this._texture.orig.height)},i.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},i.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,i=e.a,r=e.b,n=e.c,o=e.d,s=e.tx,a=e.ty,l=this.vertexData,h=t.trim,c=t.orig,u=this._anchor,p=0,d=0,m=0,f=0;if(h?(p=(d=h.x-u._x*c.width)+h.width,m=(f=h.y-u._y*c.height)+h.height):(p=(d=-u._x*c.width)+c.width,m=(f=-u._y*c.height)+c.height),l[0]=i*d+n*f+s,l[1]=o*f+r*d+a,l[2]=i*p+n*f+s,l[3]=o*f+r*p+a,l[4]=i*p+n*m+s,l[5]=o*m+r*p+a,l[6]=i*d+n*m+s,l[7]=o*m+r*d+a,this._roundPixels)for(var y=B.RESOLUTION,_=0;_<l.length;++_)l[_]=Math.round((l[_]*y|0)/y)}},i.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,i=t.orig,r=this._anchor,n=this.transform.worldTransform,o=n.a,s=n.b,a=n.c,l=n.d,h=n.tx,c=n.ty,u=-r._x*i.width,p=u+i.width,d=-r._y*i.height,m=d+i.height;e[0]=o*u+a*d+h,e[1]=l*d+s*u+c,e[2]=o*p+a*d+h,e[3]=l*d+s*p+c,e[4]=o*p+a*m+h,e[5]=l*m+s*p+c,e[6]=o*u+a*m+h,e[7]=l*m+s*u+c},i.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},i.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},i.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new ve),t=this._localBoundsRect),this._bounds.getRectangle(t)):e.prototype.getLocalBounds.call(this,t)},i.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Lo);var e=this._texture.orig.width,i=this._texture.orig.height,r=-e*this.anchor.x,n=0;return Lo.x>=r&&Lo.x<r+e&&(n=-i*this.anchor.y,Lo.y>=n&&Lo.y<n+i)},i.prototype.destroy=function(t){if(e.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t&&t.texture){var i="boolean"==typeof t?t:t&&t.baseTexture;this._texture.destroy(!!i)}this._texture=null},i.from=function(t,e){return new i(t instanceof Pi?t:Pi.from(t,e))},Object.defineProperty(i.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=ee(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=ee(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Pi.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),i}(ze),No=function(t,e){return No=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},No(t,e)};(Ro=t.TEXT_GRADIENT||(t.TEXT_GRADIENT={}))[Ro.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",Ro[Ro.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL";var Vo={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:t.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},Go=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Uo=function(){function t(t){this.styleID=0,this.reset(),Xo(this,t,t)}return t.prototype.clone=function(){var e={};return Xo(e,this,Vo),new t(e)},t.prototype.reset=function(){Xo(this,Vo,Vo)},Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=zo(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=zo(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=zo(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var i=e.length-1;i>=0;i--){var r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&Go.indexOf(r)<0&&(r='"'+r+'"'),e[i]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},t}();function jo(t){return"number"==typeof t?Gt(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function zo(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=jo(t[e]);return t}return jo(t)}function Xo(t,e,i){for(var r in i)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}var Ho=function(){function t(t,e,i,r,n,o,s,a,l){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=n,this.lineWidths=o,this.lineHeight=s,this.maxLineWidth=a,this.fontProperties=l}return t.measureText=function(e,i,r,n){void 0===n&&(n=t._canvas),r=null==r?i.wordWrap:r;var o=i.toFontString(),s=t.measureFont(o);0===s.fontSize&&(s.fontSize=i.fontSize,s.ascent=i.fontSize);var a=n.getContext("2d");a.font=o;for(var l=(r?t.wordWrap(e,i,n):e).split(/(?:\r\n|\r|\n)/),h=new Array(l.length),c=0,u=0;u<l.length;u++){var p=a.measureText(l[u]).width+(l[u].length-1)*i.letterSpacing;h[u]=p,c=Math.max(c,p)}var d=c+i.strokeThickness;i.dropShadow&&(d+=i.dropShadowDistance);var m=i.lineHeight||s.fontSize+i.strokeThickness,f=Math.max(m,s.fontSize+i.strokeThickness)+(l.length-1)*(m+i.leading);return i.dropShadow&&(f+=i.dropShadowDistance),new t(e,i,d,f,l,h,m+i.leading,c,s)},t.wordWrap=function(e,i,r){void 0===r&&(r=t._canvas);for(var n=r.getContext("2d"),o=0,s="",a="",l=Object.create(null),h=i.letterSpacing,c=i.whiteSpace,u=t.collapseSpaces(c),p=t.collapseNewlines(c),d=!u,m=i.wordWrapWidth+h,f=t.tokenize(e),y=0;y<f.length;y++){var _=f[y];if(t.isNewline(_)){if(!p){a+=t.addLine(s),d=!u,s="",o=0;continue}_=" "}if(u){var g=t.isBreakingSpace(_),x=t.isBreakingSpace(s[s.length-1]);if(g&&x)continue}var v=t.getFromCache(_,h,l,n);if(v>m)if(""!==s&&(a+=t.addLine(s),s="",o=0),t.canBreakWords(_,i.breakWords))for(var b=t.wordWrapSplit(_),w=0;w<b.length;w++){for(var S=b[w],C=1;b[w+C];){var D=b[w+C],T=S[S.length-1];if(t.canBreakChars(T,D,_,w,i.breakWords))break;S+=D,C++}w+=S.length-1;var A=t.getFromCache(S,h,l,n);A+o>m&&(a+=t.addLine(s),d=!1,s="",o=0),s+=S,o+=A}else{s.length>0&&(a+=t.addLine(s),s="",o=0);var E=y===f.length-1;a+=t.addLine(_,!E),d=!1,s="",o=0}else v+o>m&&(d=!1,a+=t.addLine(s),s="",o=0),(s.length>0||!t.isBreakingSpace(_)||d)&&(s+=_,o+=v)}return a+=t.addLine(s,!1)},t.addLine=function(e,i){return void 0===i&&(i=!0),e=t.trimRight(e),e=i?e+"\n":e},t.getFromCache=function(t,e,i,r){var n=i[t];if("number"!=typeof n){var o=t.length*e;n=r.measureText(t).width+o,i[t]=n}return n},t.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},t.collapseNewlines=function(t){return"normal"===t},t.trimRight=function(e){if("string"!=typeof e)return"";for(var i=e.length-1;i>=0;i--){var r=e[i];if(!t.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return"string"==typeof e&&t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e){return"string"==typeof e&&t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var i=[],r="";if("string"!=typeof e)return i;for(var n=0;n<e.length;n++){var o=e[n];t.isBreakingSpace(o)||t.isNewline(o)?(""!==r&&(i.push(r),r=""),i.push(o)):r+=o}return""!==r&&i.push(r),i},t.canBreakWords=function(t,e){return e},t.canBreakChars=function(t,e,i,r,n){return!0},t.wordWrapSplit=function(t){return t.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var i={ascent:0,descent:0,fontSize:0},r=t._canvas,n=t._context;n.font=e;var o=t.METRICS_STRING+t.BASELINE_SYMBOL,s=Math.ceil(n.measureText(o).width),a=Math.ceil(n.measureText(t.BASELINE_SYMBOL).width),l=2*a;a=a*t.BASELINE_MULTIPLIER|0,r.width=s,r.height=l,n.fillStyle="#f00",n.fillRect(0,0,s,l),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(o,0,a);var h=n.getImageData(0,0,s,l).data,c=h.length,u=4*s,p=0,d=0,m=!1;for(p=0;p<a;++p){for(var f=0;f<u;f+=4)if(255!==h[d+f]){m=!0;break}if(m)break;d+=u}for(i.ascent=a-p,d=c-u,m=!1,p=l;p>a;--p){for(f=0;f<u;f+=4)if(255!==h[d+f]){m=!0;break}if(m)break;d-=u}return i.descent=p-a,i.fontSize=i.ascent+i.descent,t._fonts[e]=i,i},t.clearMetrics=function(e){void 0===e&&(e=""),e?delete t._fonts[e]:t._fonts={}},t}(),Jo=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();Jo.width=Jo.height=10,Ho._canvas=Jo,Ho._context=Jo.getContext("2d"),Ho._fonts={},Ho.METRICS_STRING="|Ãƒâ€°qÃƒâ€¦",Ho.BASELINE_SYMBOL="M",Ho.BASELINE_MULTIPLIER=1.4,Ho._newlines=[10,13],Ho._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Wo={texture:!0,children:!1,baseTexture:!0},$o=function(e){function i(t,i,r){var n=this,o=!1;r||(r=document.createElement("canvas"),o=!0),r.width=3,r.height=3;var s=Pi.from(r);return s.orig=new ve,s.trim=new ve,(n=e.call(this,s)||this)._ownCanvas=o,n.canvas=r,n.context=n.canvas.getContext("2d"),n._resolution=B.RESOLUTION,n._autoResolution=!0,n._text=null,n._style=null,n._styleListener=null,n._font="",n.text=t,n.style=i,n.localStyleID=-1,n}return function(t,e){function i(){this.constructor=t}No(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(i,e),i.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var i,r,n=this.context,o=Ho.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=o.width,a=o.height,l=o.lines,h=o.lineHeight,c=o.lineWidths,u=o.maxLineWidth,p=o.fontProperties;this.canvas.width=Math.ceil((Math.max(1,s)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,a)+2*e.padding)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=e.strokeThickness,n.textBaseline=e.textBaseline,n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit;for(var d=e.dropShadow?2:1,m=0;m<d;++m){var f=e.dropShadow&&0===m,y=f?Math.ceil(Math.max(1,a)+2*e.padding):0,_=y*this._resolution;if(f){n.fillStyle="black",n.strokeStyle="black";var g=e.dropShadowColor,x=Vt("number"==typeof g?g:Ut(g)),v=e.dropShadowBlur*this._resolution,b=e.dropShadowDistance*this._resolution;n.shadowColor="rgba("+255*x[0]+","+255*x[1]+","+255*x[2]+","+e.dropShadowAlpha+")",n.shadowBlur=v,n.shadowOffsetX=Math.cos(e.dropShadowAngle)*b,n.shadowOffsetY=Math.sin(e.dropShadowAngle)*b+_}else n.fillStyle=this._generateFillStyle(e,l,o),n.strokeStyle=e.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;for(var w=0;w<l.length;w++)i=e.strokeThickness/2,r=e.strokeThickness/2+w*h+p.ascent,"right"===e.align?i+=u-c[w]:"center"===e.align&&(i+=(u-c[w])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(l[w],i+e.padding,r+e.padding-y,!0),e.fill&&this.drawLetterSpacing(l[w],i+e.padding,r+e.padding-y)}this.updateTexture()}},i.prototype.drawLetterSpacing=function(t,e,i,r){void 0===r&&(r=!1);var n=this._style.letterSpacing;if(0!==n)for(var o=e,s=Array.from?Array.from(t):t.split(""),a=this.context.measureText(t).width,l=0,h=0;h<s.length;++h){var c=s[h];r?this.context.strokeText(c,o,i):this.context.fillText(c,o,i),o+=a-(l=this.context.measureText(t.substring(h+1)).width)+n,a=l}else r?this.context.strokeText(t,e,i):this.context.fillText(t,e,i)},i.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=ce(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var i=this._texture,r=this._style,n=r.trim?0:r.padding,o=i.baseTexture;i.trim.width=i._frame.width=Math.ceil(t.width/this._resolution),i.trim.height=i._frame.height=Math.ceil(t.height/this._resolution),i.trim.x=-n,i.trim.y=-n,i.orig.width=i._frame.width-2*n,i.orig.height=i._frame.height-2*n,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),this._recursivePostUpdateTransform(),this.dirty=!1},i.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),e.prototype._render.call(this,t)},i.prototype.getLocalBounds=function(t){return this.updateText(!0),e.prototype.getLocalBounds.call(this,t)},i.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},i.prototype._generateFillStyle=function(e,i,r){var n,o=e.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];var s=e.dropShadow?e.dropShadowDistance:0,a=e.padding||0,l=Math.ceil(this.canvas.width/this._resolution)-s-2*a,h=Math.ceil(this.canvas.height/this._resolution)-s-2*a,c=o.slice(),u=e.fillGradientStops.slice();if(!u.length)for(var p=c.length+1,d=1;d<p;++d)u.push(d/p);if(c.unshift(o[0]),u.unshift(0),c.push(o[o.length-1]),u.push(1),e.fillGradientType===t.TEXT_GRADIENT.LINEAR_VERTICAL){n=this.context.createLinearGradient(l/2,a,l/2,h+a);var m=0,f=(r.fontProperties.fontSize+e.strokeThickness)/h;for(d=0;d<i.length;d++)for(var y=r.lineHeight*d,_=0;_<c.length;_++){var g=y/h+("number"==typeof u[_]?u[_]:_/c.length)*f,x=Math.max(m,g);x=Math.min(x,1),n.addColorStop(x,c[_]),m=x}}else{n=this.context.createLinearGradient(a,h/2,l+a,h/2);var v=c.length+1,b=1;for(d=0;d<c.length;d++){var w=void 0;w="number"==typeof u[d]?u[d]:b/v,n.addColorStop(w,c[d]),b++}}return n},i.prototype.destroy=function(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Wo,t),e.prototype.destroy.call(this,t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(i.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=ee(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=ee(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},this._style=t instanceof Uo?t:new Uo(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),i}(Fo);B.UPLOADS_PER_FRAME=4;var Yo=function(t,e){return Yo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Yo(t,e)};var qo=function(){function t(t){this.maxItemsPerFrame=t,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();function Ko(t,e){var i=!1;if(t&&t._textures&&t._textures.length)for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof Pi){var n=t._textures[r].baseTexture;-1===e.indexOf(n)&&(e.push(n),i=!0)}return i}function Zo(t,e){if(t.baseTexture instanceof di){var i=t.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function Qo(t,e){if(t._texture&&t._texture instanceof Pi){var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function ts(t,e){return e instanceof $o&&(e.updateText(!0),!0)}function es(t,e){if(e instanceof Uo){var i=e.toFontString();return Ho.measureFont(i),!0}return!1}function is(t,e){if(t instanceof $o){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function rs(t,e){return t instanceof Uo&&(-1===e.indexOf(t)&&e.push(t),!0)}var ns=function(){function e(t){var e=this;this.limiter=new qo(B.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(is),this.registerFindHook(rs),this.registerFindHook(Ko),this.registerFindHook(Zo),this.registerFindHook(Qo),this.registerUploadHook(ts),this.registerUploadHook(es)}return e.prototype.upload=function(e,i){"function"==typeof e&&(i=e,e=null),e&&this.add(e),this.queue.length?(i&&this.completes.push(i),this.ticking||(this.ticking=!0,Ye.system.addOnce(this.tick,this,t.UPDATE_PRIORITY.UTILITY))):i&&i()},e.prototype.tick=function(){setTimeout(this.delayedTick,0)},e.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],i=!1;if(e&&!e._destroyed)for(var r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),i=!0;break}i||this.queue.shift()}if(this.queue.length)Ye.system.addOnce(this.tick,this,t.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var o=this.completes.slice(0);this.completes.length=0;for(r=0,n=o.length;r<n;r++)o[r]()}},e.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},e.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},e.prototype.add=function(t){for(var e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ze)for(e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this},e.prototype.destroy=function(){this.ticking&&Ye.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},e}();function os(t,e){return e instanceof di&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function ss(t,e){if(!(e instanceof Mo))return!1;var i=e.geometry;e.finishPoly(),i.updateBatches();for(var r=i.batches,n=0;n<r.length;n++){var o=r[n].style.texture;o&&os(t,o.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function as(t,e){return t instanceof Mo&&(e.push(t),!0)}var ls=function(t){function e(e){var i=t.call(this,e)||this;return i.uploadHookHelper=i.renderer,i.registerFindHook(as),i.registerUploadHook(os),i.registerUploadHook(ss),i}return function(t,e){function i(){this.constructor=t}Yo(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e}(ns),hs=function(){function t(t){this.maxMilliseconds=t,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}(),cs=function(){function t(t,e,i){void 0===i&&(i=null),this._texture=t instanceof Pi?t:null,this.baseTexture=t instanceof di?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var r=this.baseTexture.resource;this.resolution=this._updateResolution(i||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(t){void 0===t&&(t=null);var e=this.data.meta.scale,i=me(t,null);return null===i&&(i=void 0!==e?parseFloat(e):1),1!==i&&this.baseTexture.setResolution(i),i},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var i=e,r=t.BATCH_SIZE;i-e<r&&i<this._frameKeys.length;){var n=this._frameKeys[i],o=this._frames[n],s=o.frame;if(s){var a=null,l=null,h=!1!==o.trimmed&&o.sourceSize?o.sourceSize:o.frame,c=new ve(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);a=o.rotated?new ve(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):new ve(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),!1!==o.trimmed&&o.spriteSourceSize&&(l=new ve(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[n]=new Pi(this.baseTexture,a,c,l,o.rotated?2:0,o.anchor),Pi.addToCache(this.textures[n],n)}i++}},t.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var i=0;i<t[e].length;i++){var r=t[e][i];this.animations[e].push(this.textures[r])}}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())}),0)},t.prototype.destroy=function(t){var e;for(var i in void 0===t&&(t=!1),this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null===(e=this._texture)||void 0===e||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},t.BATCH_SIZE=1e3,t}(),us=function(){function t(){}return t.use=function(e,i){var r=this,n=e.name+"_image";if(e.data&&e.type===zn.TYPE.JSON&&e.data.frames&&!r.resources[n]){var o={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},s=t.getResourcePath(e,r.baseUrl);r.add(n,s,o,(function(t){if(t.error)i(t.error);else{var r=new cs(t.texture,e.data,e.url);r.parse((function(){e.spritesheet=r,e.textures=r.textures,i()}))}}))}else i()},t.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:Ot.resolve(t.url.replace(e,""),t.data.meta.image)},t}(),ps=function(t,e){return ps=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},ps(t,e)};function ds(t,e){function i(){this.constructor=t}ps(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var ms=new De,fs=function(t){function e(e,i,r){void 0===i&&(i=100),void 0===r&&(r=100);var n=t.call(this,e)||this;return n.tileTransform=new ke,n._width=i,n._height=r,n.uvMatrix=n.texture.uvMatrix||new Rr(e),n.pluginName="tilingSprite",n.uvRespectAnchor=!1,n}return ds(e,t),Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,i,r)},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new ve),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,ms);var e=this._width,i=this._height,r=-e*this.anchor._x;if(ms.x>=r&&ms.x<r+e){var n=-i*this.anchor._y;if(ms.y>=n&&ms.y<n+i)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,i){return"number"==typeof i&&(oe("5.3.0","TilingSprite.from use options instead of width and height args"),i={width:i,height:arguments[2]}),new e(Pi.from(t,i),i.width,i.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e}(Fo),ys="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",_s=new Ae,gs=function(e){function i(t){var i=e.call(this,t)||this,r={globals:i.renderer.globalUniforms};return i.shader=Pr.from(ys,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",r),i.simpleShader=Pr.from(ys,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",r),i.quad=new Xi,i.state=Br.for2d(),i}return ds(i,e),i.prototype.render=function(e){var i=this.renderer,r=this.quad,n=r.vertices;n[0]=n[6]=e._width*-e.anchor.x,n[1]=n[3]=e._height*-e.anchor.y,n[2]=n[4]=e._width*(1-e.anchor.x),n[5]=n[7]=e._height*(1-e.anchor.y),e.uvRespectAnchor&&((n=r.uvs)[0]=n[6]=-e.anchor.x,n[1]=n[3]=-e.anchor.y,n[2]=n[4]=1-e.anchor.x,n[5]=n[7]=1-e.anchor.y),r.invalidate();var o=e._texture,s=o.baseTexture,a=e.tileTransform.localTransform,l=e.uvMatrix,h=s.isPowerOfTwo&&o.frame.width===s.width&&o.frame.height===s.height;h&&(s._glTextures[i.CONTEXT_UID]?h=s.wrapMode!==t.WRAP_MODES.CLAMP:s.wrapMode===t.WRAP_MODES.CLAMP&&(s.wrapMode=t.WRAP_MODES.REPEAT));var c=h?this.simpleShader:this.shader,u=o.width,p=o.height,d=e._width,m=e._height;_s.set(a.a*u/d,a.b*u/m,a.c*p/d,a.d*p/m,a.tx/d,a.ty/m),_s.invert(),h?_s.prepend(l.mapCoord):(c.uniforms.uMapCoord=l.mapCoord.toArray(!0),c.uniforms.uClampFrame=l.uClampFrame,c.uniforms.uClampOffset=l.uClampOffset),c.uniforms.uTransform=_s.toArray(!0),c.uniforms.uColor=Wt(e.tint,e.worldAlpha,c.uniforms.uColor,s.alphaMode),c.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),c.uniforms.uSampler=o,i.shader.bind(c),i.geometry.bind(r),this.state.blendMode=Xt(e.blendMode,s.alphaMode),i.state.set(this.state),i.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},i}(Yi),xs=function(t,e){return xs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},xs(t,e)};function vs(t,e){function i(){this.constructor=t}xs(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var bs=function(){function t(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},t}(),ws=new De,Ss=new Se,Cs=function(e){function i(i,r,n,o){void 0===o&&(o=t.DRAW_MODES.TRIANGLES);var s=e.call(this)||this;return s.geometry=i,i.refCount++,s.shader=r,s.state=n||Br.for2d(),s.drawMode=o,s.start=0,s.size=0,s.uvs=null,s.indices=null,s.vertexData=new Float32Array(1),s.vertexDirty=0,s._transformID=-1,s._roundPixels=B.ROUND_PIXELS,s.batchUvs=null,s}return vs(i,e),Object.defineProperty(i.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tint",{get:function(){return this.shader.tint},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),i.prototype._render=function(e){var r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===t.DRAW_MODES.TRIANGLES&&r.length<2*i.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)},i.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},i.prototype._renderToBatch=function(t){var e=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var i=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[i]),t.plugins[i].render(this)},i.prototype.calculateVertices=function(){var t=this.geometry,e=t.buffers[0].data;if(t.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var i=this.transform.worldTransform,r=i.a,n=i.b,o=i.c,s=i.d,a=i.tx,l=i.ty,h=this.vertexData,c=0;c<h.length/2;c++){var u=e[2*c],p=e[2*c+1];h[2*c]=r*u+o*p+a,h[2*c+1]=n*u+s*p+l}if(this._roundPixels){var d=B.RESOLUTION;for(c=0;c<h.length;++c)h[c]=Math.round((h[c]*d|0)/d)}this.vertexDirty=t.vertexDirtyId}},i.prototype.calculateUvs=function(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new bs(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},i.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},i.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,ws);for(var e=this.geometry.getBuffer("aVertexPosition").data,i=Ss.points,r=this.geometry.getIndex().data,n=r.length,o=4===this.drawMode?3:1,s=0;s+2<n;s+=o){var a=2*r[s],l=2*r[s+1],h=2*r[s+2];if(i[0]=e[a],i[1]=e[a+1],i[2]=e[l],i[3]=e[l+1],i[4]=e[h],i[5]=e[h+1],Ss.contains(ws.x,ws.y))return!0}return!1},i.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},i.BATCHABLE_SIZE=100,i}(ze),Ds=function(t){function e(e,i){var r=this,n={uSampler:e,alpha:1,uTextureMatrix:Ae.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(i=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},i)).uniforms&&Object.assign(n,i.uniforms),(r=t.call(this,i.program||Ir.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),n)||this)._colorDirty=!1,r.uvMatrix=new Rr(e),r.batchable=void 0===i.program,r.pluginName=i.pluginName,r.tint=i.tint,r.alpha=i.alpha,r}return vs(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;Wt(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(Pr),Ts=function(e){function i(i,r,n){var o=e.call(this)||this,s=new ki(i),a=new ki(r,!0),l=new ki(n,!0,!0);return o.addAttribute("aVertexPosition",s,2,!1,t.TYPES.FLOAT).addAttribute("aTextureCoord",a,2,!1,t.TYPES.FLOAT).addIndex(l),o._updateId=-1,o}return vs(i,e),Object.defineProperty(i.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),i}(ji),As=function(t,e){return As=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},As(t,e)};var Es=function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]},Is=function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var r in e){var n=e[r].match(/^[a-z]+/gm)[0],o=e[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(var a in o){var l=o[a].split("="),h=l[0],c=l[1].replace(/"/gm,""),u=parseFloat(c),p=isNaN(u)?c:u;s[h]=p}i[n].push(s)}var d=new Es;return i.info.forEach((function(t){return d.info.push({face:t.face,size:parseInt(t.size,10)})})),i.common.forEach((function(t){return d.common.push({lineHeight:parseInt(t.lineHeight,10)})})),i.page.forEach((function(t){return d.page.push({id:parseInt(t.id,10),file:t.file})})),i.char.forEach((function(t){return d.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})})),i.kerning.forEach((function(t){return d.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})})),d},t}(),Ps=function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new Es,i=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),s=t.getElementsByTagName("kerning"),a=0;a<i.length;a++)e.info.push({face:i[a].getAttribute("face"),size:parseInt(i[a].getAttribute("size"),10)});for(a=0;a<r.length;a++)e.common.push({lineHeight:parseInt(r[a].getAttribute("lineHeight"),10)});for(a=0;a<n.length;a++)e.page.push({id:parseInt(n[a].getAttribute("id"),10)||0,file:n[a].getAttribute("file")});for(a=0;a<o.length;a++){var l=o[a];e.char.push({id:parseInt(l.getAttribute("id"),10),page:parseInt(l.getAttribute("page"),10)||0,x:parseInt(l.getAttribute("x"),10),y:parseInt(l.getAttribute("y"),10),width:parseInt(l.getAttribute("width"),10),height:parseInt(l.getAttribute("height"),10),xoffset:parseInt(l.getAttribute("xoffset"),10),yoffset:parseInt(l.getAttribute("yoffset"),10),xadvance:parseInt(l.getAttribute("xadvance"),10)})}for(a=0;a<s.length;a++)e.kerning.push({first:parseInt(s[a].getAttribute("first"),10),second:parseInt(s[a].getAttribute("second"),10),amount:parseInt(s[a].getAttribute("amount"),10)});return e},t}(),Bs=function(){function t(){}return t.test=function(t){if("string"==typeof t&&t.indexOf("<font>")>-1){var e=(new self.DOMParser).parseFromString(t,"text/xml");return Ps.test(e)}return!1},t.parse=function(t){var e=(new window.DOMParser).parseFromString(t,"text/xml");return Ps.parse(e)},t}(),Ms=[Is,Ps,Bs];function Os(t){for(var e=0;e<Ms.length;e++)if(Ms[e].test(t))return Ms[e];return null}function Rs(e,i,r,n,o,s,a){var l=r.text,h=r.fontProperties;i.translate(n,o),i.scale(s,s);var c=a.strokeThickness/2,u=-a.strokeThickness/2;if(i.font=a.toFontString(),i.lineWidth=a.strokeThickness,i.textBaseline=a.textBaseline,i.lineJoin=a.lineJoin,i.miterLimit=a.miterLimit,i.fillStyle=function(e,i,r,n,o,s){var a,l=r.fill;if(!Array.isArray(l))return l;if(1===l.length)return l[0];var h=r.dropShadow?r.dropShadowDistance:0,c=r.padding||0,u=Math.ceil(e.width/n)-h-2*c,p=Math.ceil(e.height/n)-h-2*c,d=l.slice(),m=r.fillGradientStops.slice();if(!m.length)for(var f=d.length+1,y=1;y<f;++y)m.push(y/f);if(d.unshift(l[0]),m.unshift(0),d.push(l[l.length-1]),m.push(1),r.fillGradientType===t.TEXT_GRADIENT.LINEAR_VERTICAL){a=i.createLinearGradient(u/2,c,u/2,p+c);var _=0,g=(s.fontProperties.fontSize+r.strokeThickness)/p;for(y=0;y<o.length;y++)for(var x=s.lineHeight*y,v=0;v<d.length;v++){var b=x/p+("number"==typeof m[v]?m[v]:v/d.length)*g,w=Math.max(_,b);w=Math.min(w,1),a.addColorStop(w,d[v]),_=w}}else{a=i.createLinearGradient(c,p/2,u+c,p/2);var S=d.length+1,C=1;for(y=0;y<d.length;y++){var D=void 0;D="number"==typeof m[y]?m[y]:C/S,a.addColorStop(D,d[y]),C++}}return a}(e,i,a,s,[l],r),i.strokeStyle=a.stroke,a.dropShadow){var p=a.dropShadowColor,d=Vt("number"==typeof p?p:Ut(p)),m=a.dropShadowBlur*s,f=a.dropShadowDistance*s;i.shadowColor="rgba("+255*d[0]+","+255*d[1]+","+255*d[2]+","+a.dropShadowAlpha+")",i.shadowBlur=m,i.shadowOffsetX=Math.cos(a.dropShadowAngle)*f,i.shadowOffsetY=Math.sin(a.dropShadowAngle)*f}else i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;a.stroke&&a.strokeThickness&&i.strokeText(l,c,u+r.lineHeight-h.descent),a.fill&&i.fillText(l,c,u+r.lineHeight-h.descent),i.setTransform(1,0,0,1,0,0),i.fillStyle="rgba(0, 0, 0, 0)"}var Ls=function(){function t(t,e,i){var r=t.info[0],n=t.common[0],o=me(t.page[0].file),s={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=n.lineHeight/o,this.chars={},this.pageTextures=s;for(var a=0;a<t.page.length;a++){var l=t.page[a],h=l.id,c=l.file;s[h]=e instanceof Array?e[a]:e[c]}for(a=0;a<t.char.length;a++){var u=t.char[a],p=(h=u.id,u.page),d=t.char[a],m=d.x,f=d.y,y=d.width,_=d.height,g=d.xoffset,x=d.yoffset,v=d.xadvance;f/=o,y/=o,_/=o,g/=o,x/=o,v/=o;var b=new ve((m/=o)+s[p].frame.x/o,f+s[p].frame.y/o,y,_);this.chars[h]={xOffset:g,yOffset:x,xAdvance:v,kerning:{},texture:new Pi(s[p].baseTexture,b),page:p}}for(a=0;a<t.kerning.length;a++){var w=t.kerning[a],S=w.first,C=w.second,D=w.amount;S/=o,C/=o,D/=o,this.chars[C]&&(this.chars[C].kerning[S]=D)}}return t.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},t.install=function(e,i,r){var n;if(e instanceof Es)n=e;else{var o=Os(e);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(e)}i instanceof Pi&&(i=[i]);var s=new t(n,i,r);return t.available[s.font]=s,s},t.uninstall=function(e){var i=t.available[e];if(!i)throw new Error("No font found named '"+e+"'");i.destroy(),delete t.available[e]},t.from=function(e,i,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},t.defaultOptions,r),o=n.chars,s=n.padding,a=n.resolution,l=n.textureWidth,h=n.textureHeight,c=function(t){"string"==typeof t&&(t=[t]);for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i];if(Array.isArray(n)){if(2!==n.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var o=n[0].charCodeAt(0),s=n[1].charCodeAt(0);if(s<o)throw new Error("[BitmapFont]: Invalid character range.");for(var a=o,l=s;a<=l;a++)e.push(String.fromCharCode(a))}else e.push.apply(e,n.split(""))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(o),u=i instanceof Uo?i:new Uo(i),p=l,d=new Es;d.info[0]={face:u.fontFamily,size:u.fontSize},d.common[0]={lineHeight:u.fontSize};for(var m,f,y,_=0,g=0,x=0,v=[],b=0;b<c.length;b++){m||((m=document.createElement("canvas")).width=l,m.height=h,f=m.getContext("2d"),y=new di(m,{resolution:a}),v.push(new Pi(y)),d.page.push({id:v.length-1,file:""}));var w=Ho.measureText(c[b],u,!1,m),S=w.width,C=Math.ceil(w.height),D=Math.ceil(("italic"===u.fontStyle?2:1)*S);if(g>=h-C*a){if(0===g)throw new Error("[BitmapFont] textureHeight "+h+"px is too small for "+u.fontSize+"px fonts");--b,m=null,f=null,y=null,g=0,_=0,x=0}else if(x=Math.max(C+w.fontProperties.descent,x),D*a+_>=p)--b,g+=x*a,g=Math.ceil(g),_=0,x=0;else{Rs(m,f,w,_,g,a,u);var T=w.text.charCodeAt(0);d.char.push({id:T,page:v.length-1,x:_/a,y:g/a,width:D,height:C,xoffset:0,yoffset:0,xadvance:Math.ceil(S-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0))}),_+=(D+2*s)*a,_=Math.ceil(_)}}var A=new t(d,v,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=A,A},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),ks=[],Fs=[],Ns=function(t){function e(i,r){void 0===r&&(r={});var n=t.call(this)||this;n._tint=16777215,r.font&&(oe("5.3.0","PIXI.BitmapText constructor style.font property is deprecated."),n._upgradeStyle(r));var o=Object.assign({},e.styleDefaults,r),s=o.align,a=o.tint,l=o.maxWidth,h=o.letterSpacing,c=o.fontName,u=o.fontSize;if(!Ls.available[c])throw new Error('Missing BitmapFont "'+c+'"');return n._activePagesMeshData=[],n._textWidth=0,n._textHeight=0,n._align=s,n._tint=a,n._fontName=c,n._fontSize=u||Ls.available[c].size,n._text=i,n._maxWidth=l,n._maxLineHeight=0,n._letterSpacing=h,n._anchor=new Te((function(){n.dirty=!0}),n,0,0),n._roundPixels=B.ROUND_PIXELS,n.dirty=!0,n._textureCache={},n}return function(t,e){function i(){this.constructor=t}As(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.updateText=function(){for(var t,e=Ls.available[this._fontName],i=this._fontSize/e.size,r=new De,n=[],o=[],s=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",a=s.length,l=this._maxWidth*e.size/this._fontSize,h=null,c=0,u=0,p=0,d=-1,m=0,f=0,y=0,_=0;_<a;_++){var g=s.charCodeAt(_),x=s.charAt(_);if(/(?:\s)/.test(x)&&(d=_,m=c),"\r"!==x&&"\n"!==x){var v=e.chars[g];if(v){h&&v.kerning[h]&&(r.x+=v.kerning[h]);var b=Fs.pop()||{texture:Pi.EMPTY,line:0,charCode:0,position:new De};b.texture=v.texture,b.line=p,b.charCode=g,b.position.x=r.x+v.xOffset+this._letterSpacing/2,b.position.y=r.y+v.yOffset,n.push(b),r.x+=v.xAdvance+this._letterSpacing,c=r.x,y=Math.max(y,v.yOffset+v.texture.height),h=g,-1!==d&&l>0&&r.x>l&&(te(n,1+d-++f,1+_-d),_=d,d=-1,o.push(m),u=Math.max(u,m),p++,r.x=0,r.y+=e.lineHeight,h=null)}}else o.push(c),u=Math.max(u,c),++p,++f,r.x=0,r.y+=e.lineHeight,h=null}var w=s.charAt(s.length-1);"\r"!==w&&"\n"!==w&&(/(?:\s)/.test(w)&&(c=m),o.push(c),u=Math.max(u,c));var S=[];for(_=0;_<=p;_++){var C=0;"right"===this._align?C=u-o[_]:"center"===this._align&&(C=(u-o[_])/2),S.push(C)}var D=n.length,T={},A=[],E=this._activePagesMeshData;for(_=0;_<E.length;_++)ks.push(E[_]);for(_=0;_<D;_++){var I=(N=n[_].texture).baseTexture.uid;if(!T[I]){if(!(H=ks.pop())){var P=new Ts,B=new Ds(Pi.EMPTY);H={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new Cs(P,B),vertices:null,uvs:null,indices:null}}H.index=0,H.indexCount=0,H.vertexCount=0,H.uvsCount=0,H.total=0;var M=this._textureCache;M[I]=M[I]||new Pi(N.baseTexture),H.mesh.texture=M[I],H.mesh.tint=this._tint,A.push(H),T[I]=H}T[I].total++}for(_=0;_<E.length;_++)-1===A.indexOf(E[_])&&this.removeChild(E[_].mesh);for(_=0;_<A.length;_++)A[_].mesh.parent!==this&&this.addChild(A[_].mesh);for(var _ in this._activePagesMeshData=A,T){var O=(H=T[_]).total;if(!((null===(t=H.indices)||void 0===t?void 0:t.length)>6*O)||H.vertices.length<2*Cs.BATCHABLE_SIZE)H.vertices=new Float32Array(8*O),H.uvs=new Float32Array(8*O),H.indices=new Uint16Array(6*O);else for(var R=H.total,L=H.vertices,k=4*R*2;k<L.length;k++)L[k]=0;H.mesh.size=6*O}for(_=0;_<D;_++){var F=(x=n[_]).position.x+S[x.line];this._roundPixels&&(F=Math.round(F));var N,V=F*i,G=x.position.y*i,U=T[(N=x.texture).baseTexture.uid],j=N.frame,z=N._uvs,X=U.index++;U.indices[6*X+0]=0+4*X,U.indices[6*X+1]=1+4*X,U.indices[6*X+2]=2+4*X,U.indices[6*X+3]=0+4*X,U.indices[6*X+4]=2+4*X,U.indices[6*X+5]=3+4*X,U.vertices[8*X+0]=V,U.vertices[8*X+1]=G,U.vertices[8*X+2]=V+j.width*i,U.vertices[8*X+3]=G,U.vertices[8*X+4]=V+j.width*i,U.vertices[8*X+5]=G+j.height*i,U.vertices[8*X+6]=V,U.vertices[8*X+7]=G+j.height*i,U.uvs[8*X+0]=z.x0,U.uvs[8*X+1]=z.y0,U.uvs[8*X+2]=z.x1,U.uvs[8*X+3]=z.y1,U.uvs[8*X+4]=z.x2,U.uvs[8*X+5]=z.y2,U.uvs[8*X+6]=z.x3,U.uvs[8*X+7]=z.y3}for(var _ in this._textWidth=u*i,this._textHeight=(r.y+e.lineHeight)*i,T){var H=T[_];if(0!==this.anchor.x||0!==this.anchor.y)for(var J=0,W=this._textWidth*this.anchor.x,$=this._textHeight*this.anchor.y,Y=0;Y<H.total;Y++)H.vertices[J++]-=W,H.vertices[J++]-=$,H.vertices[J++]-=W,H.vertices[J++]-=$,H.vertices[J++]-=W,H.vertices[J++]-=$,H.vertices[J++]-=W,H.vertices[J++]-=$;this._maxLineHeight=y*i;var q=H.mesh.geometry.getBuffer("aVertexPosition"),K=H.mesh.geometry.getBuffer("aTextureCoord"),Z=H.mesh.geometry.getIndex();q.data=H.vertices,K.data=H.uvs,Z.data=H.indices,q.update(),K.update(),Z.update()}for(_=0;_<n.length;_++)Fs.push(n[_])},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!Ls.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),e.prototype._upgradeStyle=function(t){if("string"==typeof t.font){var e=t.font.split(" ");t.fontName=1===e.length?e[0]:e.slice(1).join(" "),e.length>=2&&(t.fontSize=parseInt(e[0],10))}else t.fontName=t.font.name,t.fontSize="number"==typeof t.font.size?t.font.size:parseInt(t.font.size,10)},e.prototype.destroy=function(e){var i=this._textureCache;for(var r in i){i[r].destroy(),delete i[r]}this._textureCache=null,t.prototype.destroy.call(this,e)},e.registerFont=function(t,e){return oe("5.3.0","PIXI.BitmapText.registerFont is deprecated, use PIXI.BitmapFont.install"),Ls.install(t,e)},Object.defineProperty(e,"fonts",{get:function(){return oe("5.3.0","PIXI.BitmapText.fonts is deprecated, use PIXI.BitmapFont.available"),Ls.available},enumerable:!1,configurable:!0}),e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e}(ze),Vs=function(){function t(){}return t.add=function(){zn.setExtensionXhrType("fnt",zn.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,i){var r=Os(e.data);if(r)for(var n=t.getBaseUrl(this,e),o=r.parse(e.data),s={},a=function(t){s[t.metadata.pageFile]=t.texture,Object.keys(s).length===o.page.length&&(e.bitmapFont=Ls.install(o,s,!0),i())},l=0;l<o.page.length;++l){var h=o.page[l].file,c=n+h,u=!1;for(var p in this.resources){var d=this.resources[p];if(d.url===c){d.metadata.pageFile=h,d.texture?a(d):d.onAfterMiddleware.add(a),u=!0;break}}if(!u){var m={crossOrigin:e.crossOrigin,loadType:zn.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:h},e.metadata.imageMetadata),parentResource:e};this.add(c,m,a)}}else i()},t.getBaseUrl=function(e,i){var r=i.isDataUrl?"":t.dirname(i.url);return i.isDataUrl&&("."===r&&(r=""),e.baseUrl&&r&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(r+="/")),(r=r.replace(e.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/"),r},t.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},t}(),Gs=function(t,e){return Gs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Gs(t,e)};var Us=function(t){function e(e){void 0===e&&(e=1);var i=t.call(this,sn,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1})||this;return i.alpha=e,i}return function(t,e){function i(){this.constructor=t}Gs(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(Mr),js=function(t,e){return js=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},js(t,e)};function zs(t,e){function i(){this.constructor=t}js(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Xs,Hs,Js,Ws,$s,Ys,qs,Ks,Zs,Qs,ta,ea,ia,ra,na,oa,sa,aa={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},la=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(Xs||(Xs={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(Hs||(Hs={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(Js||(Js={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(Ws||(Ws={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}($s||($s={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Ys||(Ys={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(qs||(qs={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Ks||(Ks={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(Zs||(Zs={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Qs||(Qs={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON"}(ta||(ta={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(ea||(ea={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(ia||(ia={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(ra||(ra={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(na||(na={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(oa||(oa={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(sa||(sa={}));var ha=function(t){function e(e,i,r,n,o){void 0===i&&(i=8),void 0===r&&(r=4),void 0===n&&(n=B.FILTER_RESOLUTION),void 0===o&&(o=5);var s=this,a=function(t,e){var i,r=Math.ceil(t/2),n="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",o="";i=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var s=0;s<t;s++){var a=i.replace("%index%",s.toString());o+=a=a.replace("%sampleIndex%",s-(r-1)+".0"),o+="\n"}return(n=n.replace("%blur%",o)).replace("%size%",t.toString())}(o,e),l=function(t){for(var e,i=aa[t],r=i.length,n=la,o="",s=0;s<t;s++){var a="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s.toString());e=s,s>=r&&(e=t-s-1),o+=a=a.replace("%value%",i[e].toString()),o+="\n"}return(n=n.replace("%blur%",o)).replace("%size%",t.toString())}(o);return(s=t.call(this,a,l)||this).horizontal=e,s.resolution=n,s._quality=0,s.quality=r,s.blur=i,s}return zs(e,t),e.prototype.apply=function(t,e,i,r){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,r);else{var n=t.getFilterTexture(),o=t.renderer,s=e,a=n;this.state.blend=!1,t.applyFilter(this,s,a,ia.CLEAR);for(var l=1;l<this.passes-1;l++){t.bindAndClear(s,ia.BLIT),this.uniforms.uSampler=a;var h=a;a=s,s=h,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,i,r),t.returnFilterTexture(n)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+2*Math.abs(t),this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e}(Mr),ca=function(t){function e(e,i,r,n){void 0===e&&(e=8),void 0===i&&(i=4),void 0===r&&(r=B.FILTER_RESOLUTION),void 0===n&&(n=5);var o=t.call(this)||this;return o.blurXFilter=new ha(!0,e,i,r,n),o.blurYFilter=new ha(!1,e,i,r,n),o.resolution=r,o.quality=i,o.blur=e,o.repeatEdgePixels=!1,o}return zs(e,t),e.prototype.apply=function(t,e,i,r){var n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){var s=t.getFilterTexture();this.blurXFilter.apply(t,e,s,ia.CLEAR),this.blurYFilter.apply(t,s,i,r),t.returnFilterTexture(s)}else o?this.blurYFilter.apply(t,e,i,r):this.blurXFilter.apply(t,e,i,r)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),e}(Mr),ua=function(t,e){return ua=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},ua(t,e)};var pa=function(t){function e(){var e=this,i={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(e=t.call(this,an,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",i)||this).alpha=1,e}return function(t,e){function i(){this.constructor=t}ua(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i},e.prototype._multiply=function(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){var i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.greyscale=function(t,e){var i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var i=Math.cos(t),r=Math.sin(t),n=1/3,o=(0,Math.sqrt)(n),s=[i+(1-i)*n,n*(1-i)-o*r,n*(1-i)+o*r,0,0,n*(1-i)+o*r,i+n*(1-i),n*(1-i)-o*r,0,0,n*(1-i)-o*r,n*(1-i)+o*r,i+n*(1-i),0,0,0,0,0,1,0];this._loadMatrix(s,e)},e.prototype.contrast=function(t,e){var i=(t||0)+1,r=-.5*(i-1),n=[i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var i=2*t/3+1,r=-.5*(i-1),n=[i,r,r,0,0,r,i,r,0,0,r,r,i,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,i,r,n){var o=((i=i||16770432)>>16&255)/255,s=(i>>8&255)/255,a=(255&i)/255,l=((r=r||3375104)>>16&255)/255,h=(r>>8&255)/255,c=(255&r)/255,u=[.3,.59,.11,0,0,o,s,a,t=t||.2,0,l,h,c,e=e||.15,0,o-l,s-h,a-c,0,0];this._loadMatrix(u,n)},e.prototype.night=function(t,e){var i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.predator=function(t,e){var i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(Mr);pa.prototype.grayscale=pa.prototype.greyscale;var da=function(t,e){return da=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},da(t,e)};var ma=function(t){function e(e,i){var r=this,n=new Ae;return e.renderable=!1,(r=t.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=e,r.maskMatrix=n,null==i&&(i=20),r.scale=new De(i,i),r}return function(t,e){function i(){this.constructor=t}da(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.apply=function(t,e,i,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),s=Math.sqrt(n.c*n.c+n.d*n.d);0!==o&&0!==s&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/s,this.uniforms.rotation[3]=n.d/s),t.applyFilter(this,e,i,r)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),e}(Mr),fa=function(t,e){return fa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},fa(t,e)};var ya=function(t){function e(){return t.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputPixel;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputPixel;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')||this}return function(t,e){function i(){this.constructor=t}fa(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e}(Mr),_a=function(t,e){return _a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},_a(t,e)};var ga=function(t){function e(e,i){void 0===e&&(e=.5),void 0===i&&(i=Math.random());var r=t.call(this,an,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0})||this;return r.noise=e,r.seed=i,r}return function(t,e){function i(){this.constructor=t}_a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),e}(Mr),xa=new Ae;Ge.prototype._cacheAsBitmap=!1,Ge.prototype._cacheData=null;var va=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null};Object.defineProperties(Ge.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new va),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),Ge.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Ge.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.batch.flush();var i=this.getLocalBounds(null,!0).clone();if(this.filters){var r=this.filters[0].padding;i.pad(r)}i.ceil(B.RESOLUTION);var n=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),s=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,l=Mi.create({width:i.width,height:i.height}),h="cacheAsBitmap_"+re();this._cacheData.textureCacheId=h,di.addToCache(l.baseTexture,h),Pi.addToCache(l,h);var c=this.transform.localTransform.copyTo(xa).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,l,!0,c,!1),t.projection.transform=a,t.renderTexture.bind(n,o,s),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var u=new Fo(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-i.x/i.width,u.anchor.y=-i.y/i.height,u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)}},Ge.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Ge.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;var r=t.context,n=t._projTransform;e.ceil(B.RESOLUTION);var o=Mi.create({width:e.width,height:e.height}),s="cacheAsBitmap_"+re();this._cacheData.textureCacheId=s,di.addToCache(o.baseTexture,s),Pi.addToCache(o,s);var a=xa;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,o,!0,a,!1),t.context=r,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var l=new Fo(o);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-e.x/e.width,l.anchor.y=-e.y/e.height,l.alpha=i,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)}},Ge.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Ge.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Ge.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,di.removeFromCache(this._cacheData.textureCacheId),Pi.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Ge.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Ge.prototype.name=null,ze.prototype.getChildByName=function(t,e){for(var i=0,r=this.children.length;i<r;i++)if(this.children[i].name===t)return this.children[i];if(e)for(i=0,r=this.children.length;i<r;i++){if(this.children[i].getChildByName){var n=this.children[i].getChildByName(t,!0);if(n)return n}}return null},Ge.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new De),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var ba=function(t,e){return ba=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},ba(t,e)};function wa(t,e){function i(){this.constructor=t}ba(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Sa=function(t){function e(e,i,r,n){void 0===e&&(e=100),void 0===i&&(i=100),void 0===r&&(r=10),void 0===n&&(n=10);var o=t.call(this)||this;return o.segWidth=r,o.segHeight=n,o.width=e,o.height=i,o.build(),o}return wa(e,t),e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,e=[],i=[],r=[],n=this.segWidth-1,o=this.segHeight-1,s=this.width/n,a=this.height/o,l=0;l<t;l++){var h=l%this.segWidth,c=l/this.segWidth|0;e.push(h*s,c*a),i.push(h/n,c/o)}var u=n*o;for(l=0;l<u;l++){var p=l%n,d=l/n|0,m=d*this.segWidth+p,f=d*this.segWidth+p+1,y=(d+1)*this.segWidth+p,_=(d+1)*this.segWidth+p+1;r.push(m,f,y,f,_,y)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint16Array(r),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(Ts),Ca=function(t){function e(e,i,r){void 0===e&&(e=200),void 0===r&&(r=0);var n=t.call(this,new Float32Array(4*i.length),new Float32Array(4*i.length),new Uint16Array(6*(i.length-1)))||this;return n.points=i,n._width=e,n.textureScale=r,n.build(),n}return wa(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),r=this.getIndex();if(!(t.length<1)){e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),i.data=new Float32Array(4*t.length),r.data=new Uint16Array(6*(t.length-1)));var n=i.data,o=r.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;for(var s=0,a=t[0],l=this._width*this.textureScale,h=t.length,c=0;c<h;c++){var u=4*c;if(this.textureScale>0){var p=a.x-t[c].x,d=a.y-t[c].y,m=Math.sqrt(p*p+d*d);a=t[c],s+=m/l}else s=c/(h-1);n[u]=s,n[u+1]=0,n[u+2]=s,n[u+3]=1}var f=0;for(c=0;c<h-1;c++){u=2*c;o[f++]=u,o[f++]=u+1,o[f++]=u+2,o[f++]=u+2,o[f++]=u+1,o[f++]=u+3}i.update(),r.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var e,i=t[0],r=0,n=0,o=this.buffers[0].data,s=t.length,a=0;a<s;a++){var l=t[a],h=4*a;n=-((e=a<t.length-1?t[a+1]:l).x-i.x),r=e.y-i.y;var c=Math.sqrt(r*r+n*n),u=this.textureScale>0?this.textureScale*this._width/2:this._width/2;r/=c,n/=c,r*=u,n*=u,o[h]=l.x+r,o[h+1]=l.y+n,o[h+2]=l.x-r,o[h+3]=l.y-n,i=l}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(Ts),Da=function(e){function i(i,r,n){void 0===n&&(n=0);var o=this,s=new Ca(i.height,r,n),a=new Ds(i);return n>0&&(i.baseTexture.wrapMode=t.WRAP_MODES.REPEAT),(o=e.call(this,s,a)||this).autoUpdate=!0,o}return wa(i,e),i.prototype._render=function(t){var i=this.geometry;(this.autoUpdate||i._width!==this.shader.texture.height)&&(i._width=this.shader.texture.height,i.update()),e.prototype._render.call(this,t)},i}(Cs),Ta=function(t){function e(e,i,r){var n=this,o=new Sa(e.width,e.height,i,r),s=new Ds(Pi.WHITE);return(n=t.call(this,o,s)||this).texture=e,n}return wa(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry;t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build()},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,e)},e.prototype.destroy=function(e){this.shader.texture.off("update",this.textureUpdated,this),t.prototype.destroy.call(this,e)},e}(Cs),Aa=function(t){function e(e,i,r,n,o){void 0===e&&(e=Pi.EMPTY);var s=this,a=new Ts(i,r,n);a.getBuffer("aVertexPosition").static=!1;var l=new Ds(e);return(s=t.call(this,a,l,null,o)||this).autoUpdate=!0,s}return wa(e,t),Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,e)},e}(Cs),Ea=function(t){function e(e,i,r,n,o){void 0===i&&(i=10),void 0===r&&(r=10),void 0===n&&(n=10),void 0===o&&(o=10);var s=t.call(this,Pi.WHITE,4,4)||this;return s._origWidth=e.orig.width,s._origHeight=e.orig.height,s._width=s._origWidth,s._height=s._origHeight,s._leftWidth=i,s._rightWidth=n,s._topHeight=r,s._bottomHeight=o,s.texture=e,s}return wa(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,i=this._topHeight+this._bottomHeight,r=this._height>i?1:this._height/i;return Math.min(e,r)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var i=1/this._origWidth,r=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=i*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-i*this._rightWidth,e[9]=e[11]=e[13]=e[15]=r*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-r*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e}(Ta),Ia=function(t,e){return Ia=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Ia(t,e)};var Pa=function(e){function i(t,i){void 0===i&&(i=!0);var r=e.call(this,t[0]instanceof Pi?t[0]:t[0].texture)||this;return r._textures=null,r._durations=null,r._autoUpdate=i,r._isConnectedToTicker=!1,r.animationSpeed=1,r.loop=!0,r.updateAnchor=!1,r.onComplete=null,r.onFrameChange=null,r.onLoop=null,r._currentTime=0,r._playing=!1,r._previousFrame=null,r.textures=t,r}return function(t,e){function i(){this.constructor=t}Ia(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(i,e),i.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ye.shared.remove(this.update,this),this._isConnectedToTicker=!1))},i.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ye.shared.add(this.update,this,t.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},i.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},i.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},i.prototype.update=function(t){if(this._playing){var e=this.animationSpeed*t,i=this.currentFrame;if(null!==this._durations){var r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];var n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}},i.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},i.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},i.fromFrames=function(t){for(var e=[],r=0;r<t.length;++r)e.push(Pi.from(t[r]));return new i(e)},i.fromImages=function(t){for(var e=[],r=0;r<t.length;++r)e.push(Pi.from(t[r]));return new i(e)},Object.defineProperty(i.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof Pi)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Ye.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ye.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),i}(Fo),Ba=function(t,e){return Ba=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Ba(t,e)};function Ma(t,e){function i(){this.constructor=t}Ba(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var Oa="5.0.0";nn.registerPlugin("accessibility",We),nn.registerPlugin("extract",bn),nn.registerPlugin("interaction",ni),nn.registerPlugin("particle",to),nn.registerPlugin("prepare",ls),nn.registerPlugin("batch",_n),nn.registerPlugin("tilingSprite",gs),Jn.registerPlugin(Vs),Jn.registerPlugin(us),gn.registerPlugin(qe),gn.registerPlugin(Wn);var Ra={AlphaFilter:Us,BlurFilter:ca,BlurFilterPass:ha,ColorMatrixFilter:pa,DisplacementFilter:ma,FXAAFilter:ya,NoiseFilter:ga},La=function(t,e){return La=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},La(t,e)};var ka=function(){function e(t){this.renderer=t,this._foundShapes=[]}return e.prototype.pushMask=function(t){var e=this.renderer,i=t.maskObject||t;e.context.save();var r=this._foundShapes;if(this.recursiveFindShapes(i,r),r.length>0){var n=e.context;n.beginPath();for(var o=0;o<r.length;o++){var s=r[o],a=s.transform.worldTransform;this.renderer.setContextTransform(a),this.renderGraphicsShape(s)}r.length=0,n.clip()}},e.prototype.recursiveFindShapes=function(t,e){t.geometry&&t.geometry.graphicsData&&e.push(t);var i=t.children;if(i)for(var r=0;r<i.length;r++)this.recursiveFindShapes(i[r],e)},e.prototype.renderGraphicsShape=function(e){e.finishPoly();var i=this.renderer.context,r=e.geometry.graphicsData,n=r.length;if(0!==n)for(var o=0;o<n;o++){var s=r[o].shape;if(s.type===t.SHAPES.POLY){var a=s.points;i.moveTo(a[0],a[1]);for(var l=1;l<a.length/2;l++)i.lineTo(a[2*l],a[2*l+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&i.closePath()}else if(s.type===t.SHAPES.RECT)i.rect(s.x,s.y,s.width,s.height),i.closePath();else if(s.type===t.SHAPES.CIRC)i.arc(s.x,s.y,s.radius,0,2*Math.PI),i.closePath();else if(s.type===t.SHAPES.ELIP){var h=2*s.width,c=2*s.height,u=s.x-h/2,p=s.y-c/2,d=.5522848,m=h/2*d,f=c/2*d,y=u+h,_=p+c,g=u+h/2,x=p+c/2;i.moveTo(u,x),i.bezierCurveTo(u,x-f,g-m,p,g,p),i.bezierCurveTo(g+m,p,y,x-f,y,x),i.bezierCurveTo(y,x+f,g+m,_,g,_),i.bezierCurveTo(g-m,_,u,x+f,u,x),i.closePath()}else if(s.type===t.SHAPES.RREC){var v=s.x,b=s.y,w=s.width,S=s.height,C=s.radius,D=Math.min(w,S)/2|0;C=C>D?D:C,i.moveTo(v,b+C),i.lineTo(v,b+S-C),i.quadraticCurveTo(v,b+S,v+C,b+S),i.lineTo(v+w-C,b+S),i.quadraticCurveTo(v+w,b+S,v+w,b+S-C),i.lineTo(v+w,b+C),i.quadraticCurveTo(v+w,b,v+w-C,b),i.lineTo(v+C,b),i.quadraticCurveTo(v,b,v,b+C),i.closePath()}}},e.prototype.popMask=function(t){t.context.restore(),t.invalidateBlendMode()},e.prototype.destroy=function(){},e}();function Fa(t){var e=document.createElement("canvas");e.width=6,e.height=1;var i=e.getContext("2d");return i.fillStyle=t,i.fillRect(0,0,6,1),e}function Na(){if("undefined"==typeof document)return!1;var t=Fa("#ff00ff"),e=Fa("#ffff00"),i=document.createElement("canvas");i.width=6,i.height=1;var r=i.getContext("2d");r.globalCompositeOperation="multiply",r.drawImage(t,0,0),r.drawImage(e,2,0);var n=r.getImageData(2,0,1,1);if(!n)return!1;var o=n.data;return 255===o[0]&&0===o[1]&&0===o[2]}var Va=new Ae,Ga=function(e){function i(r){var n,o=e.call(this,t.RENDERER_TYPE.CANVAS,r)||this;if(o.rootContext=o.view.getContext("2d",{alpha:o.transparent}),o.context=o.rootContext,o.refresh=!0,o.maskManager=new ka(o),o.smoothProperty="imageSmoothingEnabled",!o.rootContext.imageSmoothingEnabled){var s=o.rootContext;s.webkitImageSmoothingEnabled?o.smoothProperty="webkitImageSmoothingEnabled":s.mozImageSmoothingEnabled?o.smoothProperty="mozImageSmoothingEnabled":s.oImageSmoothingEnabled?o.smoothProperty="oImageSmoothingEnabled":s.msImageSmoothingEnabled&&(o.smoothProperty="msImageSmoothingEnabled")}return o.initPlugins(i.__plugins),o.blendModes=(void 0===n&&(n=[]),Na()?(n[t.BLEND_MODES.NORMAL]="source-over",n[t.BLEND_MODES.ADD]="lighter",n[t.BLEND_MODES.MULTIPLY]="multiply",n[t.BLEND_MODES.SCREEN]="screen",n[t.BLEND_MODES.OVERLAY]="overlay",n[t.BLEND_MODES.DARKEN]="darken",n[t.BLEND_MODES.LIGHTEN]="lighten",n[t.BLEND_MODES.COLOR_DODGE]="color-dodge",n[t.BLEND_MODES.COLOR_BURN]="color-burn",n[t.BLEND_MODES.HARD_LIGHT]="hard-light",n[t.BLEND_MODES.SOFT_LIGHT]="soft-light",n[t.BLEND_MODES.DIFFERENCE]="difference",n[t.BLEND_MODES.EXCLUSION]="exclusion",n[t.BLEND_MODES.HUE]="hue",n[t.BLEND_MODES.SATURATION]="saturate",n[t.BLEND_MODES.COLOR]="color",n[t.BLEND_MODES.LUMINOSITY]="luminosity"):(n[t.BLEND_MODES.NORMAL]="source-over",n[t.BLEND_MODES.ADD]="lighter",n[t.BLEND_MODES.MULTIPLY]="source-over",n[t.BLEND_MODES.SCREEN]="source-over",n[t.BLEND_MODES.OVERLAY]="source-over",n[t.BLEND_MODES.DARKEN]="source-over",n[t.BLEND_MODES.LIGHTEN]="source-over",n[t.BLEND_MODES.COLOR_DODGE]="source-over",n[t.BLEND_MODES.COLOR_BURN]="source-over",n[t.BLEND_MODES.HARD_LIGHT]="source-over",n[t.BLEND_MODES.SOFT_LIGHT]="source-over",n[t.BLEND_MODES.DIFFERENCE]="source-over",n[t.BLEND_MODES.EXCLUSION]="source-over",n[t.BLEND_MODES.HUE]="source-over",n[t.BLEND_MODES.SATURATION]="source-over",n[t.BLEND_MODES.COLOR]="source-over",n[t.BLEND_MODES.LUMINOSITY]="source-over"),n[t.BLEND_MODES.NORMAL_NPM]=n[t.BLEND_MODES.NORMAL],n[t.BLEND_MODES.ADD_NPM]=n[t.BLEND_MODES.ADD],n[t.BLEND_MODES.SCREEN_NPM]=n[t.BLEND_MODES.SCREEN],n[t.BLEND_MODES.SRC_IN]="source-in",n[t.BLEND_MODES.SRC_OUT]="source-out",n[t.BLEND_MODES.SRC_ATOP]="source-atop",n[t.BLEND_MODES.DST_OVER]="destination-over",n[t.BLEND_MODES.DST_IN]="destination-in",n[t.BLEND_MODES.DST_OUT]="destination-out",n[t.BLEND_MODES.DST_ATOP]="destination-atop",n[t.BLEND_MODES.XOR]="xor",n[t.BLEND_MODES.SUBTRACT]="source-over",n),o._activeBlendMode=null,o._outerBlend=!1,o._projTransform=null,o.renderingToScreen=!1,Ft("Canvas"),o.resize(o.options.width,o.options.height),o}return function(t,e){function i(){this.constructor=t}La(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(i,e),i.prototype.render=function(e,i,r,n,o){if(this.view){this.renderingToScreen=!i,this.emit("prerender");var s=this.resolution;i?((i=i.castToBaseTexture())._canvasRenderTarget||(i._canvasRenderTarget=new he(i.width,i.height,i.resolution),i.resource=new Si.CanvasResource(i._canvasRenderTarget.canvas),i.valid=!0),this.context=i._canvasRenderTarget.context,this.resolution=i._canvasRenderTarget.resolution):this.context=this.rootContext;var a=this.context;if(this._projTransform=n||null,i||(this._lastObjectRendered=e),!o){var l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}if(a.save(),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this._activeBlendMode=t.BLEND_MODES.NORMAL,this._outerBlend=!1,a.globalCompositeOperation=this.blendModes[t.BLEND_MODES.NORMAL],void 0!==r?r:this.clearBeforeRender)if(this.renderingToScreen)this.transparent?a.clearRect(0,0,this.width,this.height):(a.fillStyle=this._backgroundColorString,a.fillRect(0,0,this.width,this.height));else{i._canvasRenderTarget.clear();var h=i.clearColor;h[3]>0&&(a.fillStyle=Gt(jt(h)),a.fillRect(0,0,i.realWidth,i.realHeight))}var c=this.context;this.context=a,e.renderCanvas(this),this.context=c,a.restore(),this.resolution=s,this._projTransform=null,this.emit("postrender")}},i.prototype.setContextTransform=function(t,e,i){var r=t,n=this._projTransform,o=this.resolution;i=i||o,n&&((r=Va).copyFrom(t),r.prepend(n)),e?this.context.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*o|0,r.ty*o|0):this.context.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*o,r.ty*o)},i.prototype.clear=function(t){var e=this.context;t=t||this._backgroundColorString,!this.transparent&&t?(e.fillStyle=t,e.fillRect(0,0,this.width,this.height)):e.clearRect(0,0,this.width,this.height)},i.prototype.setBlendMode=function(e,i){var r=e===t.BLEND_MODES.SRC_IN||e===t.BLEND_MODES.SRC_OUT||e===t.BLEND_MODES.DST_IN||e===t.BLEND_MODES.DST_ATOP;!i&&r&&(e=t.BLEND_MODES.NORMAL),this._activeBlendMode!==e&&(this._activeBlendMode=e,this._outerBlend=r,this.context.globalCompositeOperation=this.blendModes[e])},i.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},i.prototype.resize=function(i,r){e.prototype.resize.call(this,i,r),this.smoothProperty&&(this.rootContext[this.smoothProperty]=B.SCALE_MODE===t.SCALE_MODES.LINEAR)},i.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},i.registerPlugin=function(t,e){i.__plugins=i.__plugins||{},i.__plugins[t]=e},i}(rn),Ua={canvas:null,getTintedCanvas:function(t,e){var i=t.texture,r="#"+("00000"+(0|(e=Ua.roundColor(e))).toString(16)).substr(-6);i.tintCache=i.tintCache||{};var n,o=i.tintCache[r];if(o){if(o.tintId===i._updateID)return i.tintCache[r];n=i.tintCache[r]}else n=document.createElement("canvas");if(Ua.tintMethod(i,e,n),n.tintId=i._updateID,Ua.convertTintToImage){var s=new Image;s.src=n.toDataURL(),i.tintCache[r]=s}else i.tintCache[r]=n;return n},getTintedPattern:function(t,e){var i="#"+("00000"+(0|(e=Ua.roundColor(e))).toString(16)).substr(-6);t.patternCache=t.patternCache||{};var r=t.patternCache[i];return r&&r.tintId===t._updateID||(Ua.canvas||(Ua.canvas=document.createElement("canvas")),Ua.tintMethod(t,e,Ua.canvas),(r=Ua.canvas.getContext("2d").createPattern(Ua.canvas,"repeat")).tintId=t._updateID,t.patternCache[i]=r),r},tintWithMultiply:function(t,e,i){var r=i.getContext("2d"),n=t._frame.clone(),o=t.baseTexture.resolution;n.x*=o,n.y*=o,n.width*=o,n.height*=o,i.width=Math.ceil(n.width),i.height=Math.ceil(n.height),r.save(),r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,n.width,n.height),r.globalCompositeOperation="multiply";var s=t.baseTexture.getDrawableSource();r.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.globalCompositeOperation="destination-atop",r.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.restore()},tintWithOverlay:function(t,e,i){var r=i.getContext("2d"),n=t._frame.clone(),o=t.baseTexture.resolution;n.x*=o,n.y*=o,n.width*=o,n.height*=o,i.width=Math.ceil(n.width),i.height=Math.ceil(n.height),r.save(),r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,n.width,n.height),r.globalCompositeOperation="destination-atop",r.drawImage(t.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.restore()},tintWithPerPixel:function(t,e,i){var r=i.getContext("2d"),n=t._frame.clone(),o=t.baseTexture.resolution;n.x*=o,n.y*=o,n.width*=o,n.height*=o,i.width=Math.ceil(n.width),i.height=Math.ceil(n.height),r.save(),r.globalCompositeOperation="copy",r.drawImage(t.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.restore();for(var s=Vt(e),a=s[0],l=s[1],h=s[2],c=r.getImageData(0,0,n.width,n.height),u=c.data,p=0;p<u.length;p+=4)u[p+0]*=a,u[p+1]*=l,u[p+2]*=h;r.putImageData(c,0,0)},roundColor:function(t){var e=Ua.cacheStepsPerColorChannel,i=Vt(t);return i[0]=Math.min(255,i[0]/e*e),i[1]=Math.min(255,i[1]/e*e),i[2]=Math.min(255,i[2]/e*e),jt(i)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:Na(),tintMethod:null};Ua.tintMethod=Ua.canUseMultiply?Ua.tintWithMultiply:Ua.tintWithPerPixel;var ja=nn.create;nn.create=function(t){if(!(t&&t.forceCanvas))try{return ja(t)}catch(t){}return new Ga(t)},di.prototype.getDrawableSource=function(){var t=this.resource;return t?t.bitmap||t.source:null},Ai.prototype._canvasRenderTarget=null,Pi.prototype.patternCache=null,Pi.prototype.tintCache=null;var za=function(){function e(t){this.renderer=t}return e.prototype.render=function(e){var i=this.renderer,r=e.worldTransform;i.context.globalAlpha=e.worldAlpha,i.setBlendMode(e.blendMode),i.setContextTransform(r,e.roundPixels),e.drawMode!==t.DRAW_MODES.TRIANGLES?this._renderTriangleMesh(e):this._renderTriangles(e)},e.prototype._renderTriangleMesh=function(t){for(var e=t.geometry.buffers[0].data.length,i=0;i<e-2;i++){var r=2*i;this._renderDrawTriangle(t,r,r+2,r+4)}},e.prototype._renderTriangles=function(t){for(var e=t.geometry.getIndex().data,i=e.length,r=0;r<i;r+=3){var n=2*e[r],o=2*e[r+1],s=2*e[r+2];this._renderDrawTriangle(t,n,o,s)}},e.prototype._renderDrawTriangle=function(t,e,i,r){var n=this.renderer.context,o=t.geometry.buffers[0].data,s=t.uvs,a=t.texture;if(a.valid){var l=16777215!==t.tint,h=a.baseTexture,c=h.width,u=h.height;l&&t._cachedTint!==t.tint&&(t._cachedTint=t.tint,t._tintedCanvas=Ua.getTintedCanvas(t,t.tint));var p=l?t._tintedCanvas:h.getDrawableSource(),d=s[e]*h.width,m=s[i]*h.width,f=s[r]*h.width,y=s[e+1]*h.height,_=s[i+1]*h.height,g=s[r+1]*h.height,x=o[e],v=o[i],b=o[r],w=o[e+1],S=o[i+1],C=o[r+1],D=t.canvasPadding/this.renderer.resolution;if(D>0){var T=D/Math.abs(t.worldTransform.a),A=D/Math.abs(t.worldTransform.d),E=(x+v+b)/3,I=(w+S+C)/3,P=x-E,B=w-I,M=Math.sqrt(P*P+B*B);x=E+P/M*(M+T),w=I+B/M*(M+A),B=S-I,v=E+(P=v-E)/(M=Math.sqrt(P*P+B*B))*(M+T),S=I+B/M*(M+A),B=C-I,b=E+(P=b-E)/(M=Math.sqrt(P*P+B*B))*(M+T),C=I+B/M*(M+A)}n.save(),n.beginPath(),n.moveTo(x,w),n.lineTo(v,S),n.lineTo(b,C),n.closePath(),n.clip();var O=d*_+y*f+m*g-_*f-y*m-d*g,R=x*_+y*b+v*g-_*b-y*v-x*g,L=d*v+x*f+m*b-v*f-x*m-d*b,k=d*_*b+y*v*f+x*m*g-x*_*f-y*m*b-d*v*g,F=w*_+y*C+S*g-_*C-y*S-w*g,N=d*S+w*f+m*C-S*f-w*m-d*C,V=d*_*C+y*S*f+w*m*g-w*_*f-y*m*C-d*S*g;n.transform(R/O,F/O,L/O,N/O,k/O,V/O),n.drawImage(p,0,0,c*h.resolution,u*h.resolution,0,0,c,u),n.restore(),this.renderer.invalidateBlendMode()}},e.prototype.renderMeshFlat=function(t){var e=this.renderer.context,i=t.geometry.getBuffer("aVertexPosition").data,r=i.length/2;e.beginPath();for(var n=1;n<r-2;++n){var o=2*n,s=i[o],a=i[o+1],l=i[o+2],h=i[o+3],c=i[o+4],u=i[o+5];e.moveTo(s,a),e.lineTo(l,h),e.lineTo(c,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},e.prototype.destroy=function(){this.renderer=null},e}();B.MESH_CANVAS_PADDING=0,Ds.prototype._renderCanvas=function(t,e){t.plugins.mesh.render(e)},Ea.prototype._cachedTint=16777215,Ea.prototype._tintedCanvas=null,Ea.prototype._canvasUvs=null,Ea.prototype._renderCanvas=function(t){var e=t.context,i=this.worldTransform,r=16777215!==this.tint,n=this.texture;if(n.valid){r&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedCanvas=Ua.getTintedCanvas(this,this.tint));var o=r?this._tintedCanvas:n.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var s=this.vertices,a=this._canvasUvs,l=r?0:n.frame.x,h=r?0:n.frame.y,c=l+n.frame.width,u=h+n.frame.height;a[0]=l,a[1]=l+this._leftWidth,a[2]=c-this._rightWidth,a[3]=c,a[4]=h,a[5]=h+this._topHeight,a[6]=u-this._bottomHeight,a[7]=u;for(var p=0;p<8;p++)a[p]*=n.baseTexture.resolution;e.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode),t.setContextTransform(i,this.roundPixels);for(var d=0;d<3;d++)for(var m=0;m<3;m++){var f=2*m+8*d,y=Math.max(1,a[m+1]-a[m]),_=Math.max(1,a[d+5]-a[d+4]),g=Math.max(1,s[f+10]-s[f]),x=Math.max(1,s[f+11]-s[f+1]);e.drawImage(o,a[m],a[d+4],y,_,s[f],s[f+1],g,x)}}};var Xa=!1;Cs.prototype._cachedTint=16777215,Cs.prototype._tintedCanvas=null,Cs.prototype._renderCanvas=function(t){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(t,this):Xa||(Xa=!0,window.console&&console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))},Cs.prototype._canvasPadding=null,Object.defineProperty(Cs.prototype,"canvasPadding",{get:function(){return null!==this._canvasPadding?this._canvasPadding:B.MESH_CANVAS_PADDING},set:function(t){this._canvasPadding=t}}),Aa.prototype._renderCanvas=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)},Da.prototype._renderCanvas=function(t){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)};var Ha,Ja=function(){function e(t){this.renderer=t,this._svgMatrix=null,this._tempMatrix=new Ae}return e.prototype._calcCanvasStyle=function(t,e){var i;return t.texture&&t.texture.baseTexture!==Pi.WHITE.baseTexture?t.texture.valid?(i=Ua.getTintedPattern(t.texture,e),this.setPatternTransform(i,t.matrix||Ae.IDENTITY)):i="#808080":i="#"+("00000"+(0|e).toString(16)).substr(-6),i},e.prototype.render=function(e){var i=this.renderer,r=i.context,n=e.worldAlpha,o=e.transform.worldTransform;i.setContextTransform(o),i.setBlendMode(e.blendMode);for(var s,a,l=e.geometry.graphicsData,h=(e.tint>>16&255)/255,c=(e.tint>>8&255)/255,u=(255&e.tint)/255,p=0;p<l.length;p++){var d=l[p],m=d.shape,f=d.fillStyle,y=d.lineStyle,_=0|d.fillStyle.color,g=0|d.lineStyle.color;if(d.matrix&&i.setContextTransform(o.copyTo(this._tempMatrix).append(d.matrix)),f.visible){var x=((_>>16&255)/255*h*255<<16)+((_>>8&255)/255*c*255<<8)+(255&_)/255*u*255;s=this._calcCanvasStyle(f,x)}if(y.visible){var v=((g>>16&255)/255*h*255<<16)+((g>>8&255)/255*c*255<<8)+(255&g)/255*u*255;a=this._calcCanvasStyle(y,v)}if(r.lineWidth=y.width,r.lineCap=y.cap,r.lineJoin=y.join,r.miterLimit=y.miterLimit,d.type===t.SHAPES.POLY){r.beginPath();var b=(I=m).points,w=d.holes,S=void 0,C=void 0,D=void 0,T=void 0;r.moveTo(b[0],b[1]);for(var A=2;A<b.length;A+=2)r.lineTo(b[A],b[A+1]);if(I.closeStroke&&r.closePath(),w.length>0){S=0,D=b[0],T=b[1];for(A=2;A+2<b.length;A+=2)S+=(b[A]-D)*(b[A+3]-T)-(b[A+2]-D)*(b[A+1]-T);for(var E=0;E<w.length;E++)if(b=w[E].shape.points){C=0,D=b[0],T=b[1];for(A=2;A+2<b.length;A+=2)C+=(b[A]-D)*(b[A+3]-T)-(b[A+2]-D)*(b[A+1]-T);if(C*S<0){r.moveTo(b[0],b[1]);for(A=2;A<b.length;A+=2)r.lineTo(b[A],b[A+1])}else{r.moveTo(b[b.length-2],b[b.length-1]);for(A=b.length-4;A>=0;A-=2)r.lineTo(b[A],b[A+1])}w[E].shape.closeStroke&&r.closePath()}}f.visible&&(r.globalAlpha=f.alpha*n,r.fillStyle=s,r.fill()),y.visible&&(r.globalAlpha=y.alpha*n,r.strokeStyle=a,r.stroke())}else if(d.type===t.SHAPES.RECT){var I=m;f.visible&&(r.globalAlpha=f.alpha*n,r.fillStyle=s,r.fillRect(I.x,I.y,I.width,I.height)),y.visible&&(r.globalAlpha=y.alpha*n,r.strokeStyle=a,r.strokeRect(I.x,I.y,I.width,I.height))}else if(d.type===t.SHAPES.CIRC){I=m;r.beginPath(),r.arc(I.x,I.y,I.radius,0,2*Math.PI),r.closePath(),f.visible&&(r.globalAlpha=f.alpha*n,r.fillStyle=s,r.fill()),y.visible&&(r.globalAlpha=y.alpha*n,r.strokeStyle=a,r.stroke())}else if(d.type===t.SHAPES.ELIP){var P=2*(I=m).width,B=2*I.height,M=I.x-P/2,O=I.y-B/2;r.beginPath();var R=.5522848,L=P/2*R,k=B/2*R,F=M+P,N=O+B,V=M+P/2,G=O+B/2;r.moveTo(M,G),r.bezierCurveTo(M,G-k,V-L,O,V,O),r.bezierCurveTo(V+L,O,F,G-k,F,G),r.bezierCurveTo(F,G+k,V+L,N,V,N),r.bezierCurveTo(V-L,N,M,G+k,M,G),r.closePath(),f.visible&&(r.globalAlpha=f.alpha*n,r.fillStyle=s,r.fill()),y.visible&&(r.globalAlpha=y.alpha*n,r.strokeStyle=a,r.stroke())}else if(d.type===t.SHAPES.RREC){var U=(I=m).x,j=I.y,z=I.width,X=I.height,H=I.radius,J=Math.min(z,X)/2|0;H=H>J?J:H,r.beginPath(),r.moveTo(U,j+H),r.lineTo(U,j+X-H),r.quadraticCurveTo(U,j+X,U+H,j+X),r.lineTo(U+z-H,j+X),r.quadraticCurveTo(U+z,j+X,U+z,j+X-H),r.lineTo(U+z,j+H),r.quadraticCurveTo(U+z,j,U+z-H,j),r.lineTo(U+H,j),r.quadraticCurveTo(U,j,U,j+H),r.closePath(),f.visible&&(r.globalAlpha=f.alpha*n,r.fillStyle=s,r.fill()),y.visible&&(r.globalAlpha=y.alpha*n,r.strokeStyle=a,r.stroke())}}},e.prototype.setPatternTransform=function(t,e){if(!1!==this._svgMatrix){if(!this._svgMatrix){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");if(i&&i.createSVGMatrix&&(this._svgMatrix=i.createSVGMatrix()),!this._svgMatrix||!t.setTransform)return void(this._svgMatrix=!1)}this._svgMatrix.a=e.a,this._svgMatrix.b=e.b,this._svgMatrix.c=e.c,this._svgMatrix.d=e.d,this._svgMatrix.e=e.tx,this._svgMatrix.f=e.ty,t.setTransform(this._svgMatrix.inverse())}},e.prototype.destroy=function(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null},e}(),Wa=new Ae;Mo.prototype.generateCanvasTexture=function(t,e){void 0===e&&(e=1);var i=this.getLocalBounds(),r=Mi.create({width:i.width,height:i.height,scaleMode:t,resolution:e});Ha||(Ha=new Ga),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(Wa),Wa.invert(),Wa.tx-=i.x,Wa.ty-=i.y,Ha.render(this,r,!0,Wa);var n=Pi.from(r.baseTexture._canvasRenderTarget.canvas,{scaleMode:t});return n.baseTexture.setResolution(e),n},Mo.prototype.cachedGraphicsData=[],Mo.prototype._renderCanvas=function(t){!0!==this.isMask&&(this.finishPoly(),t.plugins.graphics.render(this))};var $a=new Ae,Ya=function(){function e(t){this.renderer=t}return e.prototype.render=function(e){var i=e._texture,r=this.renderer,n=r.context,o=i._frame.width,s=i._frame.height,a=e.transform.worldTransform,l=0,h=0,c=i.baseTexture.getDrawableSource();if(!(i.orig.width<=0||i.orig.height<=0)&&i.valid&&c&&i.valid){r.setBlendMode(e.blendMode,!0),r.context.globalAlpha=e.worldAlpha;var u=i.baseTexture.scaleMode===t.SCALE_MODES.LINEAR;r.smoothProperty&&r.context[r.smoothProperty]!==u&&(n[r.smoothProperty]=u),i.trim?(l=i.trim.width/2+i.trim.x-e.anchor.x*i.orig.width,h=i.trim.height/2+i.trim.y-e.anchor.y*i.orig.height):(l=(.5-e.anchor.x)*i.orig.width,h=(.5-e.anchor.y)*i.orig.height),i.rotate&&(a.copyTo($a),a=$a,Le.matrixAppendRotationInv(a,i.rotate,l,h),l=0,h=0),l-=o/2,h-=s/2,r.setContextTransform(a,e.roundPixels,1),e.roundPixels&&(l|=0,h|=0);var p=i.baseTexture.resolution,d=r._outerBlend;d&&(n.save(),n.beginPath(),n.rect(l*r.resolution,h*r.resolution,o*r.resolution,s*r.resolution),n.clip()),16777215!==e.tint?(e._cachedTint===e.tint&&e._tintedCanvas.tintId===e._texture._updateID||(e._cachedTint=e.tint,e._tintedCanvas=Ua.getTintedCanvas(e,e.tint)),n.drawImage(e._tintedCanvas,0,0,Math.floor(o*p),Math.floor(s*p),Math.floor(l*r.resolution),Math.floor(h*r.resolution),Math.floor(o*r.resolution),Math.floor(s*r.resolution))):n.drawImage(c,i._frame.x*p,i._frame.y*p,Math.floor(o*p),Math.floor(s*p),Math.floor(l*r.resolution),Math.floor(h*r.resolution),Math.floor(o*r.resolution),Math.floor(s*r.resolution)),d&&n.restore(),r.setBlendMode(t.BLEND_MODES.NORMAL)}},e.prototype.destroy=function(){this.renderer=null},e}();Fo.prototype._tintedCanvas=null,Fo.prototype._renderCanvas=function(t){t.plugins.sprite.render(this)};var qa=new ve,Ka=function(){function t(t){this.renderer=t}return t.prototype.image=function(t,e,i){var r=new Image;return r.src=this.base64(t,e,i),r},t.prototype.base64=function(t,e,i){return this.canvas(t).toDataURL(e,i)},t.prototype.canvas=function(t){var e,i,r,n,o=this.renderer;t&&(n=t instanceof Mi?t:o.generateTexture(t)),n?(e=n.baseTexture._canvasRenderTarget.context,i=n.baseTexture._canvasRenderTarget.resolution,r=n.frame):(e=o.rootContext,i=o.resolution,(r=qa).width=this.renderer.width,r.height=this.renderer.height);var s=Math.floor(r.width*i+1e-4),a=Math.floor(r.height*i+1e-4),l=new he(s,a,1),h=e.getImageData(r.x*i,r.y*i,s,a);return l.context.putImageData(h,0,0),l.canvas},t.prototype.pixels=function(t){var e,i,r,n,o=this.renderer;return t&&(n=t instanceof Mi?t:o.generateTexture(t)),n?(e=n.baseTexture._canvasRenderTarget.context,i=n.baseTexture._canvasRenderTarget.resolution,r=n.frame):(e=o.rootContext,(r=qa).width=o.width,r.height=o.height),e.getImageData(0,0,r.width*i,r.height*i).data},t.prototype.destroy=function(){this.renderer=null},t}();Object.defineProperty(Ga.prototype,"extract",{get:function(){return oe("v5.3.0","CanvasRenderer#extract is deprecated, use CanvasRenderer#plugins.extract"),this.plugins.extract}});var Za=function(t,e){return Za=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},Za(t,e)};function Qa(t,e){var i=t;if(e instanceof di){var r=e.source,n=0===r.width?i.canvas.width:Math.min(i.canvas.width,r.width),o=0===r.height?i.canvas.height:Math.min(i.canvas.height,r.height);return i.ctx.drawImage(r,0,0,n,o,0,0,i.canvas.width,i.canvas.height),!0}return!1}var tl=function(t){function e(e){var i=t.call(this,e)||this;return i.uploadHookHelper=i,i.canvas=document.createElement("canvas"),i.canvas.width=16,i.canvas.height=16,i.ctx=i.canvas.getContext("2d"),i.registerUploadHook(Qa),i}return function(t,e){function i(){this.constructor=t}Za(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.ctx=null,this.canvas=null},e}(ns);return fs.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.valid){var i=t.context,r=this.worldTransform,n=e.baseTexture,o=n.getDrawableSource(),s=n.resolution,a=this.tilePosition.x/this.tileScale.x%e._frame.width*s,l=this.tilePosition.y/this.tileScale.y%e._frame.height*s;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tint){this._textureID=this._texture._updateID;var h=new he(e._frame.width,e._frame.height,s);16777215!==this.tint?(this._tintedCanvas=Ua.getTintedCanvas(this,this.tint),h.context.drawImage(this._tintedCanvas,0,0)):h.context.drawImage(o,-e._frame.x*s,-e._frame.y*s),this._cachedTint=this.tint,this._canvasPattern=h.context.createPattern(h.canvas,"repeat")}i.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode),t.setContextTransform(r),i.fillStyle=this._canvasPattern,i.scale(this.tileScale.x/s,this.tileScale.y/s);var c=this.anchor.x*-this._width,u=this.anchor.y*-this._height;this.uvRespectAnchor?(i.translate(a,l),i.fillRect(-a+c,-l+u,this._width/this.tileScale.x*s,this._height/this.tileScale.y*s)):(i.translate(a+c,l+u),i.fillRect(-a,-l,this._width/this.tileScale.x*s,this._height/this.tileScale.y*s))}},Zn.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var e=t.context,i=this.worldTransform,r=!0,n=0,o=0,s=0,a=0;t.setBlendMode(this.blendMode),e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var l=0;l<this.children.length;++l){var h=this.children[l];if(h.visible&&h._texture.valid){var c=h._texture.frame;if(e.globalAlpha=this.worldAlpha*h.alpha,h.rotation%(2*Math.PI)==0)r&&(t.setContextTransform(i,!1,1),r=!1),n=h.anchor.x*(-c.width*h.scale.x)+h.position.x+.5,o=h.anchor.y*(-c.height*h.scale.y)+h.position.y+.5,s=c.width*h.scale.x,a=c.height*h.scale.y;else{r||(r=!0),h.displayObjectUpdateTransform();var u=h.worldTransform;t.setContextTransform(u,this.roundPixels,1),n=h.anchor.x*-c.width+.5,o=h.anchor.y*-c.height+.5,s=c.width,a=c.height}var p=h._texture.baseTexture.resolution;e.drawImage(h._texture.baseTexture.getDrawableSource(),c.x*p,c.y*p,c.width*p,c.height*p,n*t.resolution,o*t.resolution,s*t.resolution,a*t.resolution)}}}},ze.prototype._renderCanvas=function(t){},ze.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&t.maskManager.pushMask(this._mask),this._renderCanvas(t);for(var e=0,i=this.children.length;e<i;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},Ge.prototype.renderCanvas=function(t){},$o.prototype._renderCanvas=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),Fo.prototype._renderCanvas.call(this,t)},Ga.registerPlugin("accessibility",We),Ga.registerPlugin("extract",Ka),Ga.registerPlugin("graphics",Ja),Ga.registerPlugin("interaction",ni),Ga.registerPlugin("mesh",za),Ga.registerPlugin("prepare",tl),Ga.registerPlugin("sprite",Ya),t.AbstractBatchRenderer=un,t.AbstractRenderer=rn,t.AccessibilityManager=We,t.AnimatedSprite=Pa,t.AppLoaderPlugin=Wn,t.Application=gn,t.Attribute=Ri,t.BasePrepare=ns,t.BaseRenderTexture=Ai,t.BaseTexture=di,t.BatchDrawCall=ln,t.BatchGeometry=dn,t.BatchPluginFactory=yn,t.BatchRenderer=_n,t.BatchShaderGenerator=pn,t.BatchTextureArray=hn,t.BitmapFont=Ls,t.BitmapFontData=Es,t.BitmapFontLoader=Vs,t.BitmapText=Ns,t.Bounds=Fe,t.Buffer=ki,t.CanvasExtract=Ka,t.CanvasGraphicsRenderer=Ja,t.CanvasMeshRenderer=za,t.CanvasPrepare=tl,t.CanvasRenderer=Ga,t.CanvasSpriteRenderer=Ya,t.Circle=be,t.Container=ze,t.CountLimiter=qo,t.DEG_TO_RAD=xe,t.DisplayObject=Ge,t.Ellipse=we,t.Extract=bn,t.FillStyle=io,t.Filter=Mr,t.FilterState=Wi,t.Framebuffer=Ti,t.GLFramebuffer=Qi,t.GLProgram=Jr,t.GLTexture=Zr,t.GRAPHICS_CURVES=eo,t.Geometry=ji,t.Graphics=Mo,t.GraphicsData=Do,t.GraphicsGeometry=Eo,t.IGLUniformData=Hr,t.InteractionData=Ke,t.InteractionEvent=Qe,t.InteractionManager=ni,t.InteractionTrackingData=ti,t.LineStyle=Io,t.Loader=Jn,t.LoaderResource=zn,t.MaskData=or,t.Matrix=Ae,t.Mesh=Cs,t.MeshBatchUvs=bs,t.MeshGeometry=Ts,t.MeshMaterial=Ds,t.NineSlicePlane=Ea,t.ObjectRenderer=Yi,t.ObservablePoint=Te,t.PI_2=_e,t.ParticleContainer=Zn,t.ParticleRenderer=to,t.PlaneGeometry=Sa,t.Point=De,t.Polygon=Se,t.Prepare=ls,t.Program=Ir,t.Quad=zi,t.QuadUv=Xi,t.RAD_TO_DEG=ge,t.Rectangle=ve,t.RenderTexture=Mi,t.RenderTexturePool=Oi,t.Renderer=nn,t.RopeGeometry=Ca,t.RoundedRectangle=Ce,t.Runner=oi,t.Shader=Pr,t.SimpleMesh=Aa,t.SimplePlane=Ta,t.SimpleRope=Da,t.Sprite=Fo,t.SpriteMaskFilter=Lr,t.Spritesheet=cs,t.SpritesheetLoader=us,t.State=Br,t.System=Ci,t.TemporaryDisplayObject=Ue,t.Text=$o,t.TextMetrics=Ho,t.TextStyle=Uo,t.Texture=Pi,t.TextureLoader=Hn,t.TextureMatrix=Rr,t.TextureUvs=Ei,t.Ticker=Ye,t.TickerPlugin=qe,t.TilingSprite=fs,t.TilingSpriteRenderer=gs,t.TimeLimiter=hs,t.Transform=ke,t.UniformGroup=Ji,t.VERSION="5.3.12",t.ViewableBuffer=cn,t.accessibleTarget=Xe,t.autoDetectRenderer=on,t.canvasUtils=Ua,t.checkMaxIfStatementsInShader=Tr,t.defaultFilterVertex=an,t.defaultVertex=sn,t.filters=Ra,t.graphicsUtils=Co,t.groupD8=Le,t.interactiveTarget=ii,t.isMobile=P,t.resources=Si,t.settings=B,t.systems=tn,t.uniformParsers=vr,t.useDeprecated=function(){var t=this;Object.defineProperties(t,{SVG_SIZE:{get:function(){return oe(Oa,"PIXI.utils.SVG_SIZE property has moved to PIXI.resources.SVGResource.SVG_SIZE"),t.SVGResource.SVG_SIZE}},TransformStatic:{get:function(){return oe(Oa,"PIXI.TransformStatic class has been removed, use PIXI.Transform"),t.Transform}},TransformBase:{get:function(){return oe(Oa,"PIXI.TransformBase class has been removed, use PIXI.Transform"),t.Transform}},TRANSFORM_MODE:{get:function(){return oe(Oa,"PIXI.TRANSFORM_MODE property has been removed"),{STATIC:0,DYNAMIC:1}}},WebGLRenderer:{get:function(){return oe(Oa,"PIXI.WebGLRenderer class has moved to PIXI.Renderer"),t.Renderer}},CanvasRenderTarget:{get:function(){return oe(Oa,"PIXI.CanvasRenderTarget class has moved to PIXI.utils.CanvasRenderTarget"),t.utils.CanvasRenderTarget}},loader:{get:function(){return oe(Oa,"PIXI.loader instance has moved to PIXI.Loader.shared"),t.Loader.shared}},FilterManager:{get:function(){return oe(Oa,"PIXI.FilterManager class has moved to PIXI.systems.FilterSystem"),t.systems.FilterSystem}},CanvasTinter:{get:function(){return oe("5.2.0","PIXI.CanvasTinter namespace has moved to PIXI.canvasUtils"),t.canvasUtils}},GroupD8:{get:function(){return oe("5.2.0","PIXI.GroupD8 namespace has moved to PIXI.groupD8"),t.groupD8}}}),t.accessibility={},Object.defineProperties(t.accessibility,{AccessibilityManager:{get:function(){return oe("5.3.0","PIXI.accessibility.AccessibilityManager moved to PIXI.AccessibilityManager"),t.AccessibilityManager}}}),t.interaction={},Object.defineProperties(t.interaction,{InteractionManager:{get:function(){return oe("5.3.0","PIXI.interaction.InteractionManager moved to PIXI.InteractionManager"),t.InteractionManager}},InteractionData:{get:function(){return oe("5.3.0","PIXI.interaction.InteractionData moved to PIXI.InteractionData"),t.InteractionData}},InteractionEvent:{get:function(){return oe("5.3.0","PIXI.interaction.InteractionEvent moved to PIXI.InteractionEvent"),t.InteractionEvent}}}),t.prepare={},Object.defineProperties(t.prepare,{BasePrepare:{get:function(){return oe("5.2.1","PIXI.prepare.BasePrepare moved to PIXI.BasePrepare"),t.BasePrepare}},Prepare:{get:function(){return oe("5.2.1","PIXI.prepare.Prepare moved to PIXI.Prepare"),t.Prepare}},CanvasPrepare:{get:function(){return oe("5.2.1","PIXI.prepare.CanvasPrepare moved to PIXI.CanvasPrepare"),t.CanvasPrepare}}}),t.extract={},Object.defineProperties(t.extract,{Extract:{get:function(){return oe("5.2.1","PIXI.extract.Extract moved to PIXI.Extract"),t.Extract}},CanvasExtract:{get:function(){return oe("5.2.1","PIXI.extract.CanvasExtract moved to PIXI.CanvasExtract"),t.CanvasExtract}}}),t.extras={},Object.defineProperties(t.extras,{TilingSprite:{get:function(){return oe(Oa,"PIXI.extras.TilingSprite class has moved to PIXI.TilingSprite"),t.TilingSprite}},TilingSpriteRenderer:{get:function(){return oe(Oa,"PIXI.extras.TilingSpriteRenderer class has moved to PIXI.TilingSpriteRenderer"),t.TilingSpriteRenderer}},AnimatedSprite:{get:function(){return oe(Oa,"PIXI.extras.AnimatedSprite class has moved to PIXI.AnimatedSprite"),t.AnimatedSprite}},BitmapText:{get:function(){return oe(Oa,"PIXI.extras.BitmapText class has moved to PIXI.BitmapText"),t.BitmapText}}}),t.TilingSprite.fromFrame=function(e,i,r){return oe("5.3.0","TilingSprite.fromFrame is deprecated, use TilingSprite.from"),t.TilingSprite.from(e,{width:i,height:r})},t.TilingSprite.fromImage=function(e,i,r,n){return void 0===n&&(n={}),oe("5.3.0","TilingSprite.fromImage is deprecated, use TilingSprite.from"),n&&"object"!=typeof n&&(n={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}),n.width=i,n.height=r,t.TilingSprite.from(e,n)},Object.defineProperties(t.utils,{getSvgSize:{get:function(){return oe(Oa,"PIXI.utils.getSvgSize function has moved to PIXI.resources.SVGResource.getSize"),t.resources.SVGResource.getSize}}}),t.mesh={},Object.defineProperties(t.mesh,{Mesh:{get:function(){return oe(Oa,"PIXI.mesh.Mesh class has moved to PIXI.SimpleMesh"),t.SimpleMesh}},NineSlicePlane:{get:function(){return oe(Oa,"PIXI.mesh.NineSlicePlane class has moved to PIXI.NineSlicePlane"),t.NineSlicePlane}},Plane:{get:function(){return oe(Oa,"PIXI.mesh.Plane class has moved to PIXI.SimplePlane"),t.SimplePlane}},Rope:{get:function(){return oe(Oa,"PIXI.mesh.Rope class has moved to PIXI.SimpleRope"),t.SimpleRope}},RawMesh:{get:function(){return oe(Oa,"PIXI.mesh.RawMesh class has moved to PIXI.Mesh"),t.Mesh}},CanvasMeshRenderer:{get:function(){return oe(Oa,"PIXI.mesh.CanvasMeshRenderer class has moved to PIXI.CanvasMeshRenderer"),t.CanvasMeshRenderer}},MeshRenderer:{get:function(){return oe(Oa,"PIXI.mesh.MeshRenderer class has moved to PIXI.MeshRenderer"),t.MeshRenderer}}}),t.particles={},Object.defineProperties(t.particles,{ParticleContainer:{get:function(){return oe(Oa,"PIXI.particles.ParticleContainer class has moved to PIXI.ParticleContainer"),t.ParticleContainer}},ParticleRenderer:{get:function(){return oe(Oa,"PIXI.particles.ParticleRenderer class has moved to PIXI.ParticleRenderer"),t.ParticleRenderer}}}),t.ticker={},Object.defineProperties(t.ticker,{Ticker:{get:function(){return oe(Oa,"PIXI.ticker.Ticker class has moved to PIXI.Ticker"),t.Ticker}},shared:{get:function(){return oe(Oa,"PIXI.ticker.shared instance has moved to PIXI.Ticker.shared"),t.Ticker.shared}}}),t.loaders={},Object.defineProperties(t.loaders,{Loader:{get:function(){return oe(Oa,"PIXI.loaders.Loader class has moved to PIXI.Loader"),t.Loader}},Resource:{get:function(){return oe(Oa,"PIXI.loaders.Resource class has moved to PIXI.LoaderResource"),t.LoaderResource}},bitmapFontParser:{get:function(){return oe(Oa,"PIXI.loaders.bitmapFontParser function has moved to PIXI.BitmapFontLoader.use"),t.BitmapFontLoader.use}},parseBitmapFontData:{get:function(){oe(Oa,"PIXI.loaders.parseBitmapFontData function has removed")}},spritesheetParser:{get:function(){return oe(Oa,"PIXI.loaders.spritesheetParser function has moved to PIXI.SpritesheetLoader.use"),t.SpritesheetLoader.use}},getResourcePath:{get:function(){return oe(Oa,"PIXI.loaders.getResourcePath property has moved to PIXI.SpritesheetLoader.getResourcePath"),t.SpritesheetLoader.getResourcePath}}}),t.Loader.addPixiMiddleware=function(e){return oe(Oa,"PIXI.loaders.Loader.addPixiMiddleware function is deprecated, use PIXI.loaders.Loader.registerPlugin"),t.loaders.Loader.registerPlugin({use:e()})};var e=function(t){return"on"+t.charAt(0).toUpperCase()+t.slice(1)};Object.assign(t.Loader.prototype,{on:function(t){var i=e(t);oe(Oa,"PIXI.Loader#on is completely deprecated, use PIXI.Loader#"+i+".add")},once:function(t){var i=e(t);oe(Oa,"PIXI.Loader#once is completely deprecated, use PIXI.Loader#"+i+".once")},off:function(t){var i=e(t);oe(Oa,"PIXI.Loader#off is completely deprecated, use PIXI.Loader#"+i+".detach")}}),Object.defineProperty(t.extract,"WebGLExtract",{get:function(){return oe(Oa,"PIXI.extract.WebGLExtract method has moved to PIXI.Extract"),t.Extract}}),Object.defineProperty(t.prepare,"WebGLPrepare",{get:function(){return oe(Oa,"PIXI.prepare.WebGLPrepare class has moved to PIXI.Prepare"),t.Prepare}}),t.Container.prototype._renderWebGL=function(t){oe(Oa,"PIXI.Container._renderWebGL method has moved to PIXI.Container._render"),this._render(t)},t.Container.prototype.renderWebGL=function(t){oe(Oa,"PIXI.Container.renderWebGL method has moved to PIXI.Container.render"),this.render(t)},t.DisplayObject.prototype.renderWebGL=function(t){oe(Oa,"PIXI.DisplayObject.renderWebGL method has moved to PIXI.DisplayObject.render"),this.render(t)},t.Container.prototype.renderAdvancedWebGL=function(t){oe(Oa,"PIXI.Container.renderAdvancedWebGL method has moved to PIXI.Container.renderAdvanced"),this.renderAdvanced(t)},Object.defineProperties(t.settings,{TRANSFORM_MODE:{get:function(){return oe(Oa,"PIXI.settings.TRANSFORM_MODE property has been removed"),0},set:function(){oe(Oa,"PIXI.settings.TRANSFORM_MODE property has been removed")}}});var i=t.BaseTexture;i.prototype.loadSource=function(e){oe(Oa,"PIXI.BaseTexture.loadSource method has been deprecated");var i=t.resources.autoDetectResource(e);i.internal=!0,this.setResource(i),this.update()};var r=!1;Object.defineProperties(i.prototype,{hasLoaded:{get:function(){return oe(Oa,"PIXI.BaseTexture.hasLoaded property has been removed, use PIXI.BaseTexture.valid"),this.valid}},imageUrl:{get:function(){var t;return oe(Oa,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),null===(t=this.resource)||void 0===t?void 0:t.url},set:function(t){oe(Oa,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&(this.resource.url=t)}},source:{get:function(){return oe(Oa,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source`"),this.resource.source},set:function(t){oe(Oa,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source` if you want to set HTMLCanvasElement. Otherwise, create new BaseTexture."),this.resource&&(this.resource.source=t)}},premultiplyAlpha:{get:function(){return oe("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(t){oe("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}},_id:{get:function(){return r||(oe("5.2.0","PIXI.BaseTexture._id batch local field has been changed to `_batchLocation`"),r=!0),this._batchLocation},set:function(t){this._batchLocation=t}}}),i.fromImage=function(t,e,r,n){oe(Oa,"PIXI.BaseTexture.fromImage method has been replaced with PIXI.BaseTexture.from");var o={scale:n,crossorigin:e};return i.from(t,{scaleMode:r,resourceOptions:o})},i.fromCanvas=function(t,e){return oe(Oa,"PIXI.BaseTexture.fromCanvas method has been replaced with PIXI.BaseTexture.from"),i.from(t,{scaleMode:e})},i.fromSVG=function(t,e,r,n){oe(Oa,"PIXI.BaseTexture.fromSVG method has been replaced with PIXI.BaseTexture.from");var o={scale:n,crossorigin:e};return i.from(t,{scaleMode:r,resourceOptions:o})},Object.defineProperties(t.resources.ImageResource.prototype,{premultiplyAlpha:{get:function(){return oe("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(t){oe("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}}}),t.Point.prototype.copy=function(t){return oe(Oa,"PIXI.Point.copy method has been replaced with PIXI.Point.copyFrom"),this.copyFrom(t)},t.ObservablePoint.prototype.copy=function(t){return oe(Oa,"PIXI.ObservablePoint.copy method has been replaced with PIXI.ObservablePoint.copyFrom"),this.copyFrom(t)},t.Rectangle.prototype.copy=function(t){return oe(Oa,"PIXI.Rectangle.copy method has been replaced with PIXI.Rectangle.copyFrom"),this.copyFrom(t)},t.Matrix.prototype.copy=function(t){return oe(Oa,"PIXI.Matrix.copy method has been replaced with PIXI.Matrix.copyTo"),this.copyTo(t)},t.systems.StateSystem.prototype.setState=function(t){return oe("v5.1.0","StateSystem.setState has been renamed to StateSystem.set"),this.set(t)},Object.assign(t.systems.FilterSystem.prototype,{getRenderTarget:function(t,e){return oe(Oa,"PIXI.FilterManager.getRenderTarget method has been replaced with PIXI.systems.FilterSystem#getFilterTexture"),this.getFilterTexture(null,e)},returnRenderTarget:function(t){oe(Oa,"PIXI.FilterManager.returnRenderTarget method has been replaced with PIXI.systems.FilterSystem.returnFilterTexture"),this.returnFilterTexture(t)},calculateScreenSpaceMatrix:function(t){oe(Oa,"PIXI.systems.FilterSystem.calculateScreenSpaceMatrix method is removed, use `(vTextureCoord * inputSize.xy) + outputFrame.xy` instead");var e=t.identity(),i=this.activeState,r=i.sourceFrame,n=i.destinationFrame;return e.translate(r.x/n.width,r.y/n.height),e.scale(n.width,n.height),e},calculateNormalizedScreenSpaceMatrix:function(t){oe(Oa,"PIXI.systems.FilterManager.calculateNormalizedScreenSpaceMatrix method is removed, use `((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw` instead.");var e=this.activeState,i=e.sourceFrame,r=e.destinationFrame,n=t.identity();n.translate(i.x/r.width,i.y/r.height);var o=r.width/i.width,s=r.height/i.height;return n.scale(o,s),n}}),Object.defineProperties(t.RenderTexture.prototype,{sourceFrame:{get:function(){return oe(Oa,"PIXI.RenderTexture.sourceFrame property has been removed"),this.filterFrame}},size:{get:function(){return oe(Oa,"PIXI.RenderTexture.size property has been removed"),this._frame}}});var n=function(t){function e(e,i,r,n){return oe(Oa,"PIXI.filters.BlurXFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!0,e,i,r,n)||this}return Ma(e,t),e}(t.filters.BlurFilterPass),o=function(t){function e(e,i,r,n){return oe(Oa,"PIXI.filters.BlurYFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!1,e,i,r,n)||this}return Ma(e,t),e}(t.filters.BlurFilterPass);Object.assign(t.filters,{BlurXFilter:n,BlurYFilter:o});var s=t.Sprite,a=t.Texture,l=t.Graphics;function h(t,e,i,r){return oe(Oa,"PIXI.Sprite."+t+" method is deprecated, use PIXI.Sprite.from"),s.from(e,{resourceOptions:{scale:r,crossorigin:i}})}function c(t,e,i,r){return oe(Oa,"PIXI.Texture."+t+" method is deprecated, use PIXI.Texture.from"),a.from(e,{resourceOptions:{scale:r,crossorigin:i}})}l.prototype.generateCanvasTexture||(l.prototype.generateCanvasTexture=function(){oe(Oa,'PIXI.Graphics.generateCanvasTexture method is only available in "pixi.js-legacy"')}),Object.defineProperty(l.prototype,"graphicsData",{get:function(){return oe(Oa,"PIXI.Graphics.graphicsData property is deprecated, use PIXI.Graphics.geometry.graphicsData"),this.geometry.graphicsData}}),s.fromImage=h.bind(null,"fromImage"),s.fromSVG=h.bind(null,"fromSVG"),s.fromCanvas=h.bind(null,"fromCanvas"),s.fromVideo=h.bind(null,"fromVideo"),s.fromFrame=h.bind(null,"fromFrame"),a.fromImage=c.bind(null,"fromImage"),a.fromSVG=c.bind(null,"fromSVG"),a.fromCanvas=c.bind(null,"fromCanvas"),a.fromVideo=c.bind(null,"fromVideo"),a.fromFrame=c.bind(null,"fromFrame"),Object.defineProperty(t.AbstractRenderer.prototype,"autoResize",{get:function(){return oe(Oa,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity},set:function(t){oe(Oa,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity=t}}),Object.defineProperty(t.Renderer.prototype,"textureManager",{get:function(){return oe(Oa,"PIXI.Renderer.textureManager property is deprecated, use PIXI.Renderer.texture"),this.texture}}),t.utils.mixins={mixin:function(){oe(Oa,"PIXI.utils.mixins.mixin function is no longer available")},delayMixin:function(){oe(Oa,"PIXI.utils.mixins.delayMixin function is no longer available")},performMixins:function(){oe(Oa,"PIXI.utils.mixins.performMixins function is no longer available")}},Object.defineProperty(t.BitmapText.prototype,"font",{get:function(){return oe("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),{name:this._fontName,size:this._fontSize,tint:this._tint,align:this._align}},set:function(e){if(oe("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),e){var i={font:e};this._upgradeStyle(i),i.fontSize=i.fontSize||t.BitmapFont.available[i.fontName].size,this._fontName=i.fontName,this._fontSize=i.fontSize,this.dirty=!0}}})},t.utils=ye,t}({});function createRenderer(){$.cookie.json=!0;var t=!!$.cookie("disableShaders"),e=tagpro.createPNGRenderer();tagproConfig.enableShaders&&!t&&tagpro.createShaderRenderer(e),tagpro.ready.after(e.start)}PIXI.useDeprecated(),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pixiParticles=t()}}((function(){var define,module,exports;return function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[s]={exports:{}};e[s][0].call(c.exports,(function(t){var i=e[s][1][t];return n(i||t)}),c,c.exports,t,e,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e,i){"use strict";var r=t("./ParticleUtils"),n=t("./Particle"),o=PIXI.Texture,s=function(t){n.call(this,t),this.textures=null,this.duration=0,this.framerate=0,this.elapsed=0,this.loop=!1},a=n.prototype,l=s.prototype=Object.create(a);l.init=function(){this.Particle_init(),this.elapsed=0,this.framerate<0&&(this.duration=this.maxLife,this.framerate=this.textures.length/this.duration)},l.applyArt=function(t){this.textures=t.textures,this.framerate=t.framerate,this.duration=t.duration,this.loop=t.loop},l.update=function(t){if(this.Particle_update(t)>=0){this.elapsed+=t,this.elapsed>this.duration&&(this.loop?this.elapsed=this.elapsed%this.duration:this.elapsed=this.duration-1e-6);var e=this.elapsed*this.framerate+1e-7|0;this.texture=this.textures[e]||r.EMPTY_TEXTURE}},l.Particle_destroy=n.prototype.destroy,l.destroy=function(){this.Particle_destroy(),this.textures=null},s.parseArt=function(t){var e,i,r,n,s,a,l=[];for(e=0;e<t.length;++e){for(i=t[e],t[e]=l={},l.textures=a=[],n=i.textures,r=0;r<n.length;++r)if("string"==typeof(s=n[r]))a.push(o.fromImage(s));else if(s instanceof o)a.push(s);else{var h=s.count||1;for(s="string"==typeof s.texture?o.fromImage(s.texture):s.texture;h>0;--h)a.push(s)}"matchLife"==i.framerate?(l.framerate=-1,l.duration=0,l.loop=!1):(l.loop=!!i.loop,l.framerate=i.framerate>0?i.framerate:60,l.duration=a.length/l.framerate)}return t},e.exports=s},{"./Particle":3,"./ParticleUtils":4}],2:[function(t,e,i){"use strict";var r=t("./ParticleUtils"),n=t("./Particle"),o=PIXI.particles.ParticleContainer||PIXI.ParticleContainer,s=PIXI.ticker.shared,a=function(t,e,i){this._particleConstructor=n,this.particleImages=null,this.startAlpha=1,this.endAlpha=1,this.startSpeed=0,this.endSpeed=0,this.minimumSpeedMultiplier=1,this.acceleration=null,this.maxSpeed=NaN,this.startScale=1,this.endScale=1,this.minimumScaleMultiplier=1,this.startColor=null,this.endColor=null,this.minLifetime=0,this.maxLifetime=0,this.minStartRotation=0,this.maxStartRotation=0,this.noRotation=!1,this.minRotationSpeed=0,this.maxRotationSpeed=0,this.particleBlendMode=0,this.customEase=null,this.extraData=null,this._frequency=1,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=null,this.spawnType=null,this._spawnFunc=null,this.spawnRect=null,this.spawnCircle=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0,this.rotation=0,this.ownerPos=null,this._prevEmitterPos=null,this._prevPosIsValid=!1,this._posChanged=!1,this._parentIsPC=!1,this._parent=null,this.addAtBack=!1,this.particleCount=0,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticlesFirst=null,this._activeParticlesLast=null,this._poolFirst=null,this._origConfig=null,this._origArt=null,this._autoUpdate=!1,this._destroyWhenComplete=!1,this.parent=t,e&&i&&this.init(e,i),this.recycle=this.recycle,this.update=this.update,this.rotate=this.rotate,this.updateSpawnPos=this.updateSpawnPos,this.updateOwnerPos=this.updateOwnerPos},l=a.prototype={},h=new PIXI.Point;Object.defineProperty(l,"frequency",{get:function(){return this._frequency},set:function(t){this._frequency="number"==typeof t&&t>0?t:1}}),Object.defineProperty(l,"particleConstructor",{get:function(){return this._particleConstructor},set:function(t){if(t!=this._particleConstructor){this._particleConstructor=t,this.cleanup();for(var e=this._poolFirst;e;e=e.next)e.destroy();this._poolFirst=null,this._origConfig&&this._origArt&&this.init(this._origArt,this._origConfig)}}}),Object.defineProperty(l,"parent",{get:function(){return this._parent},set:function(t){if(this._parentIsPC)for(var e=this._poolFirst;e;e=e.next)e.parent&&e.parent.removeChild(e);this.cleanup(),this._parent=t,this._parentIsPC=o&&t&&t instanceof o}}),l.init=function(t,e){if(t&&e){this.cleanup(),this._origConfig=e,this._origArt=t,t=Array.isArray(t)?t.slice():[t];var i=this._particleConstructor;this.particleImages=i.parseArt?i.parseArt(t):t,e.alpha?(this.startAlpha=e.alpha.start,this.endAlpha=e.alpha.end):this.startAlpha=this.endAlpha=1,e.speed?(this.startSpeed=e.speed.start,this.endSpeed=e.speed.end,this.minimumSpeedMultiplier=e.speed.minimumSpeedMultiplier||1):(this.minimumSpeedMultiplier=1,this.startSpeed=this.endSpeed=0);var n,o=e.acceleration;switch(o&&(o.x||o.y)?(this.endSpeed=this.startSpeed,this.acceleration=new PIXI.Point(o.x,o.y),this.maxSpeed=e.maxSpeed||NaN):this.acceleration=new PIXI.Point,e.scale?(this.startScale=e.scale.start,this.endScale=e.scale.end,this.minimumScaleMultiplier=e.scale.minimumScaleMultiplier||1):this.startScale=this.endScale=this.minimumScaleMultiplier=1,e.color&&(this.startColor=r.hexToRGB(e.color.start),e.color.start!=e.color.end?this.endColor=r.hexToRGB(e.color.end):this.endColor=null),e.startRotation?(this.minStartRotation=e.startRotation.min,this.maxStartRotation=e.startRotation.max):this.minStartRotation=this.maxStartRotation=0,e.noRotation&&(this.minStartRotation||this.maxStartRotation)?this.noRotation=!!e.noRotation:this.noRotation=!1,e.rotationSpeed?(this.minRotationSpeed=e.rotationSpeed.min,this.maxRotationSpeed=e.rotationSpeed.max):this.minRotationSpeed=this.maxRotationSpeed=0,this.minLifetime=e.lifetime.min,this.maxLifetime=e.lifetime.max,this.particleBlendMode=r.getBlendMode(e.blendMode),e.ease?this.customEase="function"==typeof e.ease?e.ease:r.generateEase(e.ease):this.customEase=null,i.parseData?this.extraData=i.parseData(e.extraData):this.extraData=e.extraData||null,this.spawnRect=this.spawnCircle=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0,e.spawnType){case"rect":this.spawnType="rect",this._spawnFunc=this._spawnRect;var s=e.spawnRect;this.spawnRect=new PIXI.Rectangle(s.x,s.y,s.w,s.h);break;case"circle":this.spawnType="circle",this._spawnFunc=this._spawnCircle,n=e.spawnCircle,this.spawnCircle=new PIXI.Circle(n.x,n.y,n.r);break;case"ring":this.spawnType="ring",this._spawnFunc=this._spawnRing,n=e.spawnCircle,this.spawnCircle=new PIXI.Circle(n.x,n.y,n.r),this.spawnCircle.minRadius=n.minR;break;case"burst":this.spawnType="burst",this._spawnFunc=this._spawnBurst,this.particlesPerWave=e.particlesPerWave,this.particleSpacing=e.particleSpacing,this.angleStart=e.angleStart?e.angleStart:0;break;default:this.spawnType="point",this._spawnFunc=this._spawnPoint}this.frequency=e.frequency,this.emitterLifetime=e.emitterLifetime||-1,this.maxParticles=e.maxParticles>0?e.maxParticles:1e3,this.addAtBack=!!e.addAtBack,this.rotation=0,this.ownerPos=new PIXI.Point,this.spawnPos=new PIXI.Point(e.pos.x,e.pos.y),this._prevEmitterPos=this.spawnPos.clone(),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=void 0===e.emit||!!e.emit,this.autoUpdate=void 0!==e.autoUpdate&&!!e.autoUpdate}},l.recycle=function(t){t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t==this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t==this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),t.prev=null,t.next=this._poolFirst,this._poolFirst=t,this._parentIsPC?(t.alpha=0,t.visible=!1):t.parent&&t.parent.removeChild(t),--this.particleCount},l.rotate=function(t){if(this.rotation!=t){var e=t-this.rotation;this.rotation=t,r.rotatePoint(e,this.spawnPos),this._posChanged=!0}},l.updateSpawnPos=function(t,e){this._posChanged=!0,this.spawnPos.x=t,this.spawnPos.y=e},l.updateOwnerPos=function(t,e){this._posChanged=!0,this.ownerPos.x=t,this.ownerPos.y=e},l.resetPositionTracking=function(){this._prevPosIsValid=!1},Object.defineProperty(l,"emit",{get:function(){return this._emit},set:function(t){this._emit=!!t,this._emitterLife=this.emitterLifetime}}),Object.defineProperty(l,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate&&!t?s.remove(this.update,this):!this._autoUpdate&&t&&s.add(this.update,this),this._autoUpdate=!!t}}),l.playOnceAndDestroy=function(){this.autoUpdate=!0,this.emit=!0,this._destroyWhenComplete=!0},l.update=function(t){if(this._autoUpdate&&(t=t/PIXI.settings.TARGET_FPMS/1e3),this._parent){var e,i,r,n,o;for(i=this._activeParticlesFirst;i;i=r)r=i.next,i.update(t);this._prevPosIsValid&&(n=this._prevEmitterPos.x,o=this._prevEmitterPos.y);var s=this.ownerPos.x+this.spawnPos.x,a=this.ownerPos.y+this.spawnPos.y;if(this._emit)for(this._spawnTimer-=t;this._spawnTimer<=0;){if(this._emitterLife>0&&(this._emitterLife-=this._frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this.particleCount>=this.maxParticles)this._spawnTimer+=this._frequency;else{var l;if(l=this.minLifetime==this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer<l){var h,c;if(this._prevPosIsValid&&this._posChanged){var u=1+this._spawnTimer/t;h=(s-n)*u+n,c=(a-o)*u+o}else h=s,c=a;e=0;for(var p=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount);e<p;++e){var d,m;if(this._poolFirst?(d=this._poolFirst,this._poolFirst=this._poolFirst.next,d.next=null):d=new this.particleConstructor(this),this.particleImages.length>1?d.applyArt(this.particleImages[Math.floor(Math.random()*this.particleImages.length)]):d.applyArt(this.particleImages[0]),d.startAlpha=this.startAlpha,d.endAlpha=this.endAlpha,1!=this.minimumSpeedMultiplier?(m=Math.random()*(1-this.minimumSpeedMultiplier)+this.minimumSpeedMultiplier,d.startSpeed=this.startSpeed*m,d.endSpeed=this.endSpeed*m):(d.startSpeed=this.startSpeed,d.endSpeed=this.endSpeed),d.acceleration.x=this.acceleration.x,d.acceleration.y=this.acceleration.y,d.maxSpeed=this.maxSpeed,1!=this.minimumScaleMultiplier?(m=Math.random()*(1-this.minimumScaleMultiplier)+this.minimumScaleMultiplier,d.startScale=this.startScale*m,d.endScale=this.endScale*m):(d.startScale=this.startScale,d.endScale=this.endScale),d.startColor=this.startColor,d.endColor=this.endColor,this.minRotationSpeed==this.maxRotationSpeed?d.rotationSpeed=this.minRotationSpeed:d.rotationSpeed=Math.random()*(this.maxRotationSpeed-this.minRotationSpeed)+this.minRotationSpeed,d.noRotation=this.noRotation,d.maxLife=l,d.blendMode=this.particleBlendMode,d.ease=this.customEase,d.extraData=this.extraData,this._spawnFunc(d,h,c,e),d.init(),d.update(-this._spawnTimer),this._parentIsPC&&d.parent){var f=this._parent.children;if(f[0]==d)f.shift();else if(f[f.length-1]==d)f.pop();else{var y=f.indexOf(d);f.splice(y,1)}this.addAtBack?f.unshift(d):f.push(d)}else this.addAtBack?this._parent.addChildAt(d,0):this._parent.addChild(d);this._activeParticlesLast?(this._activeParticlesLast.next=d,d.prev=this._activeParticlesLast,this._activeParticlesLast=d):this._activeParticlesLast=this._activeParticlesFirst=d,++this.particleCount}}this._spawnTimer+=this._frequency}}this._posChanged&&(this._prevEmitterPos.x=s,this._prevEmitterPos.y=a,this._prevPosIsValid=!0,this._posChanged=!1),!this._destroyWhenComplete||this._emit||this._activeParticlesFirst||this.destroy()}},l._spawnPoint=function(t,e,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,t.position.x=e,t.position.y=i},l._spawnRect=function(t,e,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,h.x=Math.random()*this.spawnRect.width+this.spawnRect.x,h.y=Math.random()*this.spawnRect.height+this.spawnRect.y,0!==this.rotation&&r.rotatePoint(this.rotation,h),t.position.x=e+h.x,t.position.y=i+h.y},l._spawnCircle=function(t,e,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,h.x=Math.random()*this.spawnCircle.radius,h.y=0,r.rotatePoint(360*Math.random(),h),h.x+=this.spawnCircle.x,h.y+=this.spawnCircle.y,0!==this.rotation&&r.rotatePoint(this.rotation,h),t.position.x=e+h.x,t.position.y=i+h.y},l._spawnRing=function(t,e,i){var n=this.spawnCircle;this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,n.minRadius==n.radius?h.x=Math.random()*(n.radius-n.minRadius)+n.minRadius:h.x=n.radius,h.y=0;var o=360*Math.random();t.rotation+=o,r.rotatePoint(o,h),h.x+=this.spawnCircle.x,h.y+=this.spawnCircle.y,0!==this.rotation&&r.rotatePoint(this.rotation,h),t.position.x=e+h.x,t.position.y=i+h.y},l._spawnBurst=function(t,e,i,r){0===this.particleSpacing?t.rotation=360*Math.random():t.rotation=this.angleStart+this.particleSpacing*r+this.rotation,t.position.x=e,t.position.y=i},l.cleanup=function(){var t,e;for(t=this._activeParticlesFirst;t;t=e)e=t.next,this.recycle(t),t.parent&&t.parent.removeChild(t);this._activeParticlesFirst=this._activeParticlesLast=null,this.particleCount=0},l.destroy=function(){var t;this.autoUpdate=!1,this.cleanup();for(var e=this._poolFirst;e;e=t)t=e.next,e.destroy();this._poolFirst=this._parent=this.particleImages=this.spawnPos=this.ownerPos=this.startColor=this.endColor=this.customEase=null},e.exports=a},{"./Particle":3,"./ParticleUtils":4}],3:[function(t,e,i){var r=t("./ParticleUtils"),n=PIXI.Sprite,o=function(t){n.call(this),this.emitter=t,this.anchor.x=this.anchor.y=.5,this.velocity=new PIXI.Point,this.maxLife=0,this.age=0,this.ease=null,this.extraData=null,this.startAlpha=0,this.endAlpha=0,this.startSpeed=0,this.endSpeed=0,this.acceleration=new PIXI.Point,this.maxSpeed=NaN,this.startScale=0,this.endScale=0,this.startColor=null,this._sR=0,this._sG=0,this._sB=0,this.endColor=null,this._eR=0,this._eG=0,this._eB=0,this._doAlpha=!1,this._doScale=!1,this._doSpeed=!1,this._doAcceleration=!1,this._doColor=!1,this._doNormalMovement=!1,this._oneOverLife=0,this.next=null,this.prev=null,this.init=this.init,this.Particle_init=this.Particle_init,this.update=this.update,this.Particle_update=this.Particle_update,this.applyArt=this.applyArt,this.kill=this.kill},s=o.prototype=Object.create(n.prototype);s.init=s.Particle_init=function(){this.age=0,this.velocity.x=this.startSpeed,this.velocity.y=0,r.rotatePoint(this.rotation,this.velocity),this.noRotation?this.rotation=0:this.rotation*=r.DEG_TO_RADS,this.rotationSpeed*=r.DEG_TO_RADS,this.alpha=this.startAlpha,this.scale.x=this.scale.y=this.startScale,this.startColor&&(this._sR=this.startColor[0],this._sG=this.startColor[1],this._sB=this.startColor[2],this.endColor&&(this._eR=this.endColor[0],this._eG=this.endColor[1],this._eB=this.endColor[2])),this._doAlpha=this.startAlpha!=this.endAlpha,this._doSpeed=this.startSpeed!=this.endSpeed,this._doScale=this.startScale!=this.endScale,this._doColor=!!this.endColor,this._doAcceleration=0!==this.acceleration.x||0!==this.acceleration.y,this._doNormalMovement=this._doSpeed||0!==this.startSpeed||this._doAcceleration,this._oneOverLife=1/this.maxLife,this.tint=r.combineRGBComponents(this._sR,this._sG,this._sB),this.visible=!0},s.applyArt=function(t){this.texture=t||r.EMPTY_TEXTURE},s.update=s.Particle_update=function(t){if(this.age+=t,this.age>=this.maxLife)return this.kill(),-1;var e=this.age*this._oneOverLife;if(this.ease&&(e=4==this.ease.length?this.ease(e,0,1,1):this.ease(e)),this._doAlpha&&(this.alpha=(this.endAlpha-this.startAlpha)*e+this.startAlpha),this._doScale){var i=(this.endScale-this.startScale)*e+this.startScale;this.scale.x=this.scale.y=i}if(this._doNormalMovement){if(this._doSpeed){var n=(this.endSpeed-this.startSpeed)*e+this.startSpeed;r.normalize(this.velocity),r.scaleBy(this.velocity,n)}else if(this._doAcceleration&&(this.velocity.x+=this.acceleration.x*t,this.velocity.y+=this.acceleration.y*t,this.maxSpeed)){var o=r.length(this.velocity);o>this.maxSpeed&&r.scaleBy(this.velocity,this.maxSpeed/o)}this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t}if(this._doColor){var s=(this._eR-this._sR)*e+this._sR,a=(this._eG-this._sG)*e+this._sG,l=(this._eB-this._sB)*e+this._sB;this.tint=r.combineRGBComponents(s,a,l)}return 0!==this.rotationSpeed?this.rotation+=this.rotationSpeed*t:this.acceleration&&!this.noRotation&&(this.rotation=Math.atan2(this.velocity.y,this.velocity.x)),e},s.kill=function(){this.emitter.recycle(this)},s.Sprite_Destroy=n.prototype.destroy,s.destroy=function(){this.parent&&this.parent.removeChild(this),this.Sprite_Destroy&&this.Sprite_Destroy(),this.emitter=this.velocity=this.startColor=this.endColor=this.ease=this.next=this.prev=null},o.parseArt=function(t){var e;for(e=t.length;e>=0;--e)"string"==typeof t[e]&&(t[e]=PIXI.Texture.fromImage(t[e]));if(r.verbose)for(e=t.length-1;e>0;--e)if(t[e].baseTexture!=t[e-1].baseTexture){window.console&&console.warn("PixiParticles: using particle textures from different images may hinder performance in WebGL");break}return t},o.parseData=function(t){return t},e.exports=o},{"./ParticleUtils":4}],4:[function(t,e,i){"use strict";var r=PIXI.BLEND_MODES||PIXI.blendModes,n=PIXI.Texture,o={verbose:!1},s=o.DEG_TO_RADS=Math.PI/180,a=o.EMPTY_TEXTURE=n.EMPTY;a.on=a.destroy=a.once=a.emit=function(){},o.rotatePoint=function(t,e){if(t){t*=s;var i=Math.sin(t),r=Math.cos(t),n=e.x*r-e.y*i,o=e.x*i+e.y*r;e.x=n,e.y=o}},o.combineRGBComponents=function(t,e,i){return t<<16|e<<8|i},o.normalize=function(t){var e=1/o.length(t);t.x*=e,t.y*=e},o.scaleBy=function(t,e){t.x*=e,t.y*=e},o.length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},o.hexToRGB=function(t,e){var i;return e?e.length=0:e=[],"#"==t.charAt(0)?t=t.substr(1):0===t.indexOf("0x")&&(t=t.substr(2)),8==t.length&&(i=t.substr(0,2),t=t.substr(2)),e.push(parseInt(t.substr(0,2),16)),e.push(parseInt(t.substr(2,2),16)),e.push(parseInt(t.substr(4,2),16)),i&&e.push(parseInt(i,16)),e},o.generateEase=function(t){var e=t.length,i=1/e;return function(r){var n,o,s=e*r|0;return n=(r-s*i)*e,(o=t[s]||t[e-1]).s+n*(2*(1-n)*(o.cp-o.s)+n*(o.e-o.s))}},o.getBlendMode=function(t){if(!t)return r.NORMAL;for(t=t.toUpperCase();t.indexOf(" ")>=0;)t=t.replace(" ","_");return r[t]||r.NORMAL},e.exports=o},{}],5:[function(require,module,exports){"use strict";var ParticleUtils=require("./ParticleUtils"),Particle=require("./Particle"),PathParticle=function(t){Particle.call(this,t),this.path=null,this.initialRotation=0,this.initialPosition=new PIXI.Point,this.movement=0},s=Particle.prototype,p=PathParticle.prototype=Object.create(s),helperPoint=new PIXI.Point;p.init=function(){this.initialRotation=this.rotation,this.Particle_init(),this.path=this.extraData.path,this._doNormalMovement=!this.path,this.movement=0,this.initialPosition.x=this.position.x,this.initialPosition.y=this.position.y};for(var MATH_FUNCS=["pow","sqrt","abs","floor","round","ceil","E","PI","sin","cos","tan","asin","acos","atan","atan2","log"],WHITELISTER="[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]",index=MATH_FUNCS.length-1;index>=0;--index)WHITELISTER+="|"+MATH_FUNCS[index];WHITELISTER=new RegExp(WHITELISTER,"g");var parsePath=function(pathString){for(var rtn,matches=pathString.match(WHITELISTER),i=matches.length-1;i>=0;--i)MATH_FUNCS.indexOf(matches[i])>=0&&(matches[i]="Math."+matches[i]);return pathString=matches.join(""),eval("rtn = function(x){ return "+pathString+"; };"),rtn};p.update=function(t){var e=this.Particle_update(t);if(e>=0&&this.path){var i=(this.endSpeed-this.startSpeed)*e+this.startSpeed;this.movement+=i*t,helperPoint.x=this.movement,helperPoint.y=this.path(this.movement),ParticleUtils.rotatePoint(this.initialRotation,helperPoint),this.position.x=this.initialPosition.x+helperPoint.x,this.position.y=this.initialPosition.y+helperPoint.y}},p.Particle_destroy=Particle.prototype.destroy,p.destroy=function(){this.Particle_destroy(),this.path=this.initialPosition=null},PathParticle.parseArt=function(t){return Particle.parseArt(t)},PathParticle.parseData=function(t){var e={};if(t&&t.path)try{e.path=parsePath(t.path)}catch(t){ParticleUtils.verbose&&console.error("PathParticle: error in parsing path expression"),e.path=null}else ParticleUtils.verbose&&console.error("PathParticle requires a path string in extraData!"),e.path=null;return e},module.exports=PathParticle},{"./Particle":3,"./ParticleUtils":4}],6:[function(t,e,i){},{}],7:[function(t,e,i){i.ParticleUtils=t("./ParticleUtils.js"),i.Particle=t("./Particle.js"),i.Emitter=t("./Emitter.js"),i.PathParticle=t("./PathParticle.js"),i.AnimatedParticle=t("./AnimatedParticle.js"),t("./deprecation.js")},{"./AnimatedParticle.js":1,"./Emitter.js":2,"./Particle.js":3,"./ParticleUtils.js":4,"./PathParticle.js":5,"./deprecation.js":6}],8:[function(t,e,i){"use strict";"undefined"!=typeof window?window:GLOBAL;if(PIXI.particles){if(void 0===PIXI)throw"pixi-particles requires pixi.js to be loaded first"}else PIXI.particles={};var r=t("./particles");for(var n in r)PIXI.particles[n]=r[n]},{"./particles":7,"pixi.js":void 0}]},{},[8])(8)})),function(){var t={linear:function(t,e,i,r){return i*t/r+e},quadIn:function(t,e,i,r){return i*(t/=r)*t+e},quadOut:function(t,e,i,r){return-i*(t/=r)*(t-2)+e},quadInOut:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},cubeIn:function(t,e,i,r){return i*(t/=r)*t*t+e},cubeOut:function(t,e,i,r){return t/=r,i*(--t*t*t+1)+e},cubeInOut:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},quartIn:function(t,e,i,r){return i*(t/=r)*t*t*t+e},quartOut:function(t,e,i,r){return t/=r,-i*(--t*t*t*t-1)+e},quartInOut:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},quintIn:function(t,e,i,r){return i*(t/=r)*t*t*t*t+e},quintOut:function(t,e,i,r){return t/=r,i*(--t*t*t*t*t+1)+e},quintInOut:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},sineIn:function(t,e,i,r){return-i*Math.cos(t/r*(Math.PI/2))+i+e},sineOut:function(t,e,i,r){return i*Math.sin(t/r*(Math.PI/2))+e},sineInOut:function(t,e,i,r){return-i/2*(Math.cos(Math.PI*t/r)-1)+e},expoIn:function(t,e,i,r){return i*Math.pow(2,10*(t/r-1))+e},expoOut:function(t,e,i,r){return i*(1-Math.pow(2,-10*t/r))+e},expoInOut:function(t,e,i,r){return(t/=r/2)<1?i/2*Math.pow(2,10*(t-1))+e:(t--,i/2*(2-Math.pow(2,-10*t))+e)},circIn:function(t,e,i,r){return t/=r,-i*(Math.sqrt(1-t*t)-1)+e},circOut:function(t,e,i,r){return t/=r,t--,i*Math.sqrt(1-t*t)+e},circInOut:function(t,e,i,r){return(t/=r/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:(t-=2,i/2*(Math.sqrt(1-t*t)+1)+e)}},e=function(t){return Math.round(100*t)/100};window.Tween=function(t,e,i,r,n){return this.startTime=Date.now(),this.startValue=t,this.distance=e,this.duration=i,this.animationType=r,this.loop=n,this},window.Tween.prototype.getValue=function(){if(this.expired())if(this.loop)if("repeat"===this.loop){this.startTime=Date.now();i=t[this.animationType](Date.now()-this.startTime,this.startValue,this.distance,this.duration)}else{this.startValue=this.startValue+this.distance,this.distance=-this.distance,this.startTime=Date.now();i=t[this.animationType](Date.now()-this.startTime,this.startValue,this.distance,this.duration)}else var i=this.startValue+this.distance;else var i=t[this.animationType](Date.now()-this.startTime,this.startValue,this.distance,this.duration);return e(i)},window.Tween.prototype.getStartTime=function(){return Date.now()-this.startTime-this.duration+Date.now()},window.Tween.prototype.expired=function(){return this.startTime+this.duration<Date.now()},window.Tween.prototype.set=function(t,e,i,r,n){return this.startValue=t||this.startValue,this.distance=e||this.distance,this.duration=i||this.duration,this.animationType=r||this.animationType,this.loop=n||this.loop,this},window.Tween.prototype.reset=function(){return this.startTime=Date.now(),this}}(),tagpro.particleDefinitions={tagproSparks:{alpha:{start:.75,end:0},scale:{start:0,end:.25,minimumScaleMultiplier:1},color:{start:"#83FF7A",end:"#00BB00"},speed:{start:30,end:30},acceleration:{x:0,y:0},startRotation:{min:0,max:360},rotationSpeed:{min:0,max:0},lifetime:{min:.1,max:.9},blendMode:"normal",frequency:.01,emitterLifetime:-1,maxParticles:50,pos:{x:20,y:20},addAtBack:!0,spawnType:"point",spawnCircle:{x:0,y:0,r:0}},explosion:{alpha:{start:.74,end:0},scale:{start:5,end:1,minimumScaleMultiplier:.1},color:{start:"#ffdfa0",end:"#100f0c"},speed:{start:1e3,end:0},acceleration:{x:0,y:0},startRotation:{min:0,max:360},rotationSpeed:{min:0,max:200},lifetime:{min:.25,max:.5},blendMode:"normal",ease:[{s:0,cp:.329,e:.548},{s:.548,cp:.767,e:.876},{s:.876,cp:.985,e:1}],frequency:.001,emitterLifetime:.1,maxParticles:50,pos:{x:0,y:0},addAtBack:!1,spawnType:"point"},playerEmitter:{alpha:{start:.85,end:0},scale:{start:.01,end:.2,minimumScaleMultiplier:1},color:{start:"#fff191",end:"#ff622c"},speed:{start:20,end:20},acceleration:{x:0,y:0},startRotation:{min:0,max:360},rotationSpeed:{min:50,max:50},lifetime:{min:.1,max:.75},blendMode:"normal",frequency:.001,emitterLifetime:-1,maxParticles:50,pos:{x:20,y:20},addAtBack:!1,spawnType:"circle",spawnCircle:{x:0,y:0,r:10}},death:{alpha:{start:.15,end:0},scale:{start:1.5,end:0},speed:{start:300,end:100},startRotation:{min:0,max:0},rotationSpeed:{min:0,max:0},lifetime:{min:.4,max:.4},frequency:.08,emitterLifetime:.17,maxParticles:50,pos:{x:0,y:0},addAtBack:!1,spawnType:"burst",particlesPerWave:16,particleSpacing:22.5,angleStart:0},rollingBomb:{alpha:{start:.45,end:0},scale:{start:.1,end:1.5,minimumScaleMultiplier:1},color:{start:"#85888d",end:"#100f0c"},speed:{start:1,end:50},acceleration:{x:0,y:0},startRotation:{min:0,max:360},rotationSpeed:{min:0,max:0},lifetime:{min:.5,max:2},blendMode:"normal",frequency:.001,emitterLifetime:-1,maxParticles:10,pos:{x:0,y:0},addAtBack:!1,spawnType:"circle",spawnCircle:{x:20,y:20,r:30}},gravityWell:{alpha:{start:0,end:1},scale:{start:.5,end:.15,minimumScaleMultiplier:1},color:{start:"#000000",end:"#000000"},speed:{start:1,end:500},acceleration:{x:0,y:0},startRotation:{min:180,max:180},rotationSpeed:{min:90,max:180},lifetime:{min:.9,max:1},blendMode:"normal",frequency:.025,emitterLifetime:-1,maxParticles:40,pos:{x:0,y:0},addAtBack:!1,spawnType:"ring",spawnCircle:{x:0,y:0,r:240,minR:240}},arcReactor:{alpha:{start:.25,end:0},scale:{start:.5,end:.25,minimumScaleMultiplier:1},color:{start:"#57d0d6",end:"#57d0d6"},speed:{start:0,end:0,minimumSpeedMultiplier:1},acceleration:{x:0,y:0},maxSpeed:0,startRotation:{min:0,max:0},noRotation:!0,rotationSpeed:{min:0,max:0},lifetime:{min:.1,max:.1},blendMode:"normal",frequency:.001,emitterLifetime:1,maxParticles:500,pos:{x:0,y:0},addAtBack:!1,spawnType:"point"},confettiPopperBlue:{alpha:{start:1,end:.5},scale:{start:.06,end:.12,minimumScaleMultiplier:.8},color:{start:"#00ff1e",end:"#7700ff"},speed:{start:300,end:-50,minimumSpeedMultiplier:.8},acceleration:{x:0,y:500},maxSpeed:0,startRotation:{min:275,max:340},noRotation:!0,lifetime:{min:.01,max:.4},blendMode:"normal",frequency:.001,emitterLifetime:2,maxParticles:1e3,pos:{x:0,y:0},addAtBack:!1,spawnType:"circle",spawnCircle:{x:1,y:0,r:4}},confettiPopperRed:{alpha:{start:1,end:.5},scale:{start:.06,end:.12,minimumScaleMultiplier:.8},color:{start:"#ff9900",end:"#ff00ff"},speed:{start:300,end:-50,minimumSpeedMultiplier:.8},acceleration:{x:0,y:500},maxSpeed:0,startRotation:{min:275,max:340},noRotation:!0,lifetime:{min:.01,max:.4},blendMode:"normal",frequency:.001,emitterLifetime:2,maxParticles:1e3,pos:{x:0,y:0},addAtBack:!1,spawnType:"circle",spawnCircle:{x:1,y:0,r:4}},eventMaster:{alpha:{start:1,end:1},scale:{start:.2,end:.4,minimumScaleMultiplier:.5},color:{start:"#f700ff",end:"#00ffc4"},speed:{start:80,end:-50,minimumSpeedMultiplier:.8},acceleration:{x:0,y:1},maxSpeed:0,startRotation:{min:0,max:0},noRotation:!1,rotationSpeed:{min:0,max:20},lifetime:{min:.5,max:.8},blendMode:"normal",frequency:.2,emitterLifetime:2,maxParticles:1e3,pos:{x:0,y:-5},addAtBack:!0,spawnType:"burst",particlesPerWave:8,particleSpacing:45,angleStart:0}},function(){if(void 0===window.performance&&(window.performance={}),!window.performance.now){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}}(),console.image=function(t,e){e=e||1;var i=new Image;i.onload=function(){var i,r,n=(i=this.width*e,r=this.height*e,{string:"+",style:"font-size: 1px; padding: "+Math.floor(r/2)+"px "+Math.floor(i/2)+"px; line-height: "+r+"px;"});console.log("%c"+n.string,n.style+"background: url("+t+"); background-size: "+this.width*e+"px "+this.height*e+"px; color: transparent;")},i.src=t},tagpro.ready(createRenderer),PIXI.SpriteClip=function(t){PIXI.extras.AnimatedSprite.call(this,t),this.fps=4,this.lastUpdate=performance.now()},PIXI.SpriteClip.prototype=Object.create(PIXI.extras.AnimatedSprite.prototype),PIXI.SpriteClip.prototype.constructor=PIXI.SpriteClip,PIXI.SpriteClip.prototype.update=function(){var t=this.currentFrame,e=performance.now(),i=Math.min(e-this.lastUpdate,100);this.lastUpdate=e,this._currentTime+=this.fps*i/1e3,this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):t!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<t||this.animationSpeed<0&&this.currentFrame>t)&&this.onLoop(),this.updateTexture())},tagpro.createPNGRenderer=function(){var t=40,e={};return tagpro.renderer=e,tagpro.preRendererOptions=tagpro.preRendererOptions||{},tagpro.viewport={followPlayer:!0,centerLock:!1,source:{x:0,y:0}},tagpro.zooming=0,$.cookie.json=!0,PIXI.dontSayHello=!0,e.options={disableParticles:!!$.cookie("disableParticles"),forceCanvasRenderer:!!$.cookie("forceCanvasRenderer"),disableViewportScaling:!!$.cookie("disableViewportScaling"),disableBallSpin:!!$.cookie("disableBallSpin"),disableSplats:!1,transparent:!1},Object.assign(e.options,tagpro.preRendererOptions),e.particleDefinitions=tagpro.particleDefinitions,e.canvas=$("#viewport").get(0),e.stage=new PIXI.Container,e.canvas_width=1280,e.canvas_height=800,e.layers={},e.dynamicSprites={},e.frameRates=[],e.emitters=[],e.explosions=[],e.fadingSplats=[],e.frameCount=0,e.zoomThreshold=1.4,e.debug=!1,e.sayHello=function(){console.image("//"+location.host+"/images/console.png"),console.log("TagPro version "+tagpro.version);var t=e.renderer.type===PIXI.WEBGL_RENDERER?"WebGL":"Canvas";console.log("Powered by PixiJS. Currently running in "+t+" mode"),console.log("Developers: LuckySpammer, steppin, NewCompte, AnkhMorpork, Ly, ylambda")},e.resizeView=function(){if(e.renderer){var t,i,r=$(window),n=r.outerWidth(),o=r.outerHeight();n>e.canvas_width&&(n=e.canvas_width),o>e.canvas_height&&(o=e.canvas_height),t=0,(i=Math.round(n*e.canvas_height/e.canvas_width))>o?(t=Math.round(o*e.canvas_width/e.canvas_height),i=o):t=n,e.renderer.resize(t,i)}},e.resizeAndCenterView=function(){e.resizeView(),e.centerView()},e.centerView=function(){var t=$("#viewport"),i=$("#viewportDiv"),r=$(window).height(),n=$(window).width(),o=$("#options");t.css({position:"absolute",left:(n-t.outerWidth())/2,top:(r-t.outerHeight())/2}),i.css({position:"absolute",width:t.outerWidth(),height:t.outerHeight(),left:(n-t.outerWidth())/2,top:(r-t.outerHeight())/2});var s=($(window).height()-o.height())/2-200;o.css({position:"absolute",left:($(window).width()-o.width())/2,top:s<100?100:s}),tagpro.ui.resize(t.width(),t.height()),e.vpWidth=t.width(),e.vpHeight=t.height(),tagpro.chat.resize()},e.start=function(){e.renderer=e.createRenderer(),e.sayHello(),$(window).resize(e.resizeAndCenterView),e.resizeAndCenterView(),e.particleTexture=e.createParticle("#particle"),e.particleFireTexture=e.createParticle("#particleFire"),e.eventMasterTexture=PIXI.Texture.fromImage("//"+location.host+"/images/eventmaster.png"),e.gameContainer=e.createGameContainer(e.stage),e.createBackground(e.gameContainer)},e.destroyPlayer=function(t){if(t.sprites){var i,r,n=e.emitters.indexOf(t.sprites.emitter);for(i in-1!==n&&e.emitters.splice(n,1),t.sprites.emitter&&(t.sprites.emitter.destroy(),t.sprites.emitter=null),t.sprite&&t.sprite.parent.removeChild(t.sprite),t.sprites)t.sprites.hasOwnProperty(i)&&(r=t.sprites[i])&&r.parent.removeChild(r)}},e.measurePerformance=function(){e.frameCount+=1;var t=performance.now();if(e.lastFrameTime){var i=1e3/(t-e.lastFrameTime);isFinite(i)&&e.frameRates.push(i),e.frameRates.length>300&&e.frameRates.shift()}if(e.frameRates.length>=60){var r=e.frameRates.reduce((function(t,e){return t+e}));tagpro.fps=5*Math.round(r/e.frameRates.length/5)}else tagpro.fps=0},e.render=function(){requestAnimationFrame(e.render),e.replayReset(),tagpro.world.update(),e.updateGraphics(),tagpro.ui.update(),e.renderer.render(e.stage),e.measurePerformance(),e.lastFrameTime=performance.now()},e.createLayers=function(){e.createMidground(e.gameContainer),e.createForeground(e.gameContainer),e.createOverlay(e.gameContainer),e.createUI(e.gameContainer)},e.createRenderer=function(){var t={view:e.canvas,antialias:!0,transparent:!!e.options.transparent,width:e.canvas_width,height:e.canvas_height};return e.options.forceCanvasRenderer?new PIXI.CanvasRenderer(t):PIXI.autoDetectRenderer(t)},e.createMidground=function(t){e.layers.midground||(e.layers.midground=new PIXI.Container,e.layers.splats=new PIXI.particles.ParticleContainer,e.layers.midground.addChild(e.layers.splats)),t.addChild(e.layers.midground)},e.createOverlay=function(t){e.layers.overlay=new PIXI.particles.ParticleContainer,t.addChild(e.layers.overlay)},e.createGameContainer=function(t){var e=new PIXI.Container;return t.addChild(e),e},e.createBackground=function(){e.layers.background=new PIXI.Container,e.createLayers(),e.drawBackground()},e.createForeground=function(t){e.layers.foreground||(e.layers.foreground=new PIXI.Container),t.addChild(e.layers.foreground)},e.createUI=function(){e.layers.ui=new PIXI.Container,e.stage.addChild(e.layers.ui)},e.clearBackground=function(){e.layers.background.removeChildren()},e.readyToDrawBackground=function(){return tagpro.map&&tagpro.tiles.image},e.drawMarsball=function(t,i){tagpro.spectator&&(t.draw=!0),t.sprite=tagpro.tiles.draw(e.layers.foreground,"marsball",i,80,80),t.sprite.keep=!0,t.draw||(t.sprite.visible=!1)},e.createGravityWellEmitter=function(t,i){if(e.options.disableParticles){var r=new PIXI.Graphics;r.alpha=.075,r.beginFill(0).drawCircle(t,i,260),e.layers.foreground.addChild(r)}else{var n=new PIXI.particles.Emitter(e.layers.foreground,[e.particleTexture,e.particleFireTexture],tagpro.particleDefinitions.gravityWell);n.updateSpawnPos(t,i),e.emitters.push(n)}},e.drawBackgroundTiles=function(i){for(var r={x:0,y:0},n=0,o=tagpro.map.length;n!==o;n++){r.x=n*t;for(var s=0,a=tagpro.map[0].length;s!==a;s++)r.y=s*t,tagpro.tiles.drawLayers(i,n,s,r,e.layers.midground),22===tagpro.map[n][s]&&(e.createGravityWellEmitter(r.x+20,r.y+20),tagpro.world.createGravityWell(.4*n,.4*s))}e.afterDrawBackground()},e.afterDrawBackground=function(){},e.drawStartingSplats=function(){if(tagpro.map.splats)for(var t=0;t<tagpro.map.splats.length;t++){var i=tagpro.map.splats[t];e.drawSplat(i.x,i.y,i.t)}},e.drawBackground=function(){if(!e.readyToDrawBackground())return setTimeout(e.drawBackground,0),!1;e.drawBackgroundTiles(e.layers.background),e.createBackgroundTexture(e.layers.background),e.layers.backgroundDrawn||(e.gameContainer.addChildAt(e.layers.background,0),e.drawStartingSplats(),requestAnimationFrame(e.render)),e.drawDynamicTiles(),e.layers.backgroundDrawn=!0,tagpro.chat.resize()},e.drawDynamicTile=function(i,r){var n=tagpro.tiles[tagpro.map[i][r]];if(n){var o,s={x:i*t,y:r*t};if(n instanceof PIXI.extras.AnimatedSprite||n.frameTiles)o=e.drawAnimation(n,s);else{if(!n.dynamic)return;o=tagpro.tiles.draw(e.layers.midground,tagpro.map[i][r],s)}22==tagpro.map[i][r]&&((s={x:0,y:0}).x=i*t,s.y=r*t,e.createGravityWellEmitter(s.x+20,s.y+20)),e.dynamicSprites[i]||(e.dynamicSprites[i]={}),e.dynamicSprites[i][r]=o}},e.drawDynamicTiles=function(){for(var t=0;t<tagpro.map.length;t++)for(var i=0;i<tagpro.map[0].length;i++)e.drawDynamicTile(t,i)},e.drawAnimation=function(t,i){var r=t.textures||t.frameTiles.map((function(t){return tagpro.tiles.getTexture(t)})),n=new PIXI.SpriteClip(r);return n.x=i.x,n.y=i.y,n.alpha=t.alpha,t.blink?n.fps=4:n.fps=6+Math.random()/10,n.play(),e.layers.midground.addChild(n),n},e.chunkifyBackground=function(i){e.backgroundChunks=[];var r=i.baseTexture,n=tagpro.map.length*t,o=tagpro.map[0].length*t,s=1024;if(e.renderer.gl){var a=e.renderer.gl.getParameter(e.renderer.gl.MAX_TEXTURE_SIZE);s>a&&(s=Math.pow(2,Math.round(Math.log(a/2)/Math.log(2))),console.log("Chunk size was too large. Reducing to closest power of two below gl.MAX_TEXTURE_SIZE, which is "+s))}e.layers.background.removeChildren();for(var l=0;l<n;l+=s)for(var h=0;h<o;h+=s){var c=l+s>n?n-l:s,u=h+s>o?o-h:s,p=document.createElement("canvas");p.width=p.height=s,p.getContext("2d").drawImage(r.source,l,h,c,u,0,0,c,u);var d=PIXI.Texture.fromCanvas(p),m=new PIXI.Sprite(d);m.x=l,m.y=h,e.backgroundChunks.push(m),e.layers.background.addChild(m)}},e.createBackgroundTexture=function(i){var r=PIXI.RenderTexture.create(tagpro.map.length*t,tagpro.map[0].length*t);(new PIXI.CanvasRenderer).render(i,r),e.chunkifyBackground(r)},e.updateDeathStatus=function(t,e){t.toUpdate&&(e.x=-1e3,e.y=-1e3,t.sprite.x=-1e3,t.sprite.y=-1e3,t.toUpdate=!1)},e.getLockedPosition=function(t){return{x:t.x,y:t.y}},e.updatePlayerColor=function(t){var e=tagpro.events.ballSpriteTile?tagpro.events.ballSpriteTile[0].ballSpriteTile(t):1===t.team?"redball":"blueball";if(t.sprites.actualBall.tileId!==e){var i=tagpro.tiles.getTexture(e),r=new PIXI.Texture(i);t.sprites.actualBall.texture=r,t.sprites.actualBall.tileId=e}},e.drawPlayer=function(t,i){tagpro.spectator&&(t.draw=!0);var r=e.getLockedPosition(t);return e.updateFlagsFromPlayer(t),e.updatePlayerSpritePosition(t),e.updateDeathStatus(t,r),e.updatePlayerFlag(t,r),e.updatePlayerPowerUps(t,i,r),e.updatePlayerVisibility(t),e.updatePlayerColor(t),tagpro.events.afterDrawPlayer&&tagpro.events.afterDrawPlayer.forEach((function(e){e.afterDrawPlayer(t)})),r},e.drawPlayers=function(t){for(var i in tagpro.players)if(tagpro.players.hasOwnProperty(i)){var r=tagpro.players[i];e.drawPlayer(r,t)}},e.drawDegree=function(t){tagpro.settings.ui.degrees&&(!t.sprites.degrees&&t.degree&&(t.sprites.degrees=e.veryPrettyText(t.degree+"Â°"),t.sprites.info.addChild(t.sprites.degrees)),t.sprites.degrees&&(t.sprites.degrees.x=25,t.sprites.degrees.y=-10))},e.prettyText=function(t,e){return new PIXI.Text(t,{fontFamily:"Arial",fontSize:"8pt",fontWeight:"bold",fill:e||"#FFFFFF",stroke:"#000000",strokeThickness:3,lineJoin:"round"})},e.veryPrettyText=function(t,e){var i=document.createElement("canvas");i.width=128,i.height=32;var r=i.getContext("2d");r.clearRect(0,0,i.width,i.height),r.font="bold 11px arial",r.fillStyle=e||"#ffffff",r.strokeStyle="#000000",r.shadowColor="#000000",r.shadowOffsetX=0,r.shadowOffsetY=0,r.lineWidth=2,r.shadowBlur=10,r.strokeText(t,16,16),r.shadowBlur=0,r.fillText(t,16,16);var n=PIXI.Texture.fromCanvas(i);return new PIXI.Sprite(n)},e.largeText=function(t,e){return new PIXI.Text(t,{fontFamily:"Arial",fontSize:"48pt",fontWeight:"bold",fill:e||"#ffffff",stroke:"black",strokeThickness:3,lineJoin:"round"})},e.drawName=function(t,i){if(!t.sprites.name||i){if(t.sprites.name&&t.sprites.info.removeChild(t.sprites.name),!tagpro.settings.ui.names)return;var r=t.auth?"#BFFF00":"#ffffff";t.sprites.name=e.veryPrettyText(t.name,r),t.sprites.info.addChild(t.sprites.name)}t.sprites.name.x=20,t.sprites.name.y=-21,t.sprites.name.visible=!!tagpro.settings.ui.names},e.getFlairTexture=function(t,e){var i=PIXI.utils.TextureCache[t];if(!i){var r=document.createElement("canvas");r.width=16,r.height=16,r.getContext("2d").drawImage($("#flair").get(0),16*e.x,16*e.y,16,16,0,0,16,16),i=PIXI.Texture.fromCanvas(r),PIXI.utils.TextureCache[t]=i}return i},e.addConfetti=function(t){var e=new PIXI.Graphics,i=[0,0,1,1,2,3],r=i[Math.floor(Math.random()*i.length)];e.beginFill(1===t.team?[16750848,16711935,16774912,15728640][r]:[65310,7799039,16774912,15615][r]).drawCircle(0,0,1);var n=5+9*Math.random(),o=2+Math.random()*(n-3);e.position={x:n,y:o},t.sprites.flair.addChild(e)},e.clearConfetti=function(t){for(;t.sprites.flair.children[0];)t.sprites.flair.removeChild(t.sprites.flair.children[0])},e.emitConfetti=function(t,i){t.flairEmitter&&t.flairEmitter.timeoutID&&(t.flairEmitter.emit=!1,clearTimeout(t.flairEmitter.timeoutID));var r=new PIXI.particles.Emitter(e.layers.foreground,[e.particleTexture],1===t.team?tagpro.particleDefinitions.confettiPopperRed:tagpro.particleDefinitions.confettiPopperBlue);e.emitters.push(r),t.flairEmitter=r,t.flairEmitter.emit=!0,e.clearConfetti(t),i&&(t.flairEmitter.timeoutID=setTimeout((function(t){t.flairEmitter.emit=!1}),2e3,t))},e.emitEventMaster=function(t,i){t.flairEmitter&&t.flairEmitter.timeoutID&&(t.flairEmitter.emit=!1,clearTimeout(t.flairEmitter.timeoutID));var r=new PIXI.particles.Emitter(e.layers.foreground,[e.eventMasterTexture],tagpro.particleDefinitions.eventMaster);e.emitters.push(r),t.flairEmitter=r,t.flairEmitter.emit=!0,i&&(t.flairEmitter.timeoutID=setTimeout((function(t){t.flairEmitter.emit=!1}),2e3,t))},e.animateFlairWin=function(t){!e.options.disableParticles&&t.flair&&"special.supporter7"===t.flair.key?e.emitConfetti(t,!1):e.options.disableParticles||!t.flair||"special.eventmaster"!==t.flair.key&&"special.flairz1"!==t.flair.key&&"special.flairz2"!==t.flair.key||e.emitEventMaster(t,!1)},e.rgbToHex=function(t,e,i){return"0x"+(1<<24|(t=Math.floor(t))<<16|(e=Math.floor(e))<<8|(i=Math.floor(i))).toString(16).slice(1)},e.interpolateSinebow=function(t){return e.rgbToHex(255*Math.pow(Math.sin(Math.PI*t),2),255*Math.pow(Math.sin(Math.PI*(t+1/3)),2),255*Math.pow(Math.sin(Math.PI*(t+2/3)),2))},e.drawFlair=function(t){if(tagpro.settings.ui.flairs){if(t.sprites.flair&&t.sprites.flair.flairName!==t.flair&&(t.sprites.info.removeChild(t.sprites.flair),t.sprites.flair=null),t.flair&&!t.sprites.flair){var i="flair-"+t.flair.x+","+t.flair.y,r=e.getFlairTexture(i,t.flair);if(t.sprites.flair=new PIXI.Sprite(r),t.sprites.flair.pivot.x=8,t.sprites.flair.pivot.y=8,t.sprites.flair.x=20,t.sprites.flair.y=-9,t.sprites.info.addChild(t.sprites.flair),t.sprites.flair.flairName=t.flair,t.sprites.rotation=0,t.rotateFlairSpeed=0,"degree.arcreactor"===t.flair.key&&!e.options.disableParticles){var n=new PIXI.particles.Emitter(e.layers.midground,[e.particleTexture],tagpro.particleDefinitions.arcReactor);e.emitters.push(n),t.flairEmitter=n,t.flairEmitter.keep=!0,t.flairEmitter.always=!0,t.flairEmitter.emit=!0}}if(t.lastFrame||(t.lastFrame={"s-tags":t["s-tags"],"s-powerups":t["s-powerups"],"s-captures":t["s-captures"]}),!t.sprites.flair||"special.supporter4"!==t.flair.key&&"special.supporter5"!==t.flair.key&&"special.supporter6"!==t.flair.key||(t.lastFrame["s-captures"]===t["s-captures"]&&t.lastFrame["s-tags"]===t["s-tags"]||(t.tween=new Tween(.4,-.38,4e3,"quadOut"),t.rotateFlairSpeed=t.tween.getValue()),t.rotateFlairSpeed>.02&&(t.rotateFlairSpeed=t.tween.getValue()),t.rotateFlairSpeed=Math.max(.02,t.rotateFlairSpeed),t.sprites.flair.rotation+=t.rotateFlairSpeed,t.lastFrame["s-tags"]=t["s-tags"]),t.flair&&"special.supporter5"===t.flair.key&&(t.scaleTween||(t.scaleTween=new Tween(0,-.4,2500,"sineInOut",!0)),t.sprites.flair.scale.x=t.sprites.flair.scale.y=1+t.scaleTween.getValue()),t.flair&&"special.supporter6"===t.flair.key&&(t.rainbow||(t.rainbow=0),t.sprites.flair.tint=e.interpolateSinebow(t.rainbow),t.rainbow+=.002),!e.options.disableCapAnimations&&t.lastFrame["s-captures"]!==t["s-captures"])for(var o in tagpro.players)if(tagpro.players.hasOwnProperty(o)){var s=tagpro.players[o];s.team===t.team&&s.flair&&"special.supporter7"===s.flair.key?e.options.disableParticles?e.clearConfetti(s):e.emitConfetti(s,!0):s.team!==t.team||!s.flair||"special.eventmaster"!==s.flair.key&&"special.flairz1"!==s.flair.key&&"special.flairz2"!==s.flair.key||e.options.disableParticles||e.emitEventMaster(s,!0)}if(t.flair&&"special.supporter7"===t.flair.key){if(t.lastFrame["s-tags"]!==t["s-tags"]||t.lastFrame["s-powerups"]!==t["s-powerups"])for(var a=Math.floor(5*Math.random())+1,l=0;l<a;l++)e.addConfetti(t);t.lastFrame["s-tags"]=t["s-tags"],t.lastFrame["s-powerups"]=t["s-powerups"]}if(t.lastFrame["s-captures"]=t["s-captures"],!t.flair&&t.sprites.flair&&t.sprites.info.removeChild(t.sprites.flair),t.flairEmitter){var h=(t.flairEmitter.emit||t.flairEmitter.always)&&t.sprite.visible&&!t.dead;t.flairEmitter.emit=h,t.flairEmitter.updateOwnerPos(t.x+20,t.y-9),h&&t.flairEmitter.resetPositionTracking()}}},e.createParticle=function(t){var e=document.createElement("canvas"),i=$(t)[0];return e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0),PIXI.Texture.fromCanvas(e)},e.createExplosion=function(t,i){if(e.options.disableParticles){var r=new PIXI.Graphics;r.tagpro={started:performance.now(),length:150,x:t,y:i,size:200},e.layers.foreground.addChild(r),e.explosions.push(r)}else{var n=new PIXI.particles.Emitter(e.layers.foreground,[e.particleTexture],tagpro.particleDefinitions.explosion);n.updateSpawnPos(t+20,i+20),e.emitters.push(n)}},e.updateExplosions=function(){if(e.options.disableParticles){var t=performance.now();e.explosions.slice().forEach((function(i){var r=t-i.tagpro.started;if(r>=i.tagpro.length)return e.layers.foreground.removeChild(i),void e.explosions.splice(e.explosions.indexOf(i),1);var n=i.tagpro.size*(r/i.tagpro.length);i.alpha=1-r/i.tagpro.length,i.clear().beginFill(i.tagpro.color||16776960).drawCircle(i.tagpro.x+20,i.tagpro.y+20,n)}))}},e.updateFadingSplats=function(){var t=performance.now();e.fadingSplats.slice().forEach((function(i){if(t>=i.fadeUntil)return e.layers.splats.removeChild(i),void e.fadingSplats.splice(e.fadingSplats.indexOf(i),1);i.alpha=1-(t-i.fadeStart)/(i.fadeUntil-i.fadeStart)}))},e.startDeathEmitter=function(t,i,r,n){if(!e.options.disableParticles){var o=new PIXI.particles.Emitter(e.layers.foreground,[e.particleTexture],tagpro.particleDefinitions.death);o.startColor=PIXI.particles.ParticleUtils.hexToRGB(t),o.stopColor=PIXI.particles.ParticleUtils.hexToRGB(i),o.updateSpawnPos(r,n),e.emitters.push(o)}},e.drawBallPop=function(t,i,r){var n=new PIXI.Graphics,o=tagpro.events.ballPopColor?tagpro.events.ballPopColor[0].ballPopColor(r):1===r?16711680:255;n.tagpro={started:performance.now(),length:150,x:t-20,y:i-20,size:60,color:o},e.layers.foreground.addChild(n),e.explosions.push(n)},e.drawSplat=function(t,i,r,n,o,s){var a=tagpro.events.ballPopColor?tagpro.events.ballPopColor[0].ballPopColor(r):1===r?"ff0000":"0000ff";n&&(e.options.disableParticles?e.drawBallPop(t+19,i+19,r):e.startDeathEmitter(a,"ffffff",t+19,i+19)),e.addSplat(r,t,i,o,s)},e.addSplat=function(t,i,r,n,o){if(!e.options.disableSplats){var s=Math.floor(Math.random()*tagpro.tiles.splats.red.length),a=(1===t?tagpro.tiles.splats.red:tagpro.tiles.splats.blue)[s],l=new PIXI.Sprite(a);l.x=i+20,l.y=r+20,l.width=90*(.8+.2*Math.random()),l.height=90*(.8+.2*Math.random()),l.anchor.x=.5,l.anchor.y=.5,o&&(l.scale.x=o,l.scale.y=o),l.rotation=2*Math.random()*Math.PI,l.alpha=1,n&&(l.fadeStart=performance.now(),l.fadeUntil=l.fadeStart+5e3,e.fadingSplats.push(l)),e.layers.splats.addChild(l)}},e.createPlayerEmitter=function(t){e.options.disableParticles||(t.sprites.emitter=new PIXI.particles.Emitter(e.layers.midground,[e.particleTexture,e.particleFireTexture],tagpro.particleDefinitions.playerEmitter),t.sprites.emitter.keep=!0,e.emitters.push(t.sprites.emitter),t.sprites.emitter.emit=!1)},e.updateMarsBall=function(t,i){t.sprite||e.drawMarsball(t,i),t.draw?t.sprite.visible=!0:t.sprite.visible=!!tagpro.spectator,t.sprite.x=i.x,t.sprite.y=i.y},e.updateObjects=function(){for(var t in tagpro.objects)if(tagpro.objects.hasOwnProperty(t)){var i=tagpro.objects[t],r={x:Math.round(i.x-20),y:Math.round(i.y-20)};e.updateMarsBall(i,r)}},e.replayReset=function(){if(tagpro.replayReset){e.layers.splats.removeChildren();let t=tagpro.replayData.map;for(let i=0;i<t.length;i++)for(let r=0;r<t[i].length;r++)e.updateDynamicTile({x:i,y:r,v:t[i][r]});tagpro.replayReset=!1}},e.updateGraphics=function(){e.updatePlayers(),e.updateExplosions(),e.updateFadingSplats(),e.updateCamera(),e.updateObjects(),e.updateBackgroundVisibility(),e.options.disableParticles||e.updateEmitters()},e.checkIfVisible=function(){return!0},e.updateBackgroundVisibility=function(){for(var t=0;t<e.backgroundChunks.length;t++){var i=e.backgroundChunks[t];i&&(i.visible=e.checkIfVisible(i.x,i.y,i.width,i.height))}},e.centerContainerToPoint=function(t,i){var r=e.options.disableViewportScaling?1:(this.vpHeight/e.canvas_height).toFixed(2);e.gameContainer.x=this.vpWidth/2-t/tagpro.zoom*r,e.gameContainer.y=this.vpHeight/2-i/tagpro.zoom*r},e.updateCameraPosition=function(t){-1e3!==t.sprite.x&&-1e3!==t.sprite.y&&e.centerContainerToPoint(t.sprite.x+19,t.sprite.y+19)},e.updateCameraZoom=function(){var t=e.options.disableViewportScaling?1:this.vpHeight/e.canvas_height;tagpro.spectator?tagpro.zoom=tagpro.zoom+tagpro.zooming>.1?tagpro.zoom+tagpro.zooming:tagpro.zoom:tagpro.zoom=1;var i=new PIXI.Point(1/tagpro.zoom*t,1/tagpro.zoom*t),r=new PIXI.Point(tagpro.zoom,tagpro.zoom);for(var n in e.gameContainer.scale=i,tagpro.players)if(tagpro.players.hasOwnProperty(n)){var o=tagpro.players[n],s=o.sprites.info;if(s.x=19-19*tagpro.zoom,s.scale=r,o.sprites){var a=tagpro.zoom<e.zoomThreshold;o.sprites.flair&&(o.sprites.flair.visible=a),o.sprites.degrees&&(o.sprites.degrees.visible=a)}}},e.centerCameraPosition=function(){var i=tagpro.map.length||0,r=tagpro.map[0]?tagpro.map[0].length:0;e.centerContainerToPoint(i/2*t,r/2*t)},e.updateCamera=function(t){t=t||tagpro.playerId;var i=tagpro.players[t];e.updateCameraZoom(),tagpro.viewport.followPlayer&&i?e.updateCameraPosition(i):e.centerCameraPosition()},e.resetFlagStatuses=function(){tagpro.ui.blueFlagTaken=!1,tagpro.ui.redFlagTaken=!1,tagpro.ui.yellowFlagTakenByRed=!1,tagpro.ui.yellowFlagTakenByBlue=!1,tagpro.ui.bluePotatoTaken=!1,tagpro.ui.redPotatoTaken=!1,tagpro.ui.yellowPotatoTakenByRed=!1,tagpro.ui.yellowPotatoTakenByBlue=!1},e.updateFlagsFromPlayer=function(t){t.flag&&(t.potatoFlag?(tagpro.ui.bluePotatoTaken=tagpro.ui.bluePotatoTaken||2===t.flag,tagpro.ui.redPotatoTaken=tagpro.ui.redPotatoTaken||1===t.flag,tagpro.ui.yellowPotatoTakenByRed=tagpro.ui.yellowPotatoTakenByRed||1===t.team&&3===t.flag,tagpro.ui.yellowPotatoTakenByBlue=tagpro.ui.yellowPotatoTakenByBlue||2===t.team&&3===t.flag):(tagpro.ui.blueFlagTaken=tagpro.ui.blueFlagTaken||2===t.flag,tagpro.ui.redFlagTaken=tagpro.ui.redFlagTaken||1===t.flag,tagpro.ui.yellowFlagTakenByRed=tagpro.ui.yellowFlagTakenByRed||1===t.team&&3===t.flag,tagpro.ui.yellowFlagTakenByBlue=tagpro.ui.yellowFlagTakenByBlue||2===t.team&&3===t.flag))},e.setupPlayerSprites=function(t){t.sprites={tagpro:null,grip:null,flag:null,ball:null,bomb:null}},e.createBallSprite=function(t){var e=tagpro.events.ballSpriteTile?tagpro.events.ballSpriteTile[0].ballSpriteTile(t):1===t.team?"redball":"blueball";t.sprites.actualBall=tagpro.tiles.draw(t.sprites.ball,e,{x:20,y:20}),t.sprites.actualBall.anchor.x=.5,t.sprites.actualBall.anchor.y=.5,t.sprites.actualBall.tileId=e},e.addPlayerSprite=function(t){e.createBallSprite(t),e.layers.foreground.addChild(t.sprite)},e.createPlayerSprite=function(t){t.sprite=new PIXI.Container,t.sprites.ball=new PIXI.Container,t.sprite.addChild(t.sprites.ball),t.sprite.interactive=!0,t.sprite.click=function(){tagpro.kick.player(t)},t.sprite.id=t.id,e.addPlayerSprite(t)},e.updatePlayerSpritePosition=function(t){t.sprite.x=t.x,t.sprite.y=t.y,e.options.disableBallSpin||(t.sprites.actualBall.rotation=t.angle)},e.checkSelfDestruct=function(t){if(t.sprites.flag&&t.selfDestructSoon&&!t.sprites.selfDestructSoon)e.options.disableParticles||(t.sprites.selfDestructSoon=new PIXI.particles.Emitter(t.sprites.flag,[e.particleTexture],tagpro.particleDefinitions.rollingBomb),e.emitters.push(t.sprites.selfDestructSoon));else if(!t.selfDestructSoon&&t.sprites.selfDestructSoon){t.sprites.selfDestructSoon.emit=!1,t.sprites.flag.removeChild(t.sprites.selfDestructSoon);var i=e.emitters.indexOf(t.sprites.selfDestructSoon);e.emitters.splice(i,1),t.sprites.selfDestructSoon.destroy(),t.sprites.selfDestructSoon=null}},e.updatePlayerFlag=function(t){var i;t.sprites.flagLayer||(t.sprites.flagLayer=new PIXI.Container,t.sprites.info.addChildAt(t.sprites.flagLayer,0)),e.checkSelfDestruct(t),t.flag?(1===t.flag?i=t.potatoFlag?"redpotato":"redflag":2===t.flag?i=t.potatoFlag?"bluepotato":"blueflag":3===t.flag&&(i=t.potatoFlag?"yellowpotato":"yellowflag"),t.sprites.flag&&t.sprites.flag.name===i||(t.sprites.flag=tagpro.tiles.draw(t.sprites.flagLayer,i,{x:13,y:-32},null,null,null,!0),t.sprites.flag.name=i)):t.sprites.flag&&(t.sprites.flagLayer.removeChild(t.sprites.flag),t.sprites.flag=null)},e.updateGrip=function(t,e,i){t.grip?t.sprites.grip?(t.sprites.grip.x=i.x,t.sprites.grip.y=i.y+23):t.sprites.grip=tagpro.tiles.draw(e,"grip",{x:i.x,y:i.y+23},17,17):t.sprites.grip&&(e.removeChild(t.sprites.grip),t.sprites.grip=null)},e.updateTagpro=function(t){if(t.tagpro){if(!t.sprites.tagproTint){var i=t.sprites.tagproTint=new PIXI.Graphics;tagpro.events.fillTagproEffect?tagpro.events.fillTagproEffect[0].fillTagproEffect(i):i.beginFill(65280,.25).lineStyle(2,65280).drawCircle(20,20,20),t.sprites.ball.addChild(i),e.options.disableParticles||(t.sprites.tagproSparks=new PIXI.particles.Emitter(t.sprites.ball,[e.particleFireTexture],tagpro.particleDefinitions.tagproSparks),t.sprites.tagproSparks.player=t.id,e.emitters.push(t.sprites.tagproSparks))}}else if(t.sprites.tagproTint&&(t.sprites.ball.removeChild(t.sprites.tagproTint),t.sprites.tagproTint=null),t.sprites.tagproSparks){t.sprites.tagproSparks.emit=!1;var r=e.emitters.indexOf(t.sprites.tagproSparks);e.emitters.splice(r,1),t.sprites.tagproSparks.destroy(),t.sprites.tagproSparks=null}},e.updateRollingBomb=function(t){if(t.bomb)if(t.sprites.bomb)t.sprites.bomb.alpha=Math.abs(.75*Math.sin(performance.now()/150));else{e.options.disableParticles||(t.sprites.rollingBomb=new PIXI.particles.Emitter(t.sprites.ball,[e.particleTexture],tagpro.particleDefinitions.rollingBomb),e.emitters.push(t.sprites.rollingBomb));var i=t.sprites.bomb=new PIXI.Graphics;tagpro.events.fillRollingBombEffect?tagpro.events.fillRollingBombEffect[0].fillRollingBombEffect(i):i.beginFill(16776960,.75).drawCircle(20,20,20),t.sprites.ball.addChild(i)}else t.sprites.bomb&&(t.sprites.ball.removeChild(t.sprites.bomb),t.sprites.bomb=null),t.sprites.rollingBomb&&(t.sprites.rollingBomb instanceof PIXI.particles.Emitter?(t.sprites.rollingBomb.emit=!1,e.emitters.splice(e.emitters.indexOf(t.sprites.rollingBomb),1),t.sprites.rollingBomb.destroy()):t.sprites.rollingBomb.visible=!1,t.sprites.rollingBomb=null)},e.updatePlayerPowerUps=function(t,i,r){e.updateGrip(t,i,r),e.updateTagpro(t),e.updateRollingBomb(t)},e.updatePlayerVisibility=function(t){for(var e in t.sprites)if(t.sprites.hasOwnProperty(e)){var i=t.sprites[e];i&&(i.visible=t.sprite.visible)}},e.updatePlayerEmitter=function(t){var e=t.sprite.visible&&!t.dead&&(t.ac>.025||(t.speed||0)>1.5*t.ms),i=e&&!t.sprites.emitter.emit;t.sprites.emitter.emit=e,t.sprites.emitter.updateOwnerPos(t.x,t.y),i&&t.sprites.emitter.resetPositionTracking()},e.updatePlayer=function(t){if(t.sprites||e.setupPlayerSprites(t),t.sprite||e.createPlayerSprite(t),t.sprites.emitter||e.createPlayerEmitter(t),t.sprite.visible||!t.draw||t.dead||(t.toUpdate=!0),!t.sprites.info){var i=t.sprites.info=new PIXI.Container;t.sprite.addChild(i)}t.sprite.visible=!!t.draw&&!t.dead,e.drawDegree(t),e.drawName(t),e.drawFlair(t),e.options.disableParticles||e.updatePlayerEmitter(t)},e.updatePlayers=function(){for(var t in e.resetFlagStatuses(),tagpro.events.beforeUpdatePlayers&&tagpro.events.beforeUpdatePlayers.forEach((function(t){t.beforeUpdatePlayers()})),tagpro.players)if(tagpro.players.hasOwnProperty(t)){var i=tagpro.players[t];e.updatePlayer(i)}e.drawPlayers(e.layers.foreground)},e.updateEmitters=function(){var t=performance.now();e.renderDelta||(e.renderDelta=t);var i=[];e.emitters.forEach((function(r){r.emit||r.particleCount>0?r.update(.001*(t-e.renderDelta)):r.keep||i.push(r)})),i.forEach((function(t){var i=e.emitters.indexOf(t);-1!==i&&e.emitters.splice(i,1)})),e.renderDelta=performance.now()},e.updateDynamicTile=function(t){tagpro.map[t.x][t.y]=t.v,e.dynamicSprites[t.x]&&e.layers.midground.removeChild(e.dynamicSprites[t.x][t.y]),e.drawDynamicTile(t.x,t.y)},e.handleMapUpdate=function(t){if(tagpro.map){Array.isArray(t)||(t=[t]);for(var i=0,r=t.length;i!==r;i++){var n=t[i];e.updateDynamicTile(n)}}},e.drawSpawn=function(t,i,r,n){if(e.layers.foreground){var o=tagpro.events.ballSpawnTile?tagpro.events.ballSpawnTile[0].ballSpawnTile(r):1===r?"redball":"blueball",s=tagpro.tiles.draw(e.layers.foreground,o,{x:t,y:i},null,null,.25,!0);setTimeout((function(){s.parent.removeChild(s)}),n)}else setTimeout(e.drawSpawn,0,t,i,r,n)},tagpro.socket.on("mapupdate",e.handleMapUpdate),tagpro.socket.on("bomb",(function(t){e.createExplosion(t.x,t.y)})),tagpro.socket.on("splat",(function(t){e.drawSplat(t.x,t.y,t.t,!0,t.temp)})),tagpro.socket.on("spawn",(function(t){e.drawSpawn(t.x,t.y,t.t,t.w)})),e};var Box2D={};!function(t,e){function i(){}!Object.defineProperty&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(t,e,i){i.get instanceof Function&&t.__defineGetter__(e,i.get),i.set instanceof Function&&t.__defineSetter__(e,i.set)}),t.inherit=function(t,e){var r=t;i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=r},t.generateCallback=function(t,e){return function(){e.apply(t,arguments)}},t.NVector=function(t){t===e&&(t=0);for(var i=new Array(t||0),r=0;r<t;++r)i[r]=0;return i},t.is=function(t,i){return null!==t&&(i instanceof Function&&t instanceof i||!(t.constructor.__implements==e||!t.constructor.__implements[i]))},t.parseUInt=function(t){return Math.abs(parseInt(t))}}(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector,i;for(void 0===Box2D&&(Box2D={}),void 0===Box2D.Collision&&(Box2D.Collision={}),void 0===Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={}),void 0===Box2D.Common&&(Box2D.Common={}),void 0===Box2D.Common.Math&&(Box2D.Common.Math={}),void 0===Box2D.Dynamics&&(Box2D.Dynamics={}),void 0===Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={}),void 0===Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={}),void 0===Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={}),Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=function t(){t.b2AABB.apply(this,arguments)},Box2D.Collision.b2Bound=function t(){t.b2Bound.apply(this,arguments)},Box2D.Collision.b2BoundValues=function t(){t.b2BoundValues.apply(this,arguments),this.constructor===t&&this.b2BoundValues.apply(this,arguments)},Box2D.Collision.b2Collision=function t(){t.b2Collision.apply(this,arguments)},Box2D.Collision.b2ContactID=function t(){t.b2ContactID.apply(this,arguments),this.constructor===t&&this.b2ContactID.apply(this,arguments)},Box2D.Collision.b2ContactPoint=function t(){t.b2ContactPoint.apply(this,arguments)},Box2D.Collision.b2Distance=function t(){t.b2Distance.apply(this,arguments)},Box2D.Collision.b2DistanceInput=function t(){t.b2DistanceInput.apply(this,arguments)},Box2D.Collision.b2DistanceOutput=function t(){t.b2DistanceOutput.apply(this,arguments)},Box2D.Collision.b2DistanceProxy=function t(){t.b2DistanceProxy.apply(this,arguments)},Box2D.Collision.b2DynamicTree=function t(){t.b2DynamicTree.apply(this,arguments),this.constructor===t&&this.b2DynamicTree.apply(this,arguments)},Box2D.Collision.b2DynamicTreeBroadPhase=function t(){t.b2DynamicTreeBroadPhase.apply(this,arguments)},Box2D.Collision.b2DynamicTreeNode=function t(){t.b2DynamicTreeNode.apply(this,arguments)},Box2D.Collision.b2DynamicTreePair=function t(){t.b2DynamicTreePair.apply(this,arguments)},Box2D.Collision.b2Manifold=function t(){t.b2Manifold.apply(this,arguments),this.constructor===t&&this.b2Manifold.apply(this,arguments)},Box2D.Collision.b2ManifoldPoint=function t(){t.b2ManifoldPoint.apply(this,arguments),this.constructor===t&&this.b2ManifoldPoint.apply(this,arguments)},Box2D.Collision.b2Point=function t(){t.b2Point.apply(this,arguments)},Box2D.Collision.b2RayCastInput=function t(){t.b2RayCastInput.apply(this,arguments),this.constructor===t&&this.b2RayCastInput.apply(this,arguments)},Box2D.Collision.b2RayCastOutput=function t(){t.b2RayCastOutput.apply(this,arguments)},Box2D.Collision.b2Segment=function t(){t.b2Segment.apply(this,arguments)},Box2D.Collision.b2SeparationFunction=function t(){t.b2SeparationFunction.apply(this,arguments)},Box2D.Collision.b2Simplex=function t(){t.b2Simplex.apply(this,arguments),this.constructor===t&&this.b2Simplex.apply(this,arguments)},Box2D.Collision.b2SimplexCache=function t(){t.b2SimplexCache.apply(this,arguments)},Box2D.Collision.b2SimplexVertex=function t(){t.b2SimplexVertex.apply(this,arguments)},Box2D.Collision.b2TimeOfImpact=function t(){t.b2TimeOfImpact.apply(this,arguments)},Box2D.Collision.b2TOIInput=function t(){t.b2TOIInput.apply(this,arguments)},Box2D.Collision.b2WorldManifold=function t(){t.b2WorldManifold.apply(this,arguments),this.constructor===t&&this.b2WorldManifold.apply(this,arguments)},Box2D.Collision.ClipVertex=function t(){t.ClipVertex.apply(this,arguments)},Box2D.Collision.Features=function t(){t.Features.apply(this,arguments)},Box2D.Collision.Shapes.b2CircleShape=function t(){t.b2CircleShape.apply(this,arguments),this.constructor===t&&this.b2CircleShape.apply(this,arguments)},Box2D.Collision.Shapes.b2EdgeChainDef=function t(){t.b2EdgeChainDef.apply(this,arguments),this.constructor===t&&this.b2EdgeChainDef.apply(this,arguments)},Box2D.Collision.Shapes.b2EdgeShape=function t(){t.b2EdgeShape.apply(this,arguments),this.constructor===t&&this.b2EdgeShape.apply(this,arguments)},Box2D.Collision.Shapes.b2MassData=function t(){t.b2MassData.apply(this,arguments)},Box2D.Collision.Shapes.b2PolygonShape=function t(){t.b2PolygonShape.apply(this,arguments),this.constructor===t&&this.b2PolygonShape.apply(this,arguments)},Box2D.Collision.Shapes.b2Shape=function t(){t.b2Shape.apply(this,arguments),this.constructor===t&&this.b2Shape.apply(this,arguments)},Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=function t(){t.b2Color.apply(this,arguments),this.constructor===t&&this.b2Color.apply(this,arguments)},Box2D.Common.b2Settings=function t(){t.b2Settings.apply(this,arguments)},Box2D.Common.Math.b2Mat22=function t(){t.b2Mat22.apply(this,arguments),this.constructor===t&&this.b2Mat22.apply(this,arguments)},Box2D.Common.Math.b2Mat33=function t(){t.b2Mat33.apply(this,arguments),this.constructor===t&&this.b2Mat33.apply(this,arguments)},Box2D.Common.Math.b2Math=function t(){t.b2Math.apply(this,arguments)},Box2D.Common.Math.b2Sweep=function t(){t.b2Sweep.apply(this,arguments)},Box2D.Common.Math.b2Transform=function t(){t.b2Transform.apply(this,arguments),this.constructor===t&&this.b2Transform.apply(this,arguments)},Box2D.Common.Math.b2Vec2=function t(){t.b2Vec2.apply(this,arguments),this.constructor===t&&this.b2Vec2.apply(this,arguments)},Box2D.Common.Math.b2Vec3=function t(){t.b2Vec3.apply(this,arguments),this.constructor===t&&this.b2Vec3.apply(this,arguments)},Box2D.Dynamics.b2Body=function t(){t.b2Body.apply(this,arguments),this.constructor===t&&this.b2Body.apply(this,arguments)},Box2D.Dynamics.b2BodyDef=function t(){t.b2BodyDef.apply(this,arguments),this.constructor===t&&this.b2BodyDef.apply(this,arguments)},Box2D.Dynamics.b2ContactFilter=function t(){t.b2ContactFilter.apply(this,arguments)},Box2D.Dynamics.b2ContactImpulse=function t(){t.b2ContactImpulse.apply(this,arguments)},Box2D.Dynamics.b2ContactListener=function t(){t.b2ContactListener.apply(this,arguments)},Box2D.Dynamics.b2ContactManager=function t(){t.b2ContactManager.apply(this,arguments),this.constructor===t&&this.b2ContactManager.apply(this,arguments)},Box2D.Dynamics.b2DebugDraw=function t(){t.b2DebugDraw.apply(this,arguments),this.constructor===t&&this.b2DebugDraw.apply(this,arguments)},Box2D.Dynamics.b2DestructionListener=function t(){t.b2DestructionListener.apply(this,arguments)},Box2D.Dynamics.b2FilterData=function t(){t.b2FilterData.apply(this,arguments)},Box2D.Dynamics.b2Fixture=function t(){t.b2Fixture.apply(this,arguments),this.constructor===t&&this.b2Fixture.apply(this,arguments)},Box2D.Dynamics.b2FixtureDef=function t(){t.b2FixtureDef.apply(this,arguments),this.constructor===t&&this.b2FixtureDef.apply(this,arguments)},Box2D.Dynamics.b2Island=function t(){t.b2Island.apply(this,arguments),this.constructor===t&&this.b2Island.apply(this,arguments)},Box2D.Dynamics.b2TimeStep=function t(){t.b2TimeStep.apply(this,arguments)},Box2D.Dynamics.b2World=function t(){t.b2World.apply(this,arguments),this.constructor===t&&this.b2World.apply(this,arguments)},Box2D.Dynamics.Contacts.b2CircleContact=function t(){t.b2CircleContact.apply(this,arguments)},Box2D.Dynamics.Contacts.b2Contact=function t(){t.b2Contact.apply(this,arguments),this.constructor===t&&this.b2Contact.apply(this,arguments)},Box2D.Dynamics.Contacts.b2ContactConstraint=function t(){t.b2ContactConstraint.apply(this,arguments),this.constructor===t&&this.b2ContactConstraint.apply(this,arguments)},Box2D.Dynamics.Contacts.b2ContactConstraintPoint=function t(){t.b2ContactConstraintPoint.apply(this,arguments)},Box2D.Dynamics.Contacts.b2ContactEdge=function t(){t.b2ContactEdge.apply(this,arguments)},Box2D.Dynamics.Contacts.b2ContactFactory=function t(){t.b2ContactFactory.apply(this,arguments),this.constructor===t&&this.b2ContactFactory.apply(this,arguments)},Box2D.Dynamics.Contacts.b2ContactRegister=function t(){t.b2ContactRegister.apply(this,arguments)},Box2D.Dynamics.Contacts.b2ContactResult=function t(){t.b2ContactResult.apply(this,arguments)},Box2D.Dynamics.Contacts.b2ContactSolver=function t(){t.b2ContactSolver.apply(this,arguments),this.constructor===t&&this.b2ContactSolver.apply(this,arguments)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=function t(){t.b2EdgeAndCircleContact.apply(this,arguments)},Box2D.Dynamics.Contacts.b2NullContact=function t(){t.b2NullContact.apply(this,arguments),this.constructor===t&&this.b2NullContact.apply(this,arguments)},Box2D.Dynamics.Contacts.b2PolyAndCircleContact=function t(){t.b2PolyAndCircleContact.apply(this,arguments)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=function t(){t.b2PolyAndEdgeContact.apply(this,arguments)},Box2D.Dynamics.Contacts.b2PolygonContact=function t(){t.b2PolygonContact.apply(this,arguments)},Box2D.Dynamics.Contacts.b2PositionSolverManifold=function t(){t.b2PositionSolverManifold.apply(this,arguments),this.constructor===t&&this.b2PositionSolverManifold.apply(this,arguments)},Box2D.Dynamics.Controllers.b2BuoyancyController=function t(){t.b2BuoyancyController.apply(this,arguments)},Box2D.Dynamics.Controllers.b2ConstantAccelController=function t(){t.b2ConstantAccelController.apply(this,arguments)},Box2D.Dynamics.Controllers.b2ConstantForceController=function t(){t.b2ConstantForceController.apply(this,arguments)},Box2D.Dynamics.Controllers.b2Controller=function t(){t.b2Controller.apply(this,arguments)},Box2D.Dynamics.Controllers.b2ControllerEdge=function t(){t.b2ControllerEdge.apply(this,arguments)},Box2D.Dynamics.Controllers.b2GravityController=function t(){t.b2GravityController.apply(this,arguments)},Box2D.Dynamics.Controllers.b2TensorDampingController=function t(){t.b2TensorDampingController.apply(this,arguments)},Box2D.Dynamics.Joints.b2DistanceJoint=function t(){t.b2DistanceJoint.apply(this,arguments),this.constructor===t&&this.b2DistanceJoint.apply(this,arguments)},Box2D.Dynamics.Joints.b2DistanceJointDef=function t(){t.b2DistanceJointDef.apply(this,arguments),this.constructor===t&&this.b2DistanceJointDef.apply(this,arguments)},Box2D.Dynamics.Joints.b2FrictionJoint=function t(){t.b2FrictionJoint.apply(this,arguments),this.constructor===t&&this.b2FrictionJoint.apply(this,arguments)},Box2D.Dynamics.Joints.b2FrictionJointDef=function t(){t.b2FrictionJointDef.apply(this,arguments),this.constructor===t&&this.b2FrictionJointDef.apply(this,arguments)},Box2D.Dynamics.Joints.b2GearJoint=function t(){t.b2GearJoint.apply(this,arguments),this.constructor===t&&this.b2GearJoint.apply(this,arguments)},Box2D.Dynamics.Joints.b2GearJointDef=function t(){t.b2GearJointDef.apply(this,arguments),this.constructor===t&&this.b2GearJointDef.apply(this,arguments)},Box2D.Dynamics.Joints.b2Jacobian=function t(){t.b2Jacobian.apply(this,arguments)},Box2D.Dynamics.Joints.b2Joint=function t(){t.b2Joint.apply(this,arguments),this.constructor===t&&this.b2Joint.apply(this,arguments)},Box2D.Dynamics.Joints.b2JointDef=function t(){t.b2JointDef.apply(this,arguments),this.constructor===t&&this.b2JointDef.apply(this,arguments)},Box2D.Dynamics.Joints.b2JointEdge=function t(){t.b2JointEdge.apply(this,arguments)},Box2D.Dynamics.Joints.b2LineJoint=function t(){t.b2LineJoint.apply(this,arguments),this.constructor===t&&this.b2LineJoint.apply(this,arguments)},Box2D.Dynamics.Joints.b2LineJointDef=function t(){t.b2LineJointDef.apply(this,arguments),this.constructor===t&&this.b2LineJointDef.apply(this,arguments)},Box2D.Dynamics.Joints.b2MouseJoint=function t(){t.b2MouseJoint.apply(this,arguments),this.constructor===t&&this.b2MouseJoint.apply(this,arguments)},Box2D.Dynamics.Joints.b2MouseJointDef=function t(){t.b2MouseJointDef.apply(this,arguments),this.constructor===t&&this.b2MouseJointDef.apply(this,arguments)},Box2D.Dynamics.Joints.b2PrismaticJoint=function t(){t.b2PrismaticJoint.apply(this,arguments),this.constructor===t&&this.b2PrismaticJoint.apply(this,arguments)},Box2D.Dynamics.Joints.b2PrismaticJointDef=function t(){t.b2PrismaticJointDef.apply(this,arguments),this.constructor===t&&this.b2PrismaticJointDef.apply(this,arguments)},Box2D.Dynamics.Joints.b2PulleyJoint=function t(){t.b2PulleyJoint.apply(this,arguments),this.constructor===t&&this.b2PulleyJoint.apply(this,arguments)},Box2D.Dynamics.Joints.b2PulleyJointDef=function t(){t.b2PulleyJointDef.apply(this,arguments),this.constructor===t&&this.b2PulleyJointDef.apply(this,arguments)},Box2D.Dynamics.Joints.b2RevoluteJoint=function t(){t.b2RevoluteJoint.apply(this,arguments),this.constructor===t&&this.b2RevoluteJoint.apply(this,arguments)},Box2D.Dynamics.Joints.b2RevoluteJointDef=function t(){t.b2RevoluteJointDef.apply(this,arguments),this.constructor===t&&this.b2RevoluteJointDef.apply(this,arguments)},Box2D.Dynamics.Joints.b2WeldJoint=function t(){t.b2WeldJoint.apply(this,arguments),this.constructor===t&&this.b2WeldJoint.apply(this,arguments)},Box2D.Dynamics.Joints.b2WeldJointDef=function t(){t.b2WeldJointDef.apply(this,arguments),this.constructor===t&&this.b2WeldJointDef.apply(this,arguments)},Box2D.postDefs=[],function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),i=Box2D.Collision.Shapes.b2Shape,r=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),n=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),o=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,l=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB),h=Box2D.Collision.b2Bound,c=Box2D.Collision.b2BoundValues,u=Box2D.Collision.b2Collision,p=Box2D.Collision.b2ContactID,d=Box2D.Collision.b2ContactPoint,m=Box2D.Collision.b2Distance,f=Box2D.Collision.b2DistanceInput,y=Box2D.Collision.b2DistanceOutput,_=Box2D.Collision.b2DistanceProxy,g=Box2D.Collision.b2DynamicTree,x=Box2D.Collision.b2DynamicTreeBroadPhase,v=Box2D.Collision.b2DynamicTreeNode,b=Box2D.Collision.b2DynamicTreePair,w=Box2D.Collision.b2Manifold,S=Box2D.Collision.b2ManifoldPoint,C=Box2D.Collision.b2Point,D=Box2D.Collision.b2RayCastInput,T=Box2D.Collision.b2RayCastOutput,A=Box2D.Collision.b2Segment,E=Box2D.Collision.b2SeparationFunction,I=Box2D.Collision.b2Simplex,P=Box2D.Collision.b2SimplexCache,B=Box2D.Collision.b2SimplexVertex,M=Box2D.Collision.b2TimeOfImpact,O=Box2D.Collision.b2TOIInput,R=Box2D.Collision.b2WorldManifold,L=Box2D.Collision.ClipVertex,k=Box2D.Collision.Features,F=Box2D.Collision.IBroadPhase;l.b2AABB=function(){this.lowerBound=new a,this.upperBound=new a},l.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y,i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},l.prototype.GetCenter=function(){return new a((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},l.prototype.GetExtents=function(){return new a((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},l.prototype.Contains=function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},l.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE,r=Number.MAX_VALUE,n=e.p1.x,o=e.p1.y,s=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,l=Math.abs(s),h=Math.abs(a),c=t.normal,u=0,p=0,d=0,m=0,f=0;if(l<Number.MIN_VALUE){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else if(u=1/s,f=-1,(p=(this.lowerBound.x-n)*u)>(d=(this.upperBound.x-n)*u)&&(m=p,p=d,d=m,f=1),p>i&&(c.x=f,c.y=0,i=p),i>(r=Math.min(r,d)))return!1;if(h<Number.MIN_VALUE){if(o<this.lowerBound.y||this.upperBound.y<o)return!1}else if(u=1/a,f=-1,(p=(this.lowerBound.y-o)*u)>(d=(this.upperBound.y-o)*u)&&(m=p,p=d,d=m,f=1),p>i&&(c.y=f,c.x=0,i=p),i>(r=Math.min(r,d)))return!1;return t.fraction=i,!0},l.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,r=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return!(e>0||i>0)&&!(r>0||n>0)},l.Combine=function(t,e){var i=new l;return i.Combine(t,e),i},l.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)},h.b2Bound=function(){},h.prototype.IsLower=function(){return 0==(1&this.value)},h.prototype.IsUpper=function(){return 1==(1&this.value)},h.prototype.Swap=function(t){var e=this.value,i=this.proxy,r=this.stabbingCount;this.value=t.value,this.proxy=t.proxy,this.stabbingCount=t.stabbingCount,t.value=e,t.proxy=i,t.stabbingCount=r},c.b2BoundValues=function(){},c.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},u.b2Collision=function(){},u.ClipSegmentToLine=function(t,e,i,r){var n;void 0===r&&(r=0);var o=0,s=(n=e[0]).v,a=(n=e[1]).v,l=i.x*s.x+i.y*s.y-r,h=i.x*a.x+i.y*a.y-r;if(l<=0&&t[o++].Set(e[0]),h<=0&&t[o++].Set(e[1]),l*h<0){var c,u=l/(l-h),p=(n=t[o]).v;p.x=s.x+u*(a.x-s.x),p.y=s.y+u*(a.y-s.y),n=t[o],l>0?(c=e[0],n.id=c.id):(c=e[1],n.id=c.id),++o}return o},u.EdgeSeparation=function(t,e,i,r,n){void 0===i&&(i=0);parseInt(t.m_vertexCount);var o,s,a=t.m_vertices,l=t.m_normals,h=parseInt(r.m_vertexCount),c=r.m_vertices;o=e.R,s=l[i];for(var u=o.col1.x*s.x+o.col2.x*s.y,p=o.col1.y*s.x+o.col2.y*s.y,d=(o=n.R).col1.x*u+o.col1.y*p,m=o.col2.x*u+o.col2.y*p,f=0,y=Number.MAX_VALUE,_=0;_<h;++_){var g=(s=c[_]).x*d+s.y*m;g<y&&(y=g,f=_)}s=a[i],o=e.R;var x=e.position.x+(o.col1.x*s.x+o.col2.x*s.y),v=e.position.y+(o.col1.y*s.x+o.col2.y*s.y);s=c[f],o=n.R;var b=n.position.x+(o.col1.x*s.x+o.col2.x*s.y),w=n.position.y+(o.col1.y*s.x+o.col2.y*s.y);return(b-=x)*u+(w-=v)*p},u.FindMaxSeparation=function(t,e,i,r,n){var o,s,a=parseInt(e.m_vertexCount),l=e.m_normals;s=n.R,o=r.m_centroid;var h=n.position.x+(s.col1.x*o.x+s.col2.x*o.y),c=n.position.y+(s.col1.y*o.x+s.col2.y*o.y);s=i.R,o=e.m_centroid,h-=i.position.x+(s.col1.x*o.x+s.col2.x*o.y),c-=i.position.y+(s.col1.y*o.x+s.col2.y*o.y);for(var p=h*i.R.col1.x+c*i.R.col1.y,d=h*i.R.col2.x+c*i.R.col2.y,m=0,f=-Number.MAX_VALUE,y=0;y<a;++y){var _=(o=l[y]).x*p+o.y*d;_>f&&(f=_,m=y)}var g=u.EdgeSeparation(e,i,m,r,n),x=parseInt(m-1>=0?m-1:a-1),v=u.EdgeSeparation(e,i,x,r,n),b=parseInt(m+1<a?m+1:0),w=u.EdgeSeparation(e,i,b,r,n),S=0,C=0,D=0;if(v>g&&v>w)D=-1,S=x,C=v;else{if(!(w>g))return t[0]=m,g;D=1,S=b,C=w}for(;m=-1==D?S-1>=0?S-1:a-1:S+1<a?S+1:0,(g=u.EdgeSeparation(e,i,m,r,n))>C;)S=m,C=g;return t[0]=S,C},u.FindIncidentEdge=function(t,e,i,r,n,o){void 0===r&&(r=0);parseInt(e.m_vertexCount);var s,a,l=e.m_normals,h=parseInt(n.m_vertexCount),c=n.m_vertices,u=n.m_normals;s=i.R,a=l[r];var p=s.col1.x*a.x+s.col2.x*a.y,d=s.col1.y*a.x+s.col2.y*a.y,m=(s=o.R).col1.x*p+s.col1.y*d;d=s.col2.x*p+s.col2.y*d,p=m;for(var f,y=0,_=Number.MAX_VALUE,g=0;g<h;++g){var x=p*(a=u[g]).x+d*a.y;x<_&&(_=x,y=g)}var v=parseInt(y),b=parseInt(v+1<h?v+1:0);f=t[0],a=c[v],s=o.R,f.v.x=o.position.x+(s.col1.x*a.x+s.col2.x*a.y),f.v.y=o.position.y+(s.col1.y*a.x+s.col2.y*a.y),f.id.features.referenceEdge=r,f.id.features.incidentEdge=v,f.id.features.incidentVertex=0,f=t[1],a=c[b],s=o.R,f.v.x=o.position.x+(s.col1.x*a.x+s.col2.x*a.y),f.v.y=o.position.y+(s.col1.y*a.x+s.col2.y*a.y),f.id.features.referenceEdge=r,f.id.features.incidentEdge=b,f.id.features.incidentVertex=1},u.MakeClipPointVector=function(){var t=new Vector(2);return t[0]=new L,t[1]=new L,t},u.CollidePolygons=function(t,e,i,n,o){var s;t.m_pointCount=0;var a=e.m_radius+n.m_radius,l=0;u.s_edgeAO[0]=l;var h=u.FindMaxSeparation(u.s_edgeAO,e,i,n,o);if(l=u.s_edgeAO[0],!(h>a)){var c=0;u.s_edgeBO[0]=c;var p=u.FindMaxSeparation(u.s_edgeBO,n,o,e,i);if(c=u.s_edgeBO[0],!(p>a)){var d,m,f,y,_,g=0,x=0;p>.98*h+.001?(d=n,m=e,f=o,y=i,g=c,t.m_type=w.e_faceB,x=1):(d=e,m=n,f=i,y=o,g=l,t.m_type=w.e_faceA,x=0);var v=u.s_incidentEdge;u.FindIncidentEdge(v,d,f,g,m,y);var b,S=parseInt(d.m_vertexCount),C=d.m_vertices,D=C[g];b=g+1<S?C[parseInt(g+1)]:C[0];var T=u.s_localTangent;T.Set(b.x-D.x,b.y-D.y),T.Normalize();var A=u.s_localNormal;A.x=T.y,A.y=-T.x;var E=u.s_planePoint;E.Set(.5*(D.x+b.x),.5*(D.y+b.y));var I=u.s_tangent;_=f.R,I.x=_.col1.x*T.x+_.col2.x*T.y,I.y=_.col1.y*T.x+_.col2.y*T.y;var P=u.s_tangent2;P.x=-I.x,P.y=-I.y;var B=u.s_normal;B.x=I.y,B.y=-I.x;var M=u.s_v11,O=u.s_v12;M.x=f.position.x+(_.col1.x*D.x+_.col2.x*D.y),M.y=f.position.y+(_.col1.y*D.x+_.col2.y*D.y),O.x=f.position.x+(_.col1.x*b.x+_.col2.x*b.y),O.y=f.position.y+(_.col1.y*b.x+_.col2.y*b.y);var R=B.x*M.x+B.y*M.y,L=-I.x*M.x-I.y*M.y+a,k=I.x*O.x+I.y*O.y+a,F=u.s_clipPoints1,N=u.s_clipPoints2;if(!(u.ClipSegmentToLine(F,v,P,L)<2||u.ClipSegmentToLine(N,F,I,k)<2)){t.m_localPlaneNormal.SetV(A),t.m_localPoint.SetV(E);for(var V=0,G=0;G<r.b2_maxManifoldPoints;++G){if(s=N[G],B.x*s.v.x+B.y*s.v.y-R<=a){var U=t.m_points[V];_=y.R;var j=s.v.x-y.position.x,z=s.v.y-y.position.y;U.m_localPoint.x=j*_.col1.x+z*_.col1.y,U.m_localPoint.y=j*_.col2.x+z*_.col2.y,U.m_id.Set(s.id),U.m_id.features.flip=x,++V}}t.m_pointCount=V}}}},u.CollideCircles=function(t,e,i,r,n){var o,s;t.m_pointCount=0,o=i.R,s=e.m_p;var a=i.position.x+(o.col1.x*s.x+o.col2.x*s.y),l=i.position.y+(o.col1.y*s.x+o.col2.y*s.y);o=n.R,s=r.m_p;var h=n.position.x+(o.col1.x*s.x+o.col2.x*s.y)-a,c=n.position.y+(o.col1.y*s.x+o.col2.y*s.y)-l,u=h*h+c*c,p=e.m_radius+r.m_radius;u>p*p||(t.m_type=w.e_circles,t.m_localPoint.SetV(e.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(r.m_p),t.m_points[0].m_id.key=0)},u.CollidePolygonAndCircle=function(t,e,i,r,n){t.m_pointCount=0;var o,s,a=0,l=0;s=n.R,o=r.m_p;var h=n.position.x+(s.col1.x*o.x+s.col2.x*o.y),c=n.position.y+(s.col1.y*o.x+s.col2.y*o.y);a=h-i.position.x,l=c-i.position.y;for(var u=a*(s=i.R).col1.x+l*s.col1.y,p=a*s.col2.x+l*s.col2.y,d=0,m=-Number.MAX_VALUE,f=e.m_radius+r.m_radius,y=parseInt(e.m_vertexCount),_=e.m_vertices,g=e.m_normals,x=0;x<y;++x){a=u-(o=_[x]).x,l=p-o.y;var v=(o=g[x]).x*a+o.y*l;if(v>f)return;v>m&&(m=v,d=x)}var b=parseInt(d),S=parseInt(b+1<y?b+1:0),C=_[b],D=_[S];if(m<Number.MIN_VALUE)return t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.SetV(g[d]),t.m_localPoint.x=.5*(C.x+D.x),t.m_localPoint.y=.5*(C.y+D.y),t.m_points[0].m_localPoint.SetV(r.m_p),void(t.m_points[0].m_id.key=0);var T=(u-C.x)*(D.x-C.x)+(p-C.y)*(D.y-C.y),A=(u-D.x)*(C.x-D.x)+(p-D.y)*(C.y-D.y);if(T<=0){if((u-C.x)*(u-C.x)+(p-C.y)*(p-C.y)>f*f)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=u-C.x,t.m_localPlaneNormal.y=p-C.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(C),t.m_points[0].m_localPoint.SetV(r.m_p),t.m_points[0].m_id.key=0}else if(A<=0){if((u-D.x)*(u-D.x)+(p-D.y)*(p-D.y)>f*f)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=u-D.x,t.m_localPlaneNormal.y=p-D.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(D),t.m_points[0].m_localPoint.SetV(r.m_p),t.m_points[0].m_id.key=0}else{var E=.5*(C.x+D.x),I=.5*(C.y+D.y);if((m=(u-E)*g[b].x+(p-I)*g[b].y)>f)return;t.m_pointCount=1,t.m_type=w.e_faceA,t.m_localPlaneNormal.x=g[b].x,t.m_localPlaneNormal.y=g[b].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(E,I),t.m_points[0].m_localPoint.SetV(r.m_p),t.m_points[0].m_id.key=0}},u.TestOverlap=function(t,e){var i=e.lowerBound,r=t.upperBound,n=i.x-r.x,o=i.y-r.y;i=t.lowerBound,r=e.upperBound;var s=i.x-r.x,a=i.y-r.y;return!(n>0||o>0)&&!(s>0||a>0)},Box2D.postDefs.push((function(){Box2D.Collision.b2Collision.s_incidentEdge=u.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=u.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=u.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new a,Box2D.Collision.b2Collision.s_localNormal=new a,Box2D.Collision.b2Collision.s_planePoint=new a,Box2D.Collision.b2Collision.s_normal=new a,Box2D.Collision.b2Collision.s_tangent=new a,Box2D.Collision.b2Collision.s_tangent2=new a,Box2D.Collision.b2Collision.s_v11=new a,Box2D.Collision.b2Collision.s_v12=new a,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new a,Box2D.Collision.b2Collision.b2_nullFeature=255})),p.b2ContactID=function(){this.features=new k},p.prototype.b2ContactID=function(){this.features._m_id=this},p.prototype.Set=function(t){this.key=t._key},p.prototype.Copy=function(){var t=new p;return t.key=this.key,t},Object.defineProperty(p.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(p.prototype,"key",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._key=t,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}),d.b2ContactPoint=function(){this.position=new a,this.velocity=new a,this.normal=new a,this.id=new p},m.b2Distance=function(){},m.Distance=function(t,e,i){++m.b2_gjkCalls;var o=i.proxyA,s=i.proxyB,l=i.transformA,h=i.transformB,c=m.s_simplex;c.ReadCache(e,o,l,s,h);for(var u,p=c.m_vertices,d=m.s_saveA,f=m.s_saveB,y=0,_=(c.GetClosestPoint().LengthSquared(),0),g=0;g<20;){for(y=c.m_count,_=0;_<y;_++)d[_]=p[_].indexA,f[_]=p[_].indexB;switch(c.m_count){case 1:break;case 2:c.Solve2();break;case 3:c.Solve3();break;default:r.b2Assert(!1)}if(3==c.m_count)break;(u=c.GetClosestPoint()).LengthSquared();var x=c.GetSearchDirection();if(x.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var v=p[c.m_count];v.indexA=o.GetSupport(n.MulTMV(l.R,x.GetNegative())),v.wA=n.MulX(l,o.GetVertex(v.indexA)),v.indexB=s.GetSupport(n.MulTMV(h.R,x)),v.wB=n.MulX(h,s.GetVertex(v.indexB)),v.w=n.SubtractVV(v.wB,v.wA),++g,++m.b2_gjkIters;var b=!1;for(_=0;_<y;_++)if(v.indexA==d[_]&&v.indexB==f[_]){b=!0;break}if(b)break;++c.m_count}if(m.b2_gjkMaxIters=n.Max(m.b2_gjkMaxIters,g),c.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.SubtractVV(t.pointA,t.pointB).Length(),t.iterations=g,c.WriteCache(e),i.useRadii){var w=o.m_radius,S=s.m_radius;if(t.distance>w+S&&t.distance>Number.MIN_VALUE){t.distance-=w+S;var C=n.SubtractVV(t.pointB,t.pointA);C.Normalize(),t.pointA.x+=w*C.x,t.pointA.y+=w*C.y,t.pointB.x-=S*C.x,t.pointB.y-=S*C.y}else(u=new a).x=.5*(t.pointA.x+t.pointB.x),u.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=u.x,t.pointA.y=t.pointB.y=u.y,t.distance=0}},Box2D.postDefs.push((function(){Box2D.Collision.b2Distance.s_simplex=new I,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)})),f.b2DistanceInput=function(){},y.b2DistanceOutput=function(){this.pointA=new a,this.pointB=new a},_.b2DistanceProxy=function(){},_.prototype.Set=function(n){switch(n.GetType()){case i.e_circleShape:var o=n instanceof t?n:null;this.m_vertices=new Vector(1,!0),this.m_vertices[0]=o.m_p,this.m_count=1,this.m_radius=o.m_radius;break;case i.e_polygonShape:var s=n instanceof e?n:null;this.m_vertices=s.m_vertices,this.m_count=s.m_vertexCount,this.m_radius=s.m_radius;break;default:r.b2Assert(!1)}},_.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,r=1;r<this.m_count;++r){var n=this.m_vertices[r].x*t.x+this.m_vertices[r].y*t.y;n>i&&(e=r,i=n)}return e},_.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,r=1;r<this.m_count;++r){var n=this.m_vertices[r].x*t.x+this.m_vertices[r].y*t.y;n>i&&(e=r,i=n)}return this.m_vertices[e]},_.prototype.GetVertexCount=function(){return this.m_count},_.prototype.GetVertex=function(t){return void 0===t&&(t=0),r.b2Assert(0<=t&&t<this.m_count),this.m_vertices[t]},g.b2DynamicTree=function(){},g.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},g.prototype.CreateProxy=function(t,e){var i=this.AllocateNode(),n=r.b2_aabbExtension,o=r.b2_aabbExtension;return i.aabb.lowerBound.x=t.lowerBound.x-n,i.aabb.lowerBound.y=t.lowerBound.y-o,i.aabb.upperBound.x=t.upperBound.x+n,i.aabb.upperBound.y=t.upperBound.y+o,i.userData=e,this.InsertLeaf(i),i},g.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},g.prototype.MoveProxy=function(t,e,i){if(r.b2Assert(t.IsLeaf()),t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var n=r.b2_aabbExtension+r.b2_aabbMultiplier*(i.x>0?i.x:-i.x),o=r.b2_aabbExtension+r.b2_aabbMultiplier*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-n,t.aabb.lowerBound.y=e.lowerBound.y-o,t.aabb.upperBound.x=e.upperBound.x+n,t.aabb.upperBound.y=e.upperBound.y+o,this.InsertLeaf(t),!0},g.prototype.Rebalance=function(t){if(void 0===t&&(t=0),null!=this.m_root)for(var e=0;e<t;e++){for(var i=this.m_root,r=0;0==i.IsLeaf();)i=this.m_path>>r&1?i.child2:i.child1,r=r+1&31;++this.m_path,this.RemoveLeaf(i),this.InsertLeaf(i)}},g.prototype.GetFatAABB=function(t){return t.aabb},g.prototype.GetUserData=function(t){return t.userData},g.prototype.Query=function(t,e){if(null!=this.m_root){var i=new Vector,r=0;for(i[r++]=this.m_root;r>0;){var n=i[--r];if(n.aabb.TestOverlap(e))if(n.IsLeaf()){if(!t(n))return}else i[r++]=n.child1,i[r++]=n.child2}}},g.prototype.RayCast=function(t,e){if(null!=this.m_root){var i=e.p1,r=e.p2,o=n.SubtractVV(i,r);o.Normalize();var s=n.CrossFV(1,o),a=n.AbsV(s),h=e.maxFraction,c=new l,u=0,p=0;u=i.x+h*(r.x-i.x),p=i.y+h*(r.y-i.y),c.lowerBound.x=Math.min(i.x,u),c.lowerBound.y=Math.min(i.y,p),c.upperBound.x=Math.max(i.x,u),c.upperBound.y=Math.max(i.y,p);var d=new Vector,m=0;for(d[m++]=this.m_root;m>0;){var f=d[--m];if(0!=f.aabb.TestOverlap(c)){var y=f.aabb.GetCenter(),_=f.aabb.GetExtents();if(!(Math.abs(s.x*(i.x-y.x)+s.y*(i.y-y.y))-a.x*_.x-a.y*_.y>0))if(f.IsLeaf()){var g=new D;if(g.p1=e.p1,g.p2=e.p2,g.maxFraction=e.maxFraction,0==(h=t(g,f)))return;h>0&&(u=i.x+h*(r.x-i.x),p=i.y+h*(r.y-i.y),c.lowerBound.x=Math.min(i.x,u),c.lowerBound.y=Math.min(i.y,p),c.upperBound.x=Math.max(i.x,u),c.upperBound.y=Math.max(i.y,p))}else d[m++]=f.child1,d[m++]=f.child2}}}},g.prototype.AllocateNode=function(){if(this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t}return new v},g.prototype.FreeNode=function(t){t.parent=this.m_freeList,this.m_freeList=t},g.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);var e=t.aabb.GetCenter(),i=this.m_root;if(0==i.IsLeaf())do{var r=i.child1,n=i.child2;i=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-e.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-e.y)<Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y)?r:n}while(0==i.IsLeaf());var o=i.parent,s=this.AllocateNode();if(s.parent=o,s.userData=null,s.aabb.Combine(t.aabb,i.aabb),o){i.parent.child1==i?o.child1=s:o.child2=s,s.child1=i,s.child2=t,i.parent=s,t.parent=s;do{if(o.aabb.Contains(s.aabb))break;o.aabb.Combine(o.child1.aabb,o.child2.aabb),s=o,o=o.parent}while(o)}else s.child1=i,s.child2=t,i.parent=s,t.parent=s,this.m_root=s},g.prototype.RemoveLeaf=function(t){if(t!=this.m_root){var e,i=t.parent,r=i.parent;if(e=i.child1==t?i.child2:i.child1,r)for(r.child1==i?r.child1=e:r.child2=e,e.parent=r,this.FreeNode(i);r;){var n=r.aabb;if(r.aabb=l.Combine(r.child1.aabb,r.child2.aabb),n.Contains(r.aabb))break;r=r.parent}else this.m_root=e,e.parent=null,this.FreeNode(i)}else this.m_root=null},x.b2DynamicTreeBroadPhase=function(){this.m_tree=new g,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},x.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i},x.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},x.prototype.MoveProxy=function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)},x.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t),r=this.m_tree.GetFatAABB(e);return i.TestOverlap(r)},x.prototype.GetUserData=function(t){return this.m_tree.GetUserData(t)},x.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},x.prototype.GetProxyCount=function(){return this.m_proxyCount},x.prototype.UpdatePairs=function(t){var e=this;e.m_pairCount=0;var i,r=0;for(r=0;r<e.m_moveBuffer.length;++r){function n(t){if(t==i)return!0;e.m_pairCount==e.m_pairBuffer.length&&(e.m_pairBuffer[e.m_pairCount]=new b);var r=e.m_pairBuffer[e.m_pairCount];return r.proxyA=t<i?t:i,r.proxyB=t>=i?t:i,++e.m_pairCount,!0}i=e.m_moveBuffer[r];var o=e.m_tree.GetFatAABB(i);e.m_tree.Query(n,o)}e.m_moveBuffer.length=0;for(r=0;r<e.m_pairCount;){var s=e.m_pairBuffer[r];for(t(e.m_tree.GetUserData(s.proxyA),e.m_tree.GetUserData(s.proxyB)),++r;r<e.m_pairCount;){var a=e.m_pairBuffer[r];if(a.proxyA!=s.proxyA||a.proxyB!=s.proxyB)break;++r}}},x.prototype.Query=function(t,e){this.m_tree.Query(t,e)},x.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},x.prototype.Validate=function(){},x.prototype.Rebalance=function(t){void 0===t&&(t=0),this.m_tree.Rebalance(t)},x.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t},x.prototype.UnBufferMove=function(t){var e=parseInt(this.m_moveBuffer.indexOf(t));this.m_moveBuffer.splice(e,1)},x.prototype.ComparePairs=function(t,e){return 0},x.__implements={},x.__implements[F]=!0,v.b2DynamicTreeNode=function(){this.aabb=new l},v.prototype.IsLeaf=function(){return null==this.child1},b.b2DynamicTreePair=function(){},w.b2Manifold=function(){this.m_pointCount=0},w.prototype.b2Manifold=function(){this.m_points=new Vector(r.b2_maxManifoldPoints);for(var t=0;t<r.b2_maxManifoldPoints;t++)this.m_points[t]=new S;this.m_localPlaneNormal=new a,this.m_localPoint=new a},w.prototype.Reset=function(){for(var t=0;t<r.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof S?this.m_points[t]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},w.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<r.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof S?this.m_points[e]:null).Set(t.m_points[e]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},w.prototype.Copy=function(){var t=new w;return t.Set(this),t},Box2D.postDefs.push((function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4})),S.b2ManifoldPoint=function(){this.m_localPoint=new a,this.m_id=new p},S.prototype.b2ManifoldPoint=function(){this.Reset()},S.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},S.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},C.b2Point=function(){this.p=new a},C.prototype.Support=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),this.p},C.prototype.GetFirstVertex=function(t){return this.p},D.b2RayCastInput=function(){this.p1=new a,this.p2=new a},D.prototype.b2RayCastInput=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=1),t&&this.p1.SetV(t),e&&this.p2.SetV(e),this.maxFraction=i},T.b2RayCastOutput=function(){this.normal=new a},A.b2Segment=function(){this.p1=new a,this.p2=new a},A.prototype.TestSegment=function(t,e,i,r){void 0===r&&(r=0);var n=i.p1,o=i.p2.x-n.x,s=i.p2.y-n.y,a=this.p2.x-this.p1.x,l=this.p2.y-this.p1.y,h=-a,c=100*Number.MIN_VALUE,u=-(o*l+s*h);if(u>c){var p=n.x-this.p1.x,d=n.y-this.p1.y,m=p*l+d*h;if(0<=m&&m<=r*u){var f=-o*d+s*p;if(-c*u<=f&&f<=u*(1+c)){m/=u;var y=Math.sqrt(l*l+h*h);return l/=y,h/=y,t[0]=m,e.Set(l,h),!0}}}return!1},A.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},A.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,r=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:e<0?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p1.y)/i:i<0?(t.lowerBound.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*r,this.p2.y=this.p1.y+i*r},A.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x,i=-this.p2.y+this.p1.y,r=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:e<0?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound.y-this.p2.y)/i:i<0?(t.lowerBound.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*r,this.p1.y=this.p2.y+i*r},E.b2SeparationFunction=function(){this.m_localPoint=new a,this.m_axis=new a},E.prototype.Initialize=function(t,e,i,o,s){this.m_proxyA=e,this.m_proxyB=o;var l,h,c,u,p,d,m=parseInt(t.count);r.b2Assert(0<m&&m<3);var f,y,_=0,g=0,x=0,v=0,b=0,w=0,S=0;if(1==m)this.m_type=E.e_points,l=this.m_proxyA.GetVertex(t.indexA[0]),u=this.m_proxyB.GetVertex(t.indexB[0]),y=l,f=i.R,_=i.position.x+(f.col1.x*y.x+f.col2.x*y.y),g=i.position.y+(f.col1.y*y.x+f.col2.y*y.y),y=u,f=s.R,x=s.position.x+(f.col1.x*y.x+f.col2.x*y.y),v=s.position.y+(f.col1.y*y.x+f.col2.y*y.y),this.m_axis.x=x-_,this.m_axis.y=v-g,this.m_axis.Normalize();else if(t.indexB[0]==t.indexB[1])this.m_type=E.e_faceA,h=this.m_proxyA.GetVertex(t.indexA[0]),c=this.m_proxyA.GetVertex(t.indexA[1]),u=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(h.x+c.x),this.m_localPoint.y=.5*(h.y+c.y),this.m_axis=n.CrossVF(n.SubtractVV(c,h),1),this.m_axis.Normalize(),y=this.m_axis,b=(f=i.R).col1.x*y.x+f.col2.x*y.y,w=f.col1.y*y.x+f.col2.y*y.y,y=this.m_localPoint,f=i.R,_=i.position.x+(f.col1.x*y.x+f.col2.x*y.y),g=i.position.y+(f.col1.y*y.x+f.col2.y*y.y),y=u,f=s.R,(S=((x=s.position.x+(f.col1.x*y.x+f.col2.x*y.y))-_)*b+((v=s.position.y+(f.col1.y*y.x+f.col2.y*y.y))-g)*w)<0&&this.m_axis.NegativeSelf();else if(t.indexA[0]==t.indexA[0])this.m_type=E.e_faceB,p=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]),l=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(p.x+d.x),this.m_localPoint.y=.5*(p.y+d.y),this.m_axis=n.CrossVF(n.SubtractVV(d,p),1),this.m_axis.Normalize(),y=this.m_axis,b=(f=s.R).col1.x*y.x+f.col2.x*y.y,w=f.col1.y*y.x+f.col2.y*y.y,y=this.m_localPoint,f=s.R,x=s.position.x+(f.col1.x*y.x+f.col2.x*y.y),v=s.position.y+(f.col1.y*y.x+f.col2.y*y.y),y=l,f=i.R,(S=((_=i.position.x+(f.col1.x*y.x+f.col2.x*y.y))-x)*b+((g=i.position.y+(f.col1.y*y.x+f.col2.y*y.y))-v)*w)<0&&this.m_axis.NegativeSelf();else{h=this.m_proxyA.GetVertex(t.indexA[0]),c=this.m_proxyA.GetVertex(t.indexA[1]),p=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]);n.MulX(i,l);var C=n.MulMV(i.R,n.SubtractVV(c,h)),D=(n.MulX(s,u),n.MulMV(s.R,n.SubtractVV(d,p))),T=C.x*C.x+C.y*C.y,A=D.x*D.x+D.y*D.y,I=n.SubtractVV(D,C),P=C.x*I.x+C.y*I.y,B=D.x*I.x+D.y*I.y,M=C.x*D.x+C.y*D.y,O=T*A-M*M;S=0,0!=O&&(S=n.Clamp((M*B-P*A)/O,0,1));var R=(M*S+B)/A;R<0&&(R=0,S=n.Clamp((M-P)/T,0,1)),(l=new a).x=h.x+S*(c.x-h.x),l.y=h.y+S*(c.y-h.y),(u=new a).x=p.x+S*(d.x-p.x),u.y=p.y+S*(d.y-p.y),0==S||1==S?(this.m_type=E.e_faceB,this.m_axis=n.CrossVF(n.SubtractVV(d,p),1),this.m_axis.Normalize(),this.m_localPoint=u,y=this.m_axis,b=(f=s.R).col1.x*y.x+f.col2.x*y.y,w=f.col1.y*y.x+f.col2.y*y.y,y=this.m_localPoint,f=s.R,x=s.position.x+(f.col1.x*y.x+f.col2.x*y.y),v=s.position.y+(f.col1.y*y.x+f.col2.y*y.y),y=l,f=i.R,((_=i.position.x+(f.col1.x*y.x+f.col2.x*y.y))-x)*b+((g=i.position.y+(f.col1.y*y.x+f.col2.y*y.y))-v)*w,S<0&&this.m_axis.NegativeSelf()):(this.m_type=E.e_faceA,this.m_axis=n.CrossVF(n.SubtractVV(c,h),1),this.m_localPoint=l,y=this.m_axis,b=(f=i.R).col1.x*y.x+f.col2.x*y.y,w=f.col1.y*y.x+f.col2.y*y.y,y=this.m_localPoint,f=i.R,_=i.position.x+(f.col1.x*y.x+f.col2.x*y.y),g=i.position.y+(f.col1.y*y.x+f.col2.y*y.y),y=u,f=s.R,((x=s.position.x+(f.col1.x*y.x+f.col2.x*y.y))-_)*b+((v=s.position.y+(f.col1.y*y.x+f.col2.y*y.y))-g)*w,S<0&&this.m_axis.NegativeSelf())}},E.prototype.Evaluate=function(t,e){var i,o,s,a,l,h,c;switch(this.m_type){case E.e_points:return i=n.MulTMV(t.R,this.m_axis),o=n.MulTMV(e.R,this.m_axis.GetNegative()),s=this.m_proxyA.GetSupportVertex(i),a=this.m_proxyB.GetSupportVertex(o),l=n.MulX(t,s),((h=n.MulX(e,a)).x-l.x)*this.m_axis.x+(h.y-l.y)*this.m_axis.y;case E.e_faceA:return c=n.MulMV(t.R,this.m_axis),l=n.MulX(t,this.m_localPoint),o=n.MulTMV(e.R,c.GetNegative()),a=this.m_proxyB.GetSupportVertex(o),((h=n.MulX(e,a)).x-l.x)*c.x+(h.y-l.y)*c.y;case E.e_faceB:return c=n.MulMV(e.R,this.m_axis),h=n.MulX(e,this.m_localPoint),i=n.MulTMV(t.R,c.GetNegative()),s=this.m_proxyA.GetSupportVertex(i),((l=n.MulX(t,s)).x-h.x)*c.x+(l.y-h.y)*c.y;default:return r.b2Assert(!1),0}},Box2D.postDefs.push((function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4})),I.b2Simplex=function(){this.m_v1=new B,this.m_v2=new B,this.m_v3=new B,this.m_vertices=new Vector(3)},I.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},I.prototype.ReadCache=function(t,e,i,o,s){var a,l;r.b2Assert(0<=t.count&&t.count<=3),this.m_count=t.count;for(var h=this.m_vertices,c=0;c<this.m_count;c++){var u=h[c];u.indexA=t.indexA[c],u.indexB=t.indexB[c],a=e.GetVertex(u.indexA),l=o.GetVertex(u.indexB),u.wA=n.MulX(i,a),u.wB=n.MulX(s,l),u.w=n.SubtractVV(u.wB,u.wA),u.a=0}if(this.m_count>1){var p=t.metric,d=this.GetMetric();(d<.5*p||2*p<d||d<Number.MIN_VALUE)&&(this.m_count=0)}0==this.m_count&&((u=h[0]).indexA=0,u.indexB=0,a=e.GetVertex(0),l=o.GetVertex(0),u.wA=n.MulX(i,a),u.wB=n.MulX(s,l),u.w=n.SubtractVV(u.wB,u.wA),this.m_count=1)},I.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=Box2D.parseUInt(this.m_count);for(var e=this.m_vertices,i=0;i<this.m_count;i++)t.indexA[i]=Box2D.parseUInt(e[i].indexA),t.indexB[i]=Box2D.parseUInt(e[i].indexB)},I.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var t=n.SubtractVV(this.m_v2.w,this.m_v1.w);return n.CrossVV(t,this.m_v1.w.GetNegative())>0?n.CrossFV(1,t):n.CrossVF(t,1);default:return r.b2Assert(!1),new a}},I.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:default:return r.b2Assert(!1),new a;case 1:return this.m_v1.w;case 2:return new a(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y)}},I.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:default:r.b2Assert(!1);break;case 1:t.SetV(this.m_v1.wA),e.SetV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}},I.prototype.GetMetric=function(){switch(this.m_count){case 0:default:return r.b2Assert(!1),0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w))}},I.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=n.SubtractVV(e,t),r=-(t.x*i.x+t.y*i.y);if(r<=0)return this.m_v1.a=1,void(this.m_count=1);var o=e.x*i.x+e.y*i.y;if(o<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);var s=1/(o+r);this.m_v1.a=o*s,this.m_v2.a=r*s,this.m_count=2},I.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,r=n.SubtractVV(e,t),o=n.Dot(t,r),s=n.Dot(e,r),a=-o,l=n.SubtractVV(i,t),h=n.Dot(t,l),c=n.Dot(i,l),u=-h,p=n.SubtractVV(i,e),d=n.Dot(e,p),m=n.Dot(i,p),f=-d,y=n.CrossVV(r,l),_=y*n.CrossVV(e,i),g=y*n.CrossVV(i,t),x=y*n.CrossVV(t,e);if(a<=0&&u<=0)return this.m_v1.a=1,void(this.m_count=1);if(s>0&&a>0&&x<=0){var v=1/(s+a);return this.m_v1.a=s*v,this.m_v2.a=a*v,void(this.m_count=2)}if(c>0&&u>0&&g<=0){var b=1/(c+u);return this.m_v1.a=c*b,this.m_v3.a=u*b,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(s<=0&&f<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(c<=0&&m<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(m>0&&f>0&&_<=0){var w=1/(m+f);return this.m_v2.a=m*w,this.m_v3.a=f*w,this.m_count=2,void this.m_v1.Set(this.m_v3)}var S=1/(_+g+x);this.m_v1.a=_*S,this.m_v2.a=g*S,this.m_v3.a=x*S,this.m_count=3},P.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},B.b2SimplexVertex=function(){},B.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},M.b2TimeOfImpact=function(){},M.TimeOfImpact=function(t){++M.b2_toiCalls;var e=t.proxyA,i=t.proxyB,o=t.sweepA,s=t.sweepB;r.b2Assert(o.t0==s.t0),r.b2Assert(1-o.t0>Number.MIN_VALUE);var a=e.m_radius+i.m_radius,l=t.tolerance,h=0,c=0,u=0;for(M.s_cache.count=0,M.s_distanceInput.useRadii=!1;;){if(o.GetTransform(M.s_xfA,h),s.GetTransform(M.s_xfB,h),M.s_distanceInput.proxyA=e,M.s_distanceInput.proxyB=i,M.s_distanceInput.transformA=M.s_xfA,M.s_distanceInput.transformB=M.s_xfB,m.Distance(M.s_distanceOutput,M.s_cache,M.s_distanceInput),M.s_distanceOutput.distance<=0){h=1;break}M.s_fcn.Initialize(M.s_cache,e,M.s_xfA,i,M.s_xfB);var p=M.s_fcn.Evaluate(M.s_xfA,M.s_xfB);if(p<=0){h=1;break}if(0==c&&(u=p>a?n.Max(a-l,.75*a):n.Max(p-l,.02*a)),p-u<.5*l){if(0==c){h=1;break}break}var d=h,f=h,y=1,_=p;o.GetTransform(M.s_xfA,y),s.GetTransform(M.s_xfB,y);var g=M.s_fcn.Evaluate(M.s_xfA,M.s_xfB);if(g>=u){h=1;break}for(var x=0;;){var v=0;v=1&x?f+(u-_)*(y-f)/(g-_):.5*(f+y),o.GetTransform(M.s_xfA,v),s.GetTransform(M.s_xfB,v);var b=M.s_fcn.Evaluate(M.s_xfA,M.s_xfB);if(n.Abs(b-u)<.025*l){d=v;break}if(b>u?(f=v,_=b):(y=v,g=b),++x,++M.b2_toiRootIters,50==x)break}if(M.b2_toiMaxRootIters=n.Max(M.b2_toiMaxRootIters,x),d<(1+100*Number.MIN_VALUE)*h)break;if(h=d,c++,++M.b2_toiIters,1e3==c)break}return M.b2_toiMaxIters=n.Max(M.b2_toiMaxIters,c),h},Box2D.postDefs.push((function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new P,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new f,Box2D.Collision.b2TimeOfImpact.s_xfA=new s,Box2D.Collision.b2TimeOfImpact.s_xfB=new s,Box2D.Collision.b2TimeOfImpact.s_fcn=new E,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new y})),O.b2TOIInput=function(){this.proxyA=new _,this.proxyB=new _,this.sweepA=new o,this.sweepB=new o},R.b2WorldManifold=function(){this.m_normal=new a},R.prototype.b2WorldManifold=function(){this.m_points=new Vector(r.b2_maxManifoldPoints);for(var t=0;t<r.b2_maxManifoldPoints;t++)this.m_points[t]=new a},R.prototype.Initialize=function(t,e,i,r,n){if(void 0===i&&(i=0),void 0===n&&(n=0),0!=t.m_pointCount){var o,s,a=0,l=0,h=0,c=0,u=0,p=0,d=0;switch(t.m_type){case w.e_circles:s=e.R,o=t.m_localPoint;var m=e.position.x+s.col1.x*o.x+s.col2.x*o.y,f=e.position.y+s.col1.y*o.x+s.col2.y*o.y;s=r.R,o=t.m_points[0].m_localPoint;var y=r.position.x+s.col1.x*o.x+s.col2.x*o.y,_=r.position.y+s.col1.y*o.x+s.col2.y*o.y,g=y-m,x=_-f,v=g*g+x*x;if(v>Number.MIN_VALUE*Number.MIN_VALUE){var b=Math.sqrt(v);this.m_normal.x=g/b,this.m_normal.y=x/b}else this.m_normal.x=1,this.m_normal.y=0;var S=m+i*this.m_normal.x,C=f+i*this.m_normal.y,D=y-n*this.m_normal.x,T=_-n*this.m_normal.y;this.m_points[0].x=.5*(S+D),this.m_points[0].y=.5*(C+T);break;case w.e_faceA:for(s=e.R,o=t.m_localPlaneNormal,l=s.col1.x*o.x+s.col2.x*o.y,h=s.col1.y*o.x+s.col2.y*o.y,s=e.R,o=t.m_localPoint,c=e.position.x+s.col1.x*o.x+s.col2.x*o.y,u=e.position.y+s.col1.y*o.x+s.col2.y*o.y,this.m_normal.x=l,this.m_normal.y=h,a=0;a<t.m_pointCount;a++)s=r.R,o=t.m_points[a].m_localPoint,p=r.position.x+s.col1.x*o.x+s.col2.x*o.y,d=r.position.y+s.col1.y*o.x+s.col2.y*o.y,this.m_points[a].x=p+.5*(i-(p-c)*l-(d-u)*h-n)*l,this.m_points[a].y=d+.5*(i-(p-c)*l-(d-u)*h-n)*h;break;case w.e_faceB:for(s=r.R,o=t.m_localPlaneNormal,l=s.col1.x*o.x+s.col2.x*o.y,h=s.col1.y*o.x+s.col2.y*o.y,s=r.R,o=t.m_localPoint,c=r.position.x+s.col1.x*o.x+s.col2.x*o.y,u=r.position.y+s.col1.y*o.x+s.col2.y*o.y,this.m_normal.x=-l,this.m_normal.y=-h,a=0;a<t.m_pointCount;a++)s=e.R,o=t.m_points[a].m_localPoint,p=e.position.x+s.col1.x*o.x+s.col2.x*o.y,d=e.position.y+s.col1.y*o.x+s.col2.y*o.y,this.m_points[a].x=p+.5*(n-(p-c)*l-(d-u)*h-i)*l,this.m_points[a].y=d+.5*(n-(p-c)*l-(d-u)*h-i)*h}}},L.ClipVertex=function(){this.v=new a,this.id=new p},L.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},k.Features=function(){},Object.defineProperty(k.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(k.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._referenceEdge=t,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(k.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(k.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentEdge=t,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}}),Object.defineProperty(k.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(k.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._incidentVertex=t,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}}),Object.defineProperty(k.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(k.prototype,"flip",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._flip=t,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}})}(),function(){Box2D.Common.b2Color,Box2D.Common.b2internal;var t=Box2D.Common.b2Settings,e=Box2D.Collision.Shapes.b2CircleShape,i=Box2D.Collision.Shapes.b2EdgeChainDef,r=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2MassData,o=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,a=Box2D.Common.Math.b2Mat22,l=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),h=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform),c=Box2D.Common.Math.b2Vec2,u=(Box2D.Common.Math.b2Vec3,Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance),p=Box2D.Collision.b2DistanceInput,d=Box2D.Collision.b2DistanceOutput,m=Box2D.Collision.b2DistanceProxy,f=(Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache);Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase;Box2D.inherit(e,Box2D.Collision.Shapes.b2Shape),e.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,e.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new c},e.prototype.Copy=function(){var t=new e;return t.Set(this),t},e.prototype.Set=function(t){if(this.__super.Set.call(this,t),Box2D.is(t,e)){var i=t instanceof e?t:null;this.m_p.SetV(i.m_p)}},e.prototype.TestPoint=function(t,e){var i=t.R,r=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),n=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);return(r=e.x-r)*r+(n=e.y-n)*n<=this.m_radius*this.m_radius},e.prototype.RayCast=function(t,e,i){var r=i.R,n=i.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y),o=i.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y),s=e.p1.x-n,a=e.p1.y-o,l=s*s+a*a-this.m_radius*this.m_radius,h=e.p2.x-e.p1.x,c=e.p2.y-e.p1.y,u=s*h+a*c,p=h*h+c*c,d=u*u-p*l;if(d<0||p<Number.MIN_VALUE)return!1;var m=-(u+Math.sqrt(d));return 0<=m&&m<=e.maxFraction*p&&(m/=p,t.fraction=m,t.normal.x=s+m*h,t.normal.y=a+m*c,t.normal.Normalize(),!0)},e.prototype.ComputeAABB=function(t,e){var i=e.R,r=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),n=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.Set(r-this.m_radius,n-this.m_radius),t.upperBound.Set(r+this.m_radius,n+this.m_radius)},e.prototype.ComputeMass=function(e,i){void 0===i&&(i=0),e.mass=i*t.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},e.prototype.ComputeSubmergedArea=function(t,e,i,r){void 0===e&&(e=0);var n=l.MulX(i,this.m_p),o=-(l.Dot(t,n)-e);if(o<-this.m_radius+Number.MIN_VALUE)return 0;if(o>this.m_radius)return r.SetV(n),Math.PI*this.m_radius*this.m_radius;var s=this.m_radius*this.m_radius,a=o*o,h=s*(Math.asin(o/this.m_radius)+Math.PI/2)+o*Math.sqrt(s-a),c=-2/3*Math.pow(s-a,1.5)/h;return r.x=n.x+t.x*c,r.y=n.y+t.y*c,h},e.prototype.GetLocalPosition=function(){return this.m_p},e.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},e.prototype.GetRadius=function(){return this.m_radius},e.prototype.SetRadius=function(t){void 0===t&&(t=0),this.m_radius=t},e.prototype.b2CircleShape=function(t){void 0===t&&(t=0),this.__super.b2Shape.call(this),this.m_type=s.e_circleShape,this.m_radius=t},i.b2EdgeChainDef=function(){},i.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(r,Box2D.Collision.Shapes.b2Shape),r.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,r.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new c,this.m_v1=new c,this.m_v2=new c,this.m_coreV1=new c,this.m_coreV2=new c,this.m_normal=new c,this.m_direction=new c,this.m_cornerDir1=new c,this.m_cornerDir2=new c},r.prototype.TestPoint=function(t,e){return!1},r.prototype.RayCast=function(t,e,i){var r,n=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y;r=i.R;var s=i.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),a=i.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),l=i.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-a,h=-(i.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-s),c=100*Number.MIN_VALUE,u=-(n*l+o*h);if(u>c){var p=e.p1.x-s,d=e.p1.y-a,m=p*l+d*h;if(0<=m&&m<=e.maxFraction*u){var f=-n*d+o*p;if(-c*u<=f&&f<=u*(1+c)){m/=u,t.fraction=m;var y=Math.sqrt(l*l+h*h);return t.normal.x=l/y,t.normal.y=h/y,!0}}}return!1},r.prototype.ComputeAABB=function(t,e){var i=e.R,r=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),n=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),o=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y),s=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);r<o?(t.lowerBound.x=r,t.upperBound.x=o):(t.lowerBound.x=o,t.upperBound.x=r),n<s?(t.lowerBound.y=n,t.upperBound.y=s):(t.lowerBound.y=s,t.upperBound.y=n)},r.prototype.ComputeMass=function(t,e){void 0===e&&(e=0),t.mass=0,t.center.SetV(this.m_v1),t.I=0},r.prototype.ComputeSubmergedArea=function(t,e,i,r){void 0===e&&(e=0);var n=new c(t.x*e,t.y*e),o=l.MulX(i,this.m_v1),s=l.MulX(i,this.m_v2),a=l.Dot(t,o)-e,h=l.Dot(t,s)-e;if(a>0){if(h>0)return 0;o.x=-h/(a-h)*o.x+a/(a-h)*s.x,o.y=-h/(a-h)*o.y+a/(a-h)*s.y}else h>0&&(s.x=-h/(a-h)*o.x+a/(a-h)*s.x,s.y=-h/(a-h)*o.y+a/(a-h)*s.y);return r.x=(n.x+o.x+s.x)/3,r.y=(n.y+o.y+s.y)/3,.5*((o.x-n.x)*(s.y-n.y)-(o.y-n.y)*(s.x-n.x))},r.prototype.GetLength=function(){return this.m_length},r.prototype.GetVertex1=function(){return this.m_v1},r.prototype.GetVertex2=function(){return this.m_v2},r.prototype.GetCoreVertex1=function(){return this.m_coreV1},r.prototype.GetCoreVertex2=function(){return this.m_coreV2},r.prototype.GetNormalVector=function(){return this.m_normal},r.prototype.GetDirectionVector=function(){return this.m_direction},r.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},r.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},r.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},r.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},r.prototype.GetFirstVertex=function(t){var e=t.R;return new c(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))},r.prototype.GetNextEdge=function(){return this.m_nextEdge},r.prototype.GetPrevEdge=function(){return this.m_prevEdge},r.prototype.Support=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=t.R,n=t.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),o=t.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),s=t.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y),a=t.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y);return n*e+o*i>s*e+a*i?(this.s_supportVec.x=n,this.s_supportVec.y=o):(this.s_supportVec.x=s,this.s_supportVec.y=a),this.s_supportVec},r.prototype.b2EdgeShape=function(e,i){this.__super.b2Shape.call(this),this.m_type=s.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=e,this.m_v2=i,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-t.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-t.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-t.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-t.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},r.prototype.SetPrevEdge=function(t,e,i,r){this.m_prevEdge=t,this.m_coreV1=e,this.m_cornerDir1=i,this.m_cornerConvex1=r},r.prototype.SetNextEdge=function(t,e,i,r){this.m_nextEdge=t,this.m_coreV2=e,this.m_cornerDir2=i,this.m_cornerConvex2=r},n.b2MassData=function(){this.mass=0,this.center=new c(0,0),this.I=0},Box2D.inherit(o,Box2D.Collision.Shapes.b2Shape),o.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,o.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},o.prototype.Copy=function(){var t=new o;return t.Set(this),t},o.prototype.Set=function(t){if(this.__super.Set.call(this,t),Box2D.is(t,o)){var e=t instanceof o?t:null;this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(e.m_vertices[i]),this.m_normals[i].SetV(e.m_normals[i])}},o.prototype.SetAsArray=function(t,e){void 0===e&&(e=0);var i,r=new Vector,n=0;for(n=0;n<t.length;++n)i=t[n],r.push(i);this.SetAsVector(r,e)},o.AsArray=function(t,e){void 0===e&&(e=0);var i=new o;return i.SetAsArray(t,e),i},o.prototype.SetAsVector=function(e,i){void 0===i&&(i=0),0==i&&(i=e.length),t.b2Assert(2<=i),this.m_vertexCount=i,this.Reserve(i);var r=0;for(r=0;r<this.m_vertexCount;r++)this.m_vertices[r].SetV(e[r]);for(r=0;r<this.m_vertexCount;++r){var n=parseInt(r),s=parseInt(r+1<this.m_vertexCount?r+1:0),a=l.SubtractVV(this.m_vertices[s],this.m_vertices[n]);t.b2Assert(a.LengthSquared()>Number.MIN_VALUE),this.m_normals[r].SetV(l.CrossVF(a,1)),this.m_normals[r].Normalize()}this.m_centroid=o.ComputeCentroid(this.m_vertices,this.m_vertexCount)},o.AsVector=function(t,e){void 0===e&&(e=0);var i=new o;return i.SetAsVector(t,e),i},o.prototype.SetAsBox=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},o.AsBox=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=new o;return i.SetAsBox(t,e),i},o.prototype.SetAsOrientedBox=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===r&&(r=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=i;var n=new h;n.position=i,n.R.Set(r);for(var o=0;o<this.m_vertexCount;++o)this.m_vertices[o]=l.MulX(n,this.m_vertices[o]),this.m_normals[o]=l.MulMV(n.R,this.m_normals[o])},o.AsOrientedBox=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===r&&(r=0);var n=new o;return n.SetAsOrientedBox(t,e,i,r),n},o.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(e),this.m_centroid.x=.5*(t.x+e.x),this.m_centroid.y=.5*(t.y+e.y),this.m_normals[0]=l.CrossVF(l.SubtractVV(e,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},o.AsEdge=function(t,e){var i=new o;return i.SetAsEdge(t,e),i},o.prototype.TestPoint=function(t,e){for(var i,r=t.R,n=e.x-t.position.x,o=e.y-t.position.y,s=n*r.col1.x+o*r.col1.y,a=n*r.col2.x+o*r.col2.y,l=0;l<this.m_vertexCount;++l){if(n=s-(i=this.m_vertices[l]).x,o=a-i.y,(i=this.m_normals[l]).x*n+i.y*o>0)return!1}return!0},o.prototype.RayCast=function(t,e,i){var r,n,o=0,s=e.maxFraction,a=0,l=0;a=e.p1.x-i.position.x,l=e.p1.y-i.position.y;var h=a*(r=i.R).col1.x+l*r.col1.y,c=a*r.col2.x+l*r.col2.y;a=e.p2.x-i.position.x,l=e.p2.y-i.position.y;for(var u=a*(r=i.R).col1.x+l*r.col1.y-h,p=a*r.col2.x+l*r.col2.y-c,d=parseInt(-1),m=0;m<this.m_vertexCount;++m){a=(n=this.m_vertices[m]).x-h,l=n.y-c;var f=(n=this.m_normals[m]).x*a+n.y*l,y=n.x*u+n.y*p;if(0==y){if(f<0)return!1}else y<0&&f<o*y?(o=f/y,d=m):y>0&&f<s*y&&(s=f/y);if(s<o-Number.MIN_VALUE)return!1}return d>=0&&(t.fraction=o,r=i.R,n=this.m_normals[d],t.normal.x=r.col1.x*n.x+r.col2.x*n.y,t.normal.y=r.col1.y*n.x+r.col2.y*n.y,!0)},o.prototype.ComputeAABB=function(t,e){for(var i=e.R,r=this.m_vertices[0],n=e.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.position.y+(i.col1.y*r.x+i.col2.y*r.y),s=n,a=o,l=1;l<this.m_vertexCount;++l){r=this.m_vertices[l];var h=e.position.x+(i.col1.x*r.x+i.col2.x*r.y),c=e.position.y+(i.col1.y*r.x+i.col2.y*r.y);n=n<h?n:h,o=o<c?o:c,s=s>h?s:h,a=a>c?a:c}t.lowerBound.x=n-this.m_radius,t.lowerBound.y=o-this.m_radius,t.upperBound.x=s+this.m_radius,t.upperBound.y=a+this.m_radius},o.prototype.ComputeMass=function(t,e){if(void 0===e&&(e=0),2==this.m_vertexCount)return t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,void(t.I=0);for(var i=0,r=0,n=0,o=0,s=1/3,a=0;a<this.m_vertexCount;++a){var l=this.m_vertices[a],h=a+1<this.m_vertexCount?this.m_vertices[parseInt(a+1)]:this.m_vertices[0],c=l.x-0,u=l.y-0,p=h.x-0,d=h.y-0,m=c*d-u*p,f=.5*m;n+=f,i+=f*s*(0+l.x+h.x),r+=f*s*(0+l.y+h.y);o+=m*(s*(.25*(c*c+p*c+p*p)+(0*c+0*p))+0+(s*(.25*(u*u+d*u+d*d)+(0*u+0*d))+0))}t.mass=e*n,i*=1/n,r*=1/n,t.center.Set(i,r),t.I=e*o},o.prototype.ComputeSubmergedArea=function(t,e,i,r){void 0===e&&(e=0);var o=l.MulTMV(i.R,t),s=e-l.Dot(t,i.position),a=new Vector_a2j_Number,h=0,u=parseInt(-1),p=parseInt(-1),d=!1,m=0;for(m=0;m<this.m_vertexCount;++m){a[m]=l.Dot(o,this.m_vertices[m])-s;var f=a[m]<-Number.MIN_VALUE;m>0&&(f?d||(u=m-1,h++):d&&(p=m-1,h++)),d=f}switch(h){case 0:if(d){var y=new n;return this.ComputeMass(y,1),r.SetV(l.MulX(i,y.center)),y.mass}return 0;case 1:-1==u?u=this.m_vertexCount-1:p=this.m_vertexCount-1}var _,g=parseInt((u+1)%this.m_vertexCount),x=parseInt((p+1)%this.m_vertexCount),v=(0-a[u])/(a[g]-a[u]),b=(0-a[p])/(a[x]-a[p]),w=new c(this.m_vertices[u].x*(1-v)+this.m_vertices[g].x*v,this.m_vertices[u].y*(1-v)+this.m_vertices[g].y*v),S=new c(this.m_vertices[p].x*(1-b)+this.m_vertices[x].x*b,this.m_vertices[p].y*(1-b)+this.m_vertices[x].y*b),C=0,D=new c,T=this.m_vertices[g];for(m=g;m!=x;){_=(m=(m+1)%this.m_vertexCount)==x?S:this.m_vertices[m];var A=.5*((T.x-w.x)*(_.y-w.y)-(T.y-w.y)*(_.x-w.x));C+=A,D.x+=A*(w.x+T.x+_.x)/3,D.y+=A*(w.y+T.y+_.y)/3,T=_}return D.Multiply(1/C),r.SetV(l.MulX(i,D)),C},o.prototype.GetVertexCount=function(){return this.m_vertexCount},o.prototype.GetVertices=function(){return this.m_vertices},o.prototype.GetNormals=function(){return this.m_normals},o.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,r=1;r<this.m_vertexCount;++r){var n=this.m_vertices[r].x*t.x+this.m_vertices[r].y*t.y;n>i&&(e=r,i=n)}return e},o.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,r=1;r<this.m_vertexCount;++r){var n=this.m_vertices[r].x*t.x+this.m_vertices[r].y*t.y;n>i&&(e=r,i=n)}return this.m_vertices[e]},o.prototype.Validate=function(){return!1},o.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=s.e_polygonShape,this.m_centroid=new c,this.m_vertices=new Vector,this.m_normals=new Vector},o.prototype.Reserve=function(t){void 0===t&&(t=0);for(var e=parseInt(this.m_vertices.length);e<t;e++)this.m_vertices[e]=new c,this.m_normals[e]=new c},o.ComputeCentroid=function(t,e){void 0===e&&(e=0);for(var i=new c,r=0,n=1/3,o=0;o<e;++o){var s=t[o],a=o+1<e?t[parseInt(o+1)]:t[0],l=s.x-0,h=s.y-0,u=a.x-0,p=.5*(l*(a.y-0)-h*u);r+=p,i.x+=p*n*(0+s.x+a.x),i.y+=p*n*(0+s.y+a.y)}return i.x*=1/r,i.y*=1/r,i},o.ComputeOBB=function(t,e,i){void 0===i&&(i=0);var r=0,n=new Vector(i+1);for(r=0;r<i;++r)n[r]=e[r];n[i]=n[0];var o=Number.MAX_VALUE;for(r=1;r<=i;++r){for(var s=n[parseInt(r-1)],a=n[r].x-s.x,l=n[r].y-s.y,h=Math.sqrt(a*a+l*l),c=-(l/=h),u=a/=h,p=Number.MAX_VALUE,d=Number.MAX_VALUE,m=-Number.MAX_VALUE,f=-Number.MAX_VALUE,y=0;y<i;++y){var _=n[y].x-s.x,g=n[y].y-s.y,x=a*_+l*g,v=c*_+u*g;x<p&&(p=x),v<d&&(d=v),x>m&&(m=x),v>f&&(f=v)}var b=(m-p)*(f-d);if(b<.95*o){o=b,t.R.col1.x=a,t.R.col1.y=l,t.R.col2.x=c,t.R.col2.y=u;var w=.5*(p+m),S=.5*(d+f),C=t.R;t.center.x=s.x+(C.col1.x*w+C.col2.x*S),t.center.y=s.y+(C.col1.y*w+C.col2.y*S),t.extents.x=.5*(m-p),t.extents.y=.5*(f-d)}}},Box2D.postDefs.push((function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new a})),s.b2Shape=function(){},s.prototype.Copy=function(){return null},s.prototype.Set=function(t){this.m_radius=t.m_radius},s.prototype.GetType=function(){return this.m_type},s.prototype.TestPoint=function(t,e){return!1},s.prototype.RayCast=function(t,e,i){return!1},s.prototype.ComputeAABB=function(t,e){},s.prototype.ComputeMass=function(t,e){void 0===e&&(e=0)},s.prototype.ComputeSubmergedArea=function(t,e,i,r){return void 0===e&&(e=0),0},s.TestOverlap=function(t,e,i,r){var n=new p;n.proxyA=new m,n.proxyA.Set(t),n.proxyB=new m,n.proxyB.Set(i),n.transformA=e,n.transformB=r,n.useRadii=!0;var o=new f;o.count=0;var s=new d;return u.Distance(s,o,n),s.distance<10*Number.MIN_VALUE},s.prototype.b2Shape=function(){this.m_type=s.e_unknownShape,this.m_radius=t.b2_linearSlop},Box2D.postDefs.push((function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)}))}(),function(){var t=Box2D.Common.b2Color,e=(Box2D.Common.b2internal,Box2D.Common.b2Settings),i=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math);Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2,Box2D.Common.Math.b2Vec3;t.b2Color=function(){this._r=0,this._g=0,this._b=0},t.prototype.b2Color=function(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this._r=Box2D.parseUInt(255*i.Clamp(t,0,1)),this._g=Box2D.parseUInt(255*i.Clamp(e,0,1)),this._b=Box2D.parseUInt(255*i.Clamp(r,0,1))},t.prototype.Set=function(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this._r=Box2D.parseUInt(255*i.Clamp(t,0,1)),this._g=Box2D.parseUInt(255*i.Clamp(e,0,1)),this._b=Box2D.parseUInt(255*i.Clamp(r,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._r=Box2D.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._g=Box2D.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){void 0===t&&(t=0),this._b=Box2D.parseUInt(255*i.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),e.b2Settings=function(){},e.b2MixFriction=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),Math.sqrt(t*e)},e.b2MixRestitution=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t>e?t:e},e.b2Assert=function(t){if(!t)throw"Assertion Failed"},Box2D.postDefs.push((function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*e.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*e.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*e.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*e.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=e.b2_maxTranslation*e.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*e.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*e.b2_pi}))}(),function(){Box2D.Collision.b2AABB,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings;var t=Box2D.Common.Math.b2Mat22,e=Box2D.Common.Math.b2Mat33,i=Box2D.Common.Math.b2Math,r=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,s=Box2D.Common.Math.b2Vec3;t.b2Mat22=function(){this.col1=new o,this.col2=new o},t.prototype.b2Mat22=function(){this.SetIdentity()},t.FromAngle=function(e){void 0===e&&(e=0);var i=new t;return i.Set(e),i},t.FromVV=function(e,i){var r=new t;return r.SetVV(e,i),r},t.prototype.Set=function(t){void 0===t&&(t=0);var e=Math.cos(t),i=Math.sin(t);this.col1.x=e,this.col2.x=-i,this.col1.y=i,this.col2.y=e},t.prototype.SetVV=function(t,e){this.col1.SetV(t),this.col2.SetV(e)},t.prototype.Copy=function(){var e=new t;return e.SetM(this),e},t.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},t.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},t.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},t.prototype.GetInverse=function(t){var e=this.col1.x,i=this.col2.x,r=this.col1.y,n=this.col2.y,o=e*n-i*r;return 0!=o&&(o=1/o),t.col1.x=o*n,t.col2.x=-o*i,t.col1.y=-o*r,t.col2.y=o*e,t},t.prototype.Solve=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=this.col1.x,n=this.col2.x,o=this.col1.y,s=this.col2.y,a=r*s-n*o;return 0!=a&&(a=1/a),t.x=a*(s*e-n*i),t.y=a*(r*i-o*e),t},t.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},e.b2Mat33=function(){this.col1=new s,this.col2=new s,this.col3=new s},e.prototype.b2Mat33=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),t||e||i?(this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},e.prototype.SetVVV=function(t,e,i){this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)},e.prototype.Copy=function(){return new e(this.col1,this.col2,this.col3)},e.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},e.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},e.prototype.Solve22=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=this.col1.x,n=this.col2.x,o=this.col1.y,s=this.col2.y,a=r*s-n*o;return 0!=a&&(a=1/a),t.x=a*(s*e-n*i),t.y=a*(r*i-o*e),t},e.prototype.Solve33=function(t,e,i,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0);var n=this.col1.x,o=this.col1.y,s=this.col1.z,a=this.col2.x,l=this.col2.y,h=this.col2.z,c=this.col3.x,u=this.col3.y,p=this.col3.z,d=n*(l*p-h*u)+o*(h*c-a*p)+s*(a*u-l*c);return 0!=d&&(d=1/d),t.x=d*(e*(l*p-h*u)+i*(h*c-a*p)+r*(a*u-l*c)),t.y=d*(n*(i*p-r*u)+o*(r*c-e*p)+s*(e*u-i*c)),t.z=d*(n*(l*r-h*i)+o*(h*e-a*r)+s*(a*i-l*e)),t},i.b2Math=function(){},i.IsValid=function(t){return void 0===t&&(t=0),isFinite(t)},i.Dot=function(t,e){return t.x*e.x+t.y*e.y},i.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},i.CrossVF=function(t,e){return void 0===e&&(e=0),new o(e*t.y,-e*t.x)},i.CrossFV=function(t,e){return void 0===t&&(t=0),new o(-t*e.y,t*e.x)},i.MulMV=function(t,e){return new o(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y)},i.MulTMV=function(t,e){return new o(i.Dot(e,t.col1),i.Dot(e,t.col2))},i.MulX=function(t,e){var r=i.MulMV(t.R,e);return r.x+=t.position.x,r.y+=t.position.y,r},i.MulXT=function(t,e){var r=i.SubtractVV(e,t.position),n=r.x*t.R.col1.x+r.y*t.R.col1.y;return r.y=r.x*t.R.col2.x+r.y*t.R.col2.y,r.x=n,r},i.AddVV=function(t,e){return new o(t.x+e.x,t.y+e.y)},i.SubtractVV=function(t,e){return new o(t.x-e.x,t.y-e.y)},i.Distance=function(t,e){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},i.DistanceSquared=function(t,e){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r},i.MulFV=function(t,e){return void 0===t&&(t=0),new o(t*e.x,t*e.y)},i.AddMM=function(e,r){return t.FromVV(i.AddVV(e.col1,r.col1),i.AddVV(e.col2,r.col2))},i.MulMM=function(e,r){return t.FromVV(i.MulMV(e,r.col1),i.MulMV(e,r.col2))},i.MulTMM=function(e,r){var n=new o(i.Dot(e.col1,r.col1),i.Dot(e.col2,r.col1)),s=new o(i.Dot(e.col1,r.col2),i.Dot(e.col2,r.col2));return t.FromVV(n,s)},i.Abs=function(t){return void 0===t&&(t=0),t>0?t:-t},i.AbsV=function(t){return new o(i.Abs(t.x),i.Abs(t.y))},i.AbsM=function(e){return t.FromVV(i.AbsV(e.col1),i.AbsV(e.col2))},i.Min=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t<e?t:e},i.MinV=function(t,e){return new o(i.Min(t.x,e.x),i.Min(t.y,e.y))},i.Max=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),t>e?t:e},i.MaxV=function(t,e){return new o(i.Max(t.x,e.x),i.Max(t.y,e.y))},i.Clamp=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),t<e?e:t>i?i:t},i.ClampV=function(t,e,r){return i.MaxV(e,i.MinV(t,r))},i.Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},i.Random=function(){return 2*Math.random()-1},i.RandomRange=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=Math.random();return i=(e-t)*i+t},i.NextPowerOfTwo=function(t){return void 0===t&&(t=0),t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,(t|=t>>16&65535)+1},i.IsPowerOfTwo=function(t){return void 0===t&&(t=0),t>0&&0==(t&t-1)},Box2D.postDefs.push((function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new o(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=t.FromVV(new o(1,0),new o(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new n(i.b2Vec2_zero,i.b2Mat22_identity)})),r.b2Sweep=function(){this.localCenter=new o,this.c0=new o,this.c=new o},r.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},r.prototype.Copy=function(){var t=new r;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},r.prototype.GetTransform=function(t,e){void 0===e&&(e=0),t.position.x=(1-e)*this.c0.x+e*this.c.x,t.position.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.R.Set(i);var r=t.R;t.position.x-=r.col1.x*this.localCenter.x+r.col2.x*this.localCenter.y,t.position.y-=r.col1.y*this.localCenter.x+r.col2.y*this.localCenter.y},r.prototype.Advance=function(t){if(void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x,this.c0.y=(1-e)*this.c0.y+e*this.c.y,this.a0=(1-e)*this.a0+e*this.a,this.t0=t}},n.b2Transform=function(){this.position=new o,this.R=new t},n.prototype.b2Transform=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),t&&(this.position.SetV(t),this.R.SetM(e))},n.prototype.Initialize=function(t,e){this.position.SetV(t),this.R.SetM(e)},n.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},n.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},n.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},o.b2Vec2=function(){},o.prototype.b2Vec2=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},o.prototype.SetZero=function(){this.x=0,this.y=0},o.prototype.Set=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},o.prototype.SetV=function(t){this.x=t.x,this.y=t.y},o.prototype.GetNegative=function(){return new o(-this.x,-this.y)},o.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},o.Make=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new o(t,e)},o.prototype.Copy=function(){return new o(this.x,this.y)},o.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},o.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},o.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t},o.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},o.prototype.MulTM=function(t){var e=i.Dot(this,t.col1);this.y=i.Dot(this,t.col2),this.x=e},o.prototype.CrossVF=function(t){void 0===t&&(t=0);var e=this.x;this.x=t*this.y,this.y=-t*e},o.prototype.CrossFV=function(t){void 0===t&&(t=0);var e=this.x;this.x=-t*this.y,this.y=t*e},o.prototype.MinV=function(t){this.x=this.x<t.x?this.x:t.x,this.y=this.y<t.y?this.y:t.y},o.prototype.MaxV=function(t){this.x=this.x>t.x?this.x:t.x,this.y=this.y>t.y?this.y:t.y},o.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},o.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},o.prototype.Normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t<Number.MIN_VALUE)return 0;var e=1/t;return this.x*=e,this.y*=e,t},o.prototype.IsValid=function(){return i.IsValid(this.x)&&i.IsValid(this.y)},s.b2Vec3=function(){},s.prototype.b2Vec3=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i},s.prototype.SetZero=function(){this.x=this.y=this.z=0},s.prototype.Set=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i},s.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},s.prototype.GetNegative=function(){return new s(-this.x,-this.y,-this.z)},s.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},s.prototype.Copy=function(){return new s(this.x,this.y,this.z)},s.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},s.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},s.prototype.Multiply=function(t){void 0===t&&(t=0),this.x*=t,this.y*=t,this.z*=t}}(),function(){Box2D.Dynamics.Controllers.b2ControllerEdge,Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33;var t=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Sweep,i=Box2D.Common.Math.b2Transform,r=Box2D.Common.Math.b2Vec2,n=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),o=(Box2D.Common.b2internal,Box2D.Common.b2Settings),s=Box2D.Collision.b2AABB,a=(Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint),l=(Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase),h=(Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput),c=Box2D.Collision.b2RayCastOutput,u=(Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.Collision.Shapes.b2CircleShape),p=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),d=Box2D.Collision.Shapes.b2MassData,m=Box2D.Collision.Shapes.b2PolygonShape,f=Box2D.Collision.Shapes.b2Shape,y=Box2D.Dynamics.b2Body,_=Box2D.Dynamics.b2BodyDef,g=Box2D.Dynamics.b2ContactFilter,x=Box2D.Dynamics.b2ContactImpulse,v=Box2D.Dynamics.b2ContactListener,b=Box2D.Dynamics.b2ContactManager,w=Box2D.Dynamics.b2DebugDraw,S=Box2D.Dynamics.b2DestructionListener,C=Box2D.Dynamics.b2FilterData,D=Box2D.Dynamics.b2Fixture,T=Box2D.Dynamics.b2FixtureDef,A=Box2D.Dynamics.b2Island,E=Box2D.Dynamics.b2TimeStep,I=Box2D.Dynamics.b2World,P=(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),B=(Box2D.Dynamics.Contacts.b2ContactConstraint,Box2D.Dynamics.Contacts.b2ContactConstraintPoint,Box2D.Dynamics.Contacts.b2ContactEdge,Box2D.Dynamics.Contacts.b2ContactFactory),M=(Box2D.Dynamics.Contacts.b2ContactRegister,Box2D.Dynamics.Contacts.b2ContactResult,Box2D.Dynamics.Contacts.b2ContactSolver),O=(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2NullContact,Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2Controller,Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2Jacobian,Box2D.Dynamics.Joints.b2Joint),R=(Box2D.Dynamics.Joints.b2JointDef,Box2D.Dynamics.Joints.b2JointEdge,Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2PulleyJoint);Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2WeldJointDef;y.b2Body=function(){this.m_xf=new i,this.m_sweep=new e,this.m_linearVelocity=new r,this.m_force=new r},y.prototype.connectEdges=function(e,i,r){void 0===r&&(r=0);var n=Math.atan2(i.GetDirectionVector().y,i.GetDirectionVector().x),s=Math.tan(.5*(n-r)),a=t.MulFV(s,i.GetDirectionVector());a=t.SubtractVV(a,i.GetNormalVector()),a=t.MulFV(o.b2_toiSlop,a),a=t.AddVV(a,i.GetVertex1());var l=t.AddVV(e.GetDirectionVector(),i.GetDirectionVector());l.Normalize();var h=t.Dot(e.GetDirectionVector(),i.GetNormalVector())>0;return e.SetNextEdge(i,a,l,h),i.SetPrevEdge(e,a,l,h),n},y.prototype.CreateFixture=function(t){if(1==this.m_world.IsLocked())return null;var e=new D;if(e.Create(this,this.m_xf,t),this.m_flags&y.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxy(i,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_body=this,e.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=I.e_newFixture,e},y.prototype.CreateFixture2=function(t,e){void 0===e&&(e=0);var i=new T;return i.shape=t,i.density=e,this.CreateFixture(i)},y.prototype.DestroyFixture=function(t){if(1!=this.m_world.IsLocked()){for(var e=this.m_fixtureList,i=null;null!=e;){if(e==t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next,!0;break}i=e,e=e.m_next}for(var r=this.m_contactList;r;){var n=r.contact;r=r.next;var o=n.GetFixtureA(),s=n.GetFixtureB();t!=o&&t!=s||this.m_world.m_contactManager.Destroy(n)}if(this.m_flags&y.e_activeFlag){var a=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(a)}t.Destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},y.prototype.SetPositionAndAngle=function(t,e){var i;if(void 0===e&&(e=0),1!=this.m_world.IsLocked()){this.m_xf.R.Set(e),this.m_xf.position.SetV(t);var r=this.m_xf.R,n=this.m_sweep.localCenter;this.m_sweep.c.x=r.col1.x*n.x+r.col2.x*n.y,this.m_sweep.c.y=r.col1.y*n.x+r.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=e;var o=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(o,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},y.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},y.prototype.GetTransform=function(){return this.m_xf},y.prototype.GetPosition=function(){return this.m_xf.position},y.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},y.prototype.GetAngle=function(){return this.m_sweep.a},y.prototype.SetAngle=function(t){void 0===t&&(t=0),this.SetPositionAndAngle(this.GetPosition(),t)},y.prototype.GetWorldCenter=function(){return this.m_sweep.c},y.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},y.prototype.SetLinearVelocity=function(t){this.m_type!=y.b2_staticBody&&this.m_linearVelocity.SetV(t)},y.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},y.prototype.SetAngularVelocity=function(t){void 0===t&&(t=0),this.m_type!=y.b2_staticBody&&(this.m_angularVelocity=t)},y.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},y.prototype.GetDefinition=function(){var t=new _;return t.type=this.GetType(),t.allowSleep=(this.m_flags&y.e_allowSleepFlag)==y.e_allowSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&y.e_fixedRotationFlag)==y.e_fixedRotationFlag,t.bullet=(this.m_flags&y.e_bulletFlag)==y.e_bulletFlag,t.awake=(this.m_flags&y.e_awakeFlag)==y.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t.userData=this.GetUserData(),t},y.prototype.ApplyForce=function(t,e){this.m_type==y.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)},y.prototype.ApplyTorque=function(t){void 0===t&&(t=0),this.m_type==y.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=t)},y.prototype.ApplyImpulse=function(t,e){this.m_type==y.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},y.prototype.Split=function(e){for(var i,r=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),o=this.GetWorldCenter(),s=this,a=this.m_world.CreateBody(this.GetDefinition()),l=s.m_fixtureList;l;)if(e(l)){var h=l.m_next;i?i.m_next=h:s.m_fixtureList=h,s.m_fixtureCount--,l.m_next=a.m_fixtureList,a.m_fixtureList=l,a.m_fixtureCount++,l.m_body=a,l=h}else i=l,l=l.m_next;s.ResetMassData(),a.ResetMassData();var c=s.GetWorldCenter(),u=a.GetWorldCenter(),p=t.AddVV(r,t.CrossFV(n,t.SubtractVV(c,o))),d=t.AddVV(r,t.CrossFV(n,t.SubtractVV(u,o)));return s.SetLinearVelocity(p),a.SetLinearVelocity(d),s.SetAngularVelocity(n),a.SetAngularVelocity(n),s.SynchronizeFixtures(),a.SynchronizeFixtures(),a},y.prototype.Merge=function(t){var e;for(e=t.m_fixtureList;e;){var i=e.m_next;t.m_fixtureCount--,e.m_next=this.m_fixtureList,this.m_fixtureList=e,this.m_fixtureCount++,e.m_body=n,e=i}r.m_fixtureCount=0;var r=this,n=t;r.GetWorldCenter(),n.GetWorldCenter(),r.GetLinearVelocity().Copy(),n.GetLinearVelocity().Copy(),r.GetAngularVelocity(),n.GetAngularVelocity();r.ResetMassData(),this.SynchronizeFixtures()},y.prototype.GetMass=function(){return this.m_mass},y.prototype.GetInertia=function(){return this.m_I},y.prototype.GetMassData=function(t){t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter)},y.prototype.SetMassData=function(e){if(o.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==y.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&0==(this.m_flags&y.e_fixedRotationFlag)&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)}},y.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=y.b2_staticBody&&this.m_type!=y.b2_kinematicBody){for(var e=r.Make(0,0),i=this.m_fixtureList;i;i=i.m_next)if(0!=i.m_density){var n=i.GetMassData();this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&y.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,o.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var s=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-s.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-s.x)}},y.prototype.GetWorldPoint=function(t){var e=this.m_xf.R,i=new r(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,i},y.prototype.GetWorldVector=function(e){return t.MulMV(this.m_xf.R,e)},y.prototype.GetLocalPoint=function(e){return t.MulXT(this.m_xf,e)},y.prototype.GetLocalVector=function(e){return t.MulTMV(this.m_xf.R,e)},y.prototype.GetLinearVelocityFromWorldPoint=function(t){return new r(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},y.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R,i=new r(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,new r(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))},y.prototype.GetLinearDamping=function(){return this.m_linearDamping},y.prototype.SetLinearDamping=function(t){void 0===t&&(t=0),this.m_linearDamping=t},y.prototype.GetAngularDamping=function(){return this.m_angularDamping},y.prototype.SetAngularDamping=function(t){void 0===t&&(t=0),this.m_angularDamping=t},y.prototype.SetType=function(t){if(void 0===t&&(t=0),this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==y.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()}},y.prototype.GetType=function(){return this.m_type},y.prototype.SetBullet=function(t){t?this.m_flags|=y.e_bulletFlag:this.m_flags&=~y.e_bulletFlag},y.prototype.IsBullet=function(){return(this.m_flags&y.e_bulletFlag)==y.e_bulletFlag},y.prototype.SetSleepingAllowed=function(t){t?this.m_flags|=y.e_allowSleepFlag:(this.m_flags&=~y.e_allowSleepFlag,this.SetAwake(!0))},y.prototype.SetAwake=function(t){t?(this.m_flags|=y.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~y.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},y.prototype.IsAwake=function(){return(this.m_flags&y.e_awakeFlag)==y.e_awakeFlag},y.prototype.SetFixedRotation=function(t){t?this.m_flags|=y.e_fixedRotationFlag:this.m_flags&=~y.e_fixedRotationFlag,this.ResetMassData()},y.prototype.IsFixedRotation=function(){return(this.m_flags&y.e_fixedRotationFlag)==y.e_fixedRotationFlag},y.prototype.SetActive=function(t){var e,i;if(t!=this.IsActive())if(t)for(this.m_flags|=y.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.CreateProxy(e,this.m_xf);else{for(this.m_flags&=~y.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxy(e);for(var r=this.m_contactList;r;){var n=r;r=r.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}},y.prototype.IsActive=function(){return(this.m_flags&y.e_activeFlag)==y.e_activeFlag},y.prototype.IsSleepingAllowed=function(){return(this.m_flags&y.e_allowSleepFlag)==y.e_allowSleepFlag},y.prototype.GetFixtureList=function(){return this.m_fixtureList},y.prototype.GetJointList=function(){return this.m_jointList},y.prototype.GetControllerList=function(){return this.m_controllerList},y.prototype.GetContactList=function(){return this.m_contactList},y.prototype.GetNext=function(){return this.m_next},y.prototype.GetUserData=function(){return this.m_userData},y.prototype.SetUserData=function(t){this.m_userData=t},y.prototype.GetWorld=function(){return this.m_world},y.prototype.b2Body=function(t,e){this.m_flags=0,t.bullet&&(this.m_flags|=y.e_bulletFlag),t.fixedRotation&&(this.m_flags|=y.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=y.e_allowSleepFlag),t.awake&&(this.m_flags|=y.e_awakeFlag),t.active&&(this.m_flags|=y.e_activeFlag),this.m_world=e,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*r.x+i.col2.x*r.y,this.m_sweep.c.y=i.col1.y*r.x+i.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,this.m_type==y.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=t.inertiaScale,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0},y.prototype.SynchronizeFixtures=function(){var t=y.s_xf1;t.R.Set(this.m_sweep.a0);var e,i=t.R,r=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(i.col1.x*r.x+i.col2.x*r.y),t.position.y=this.m_sweep.c0.y-(i.col1.y*r.x+i.col2.y*r.y);var n=this.m_world.m_contactManager.m_broadPhase;for(e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(n,t,this.m_xf)},y.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)},y.prototype.ShouldCollide=function(t){if(this.m_type!=y.b2_dynamicBody&&t.m_type!=y.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},y.prototype.Advance=function(t){void 0===t&&(t=0),this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push((function(){Box2D.Dynamics.b2Body.s_xf1=new i,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2})),_.b2BodyDef=function(){this.position=new r,this.linearVelocity=new r},_.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=y.b2_staticBody,this.active=!0,this.inertiaScale=1},g.b2ContactFilter=function(){},g.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData(),r=e.GetFilterData();return i.groupIndex==r.groupIndex&&0!=i.groupIndex?i.groupIndex>0:0!=(i.maskBits&r.categoryBits)&&0!=(i.categoryBits&r.maskBits)},g.prototype.RayCollide=function(t,e){return!t||this.ShouldCollide(t instanceof D?t:null,e)},Box2D.postDefs.push((function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new g})),x.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(o.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(o.b2_maxManifoldPoints)},v.b2ContactListener=function(){},v.prototype.BeginContact=function(t){},v.prototype.EndContact=function(t){},v.prototype.PreSolve=function(t,e){},v.prototype.PostSolve=function(t,e){},Box2D.postDefs.push((function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new v})),b.b2ContactManager=function(){},b.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=g.b2_defaultFilter,this.m_contactListener=v.b2_defaultListener,this.m_contactFactory=new B(this.m_allocator),this.m_broadPhase=new l},b.prototype.AddPair=function(t,e){var i=t instanceof D?t:null,r=e instanceof D?e:null,n=i.GetBody(),o=r.GetBody();if(n!=o){for(var s=o.GetContactList();s;){if(s.other==n){var a=s.contact.GetFixtureA(),l=s.contact.GetFixtureB();if(a==i&&l==r)return;if(a==r&&l==i)return}s=s.next}if(0!=o.ShouldCollide(n)&&0!=this.m_contactFilter.ShouldCollide(i,r)){var h=this.m_contactFactory.Create(i,r);i=h.GetFixtureA(),r=h.GetFixtureB(),n=i.m_body,o=r.m_body,h.m_prev=null,h.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=h),this.m_world.m_contactList=h,h.m_nodeA.contact=h,h.m_nodeA.other=o,h.m_nodeA.prev=null,h.m_nodeA.next=n.m_contactList,null!=n.m_contactList&&(n.m_contactList.prev=h.m_nodeA),n.m_contactList=h.m_nodeA,h.m_nodeB.contact=h,h.m_nodeB.other=n,h.m_nodeB.prev=null,h.m_nodeB.next=o.m_contactList,null!=o.m_contactList&&(o.m_contactList.prev=h.m_nodeB),o.m_contactList=h.m_nodeB,++this.m_world.m_contactCount}}},b.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},b.prototype.Destroy=function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=e.GetBody(),n=i.GetBody();t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==r.m_contactList&&(r.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount},b.prototype.Collide=function(){for(var t=this.m_world.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=e.GetBody(),n=i.GetBody();if(0!=r.IsAwake()||0!=n.IsAwake()){if(t.m_flags&P.e_filterFlag){if(0==n.ShouldCollide(r)){var o=t;t=o.GetNext(),this.Destroy(o);continue}if(0==this.m_contactFilter.ShouldCollide(e,i)){t=(o=t).GetNext(),this.Destroy(o);continue}t.m_flags&=~P.e_filterFlag}var s=e.m_proxy,a=i.m_proxy;0!=this.m_broadPhase.TestOverlap(s,a)?(t.Update(this.m_contactListener),t=t.GetNext()):(t=(o=t).GetNext(),this.Destroy(o))}else t=t.GetNext()}},Box2D.postDefs.push((function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new a})),w.b2DebugDraw=function(){},w.prototype.b2DebugDraw=function(){},w.prototype.SetFlags=function(t){void 0===t&&(t=0)},w.prototype.GetFlags=function(){},w.prototype.AppendFlags=function(t){void 0===t&&(t=0)},w.prototype.ClearFlags=function(t){void 0===t&&(t=0)},w.prototype.SetSprite=function(t){},w.prototype.GetSprite=function(){},w.prototype.SetDrawScale=function(t){void 0===t&&(t=0)},w.prototype.GetDrawScale=function(){},w.prototype.SetLineThickness=function(t){void 0===t&&(t=0)},w.prototype.GetLineThickness=function(){},w.prototype.SetAlpha=function(t){void 0===t&&(t=0)},w.prototype.GetAlpha=function(){},w.prototype.SetFillAlpha=function(t){void 0===t&&(t=0)},w.prototype.GetFillAlpha=function(){},w.prototype.SetXFormScale=function(t){void 0===t&&(t=0)},w.prototype.GetXFormScale=function(){},w.prototype.DrawPolygon=function(t,e,i){void 0===e&&(e=0)},w.prototype.DrawSolidPolygon=function(t,e,i){void 0===e&&(e=0)},w.prototype.DrawCircle=function(t,e,i){void 0===e&&(e=0)},w.prototype.DrawSolidCircle=function(t,e,i,r){void 0===e&&(e=0)},w.prototype.DrawSegment=function(t,e,i){},w.prototype.DrawTransform=function(t){},Box2D.postDefs.push((function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32})),S.b2DestructionListener=function(){},S.prototype.SayGoodbyeJoint=function(t){},S.prototype.SayGoodbyeFixture=function(t){},C.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},C.prototype.Copy=function(){var t=new C;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},D.b2Fixture=function(){this.m_filter=new C},D.prototype.GetType=function(){return this.m_shape.GetType()},D.prototype.GetShape=function(){return this.m_shape},D.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(var e=this.m_body.GetContactList();e;){var i=e.contact,r=i.GetFixtureA(),n=i.GetFixtureB();r!=this&&n!=this||i.SetSensor(r.IsSensor()||n.IsSensor()),e=e.next}},D.prototype.IsSensor=function(){return this.m_isSensor},D.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),!this.m_body)for(var e=this.m_body.GetContactList();e;){var i=e.contact,r=i.GetFixtureA(),n=i.GetFixtureB();r!=this&&n!=this||i.FlagForFiltering(),e=e.next}},D.prototype.GetFilterData=function(){return this.m_filter.Copy()},D.prototype.GetBody=function(){return this.m_body},D.prototype.GetNext=function(){return this.m_next},D.prototype.GetUserData=function(){return this.m_userData},D.prototype.SetUserData=function(t){this.m_userData=t},D.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},D.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())},D.prototype.GetMassData=function(t){return void 0===t&&(t=null),null==t&&(t=new d),this.m_shape.ComputeMass(t,this.m_density),t},D.prototype.SetDensity=function(t){void 0===t&&(t=0),this.m_density=t},D.prototype.GetDensity=function(){return this.m_density},D.prototype.GetFriction=function(){return this.m_friction},D.prototype.SetFriction=function(t){void 0===t&&(t=0),this.m_friction=t},D.prototype.GetRestitution=function(){return this.m_restitution},D.prototype.SetRestitution=function(t){void 0===t&&(t=0),this.m_restitution=t},D.prototype.GetAABB=function(){return this.m_aabb},D.prototype.b2Fixture=function(){this.m_aabb=new s,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},D.prototype.Create=function(t,e,i){this.m_userData=i.userData,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_body=t,this.m_next=null,this.m_filter=i.filter.Copy(),this.m_isSensor=i.isSensor,this.m_shape=i.shape.Copy(),this.m_density=i.density},D.prototype.Destroy=function(){this.m_shape=null},D.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e),this.m_proxy=t.CreateProxy(this.m_aabb,this)},D.prototype.DestroyProxy=function(t){null!=this.m_proxy&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},D.prototype.Synchronize=function(e,i,r){if(this.m_proxy){var n=new s,o=new s;this.m_shape.ComputeAABB(n,i),this.m_shape.ComputeAABB(o,r),this.m_aabb.Combine(n,o);var a=t.SubtractVV(r.position,i.position);e.MoveProxy(this.m_proxy,this.m_aabb,a)}},T.b2FixtureDef=function(){this.filter=new C},T.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},A.b2Island=function(){},A.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},A.prototype.Initialize=function(t,e,i,r,n,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var s=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=r,this.m_listener=n,this.m_contactSolver=o,s=this.m_bodies.length;s<t;s++)this.m_bodies[s]=null;for(s=this.m_contacts.length;s<e;s++)this.m_contacts[s]=null;for(s=this.m_joints.length;s<i;s++)this.m_joints[s]=null},A.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},A.prototype.Solve=function(e,i,r){var n,s=0,a=0;for(s=0;s<this.m_bodyCount;++s)(n=this.m_bodies[s]).GetType()==y.b2_dynamicBody&&(n.m_linearVelocity.x+=e.dt*(i.x+n.m_invMass*n.m_force.x),n.m_linearVelocity.y+=e.dt*(i.y+n.m_invMass*n.m_force.y),n.m_angularVelocity+=e.dt*n.m_invI*n.m_torque,n.m_linearVelocity.Multiply(t.Clamp(1-e.dt*n.m_linearDamping,0,1)),n.m_angularVelocity*=t.Clamp(1-e.dt*n.m_angularDamping,0,1));this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var l=this.m_contactSolver;for(l.InitVelocityConstraints(e),s=0;s<this.m_jointCount;++s)this.m_joints[s].InitVelocityConstraints(e);for(s=0;s<e.velocityIterations;++s){for(a=0;a<this.m_jointCount;++a)this.m_joints[a].SolveVelocityConstraints(e);l.SolveVelocityConstraints()}for(s=0;s<this.m_jointCount;++s)this.m_joints[s].FinalizeVelocityConstraints();for(l.FinalizeVelocityConstraints(),s=0;s<this.m_bodyCount;++s)if((n=this.m_bodies[s]).GetType()!=y.b2_staticBody){var h=e.dt*n.m_linearVelocity.x,c=e.dt*n.m_linearVelocity.y;h*h+c*c>o.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=o.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=o.b2_maxTranslation*e.inv_dt);var u=e.dt*n.m_angularVelocity;u*u>o.b2_maxRotationSquared&&(n.m_angularVelocity<0?n.m_angularVelocity=-o.b2_maxRotation*e.inv_dt:n.m_angularVelocity=o.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}for(s=0;s<e.positionIterations;++s){var p=l.SolvePositionConstraints(o.b2_contactBaumgarte),d=!0;for(a=0;a<this.m_jointCount;++a){var m=this.m_joints[a].SolvePositionConstraints(o.b2_contactBaumgarte);d=d&&m}if(p&&d)break}if(this.Report(l.m_constraints),r){var f=Number.MAX_VALUE,_=o.b2_linearSleepTolerance*o.b2_linearSleepTolerance,g=o.b2_angularSleepTolerance*o.b2_angularSleepTolerance;for(s=0;s<this.m_bodyCount;++s)(n=this.m_bodies[s]).GetType()!=y.b2_staticBody&&(0==(n.m_flags&y.e_allowSleepFlag)&&(n.m_sleepTime=0,f=0),0==(n.m_flags&y.e_allowSleepFlag)||n.m_angularVelocity*n.m_angularVelocity>g||t.Dot(n.m_linearVelocity,n.m_linearVelocity)>_?(n.m_sleepTime=0,f=0):(n.m_sleepTime+=e.dt,f=t.Min(f,n.m_sleepTime)));if(f>=o.b2_timeToSleep)for(s=0;s<this.m_bodyCount;++s)(n=this.m_bodies[s]).SetAwake(!1)}},A.prototype.SolveTOI=function(t){var e=0,i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(e=0;e<this.m_jointCount;++e)this.m_joints[e].InitVelocityConstraints(t);for(e=0;e<t.velocityIterations;++e)for(r.SolveVelocityConstraints(),i=0;i<this.m_jointCount;++i)this.m_joints[i].SolveVelocityConstraints(t);for(e=0;e<this.m_bodyCount;++e){var n=this.m_bodies[e];if(n.GetType()!=y.b2_staticBody){var s=t.dt*n.m_linearVelocity.x,a=t.dt*n.m_linearVelocity.y;s*s+a*a>o.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=o.b2_maxTranslation*t.inv_dt,n.m_linearVelocity.y*=o.b2_maxTranslation*t.inv_dt);var l=t.dt*n.m_angularVelocity;l*l>o.b2_maxRotationSquared&&(n.m_angularVelocity<0?n.m_angularVelocity=-o.b2_maxRotation*t.inv_dt:n.m_angularVelocity=o.b2_maxRotation*t.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=t.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=t.dt*n.m_linearVelocity.y,n.m_sweep.a+=t.dt*n.m_angularVelocity,n.SynchronizeTransform()}}for(e=0;e<t.positionIterations;++e){var h=r.SolvePositionConstraints(.75),c=!0;for(i=0;i<this.m_jointCount;++i){var u=this.m_joints[i].SolvePositionConstraints(o.b2_contactBaumgarte);c=c&&u}if(h&&c)break}this.Report(r.m_constraints)},A.prototype.Report=function(t){if(null!=this.m_listener)for(var e=0;e<this.m_contactCount;++e){for(var i=this.m_contacts[e],r=t[e],n=0;n<r.pointCount;++n)A.s_impulse.normalImpulses[n]=r.points[n].normalImpulse,A.s_impulse.tangentImpulses[n]=r.points[n].tangentImpulse;this.m_listener.PostSolve(i,A.s_impulse)}},A.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},A.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},A.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},Box2D.postDefs.push((function(){Box2D.Dynamics.b2Island.s_impulse=new x})),E.b2TimeStep=function(){},E.prototype.Set=function(t){this.dt=t.dt,this.inv_dt=t.inv_dt,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting},I.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new b,this.m_contactSolver=new M,this.m_island=new A},I.prototype.b2World=function(t,e){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,I.m_warmStarting=!0,I.m_continuousPhysics=!0,this.m_allowSleep=e,this.m_gravity=t,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var i=new _;this.m_groundBody=this.CreateBody(i)},I.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},I.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},I.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},I.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},I.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;i;i=i.m_next)for(var r=i.m_fixtureList;r;r=r.m_next)r.m_proxy=t.CreateProxy(e.GetFatAABB(r.m_proxy),r)},I.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},I.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},I.prototype.CreateBody=function(t){if(1==this.IsLocked())return null;var e=new y(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},I.prototype.DestroyBody=function(t){if(1!=this.IsLocked()){for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint)}for(var r=t.m_controllerList;r;){var n=r;r=r.nextController,n.controller.RemoveBody(t)}for(var o=t.m_contactList;o;){var s=o;o=o.next,this.m_contactManager.Destroy(s.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var l=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxy(this.m_contactManager.m_broadPhase),l.Destroy()}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},I.prototype.CreateJoint=function(t){var e=O.Create(t,null);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.joint=e,e.m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.joint=e,e.m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA,r=t.bodyB;if(0==t.collideConnected)for(var n=r.GetContactList();n;)n.other==i&&n.contact.FlagForFiltering(),n=n.next;return e},I.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,r=t.m_bodyB;if(i.SetAwake(!0),r.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==r.m_jointList&&(r.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,O.Destroy(t,null),--this.m_jointCount,0==e)for(var n=r.GetContactList();n;)n.other==i&&n.contact.FlagForFiltering(),n=n.next},I.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList=t,t.m_world=this,this.m_controllerCount++,t},I.prototype.RemoveController=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),this.m_controllerCount--},I.prototype.CreateController=function(t){if(t.m_world!=this)throw new Error("Controller can only be a member of one world");return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t.m_world=this,t},I.prototype.DestroyController=function(t){t.Clear(),t.m_next&&(t.m_next.m_prev=t.m_prev),t.m_prev&&(t.m_prev.m_next=t.m_next),t==this.m_controllerList&&(this.m_controllerList=t.m_next),--this.m_controllerCount},I.prototype.SetWarmStarting=function(t){I.m_warmStarting=t},I.prototype.SetContinuousPhysics=function(t){I.m_continuousPhysics=t},I.prototype.GetBodyCount=function(){return this.m_bodyCount},I.prototype.GetJointCount=function(){return this.m_jointCount},I.prototype.GetContactCount=function(){return this.m_contactCount},I.prototype.SetGravity=function(t){this.m_gravity=t},I.prototype.GetGravity=function(){return this.m_gravity},I.prototype.GetGroundBody=function(){return this.m_groundBody},I.prototype.Step=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.m_flags&I.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~I.e_newFixture),this.m_flags|=I.e_locked;var r=I.s_timestep2;r.dt=t,r.velocityIterations=e,r.positionIterations=i,r.inv_dt=t>0?1/t:0,r.dtRatio=this.m_inv_dt0*t,r.warmStarting=I.m_warmStarting,this.m_contactManager.Collide(),r.dt>0&&this.Solve(r),I.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_flags&=~I.e_locked},I.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},I.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var t,e,i,o,a,l,h=this.m_debugDraw.GetFlags(),c=(new r,new r,new r,new s,new s,[new r,new r,new r,new r]),u=new n(0,0,0);if(h&w.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next)for(l=t.m_xf,e=t.GetFixtureList();e;e=e.m_next)i=e.GetShape(),0==t.IsActive()?(u.Set(.5,.5,.3),this.DrawShape(i,l,u)):t.GetType()==y.b2_staticBody?(u.Set(.5,.9,.5),this.DrawShape(i,l,u)):t.GetType()==y.b2_kinematicBody?(u.Set(.5,.5,.9),this.DrawShape(i,l,u)):0==t.IsAwake()?(u.Set(.6,.6,.6),this.DrawShape(i,l,u)):(u.Set(.9,.7,.7),this.DrawShape(i,l,u));if(h&w.e_jointBit)for(o=this.m_jointList;o;o=o.m_next)this.DrawJoint(o);if(h&w.e_controllerBit)for(var p=this.m_controllerList;p;p=p.m_next)p.Draw(this.m_debugDraw);if(h&w.e_pairBit){u.Set(.3,.9,.9);for(var d=this.m_contactManager.m_contactList;d;d=d.GetNext()){var m=d.GetFixtureA(),f=d.GetFixtureB(),_=m.GetAABB().GetCenter(),g=f.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(_,g,u)}}if(h&w.e_aabbBit)for(a=this.m_contactManager.m_broadPhase,c=[new r,new r,new r,new r],t=this.m_bodyList;t;t=t.GetNext())if(0!=t.IsActive())for(e=t.GetFixtureList();e;e=e.GetNext()){var x=a.GetFatAABB(e.m_proxy);c[0].Set(x.lowerBound.x,x.lowerBound.y),c[1].Set(x.upperBound.x,x.lowerBound.y),c[2].Set(x.upperBound.x,x.upperBound.y),c[3].Set(x.lowerBound.x,x.upperBound.y),this.m_debugDraw.DrawPolygon(c,4,u)}if(h&w.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)(l=I.s_xf).R=t.m_xf.R,l.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(l)}},I.prototype.QueryAABB=function(t,e){var i=this.m_contactManager.m_broadPhase;i.Query((function(e){return t(i.GetUserData(e))}),e)},I.prototype.QueryShape=function(t,e,r){void 0===r&&(r=null),null==r&&(r=new i).SetIdentity();var n=this.m_contactManager.m_broadPhase;var o=new s;e.ComputeAABB(o,r),n.Query((function(i){var o=n.GetUserData(i)instanceof D?n.GetUserData(i):null;return!f.TestOverlap(e,r,o.GetShape(),o.GetBody().GetTransform())||t(o)}),o)},I.prototype.QueryPoint=function(t,e){var i=this.m_contactManager.m_broadPhase;var r=new s;r.lowerBound.Set(e.x-o.b2_linearSlop,e.y-o.b2_linearSlop),r.upperBound.Set(e.x+o.b2_linearSlop,e.y+o.b2_linearSlop),i.Query((function(r){var n=i.GetUserData(r)instanceof D?i.GetUserData(r):null;return!n.TestPoint(e)||t(n)}),r)},I.prototype.RayCast=function(t,e,i){var n=this.m_contactManager.m_broadPhase,o=new c;var s=new h(e,i);n.RayCast((function(s,a){var l=n.GetUserData(a),h=l instanceof D?l:null;if(h.RayCast(o,s)){var c=o.fraction,u=new r((1-c)*e.x+c*i.x,(1-c)*e.y+c*i.y);return t(h,u,o.normal,c)}return s.maxFraction}),s)},I.prototype.RayCastOne=function(t,e){var i;return this.RayCast((function(t,e,r,n){return void 0===n&&(n=0),i=t,n}),t,e),i},I.prototype.RayCastAll=function(t,e){var i=new Vector;return this.RayCast((function(t,e,r,n){return void 0===n&&(n=0),i[i.length]=t,1}),t,e),i},I.prototype.GetBodyList=function(){return this.m_bodyList},I.prototype.GetJointList=function(){return this.m_jointList},I.prototype.GetContactList=function(){return this.m_contactList},I.prototype.IsLocked=function(){return(this.m_flags&I.e_locked)>0},I.prototype.Solve=function(t){for(var e,i=this.m_controllerList;i;i=i.m_next)i.Step(t);var r=this.m_island;for(r.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~y.e_islandFlag;for(var n=this.m_contactList;n;n=n.m_next)n.m_flags&=~P.e_islandFlag;for(var o=this.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var s=this.s_stack,a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&y.e_islandFlag)&&0!=a.IsAwake()&&0!=a.IsActive()&&a.GetType()!=y.b2_staticBody){r.Clear();var l=0;for(s[l++]=a,a.m_flags|=y.e_islandFlag;l>0;)if(e=s[--l],r.AddBody(e),0==e.IsAwake()&&e.SetAwake(!0),e.GetType()!=y.b2_staticBody){for(var h,c=e.m_contactList;c;c=c.next)c.contact.m_flags&P.e_islandFlag||1!=c.contact.IsSensor()&&0!=c.contact.IsEnabled()&&0!=c.contact.IsTouching()&&(r.AddContact(c.contact),c.contact.m_flags|=P.e_islandFlag,(h=c.other).m_flags&y.e_islandFlag||(s[l++]=h,h.m_flags|=y.e_islandFlag));for(var u=e.m_jointList;u;u=u.next)1!=u.joint.m_islandFlag&&0!=(h=u.other).IsActive()&&(r.AddJoint(u.joint),u.joint.m_islandFlag=!0,h.m_flags&y.e_islandFlag||(s[l++]=h,h.m_flags|=y.e_islandFlag))}r.Solve(t,this.m_gravity,this.m_allowSleep);for(var p=0;p<r.m_bodyCount;++p)(e=r.m_bodies[p]).GetType()==y.b2_staticBody&&(e.m_flags&=~y.e_islandFlag)}for(p=0;p<s.length&&s[p];++p)s[p]=null;for(e=this.m_bodyList;e;e=e.m_next)0!=e.IsAwake()&&0!=e.IsActive()&&e.GetType()!=y.b2_staticBody&&e.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},I.prototype.SolveTOI=function(t){var e,i,r,n,s,a,l,h=this.m_island;h.Initialize(this.m_bodyCount,o.b2_maxTOIContactsPerIsland,o.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var c,u=I.s_queue;for(e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~y.e_islandFlag,e.m_sweep.t0=0;for(c=this.m_contactList;c;c=c.m_next)c.m_flags&=~(P.e_toiFlag|P.e_islandFlag);for(l=this.m_jointList;l;l=l.m_next)l.m_islandFlag=!1;for(;;){var p=null,d=1;for(c=this.m_contactList;c;c=c.m_next)if(1!=c.IsSensor()&&0!=c.IsEnabled()&&0!=c.IsContinuous()){var m=1;if(c.m_flags&P.e_toiFlag)m=c.m_toi;else{if(i=c.m_fixtureA,r=c.m_fixtureB,n=i.m_body,s=r.m_body,!(n.GetType()==y.b2_dynamicBody&&0!=n.IsAwake()||s.GetType()==y.b2_dynamicBody&&0!=s.IsAwake()))continue;var f=n.m_sweep.t0;n.m_sweep.t0<s.m_sweep.t0?(f=s.m_sweep.t0,n.m_sweep.Advance(f)):s.m_sweep.t0<n.m_sweep.t0&&(f=n.m_sweep.t0,s.m_sweep.Advance(f)),m=c.ComputeTOI(n.m_sweep,s.m_sweep),o.b2Assert(0<=m&&m<=1),m>0&&m<1&&(m=(1-m)*f+m)>1&&(m=1),c.m_toi=m,c.m_flags|=P.e_toiFlag}Number.MIN_VALUE<m&&m<d&&(p=c,d=m)}if(null==p||1-100*Number.MIN_VALUE<d)break;if(i=p.m_fixtureA,r=p.m_fixtureB,n=i.m_body,s=r.m_body,I.s_backupA.Set(n.m_sweep),I.s_backupB.Set(s.m_sweep),n.Advance(d),s.Advance(d),p.Update(this.m_contactManager.m_contactListener),p.m_flags&=~P.e_toiFlag,1!=p.IsSensor()&&0!=p.IsEnabled()){if(0!=p.IsTouching()){var _=n;_.GetType()!=y.b2_dynamicBody&&(_=s),h.Clear();var g=0,x=0;for(u[g+x++]=_,_.m_flags|=y.e_islandFlag;x>0;)if(e=u[g++],--x,h.AddBody(e),0==e.IsAwake()&&e.SetAwake(!0),e.GetType()==y.b2_dynamicBody){for(a=e.m_contactList;a&&h.m_contactCount!=h.m_contactCapacity;a=a.next)if(!(a.contact.m_flags&P.e_islandFlag)&&1!=a.contact.IsSensor()&&0!=a.contact.IsEnabled()&&0!=a.contact.IsTouching()){h.AddContact(a.contact),a.contact.m_flags|=P.e_islandFlag;var v=a.other;v.m_flags&y.e_islandFlag||(v.GetType()!=y.b2_staticBody&&(v.Advance(d),v.SetAwake(!0)),u[g+x]=v,++x,v.m_flags|=y.e_islandFlag)}for(var b=e.m_jointList;b;b=b.next)h.m_jointCount!=h.m_jointCapacity&&1!=b.joint.m_islandFlag&&0!=(v=b.other).IsActive()&&(h.AddJoint(b.joint),b.joint.m_islandFlag=!0,v.m_flags&y.e_islandFlag||(v.GetType()!=y.b2_staticBody&&(v.Advance(d),v.SetAwake(!0)),u[g+x]=v,++x,v.m_flags|=y.e_islandFlag))}var w=I.s_timestep;w.warmStarting=!1,w.dt=(1-d)*t.dt,w.inv_dt=1/w.dt,w.dtRatio=0,w.velocityIterations=t.velocityIterations,w.positionIterations=t.positionIterations,h.SolveTOI(w);var S=0;for(S=0;S<h.m_bodyCount;++S)if((e=h.m_bodies[S]).m_flags&=~y.e_islandFlag,0!=e.IsAwake()&&e.GetType()==y.b2_dynamicBody)for(e.SynchronizeFixtures(),a=e.m_contactList;a;a=a.next)a.contact.m_flags&=~P.e_toiFlag;for(S=0;S<h.m_contactCount;++S)(c=h.m_contacts[S]).m_flags&=~(P.e_toiFlag|P.e_islandFlag);for(S=0;S<h.m_jointCount;++S)(l=h.m_joints[S]).m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else n.m_sweep.Set(I.s_backupA),s.m_sweep.Set(I.s_backupB),n.SynchronizeTransform(),s.SynchronizeTransform()}},I.prototype.DrawJoint=function(t){var e=t.GetBodyA(),i=t.GetBodyB(),r=e.m_xf,n=i.m_xf,o=r.position,s=n.position,a=t.GetAnchorA(),l=t.GetAnchorB(),h=I.s_jointColor;switch(t.m_type){case O.e_distanceJoint:this.m_debugDraw.DrawSegment(a,l,h);break;case O.e_pulleyJoint:var c=t instanceof R?t:null,u=c.GetGroundAnchorA(),p=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(u,a,h),this.m_debugDraw.DrawSegment(p,l,h),this.m_debugDraw.DrawSegment(u,p,h);break;case O.e_mouseJoint:this.m_debugDraw.DrawSegment(a,l,h);break;default:e!=this.m_groundBody&&this.m_debugDraw.DrawSegment(o,a,h),this.m_debugDraw.DrawSegment(a,l,h),i!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,l,h)}},I.prototype.DrawShape=function(e,i,r){switch(e.m_type){case f.e_circleShape:var n=e instanceof u?e:null,o=t.MulX(i,n.m_p),s=n.m_radius,a=i.R.col1;this.m_debugDraw.DrawSolidCircle(o,s,a,r);break;case f.e_polygonShape:var l=0,h=e instanceof m?e:null,c=parseInt(h.GetVertexCount()),d=h.GetVertices(),y=new Vector(c);for(l=0;l<c;++l)y[l]=t.MulX(i,d[l]);this.m_debugDraw.DrawSolidPolygon(y,c,r);break;case f.e_edgeShape:var _=e instanceof p?e:null;this.m_debugDraw.DrawSegment(t.MulX(i,_.GetVertex1()),t.MulX(i,_.GetVertex2()),r)}},Box2D.postDefs.push((function(){Box2D.Dynamics.b2World.s_timestep2=new E,Box2D.Dynamics.b2World.s_xf=new i,Box2D.Dynamics.b2World.s_backupA=new e,Box2D.Dynamics.b2World.s_backupB=new e,Box2D.Dynamics.b2World.s_timestep=new E,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new n(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2}))}(),function(){var t=Box2D.Collision.Shapes.b2CircleShape,e=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),i=(Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),r=Box2D.Collision.Shapes.b2Shape,n=Box2D.Dynamics.Contacts.b2CircleContact,o=Box2D.Dynamics.Contacts.b2Contact,s=Box2D.Dynamics.Contacts.b2ContactConstraint,a=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,l=Box2D.Dynamics.Contacts.b2ContactEdge,h=Box2D.Dynamics.Contacts.b2ContactFactory,c=Box2D.Dynamics.Contacts.b2ContactRegister,u=Box2D.Dynamics.Contacts.b2ContactResult,p=Box2D.Dynamics.Contacts.b2ContactSolver,d=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,m=Box2D.Dynamics.Contacts.b2NullContact,f=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,y=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,_=Box2D.Dynamics.Contacts.b2PolygonContact,g=Box2D.Dynamics.Contacts.b2PositionSolverManifold,x=Box2D.Dynamics.b2Body,v=(Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep),b=(Box2D.Dynamics.b2World,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),w=Box2D.Common.Math.b2Mat22,S=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),C=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),D=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision),T=Box2D.Collision.b2ContactID,A=(Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold),E=(Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact),I=Box2D.Collision.b2TOIInput,P=Box2D.Collision.b2WorldManifold;Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase;Box2D.inherit(n,Box2D.Dynamics.Contacts.b2Contact),n.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,n.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},n.Create=function(t){return new n},n.Destroy=function(t,e){},n.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},n.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody();D.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,i.m_xf)},o.b2Contact=function(){this.m_nodeA=new l,this.m_nodeB=new l,this.m_manifold=new A,this.m_oldManifold=new A},o.prototype.GetManifold=function(){return this.m_manifold},o.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),r.m_radius,i.GetTransform(),n.m_radius)},o.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)==o.e_touchingFlag},o.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)==o.e_continuousFlag},o.prototype.SetSensor=function(t){t?this.m_flags|=o.e_sensorFlag:this.m_flags&=~o.e_sensorFlag},o.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)==o.e_sensorFlag},o.prototype.SetEnabled=function(t){t?this.m_flags|=o.e_enabledFlag:this.m_flags&=~o.e_enabledFlag},o.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)==o.e_enabledFlag},o.prototype.GetNext=function(){return this.m_next},o.prototype.GetFixtureA=function(){return this.m_fixtureA},o.prototype.GetFixtureB=function(){return this.m_fixtureB},o.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},o.prototype.b2Contact=function(){},o.prototype.Reset=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=null),this.m_flags=o.e_enabledFlag,!t||!e)return this.m_fixtureA=null,void(this.m_fixtureB=null);(t.IsSensor()||e.IsSensor())&&(this.m_flags|=o.e_sensorFlag);var i=t.GetBody(),r=e.GetBody();(i.GetType()!=x.b2_dynamicBody||i.IsBullet()||r.GetType()!=x.b2_dynamicBody||r.IsBullet())&&(this.m_flags|=o.e_continuousFlag),this.m_fixtureA=t,this.m_fixtureB=e,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},o.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_flags|=o.e_enabledFlag;var i=!1,n=(this.m_flags&o.e_touchingFlag)==o.e_touchingFlag,s=this.m_fixtureA.m_body,a=this.m_fixtureB.m_body,l=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(l){var h=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape(),u=s.GetTransform(),p=a.GetTransform();i=r.TestOverlap(h,u,c,p)}this.m_manifold.m_pointCount=0}else{if(s.GetType()!=x.b2_dynamicBody||s.IsBullet()||a.GetType()!=x.b2_dynamicBody||a.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,l){this.Evaluate(),i=this.m_manifold.m_pointCount>0;for(var d=0;d<this.m_manifold.m_pointCount;++d){var m=this.m_manifold.m_points[d];m.m_normalImpulse=0,m.m_tangentImpulse=0;for(var f=m.m_id,y=0;y<this.m_oldManifold.m_pointCount;++y){var _=this.m_oldManifold.m_points[y];if(_.m_id.key==f.key){m.m_normalImpulse=_.m_normalImpulse,m.m_tangentImpulse=_.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;i!=n&&(s.SetAwake(!0),a.SetAwake(!0))}i?this.m_flags|=o.e_touchingFlag:this.m_flags&=~o.e_touchingFlag,0==n&&1==i&&t.BeginContact(this),1==n&&0==i&&t.EndContact(this),0==(this.m_flags&o.e_sensorFlag)&&t.PreSolve(this,this.m_oldManifold)},o.prototype.Evaluate=function(){},o.prototype.ComputeTOI=function(t,e){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=t,o.s_input.sweepB=e,o.s_input.tolerance=b.b2_linearSlop,E.TimeOfImpact(o.s_input)},Box2D.postDefs.push((function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new I})),s.b2ContactConstraint=function(){this.localPlaneNormal=new C,this.localPoint=new C,this.normal=new C,this.normalMass=new w,this.K=new w},s.prototype.b2ContactConstraint=function(){this.points=new Vector(b.b2_maxManifoldPoints);for(var t=0;t<b.b2_maxManifoldPoints;t++)this.points[t]=new a},a.b2ContactConstraintPoint=function(){this.localPoint=new C,this.rA=new C,this.rB=new C},l.b2ContactEdge=function(){},h.b2ContactFactory=function(){},h.prototype.b2ContactFactory=function(t){this.m_allocator=t,this.InitializeRegisters()},h.prototype.AddType=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),this.m_registers[i][r].createFcn=t,this.m_registers[i][r].destroyFcn=e,this.m_registers[i][r].primary=!0,i!=r&&(this.m_registers[r][i].createFcn=t,this.m_registers[r][i].destroyFcn=e,this.m_registers[r][i].primary=!1)},h.prototype.InitializeRegisters=function(){this.m_registers=new Vector(r.e_shapeTypeCount);for(var t=0;t<r.e_shapeTypeCount;t++){this.m_registers[t]=new Vector(r.e_shapeTypeCount);for(var e=0;e<r.e_shapeTypeCount;e++)this.m_registers[t][e]=new c}this.AddType(n.Create,n.Destroy,r.e_circleShape,r.e_circleShape),this.AddType(f.Create,f.Destroy,r.e_polygonShape,r.e_circleShape),this.AddType(_.Create,_.Destroy,r.e_polygonShape,r.e_polygonShape),this.AddType(d.Create,d.Destroy,r.e_edgeShape,r.e_circleShape),this.AddType(y.Create,y.Destroy,r.e_polygonShape,r.e_edgeShape)},h.prototype.Create=function(t,e){var i,r=parseInt(t.GetType()),n=parseInt(e.GetType()),o=this.m_registers[r][n];if(o.pool)return i=o.pool,o.pool=i.m_next,o.poolCount--,i.Reset(t,e),i;var s=o.createFcn;return null!=s?o.primary?((i=s(this.m_allocator)).Reset(t,e),i):((i=s(this.m_allocator)).Reset(e,t),i):null},h.prototype.Destroy=function(t){t.m_manifold.m_pointCount>0&&(t.m_fixtureA.m_body.SetAwake(!0),t.m_fixtureB.m_body.SetAwake(!0));var e=parseInt(t.m_fixtureA.GetType()),i=parseInt(t.m_fixtureB.GetType()),r=this.m_registers[e][i];r.poolCount++,t.m_next=r.pool,r.pool=t,(0,r.destroyFcn)(t,this.m_allocator)},c.b2ContactRegister=function(){},u.b2ContactResult=function(){this.position=new C,this.normal=new C,this.id=new T},p.b2ContactSolver=function(){this.m_step=new v,this.m_constraints=new Vector},p.prototype.b2ContactSolver=function(){},p.prototype.Initialize=function(t,e,i,r){var n;void 0===i&&(i=0),this.m_step.Set(t),this.m_allocator=r;var o=0;for(this.m_constraintCount=i;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new s;for(o=0;o<i;++o){var a=(n=e[o]).m_fixtureA,l=n.m_fixtureB,h=a.m_shape,c=l.m_shape,u=h.m_radius,d=c.m_radius,m=a.m_body,f=l.m_body,y=n.GetManifold(),_=b.b2MixFriction(a.GetFriction(),l.GetFriction()),g=b.b2MixRestitution(a.GetRestitution(),l.GetRestitution()),x=m.m_linearVelocity.x,v=m.m_linearVelocity.y,w=f.m_linearVelocity.x,S=f.m_linearVelocity.y,C=m.m_angularVelocity,D=f.m_angularVelocity;b.b2Assert(y.m_pointCount>0),p.s_worldManifold.Initialize(y,m.m_xf,u,f.m_xf,d);var T=p.s_worldManifold.m_normal.x,A=p.s_worldManifold.m_normal.y,E=this.m_constraints[o];E.bodyA=m,E.bodyB=f,E.manifold=y,E.normal.x=T,E.normal.y=A,E.pointCount=y.m_pointCount,E.friction=_,E.restitution=g,E.localPlaneNormal.x=y.m_localPlaneNormal.x,E.localPlaneNormal.y=y.m_localPlaneNormal.y,E.localPoint.x=y.m_localPoint.x,E.localPoint.y=y.m_localPoint.y,E.radius=u+d,E.type=y.m_type;for(var I=0;I<E.pointCount;++I){var P=y.m_points[I],B=E.points[I];B.normalImpulse=P.m_normalImpulse,B.tangentImpulse=P.m_tangentImpulse,B.localPoint.SetV(P.m_localPoint);var M=B.rA.x=p.s_worldManifold.m_points[I].x-m.m_sweep.c.x,O=B.rA.y=p.s_worldManifold.m_points[I].y-m.m_sweep.c.y,R=B.rB.x=p.s_worldManifold.m_points[I].x-f.m_sweep.c.x,L=B.rB.y=p.s_worldManifold.m_points[I].y-f.m_sweep.c.y,k=M*A-O*T,F=R*A-L*T;k*=k,F*=F;var N=m.m_invMass+f.m_invMass+m.m_invI*k+f.m_invI*F;B.normalMass=1/N;var V=m.m_mass*m.m_invMass+f.m_mass*f.m_invMass;V+=m.m_mass*m.m_invI*k+f.m_mass*f.m_invI*F,B.equalizedMass=1/V;var G=-T,U=M*G-O*A,j=R*G-L*A;U*=U,j*=j;var z=m.m_invMass+f.m_invMass+m.m_invI*U+f.m_invI*j;B.tangentMass=1/z,B.velocityBias=0;var X=w+-D*L-x- -C*O,H=S+D*R-v-C*M,J=E.normal.x*X+E.normal.y*H;J<-b.b2_velocityThreshold&&(B.velocityBias+=-E.restitution*J)}if(2==E.pointCount){var W=E.points[0],$=E.points[1],Y=m.m_invMass,q=m.m_invI,K=f.m_invMass,Z=f.m_invI,Q=W.rA.x*A-W.rA.y*T,tt=W.rB.x*A-W.rB.y*T,et=$.rA.x*A-$.rA.y*T,it=$.rB.x*A-$.rB.y*T,rt=Y+K+q*Q*Q+Z*tt*tt,nt=Y+K+q*et*et+Z*it*it,ot=Y+K+q*Q*et+Z*tt*it;rt*rt<100*(rt*nt-ot*ot)?(E.K.col1.Set(rt,ot),E.K.col2.Set(ot,nt),E.K.GetInverse(E.normalMass)):E.pointCount=1}}},p.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_constraintCount;++e){var i=this.m_constraints[e],r=i.bodyA,n=i.bodyB,o=r.m_invMass,s=r.m_invI,a=n.m_invMass,l=n.m_invI,h=i.normal.x,c=i.normal.y,u=c,p=-h,d=0,m=0;if(t.warmStarting)for(m=i.pointCount,d=0;d<m;++d){var f=i.points[d];f.normalImpulse*=t.dtRatio,f.tangentImpulse*=t.dtRatio;var y=f.normalImpulse*h+f.tangentImpulse*u,_=f.normalImpulse*c+f.tangentImpulse*p;r.m_angularVelocity-=s*(f.rA.x*_-f.rA.y*y),r.m_linearVelocity.x-=o*y,r.m_linearVelocity.y-=o*_,n.m_angularVelocity+=l*(f.rB.x*_-f.rB.y*y),n.m_linearVelocity.x+=a*y,n.m_linearVelocity.y+=a*_}else for(m=i.pointCount,d=0;d<m;++d){var g=i.points[d];g.normalImpulse=0,g.tangentImpulse=0}}},p.prototype.SolveVelocityConstraints=function(){for(var t,e,i=0,r=0,n=0,o=0,s=0,a=0,l=0,h=0,c=0,u=0,p=0,d=0,m=0,f=0,y=0;y<this.m_constraintCount;++y){var _=this.m_constraints[y],g=_.bodyA,x=_.bodyB,v=g.m_angularVelocity,b=x.m_angularVelocity,w=g.m_linearVelocity,C=x.m_linearVelocity,D=g.m_invMass,T=g.m_invI,A=x.m_invMass,E=x.m_invI,I=_.normal.x,P=_.normal.y,B=P,M=-I,O=_.friction;for(i=0;i<_.pointCount;i++)t=_.points[i],n=(C.x-b*t.rB.y-w.x+v*t.rA.y)*B+(C.y+b*t.rB.x-w.y-v*t.rA.x)*M,o=t.tangentMass*-n,s=O*t.normalImpulse,l=(o=(a=S.Clamp(t.tangentImpulse+o,-s,s))-t.tangentImpulse)*B,h=o*M,w.x-=D*l,w.y-=D*h,v-=T*(t.rA.x*h-t.rA.y*l),C.x+=A*l,C.y+=A*h,b+=E*(t.rB.x*h-t.rB.y*l),t.tangentImpulse=a;parseInt(_.pointCount);if(1==_.pointCount)t=_.points[0],r=(C.x+-b*t.rB.y-w.x- -v*t.rA.y)*I+(C.y+b*t.rB.x-w.y-v*t.rA.x)*P,o=-t.normalMass*(r-t.velocityBias),l=(o=(a=(a=t.normalImpulse+o)>0?a:0)-t.normalImpulse)*I,h=o*P,w.x-=D*l,w.y-=D*h,v-=T*(t.rA.x*h-t.rA.y*l),C.x+=A*l,C.y+=A*h,b+=E*(t.rB.x*h-t.rB.y*l),t.normalImpulse=a;else{var R=_.points[0],L=_.points[1],k=R.normalImpulse,F=L.normalImpulse,N=(C.x-b*R.rB.y-w.x+v*R.rA.y)*I+(C.y+b*R.rB.x-w.y-v*R.rA.x)*P,V=(C.x-b*L.rB.y-w.x+v*L.rA.y)*I+(C.y+b*L.rB.x-w.y-v*L.rA.x)*P,G=N-R.velocityBias,U=V-L.velocityBias;G-=(e=_.K).col1.x*k+e.col2.x*F,U-=e.col1.y*k+e.col2.y*F;for(;;){var j=-((e=_.normalMass).col1.x*G+e.col2.x*U),z=-(e.col1.y*G+e.col2.y*U);if(j>=0&&z>=0){p=(c=j-k)*I,d=c*P,m=(u=z-F)*I,f=u*P,w.x-=D*(p+m),w.y-=D*(d+f),v-=T*(R.rA.x*d-R.rA.y*p+L.rA.x*f-L.rA.y*m),C.x+=A*(p+m),C.y+=A*(d+f),b+=E*(R.rB.x*d-R.rB.y*p+L.rB.x*f-L.rB.y*m),R.normalImpulse=j,L.normalImpulse=z;break}if(j=-R.normalMass*G,z=0,N=0,V=_.K.col1.y*j+U,j>=0&&V>=0){p=(c=j-k)*I,d=c*P,m=(u=z-F)*I,f=u*P,w.x-=D*(p+m),w.y-=D*(d+f),v-=T*(R.rA.x*d-R.rA.y*p+L.rA.x*f-L.rA.y*m),C.x+=A*(p+m),C.y+=A*(d+f),b+=E*(R.rB.x*d-R.rB.y*p+L.rB.x*f-L.rB.y*m),R.normalImpulse=j,L.normalImpulse=z;break}if(j=0,z=-L.normalMass*U,N=_.K.col2.x*z+G,V=0,z>=0&&N>=0){p=(c=j-k)*I,d=c*P,m=(u=z-F)*I,f=u*P,w.x-=D*(p+m),w.y-=D*(d+f),v-=T*(R.rA.x*d-R.rA.y*p+L.rA.x*f-L.rA.y*m),C.x+=A*(p+m),C.y+=A*(d+f),b+=E*(R.rB.x*d-R.rB.y*p+L.rB.x*f-L.rB.y*m),R.normalImpulse=j,L.normalImpulse=z;break}if(j=0,z=0,V=U,(N=G)>=0&&V>=0){p=(c=j-k)*I,d=c*P,m=(u=z-F)*I,f=u*P,w.x-=D*(p+m),w.y-=D*(d+f),v-=T*(R.rA.x*d-R.rA.y*p+L.rA.x*f-L.rA.y*m),C.x+=A*(p+m),C.y+=A*(d+f),b+=E*(R.rB.x*d-R.rB.y*p+L.rB.x*f-L.rB.y*m),R.normalImpulse=j,L.normalImpulse=z;break}break}}g.m_angularVelocity=v,x.m_angularVelocity=b}},p.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var e=this.m_constraints[t],i=e.manifold,r=0;r<e.pointCount;++r){var n=i.m_points[r],o=e.points[r];n.m_normalImpulse=o.normalImpulse,n.m_tangentImpulse=o.tangentImpulse}},p.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var e=0,i=0;i<this.m_constraintCount;i++){var r=this.m_constraints[i],n=r.bodyA,o=r.bodyB,s=n.m_mass*n.m_invMass,a=n.m_mass*n.m_invI,l=o.m_mass*o.m_invMass,h=o.m_mass*o.m_invI;p.s_psm.Initialize(r);for(var c=p.s_psm.m_normal,u=0;u<r.pointCount;u++){var d=r.points[u],m=p.s_psm.m_points[u],f=p.s_psm.m_separations[u],y=m.x-n.m_sweep.c.x,_=m.y-n.m_sweep.c.y,g=m.x-o.m_sweep.c.x,x=m.y-o.m_sweep.c.y;e=e<f?e:f;var v=S.Clamp(t*(f+b.b2_linearSlop),-b.b2_maxLinearCorrection,0),w=-d.equalizedMass*v,C=w*c.x,D=w*c.y;n.m_sweep.c.x-=s*C,n.m_sweep.c.y-=s*D,n.m_sweep.a-=a*(y*D-_*C),n.SynchronizeTransform(),o.m_sweep.c.x+=l*C,o.m_sweep.c.y+=l*D,o.m_sweep.a+=h*(g*D-x*C),o.SynchronizeTransform()}}return e>-1.5*b.b2_linearSlop},Box2D.postDefs.push((function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new P,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new g})),Box2D.inherit(d,Box2D.Dynamics.Contacts.b2Contact),d.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,d.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},d.Create=function(t){return new d},d.Destroy=function(t,e){},d.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},d.prototype.Evaluate=function(){var i=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,i.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,r.m_xf)},d.prototype.b2CollideEdgeAndCircle=function(t,e,i,r,n){},Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact),m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,m.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},m.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},m.prototype.Evaluate=function(){},Box2D.inherit(f,Box2D.Dynamics.Contacts.b2Contact),f.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,f.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},f.Create=function(t){return new f},f.Destroy=function(t,e){},f.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),b.b2Assert(t.GetType()==r.e_polygonShape),b.b2Assert(e.GetType()==r.e_circleShape)},f.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body,r=this.m_fixtureB.m_body;D.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,r.m_xf)},Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact),y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,y.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(t){return new y},y.Destroy=function(t,e){},y.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e),b.b2Assert(t.GetType()==r.e_polygonShape),b.b2Assert(e.GetType()==r.e_edgeShape)},y.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)},y.prototype.b2CollidePolyAndEdge=function(t,e,i,r,n){},Box2D.inherit(_,Box2D.Dynamics.Contacts.b2Contact),_.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,_.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},_.Create=function(t){return new _},_.Destroy=function(t,e){},_.prototype.Reset=function(t,e){this.__super.Reset.call(this,t,e)},_.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody();D.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,e.m_xf)},g.b2PositionSolverManifold=function(){},g.prototype.b2PositionSolverManifold=function(){this.m_normal=new C,this.m_separations=new Vector_a2j_Number(b.b2_maxManifoldPoints),this.m_points=new Vector(b.b2_maxManifoldPoints);for(var t=0;t<b.b2_maxManifoldPoints;t++)this.m_points[t]=new C},g.prototype.Initialize=function(t){b.b2Assert(t.pointCount>0);var e,i,r=0,n=0,o=0,s=0,a=0;switch(t.type){case A.e_circles:e=t.bodyA.m_xf.R,i=t.localPoint;var l=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),h=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y);e=t.bodyB.m_xf.R,i=t.points[0].localPoint;var c=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),u=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),p=c-l,d=u-h,m=p*p+d*d;if(m>Number.MIN_VALUE*Number.MIN_VALUE){var f=Math.sqrt(m);this.m_normal.x=p/f,this.m_normal.y=d/f}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(l+c),this.m_points[0].y=.5*(h+u),this.m_separations[0]=p*this.m_normal.x+d*this.m_normal.y-t.radius;break;case A.e_faceA:for(e=t.bodyA.m_xf.R,i=t.localPlaneNormal,this.m_normal.x=e.col1.x*i.x+e.col2.x*i.y,this.m_normal.y=e.col1.y*i.x+e.col2.y*i.y,e=t.bodyA.m_xf.R,i=t.localPoint,s=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),a=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),e=t.bodyB.m_xf.R,r=0;r<t.pointCount;++r)i=t.points[r].localPoint,n=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),o=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),this.m_separations[r]=(n-s)*this.m_normal.x+(o-a)*this.m_normal.y-t.radius,this.m_points[r].x=n,this.m_points[r].y=o;break;case A.e_faceB:for(e=t.bodyB.m_xf.R,i=t.localPlaneNormal,this.m_normal.x=e.col1.x*i.x+e.col2.x*i.y,this.m_normal.y=e.col1.y*i.x+e.col2.y*i.y,e=t.bodyB.m_xf.R,i=t.localPoint,s=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),a=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),e=t.bodyA.m_xf.R,r=0;r<t.pointCount;++r)i=t.points[r].localPoint,n=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),o=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),this.m_separations[r]=(n-s)*this.m_normal.x+(o-a)*this.m_normal.y-t.radius,this.m_points[r].Set(n,o);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push((function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new C,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new C}))}(),function(){Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World;var t=Box2D.Common.Math.b2Mat22,e=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),i=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),r=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),n=(Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape,Box2D.Dynamics.Controllers.b2BuoyancyController),o=Box2D.Dynamics.Controllers.b2ConstantAccelController,s=Box2D.Dynamics.Controllers.b2ConstantForceController,a=Box2D.Dynamics.Controllers.b2Controller,l=Box2D.Dynamics.Controllers.b2ControllerEdge,h=Box2D.Dynamics.Controllers.b2GravityController,c=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(n,Box2D.Dynamics.Controllers.b2Controller),n.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,n.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new i(0,-1),this.offset=0,this.density=0,this.velocity=new i(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},n.prototype.Step=function(t){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var e=this.m_bodyList;e;e=e.nextBody){var r=e.body;if(0!=r.IsAwake()){for(var n=new i,o=new i,s=0,a=0,l=r.GetFixtureList();l;l=l.GetNext()){var h=new i,c=l.GetShape().ComputeSubmergedArea(this.normal,this.offset,r.GetTransform(),h);s+=c,n.x+=c*h.x,n.y+=c*h.y;var u=0;a+=c*(u=(this.useDensity,1)),o.x+=c*h.x*u,o.y+=c*h.y*u}if(n.x/=s,n.y/=s,o.x/=a,o.y/=a,!(s<Number.MIN_VALUE)){var p=this.gravity.GetNegative();p.Multiply(this.density*s),r.ApplyForce(p,o);var d=r.GetLinearVelocityFromWorldPoint(n);d.Subtract(this.velocity),d.Multiply(-this.linearDrag*s),r.ApplyForce(d,n),r.ApplyTorque(-r.GetInertia()/r.GetMass()*s*r.GetAngularVelocity()*this.angularDrag)}}}}},n.prototype.Draw=function(t){var e=1e3,n=new i,o=new i;n.x=this.normal.x*this.offset+this.normal.y*e,n.y=this.normal.y*this.offset-this.normal.x*e,o.x=this.normal.x*this.offset-this.normal.y*e,o.y=this.normal.y*this.offset+this.normal.x*e;var s=new r(0,0,1);t.DrawSegment(n,o,s)},Box2D.inherit(o,Box2D.Dynamics.Controllers.b2Controller),o.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,o.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new i(0,0)},o.prototype.Step=function(t){for(var e=new i(this.A.x*t.dt,this.A.y*t.dt),r=this.m_bodyList;r;r=r.nextBody){var n=r.body;n.IsAwake()&&n.SetLinearVelocity(new i(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}},Box2D.inherit(s,Box2D.Dynamics.Controllers.b2Controller),s.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,s.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new i(0,0)},s.prototype.Step=function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter())}},a.b2Controller=function(){},a.prototype.Step=function(t){},a.prototype.Draw=function(t){},a.prototype.AddBody=function(t){var e=new l;e.controller=this,e.body=t,e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList=e,e.nextBody&&(e.nextBody.prevBody=e),this.m_bodyCount++,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList=e,e.nextController&&(e.nextController.prevController=e),t.m_controllerCount++},a.prototype.RemoveBody=function(t){for(var e=t.m_controllerList;e&&e.controller!=this;)e=e.nextController;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),this.m_bodyList==e&&(this.m_bodyList=e.nextBody),t.m_controllerList==e&&(t.m_controllerList=e.nextController),t.m_controllerCount--,this.m_bodyCount--},a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},a.prototype.GetNext=function(){return this.m_next},a.prototype.GetWorld=function(){return this.m_world},a.prototype.GetBodyList=function(){return this.m_bodyList},l.b2ControllerEdge=function(){},Box2D.inherit(h,Box2D.Dynamics.Controllers.b2Controller),h.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,h.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},h.prototype.Step=function(t){var e=null,r=null,n=null,o=0,s=null,a=null,l=null,h=0,c=0,u=0,p=null;if(this.invSqr)for(e=this.m_bodyList;e;e=e.nextBody)for(n=(r=e.body).GetWorldCenter(),o=r.GetMass(),s=this.m_bodyList;s!=e;s=s.nextBody)(u=(h=(l=(a=s.body).GetWorldCenter()).x-n.x)*h+(c=l.y-n.y)*c)<Number.MIN_VALUE||((p=new i(h,c)).Multiply(this.G/u/Math.sqrt(u)*o*a.GetMass()),r.IsAwake()&&r.ApplyForce(p,n),p.Multiply(-1),a.IsAwake()&&a.ApplyForce(p,l));else for(e=this.m_bodyList;e;e=e.nextBody)for(n=(r=e.body).GetWorldCenter(),o=r.GetMass(),s=this.m_bodyList;s!=e;s=s.nextBody)(u=(h=(l=(a=s.body).GetWorldCenter()).x-n.x)*h+(c=l.y-n.y)*c)<Number.MIN_VALUE||((p=new i(h,c)).Multiply(this.G/u*o*a.GetMass()),r.IsAwake()&&r.ApplyForce(p,n),p.Multiply(-1),a.IsAwake()&&a.ApplyForce(p,l))},Box2D.inherit(c,Box2D.Dynamics.Controllers.b2Controller),c.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,c.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new t,this.maxTimestep=0},c.prototype.SetAxisAligned=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-e,this.maxTimestep=t>0||e>0?1/Math.max(t,e):0},c.prototype.Step=function(t){var r=t.dt;if(!(r<=Number.MIN_VALUE)){r>this.maxTimestep&&this.maxTimestep>0&&(r=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var o=n.body;if(o.IsAwake()){var s=o.GetWorldVector(e.MulMV(this.T,o.GetLocalVector(o.GetLinearVelocity())));o.SetLinearVelocity(new i(o.GetLinearVelocity().x+s.x*r,o.GetLinearVelocity().y+s.y*r))}}}}}(),function(){Box2D.Common.b2Color,Box2D.Common.b2internal;var t=Box2D.Common.b2Settings,e=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,r=Box2D.Common.Math.b2Math,n=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),o=Box2D.Common.Math.b2Vec3,s=Box2D.Dynamics.Joints.b2DistanceJoint,a=Box2D.Dynamics.Joints.b2DistanceJointDef,l=Box2D.Dynamics.Joints.b2FrictionJoint,h=Box2D.Dynamics.Joints.b2FrictionJointDef,c=Box2D.Dynamics.Joints.b2GearJoint,u=Box2D.Dynamics.Joints.b2GearJointDef,p=Box2D.Dynamics.Joints.b2Jacobian,d=Box2D.Dynamics.Joints.b2Joint,m=Box2D.Dynamics.Joints.b2JointDef,f=Box2D.Dynamics.Joints.b2JointEdge,y=Box2D.Dynamics.Joints.b2LineJoint,_=Box2D.Dynamics.Joints.b2LineJointDef,g=Box2D.Dynamics.Joints.b2MouseJoint,x=Box2D.Dynamics.Joints.b2MouseJointDef,v=Box2D.Dynamics.Joints.b2PrismaticJoint,b=Box2D.Dynamics.Joints.b2PrismaticJointDef,w=Box2D.Dynamics.Joints.b2PulleyJoint,S=Box2D.Dynamics.Joints.b2PulleyJointDef,C=Box2D.Dynamics.Joints.b2RevoluteJoint,D=Box2D.Dynamics.Joints.b2RevoluteJointDef,T=Box2D.Dynamics.Joints.b2WeldJoint,A=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World;Box2D.inherit(s,Box2D.Dynamics.Joints.b2Joint),s.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,s.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u=new n},s.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},s.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},s.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},s.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},s.prototype.GetLength=function(){return this.m_length},s.prototype.SetLength=function(t){void 0===t&&(t=0),this.m_length=t},s.prototype.GetFrequency=function(){return this.m_frequencyHz},s.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},s.prototype.GetDampingRatio=function(){return this.m_dampingRatio},s.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},s.prototype.b2DistanceJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},s.prototype.InitVelocityConstraints=function(e){var i,r=0,n=this.m_bodyA,o=this.m_bodyB;i=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;r=i.col1.x*s+i.col2.x*a,a=i.col1.y*s+i.col2.y*a,s=r,i=o.m_xf.R;var l=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y;r=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=r,this.m_u.x=o.m_sweep.c.x+l-n.m_sweep.c.x-s,this.m_u.y=o.m_sweep.c.y+h-n.m_sweep.c.y-a;var c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);c>t.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero();var u=s*this.m_u.y-a*this.m_u.x,p=l*this.m_u.y-h*this.m_u.x,d=n.m_invMass+n.m_invI*u*u+o.m_invMass+o.m_invI*p*p;if(this.m_mass=0!=d?1/d:0,this.m_frequencyHz>0){var m=c-this.m_length,f=2*Math.PI*this.m_frequencyHz,y=2*this.m_mass*this.m_dampingRatio*f,_=this.m_mass*f*f;this.m_gamma=e.dt*(y+e.dt*_),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=m*e.dt*_*this.m_gamma,this.m_mass=d+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(e.warmStarting){this.m_impulse*=e.dtRatio;var g=this.m_impulse*this.m_u.x,x=this.m_impulse*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*g,n.m_linearVelocity.y-=n.m_invMass*x,n.m_angularVelocity-=n.m_invI*(s*x-a*g),o.m_linearVelocity.x+=o.m_invMass*g,o.m_linearVelocity.y+=o.m_invMass*x,o.m_angularVelocity+=o.m_invI*(l*x-h*g)}else this.m_impulse=0},s.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyA,r=this.m_bodyB;e=i.m_xf.R;var n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,o=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=e.col1.x*n+e.col2.x*o;o=e.col1.y*n+e.col2.y*o,n=s,e=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,l=this.m_localAnchor2.y-r.m_sweep.localCenter.y;s=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=s;var h=i.m_linearVelocity.x+-i.m_angularVelocity*o,c=i.m_linearVelocity.y+i.m_angularVelocity*n,u=r.m_linearVelocity.x+-r.m_angularVelocity*l,p=r.m_linearVelocity.y+r.m_angularVelocity*a,d=this.m_u.x*(u-h)+this.m_u.y*(p-c),m=-this.m_mass*(d+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var f=m*this.m_u.x,y=m*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*f,i.m_linearVelocity.y-=i.m_invMass*y,i.m_angularVelocity-=i.m_invI*(n*y-o*f),r.m_linearVelocity.x+=r.m_invMass*f,r.m_linearVelocity.y+=r.m_invMass*y,r.m_angularVelocity+=r.m_invI*(a*y-l*f)},s.prototype.SolvePositionConstraints=function(e){var i;if(void 0===e&&(e=0),this.m_frequencyHz>0)return!0;var n=this.m_bodyA,o=this.m_bodyB;i=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y,l=i.col1.x*s+i.col2.x*a;a=i.col1.y*s+i.col2.y*a,s=l,i=o.m_xf.R;var h=this.m_localAnchor2.x-o.m_sweep.localCenter.x,c=this.m_localAnchor2.y-o.m_sweep.localCenter.y;l=i.col1.x*h+i.col2.x*c,c=i.col1.y*h+i.col2.y*c,h=l;var u=o.m_sweep.c.x+h-n.m_sweep.c.x-s,p=o.m_sweep.c.y+c-n.m_sweep.c.y-a,d=Math.sqrt(u*u+p*p);u/=d,p/=d;var m=d-this.m_length;m=r.Clamp(m,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var f=-this.m_mass*m;this.m_u.Set(u,p);var y=f*this.m_u.x,_=f*this.m_u.y;return n.m_sweep.c.x-=n.m_invMass*y,n.m_sweep.c.y-=n.m_invMass*_,n.m_sweep.a-=n.m_invI*(s*_-a*y),o.m_sweep.c.x+=o.m_invMass*y,o.m_sweep.c.y+=o.m_invMass*_,o.m_sweep.a+=o.m_invI*(h*_-c*y),n.SynchronizeTransform(),o.SynchronizeTransform(),r.Abs(m)<t.b2_linearSlop},Box2D.inherit(a,Box2D.Dynamics.Joints.b2JointDef),a.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,a.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},a.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},a.prototype.Initialize=function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r));var n=r.x-i.x,o=r.y-i.y;this.length=Math.sqrt(n*n+o*o),this.frequencyHz=0,this.dampingRatio=0},Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint),l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,l.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_linearMass=new e,this.m_linearImpulse=new n},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},l.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},l.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_angularImpulse},l.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},l.prototype.GetMaxForce=function(){return this.m_maxForce},l.prototype.SetMaxTorque=function(t){void 0===t&&(t=0),this.m_maxTorque=t},l.prototype.GetMaxTorque=function(){return this.m_maxTorque},l.prototype.b2FrictionJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},l.prototype.InitVelocityConstraints=function(t){var i,r=0,n=this.m_bodyA,o=this.m_bodyB;i=n.m_xf.R;var s=this.m_localAnchorA.x-n.m_sweep.localCenter.x,a=this.m_localAnchorA.y-n.m_sweep.localCenter.y;r=i.col1.x*s+i.col2.x*a,a=i.col1.y*s+i.col2.y*a,s=r,i=o.m_xf.R;var l=this.m_localAnchorB.x-o.m_sweep.localCenter.x,h=this.m_localAnchorB.y-o.m_sweep.localCenter.y;r=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=r;var c=n.m_invMass,u=o.m_invMass,p=n.m_invI,d=o.m_invI,m=new e;if(m.col1.x=c+u,m.col2.x=0,m.col1.y=0,m.col2.y=c+u,m.col1.x+=p*a*a,m.col2.x+=-p*s*a,m.col1.y+=-p*s*a,m.col2.y+=p*s*s,m.col1.x+=d*h*h,m.col2.x+=-d*l*h,m.col1.y+=-d*l*h,m.col2.y+=d*l*l,m.GetInverse(this.m_linearMass),this.m_angularMass=p+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio;var f=this.m_linearImpulse;n.m_linearVelocity.x-=c*f.x,n.m_linearVelocity.y-=c*f.y,n.m_angularVelocity-=p*(s*f.y-a*f.x+this.m_angularImpulse),o.m_linearVelocity.x+=u*f.x,o.m_linearVelocity.y+=u*f.y,o.m_angularVelocity+=d*(l*f.y-h*f.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},l.prototype.SolveVelocityConstraints=function(t){var e,i=0,o=this.m_bodyA,s=this.m_bodyB,a=o.m_linearVelocity,l=o.m_angularVelocity,h=s.m_linearVelocity,c=s.m_angularVelocity,u=o.m_invMass,p=s.m_invMass,d=o.m_invI,m=s.m_invI;e=o.m_xf.R;var f=this.m_localAnchorA.x-o.m_sweep.localCenter.x,y=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*f+e.col2.x*y,y=e.col1.y*f+e.col2.y*y,f=i,e=s.m_xf.R;var _=this.m_localAnchorB.x-s.m_sweep.localCenter.x,g=this.m_localAnchorB.y-s.m_sweep.localCenter.y;i=e.col1.x*_+e.col2.x*g,g=e.col1.y*_+e.col2.y*g,_=i;var x=0,v=c-l,b=-this.m_angularMass*v,w=this.m_angularImpulse;x=t.dt*this.m_maxTorque,this.m_angularImpulse=r.Clamp(this.m_angularImpulse+b,-x,x),l-=d*(b=this.m_angularImpulse-w),c+=m*b;var S=h.x-c*g-a.x+l*y,C=h.y+c*_-a.y-l*f,D=r.MulMV(this.m_linearMass,new n(-S,-C)),T=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(D),x=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>x*x&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(x)),D=r.SubtractVV(this.m_linearImpulse,T),a.x-=u*D.x,a.y-=u*D.y,l-=d*(f*D.y-y*D.x),h.x+=p*D.x,h.y+=p*D.y,c+=m*(_*D.y-g*D.x),o.m_angularVelocity=l,s.m_angularVelocity=c},l.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!0},Box2D.inherit(h,Box2D.Dynamics.Joints.b2JointDef),h.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,h.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},h.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_frictionJoint,this.maxForce=0,this.maxTorque=0},h.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))},Box2D.inherit(c,Box2D.Dynamics.Joints.b2Joint),c.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,c.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_J=new p},c.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},c.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},c.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},c.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var e=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=e.col1.x*i+e.col2.x*r;r=e.col1.y*i+e.col2.y*r,i=n;var o=this.m_impulse*this.m_J.linearB.x,s=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*s+r*o)},c.prototype.GetRatio=function(){return this.m_ratio},c.prototype.SetRatio=function(t){void 0===t&&(t=0),this.m_ratio=t},c.prototype.b2GearJoint=function(t){this.__super.b2Joint.call(this,t);var e=parseInt(t.joint1.m_type),i=parseInt(t.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var r=0,n=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),e==d.e_revoluteJoint?(this.m_revolute1=t.joint1 instanceof C?t.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),r=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1 instanceof v?t.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),r=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),i==d.e_revoluteJoint?(this.m_revolute2=t.joint2 instanceof C?t.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),n=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2 instanceof v?t.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),n=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=r+this.m_ratio*n,this.m_impulse=0},c.prototype.InitVelocityConstraints=function(t){var e,i,r=this.m_ground1,n=this.m_ground2,o=this.m_bodyA,s=this.m_bodyB,a=0,l=0,h=0,c=0,u=0,p=0,d=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,d+=o.m_invI):(e=r.m_xf.R,i=this.m_prismatic1.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,l=e.col1.y*i.x+e.col2.y*i.y,e=o.m_xf.R,h=this.m_localAnchor1.x-o.m_sweep.localCenter.x,c=this.m_localAnchor1.y-o.m_sweep.localCenter.y,p=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,u=(h=p)*l-c*a,this.m_J.linearA.Set(-a,-l),this.m_J.angularA=-u,d+=o.m_invMass+o.m_invI*u*u),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,d+=this.m_ratio*this.m_ratio*s.m_invI):(e=n.m_xf.R,i=this.m_prismatic2.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,l=e.col1.y*i.x+e.col2.y*i.y,e=s.m_xf.R,h=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y,p=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,u=(h=p)*l-c*a,this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*l),this.m_J.angularB=-this.m_ratio*u,d+=this.m_ratio*this.m_ratio*(s.m_invMass+s.m_invI*u*u)),this.m_mass=d>0?1/d:0,t.warmStarting?(o.m_linearVelocity.x+=o.m_invMass*this.m_impulse*this.m_J.linearA.x,o.m_linearVelocity.y+=o.m_invMass*this.m_impulse*this.m_J.linearA.y,o.m_angularVelocity+=o.m_invI*this.m_impulse*this.m_J.angularA,s.m_linearVelocity.x+=s.m_invMass*this.m_impulse*this.m_J.linearB.x,s.m_linearVelocity.y+=s.m_invMass*this.m_impulse*this.m_J.linearB.y,s.m_angularVelocity+=s.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},c.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,r=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity),n=-this.m_mass*r;this.m_impulse+=n,e.m_linearVelocity.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*n*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*n*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*n*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*n*this.m_J.angularB},c.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var i=this.m_bodyA,r=this.m_bodyB,n=0,o=0;n=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),o=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var s=this.m_constant-(n+this.m_ratio*o),a=-this.m_mass*s;return i.m_sweep.c.x+=i.m_invMass*a*this.m_J.linearA.x,i.m_sweep.c.y+=i.m_invMass*a*this.m_J.linearA.y,i.m_sweep.a+=i.m_invI*a*this.m_J.angularA,r.m_sweep.c.x+=r.m_invMass*a*this.m_J.linearB.x,r.m_sweep.c.y+=r.m_invMass*a*this.m_J.linearB.y,r.m_sweep.a+=r.m_invI*a*this.m_J.angularB,i.SynchronizeTransform(),r.SynchronizeTransform(),0<t.b2_linearSlop},Box2D.inherit(u,Box2D.Dynamics.Joints.b2JointDef),u.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,u.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},u.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},p.b2Jacobian=function(){this.linearA=new n,this.linearB=new n},p.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},p.prototype.Set=function(t,e,i,r){void 0===e&&(e=0),void 0===r&&(r=0),this.linearA.SetV(t),this.angularA=e,this.linearB.SetV(i),this.angularB=r},p.prototype.Compute=function(t,e,i,r){return void 0===e&&(e=0),void 0===r&&(r=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*r},d.b2Joint=function(){this.m_edgeA=new f,this.m_edgeB=new f,this.m_localCenterA=new n,this.m_localCenterB=new n},d.prototype.GetType=function(){return this.m_type},d.prototype.GetAnchorA=function(){return null},d.prototype.GetAnchorB=function(){return null},d.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),null},d.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},d.prototype.GetBodyA=function(){return this.m_bodyA},d.prototype.GetBodyB=function(){return this.m_bodyB},d.prototype.GetNext=function(){return this.m_next},d.prototype.GetUserData=function(){return this.m_userData},d.prototype.SetUserData=function(t){this.m_userData=t},d.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},d.Create=function(t,e){var i=null;switch(t.type){case d.e_distanceJoint:i=new s(t instanceof a?t:null);break;case d.e_mouseJoint:i=new g(t instanceof x?t:null);break;case d.e_prismaticJoint:i=new v(t instanceof b?t:null);break;case d.e_revoluteJoint:i=new C(t instanceof D?t:null);break;case d.e_pulleyJoint:i=new w(t instanceof S?t:null);break;case d.e_gearJoint:i=new c(t instanceof u?t:null);break;case d.e_lineJoint:i=new y(t instanceof _?t:null);break;case d.e_weldJoint:i=new T(t instanceof A?t:null);break;case d.e_frictionJoint:i=new l(t instanceof h?t:null)}return i},d.Destroy=function(t,e){},d.prototype.b2Joint=function(e){t.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_prev=null,this.m_next=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},d.prototype.InitVelocityConstraints=function(t){},d.prototype.SolveVelocityConstraints=function(t){},d.prototype.FinalizeVelocityConstraints=function(){},d.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!1},Box2D.postDefs.push((function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3})),m.b2JointDef=function(){},m.prototype.b2JointDef=function(){this.type=d.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},f.b2JointEdge=function(){},Box2D.inherit(y,Box2D.Dynamics.Joints.b2Joint),y.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,y.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new e,this.m_impulse=new n},y.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},y.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},y.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},y.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),r=e.GetWorldPoint(this.m_localAnchor2),n=r.x-i.x,o=r.y-i.y,s=t.GetWorldVector(this.m_localXAxis1);return s.x*n+s.y*o},y.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=t.col1.x*r+t.col2.x*n;n=t.col1.y*r+t.col2.y*n,r=o,t=i.m_xf.R;var s=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;o=t.col1.x*s+t.col2.x*a,a=t.col1.y*s+t.col2.y*a,s=o;var l=e.m_sweep.c.x+r,h=e.m_sweep.c.y+n,c=i.m_sweep.c.x+s-l,u=i.m_sweep.c.y+a-h,p=e.GetWorldVector(this.m_localXAxis1),d=e.m_linearVelocity,m=i.m_linearVelocity,f=e.m_angularVelocity,y=i.m_angularVelocity;return c*(-f*p.y)+u*(f*p.x)+(p.x*(m.x+-y*a-d.x- -f*n)+p.y*(m.y+y*s-d.y-f*r))},y.prototype.IsLimitEnabled=function(){return this.m_enableLimit},y.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},y.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},y.prototype.GetUpperLimit=function(){return this.m_upperTranslation},y.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},y.prototype.IsMotorEnabled=function(){return this.m_enableMotor},y.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},y.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},y.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},y.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},y.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},y.prototype.GetMotorForce=function(){return this.m_motorImpulse},y.prototype.b2LineJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=d.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},y.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,o=this.m_bodyB,s=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(o.GetLocalCenter());var a=n.GetTransform();o.GetTransform();i=n.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;s=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=s,i=o.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,u=this.m_localAnchor2.y-this.m_localCenterB.y;s=i.col1.x*c+i.col2.x*u,u=i.col1.y*c+i.col2.y*u,c=s;var p=o.m_sweep.c.x+c-n.m_sweep.c.x-l,m=o.m_sweep.c.y+u-n.m_sweep.c.y-h;this.m_invMassA=n.m_invMass,this.m_invMassB=o.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=o.m_invI,this.m_axis.SetV(r.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(p+l)*this.m_axis.y-(m+h)*this.m_axis.x,this.m_a2=c*this.m_axis.y-u*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(r.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(p+l)*this.m_perp.y-(m+h)*this.m_perp.x,this.m_s2=c*this.m_perp.y-u*this.m_perp.x;var f=this.m_invMassA,y=this.m_invMassB,_=this.m_invIA,g=this.m_invIB;if(this.m_K.col1.x=f+y+_*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.col1.y=_*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+y+_*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_enableLimit){var x=this.m_axis.x*p+this.m_axis.y*m;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=d.e_equalLimits:x<=this.m_lowerTranslation?this.m_limitState!=d.e_atLowerLimit&&(this.m_limitState=d.e_atLowerLimit,this.m_impulse.y=0):x>=this.m_upperTranslation?this.m_limitState!=d.e_atUpperLimit&&(this.m_limitState=d.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=d.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=d.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,w=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,S=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*v,n.m_linearVelocity.y-=this.m_invMassA*b,n.m_angularVelocity-=this.m_invIA*w,o.m_linearVelocity.x+=this.m_invMassB*v,o.m_linearVelocity.y+=this.m_invMassB*b,o.m_angularVelocity+=this.m_invIB*S}else this.m_impulse.SetZero(),this.m_motorImpulse=0},y.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_linearVelocity,s=e.m_angularVelocity,a=i.m_linearVelocity,l=i.m_angularVelocity,h=0,c=0,u=0,p=0;if(this.m_enableMotor&&this.m_limitState!=d.e_equalLimits){var m=this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*l-this.m_a1*s,f=this.m_motorMass*(this.m_motorSpeed-m),y=this.m_motorImpulse,_=t.dt*this.m_maxMotorForce;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+f,-_,_),h=(f=this.m_motorImpulse-y)*this.m_axis.x,c=f*this.m_axis.y,u=f*this.m_a1,p=f*this.m_a2,o.x-=this.m_invMassA*h,o.y-=this.m_invMassA*c,s-=this.m_invIA*u,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*c,l+=this.m_invIB*p}var g=this.m_perp.x*(a.x-o.x)+this.m_perp.y*(a.y-o.y)+this.m_s2*l-this.m_s1*s;if(this.m_enableLimit&&this.m_limitState!=d.e_inactiveLimit){var x=this.m_axis.x*(a.x-o.x)+this.m_axis.y*(a.y-o.y)+this.m_a2*l-this.m_a1*s,v=this.m_impulse.Copy(),b=this.m_K.Solve(new n,-g,-x);this.m_impulse.Add(b),this.m_limitState==d.e_atLowerLimit?this.m_impulse.y=r.Max(this.m_impulse.y,0):this.m_limitState==d.e_atUpperLimit&&(this.m_impulse.y=r.Min(this.m_impulse.y,0));var w=-g-(this.m_impulse.y-v.y)*this.m_K.col2.x,S=0;S=0!=this.m_K.col1.x?w/this.m_K.col1.x+v.x:v.x,this.m_impulse.x=S,b.x=this.m_impulse.x-v.x,b.y=this.m_impulse.y-v.y,h=b.x*this.m_perp.x+b.y*this.m_axis.x,c=b.x*this.m_perp.y+b.y*this.m_axis.y,u=b.x*this.m_s1+b.y*this.m_a1,p=b.x*this.m_s2+b.y*this.m_a2,o.x-=this.m_invMassA*h,o.y-=this.m_invMassA*c,s-=this.m_invIA*u,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*c,l+=this.m_invIB*p}else{var C=0;C=0!=this.m_K.col1.x?-g/this.m_K.col1.x:0,this.m_impulse.x+=C,h=C*this.m_perp.x,c=C*this.m_perp.y,u=C*this.m_s1,p=C*this.m_s2,o.x-=this.m_invMassA*h,o.y-=this.m_invMassA*c,s-=this.m_invIA*u,a.x+=this.m_invMassB*h,a.y+=this.m_invMassB*c,l+=this.m_invIB*p}e.m_linearVelocity.SetV(o),e.m_angularVelocity=s,i.m_linearVelocity.SetV(a),i.m_angularVelocity=l},y.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var o,s=this.m_bodyA,a=this.m_bodyB,l=s.m_sweep.c,h=s.m_sweep.a,c=a.m_sweep.c,u=a.m_sweep.a,p=0,d=0,m=0,f=0,y=0,_=0,g=!1,x=0,v=e.FromAngle(h),b=e.FromAngle(u);o=v;var w=this.m_localAnchor1.x-this.m_localCenterA.x,S=this.m_localAnchor1.y-this.m_localCenterA.y;p=o.col1.x*w+o.col2.x*S,S=o.col1.y*w+o.col2.y*S,w=p,o=b;var C=this.m_localAnchor2.x-this.m_localCenterB.x,D=this.m_localAnchor2.y-this.m_localCenterB.y;p=o.col1.x*C+o.col2.x*D,D=o.col1.y*C+o.col2.y*D,C=p;var T=c.x+C-l.x-w,A=c.y+D-l.y-S;if(this.m_enableLimit){this.m_axis=r.MulMV(v,this.m_localXAxis1),this.m_a1=(T+w)*this.m_axis.y-(A+S)*this.m_axis.x,this.m_a2=C*this.m_axis.y-D*this.m_axis.x;var E=this.m_axis.x*T+this.m_axis.y*A;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(x=r.Clamp(E,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),_=r.Abs(E),g=!0):E<=this.m_lowerTranslation?(x=r.Clamp(E-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),_=this.m_lowerTranslation-E,g=!0):E>=this.m_upperTranslation&&(x=r.Clamp(E-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),_=E-this.m_upperTranslation,g=!0)}this.m_perp=r.MulMV(v,this.m_localYAxis1),this.m_s1=(T+w)*this.m_perp.y-(A+S)*this.m_perp.x,this.m_s2=C*this.m_perp.y-D*this.m_perp.x;var I=new n,P=this.m_perp.x*T+this.m_perp.y*A;if(_=r.Max(_,r.Abs(P)),0,g)d=this.m_invMassA,m=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,this.m_K.col1.x=d+m+f*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=d+m+f*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,this.m_K.Solve(I,-P,-x);else{d=this.m_invMassA,m=this.m_invMassB,f=this.m_invIA,y=this.m_invIB;var B=d+m+f*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,M=0;M=0!=B?-P/B:0,I.x=M,I.y=0}var O=I.x*this.m_perp.x+I.y*this.m_axis.x,R=I.x*this.m_perp.y+I.y*this.m_axis.y,L=I.x*this.m_s1+I.y*this.m_a1,k=I.x*this.m_s2+I.y*this.m_a2;return l.x-=this.m_invMassA*O,l.y-=this.m_invMassA*R,h-=this.m_invIA*L,c.x+=this.m_invMassB*O,c.y+=this.m_invMassB*R,u+=this.m_invIB*k,s.m_sweep.a=h,a.m_sweep.a=u,s.SynchronizeTransform(),a.SynchronizeTransform(),_<=t.b2_linearSlop&&0<=t.b2_angularSlop},Box2D.inherit(_,Box2D.Dynamics.Joints.b2JointDef),_.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,_.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},_.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},_.prototype.Initialize=function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(r)},Box2D.inherit(g,Box2D.Dynamics.Joints.b2Joint),g.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,g.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.m_localAnchor=new n,this.m_target=new n,this.m_impulse=new n,this.m_mass=new e,this.m_C=new n},g.prototype.GetAnchorA=function(){return this.m_target},g.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},g.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},g.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},g.prototype.GetTarget=function(){return this.m_target},g.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=t},g.prototype.GetMaxForce=function(){return this.m_maxForce},g.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},g.prototype.GetFrequency=function(){return this.m_frequencyHz},g.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},g.prototype.GetDampingRatio=function(){return this.m_dampingRatio},g.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},g.prototype.b2MouseJoint=function(t){this.__super.b2Joint.call(this,t),this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x,i=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*r.col1.x+i*r.col1.y,this.m_localAnchor.y=e*r.col2.x+i*r.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0},g.prototype.InitVelocityConstraints=function(t){var e,i=this.m_bodyB,r=i.GetMass(),n=2*Math.PI*this.m_frequencyHz,o=2*r*this.m_dampingRatio*n,s=r*n*n;this.m_gamma=t.dt*(o+t.dt*s),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=t.dt*s*this.m_gamma,e=i.m_xf.R;var a=this.m_localAnchor.x-i.m_sweep.localCenter.x,l=this.m_localAnchor.y-i.m_sweep.localCenter.y,h=e.col1.x*a+e.col2.x*l;l=e.col1.y*a+e.col2.y*l,a=h;var c=i.m_invMass,u=i.m_invI;this.K1.col1.x=c,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=c,this.K2.col1.x=u*l*l,this.K2.col2.x=-u*a*l,this.K2.col1.y=-u*a*l,this.K2.col2.y=u*a*a,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=i.m_sweep.c.x+a-this.m_target.x,this.m_C.y=i.m_sweep.c.y+l-this.m_target.y,i.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,i.m_linearVelocity.x+=c*this.m_impulse.x,i.m_linearVelocity.y+=c*this.m_impulse.y,i.m_angularVelocity+=u*(a*this.m_impulse.y-l*this.m_impulse.x)},g.prototype.SolveVelocityConstraints=function(t){var e,i,r=this.m_bodyB,n=0;e=r.m_xf.R;var o=this.m_localAnchor.x-r.m_sweep.localCenter.x,s=this.m_localAnchor.y-r.m_sweep.localCenter.y;n=e.col1.x*o+e.col2.x*s,s=e.col1.y*o+e.col2.y*s,o=n;var a=r.m_linearVelocity.x+-r.m_angularVelocity*s,l=r.m_linearVelocity.y+r.m_angularVelocity*o;e=this.m_mass,n=a+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,i=l+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var h=-(e.col1.x*n+e.col2.x*i),c=-(e.col1.y*n+e.col2.y*i),u=this.m_impulse.x,p=this.m_impulse.y;this.m_impulse.x+=h,this.m_impulse.y+=c;var d=t.dt*this.m_maxForce;this.m_impulse.LengthSquared()>d*d&&this.m_impulse.Multiply(d/this.m_impulse.Length()),h=this.m_impulse.x-u,c=this.m_impulse.y-p,r.m_linearVelocity.x+=r.m_invMass*h,r.m_linearVelocity.y+=r.m_invMass*c,r.m_angularVelocity+=r.m_invI*(o*c-s*h)},g.prototype.SolvePositionConstraints=function(t){return void 0===t&&(t=0),!0},Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef),x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,x.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new n},x.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(v,Box2D.Dynamics.Joints.b2Joint),v.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,v.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_localXAxis1=new n,this.m_localYAxis1=new n,this.m_axis=new n,this.m_perp=new n,this.m_K=new i,this.m_impulse=new o},v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},v.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},v.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},v.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),r=e.GetWorldPoint(this.m_localAnchor2),n=r.x-i.x,o=r.y-i.y,s=t.GetWorldVector(this.m_localXAxis1);return s.x*n+s.y*o},v.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=t.col1.x*r+t.col2.x*n;n=t.col1.y*r+t.col2.y*n,r=o,t=i.m_xf.R;var s=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;o=t.col1.x*s+t.col2.x*a,a=t.col1.y*s+t.col2.y*a,s=o;var l=e.m_sweep.c.x+r,h=e.m_sweep.c.y+n,c=i.m_sweep.c.x+s-l,u=i.m_sweep.c.y+a-h,p=e.GetWorldVector(this.m_localXAxis1),d=e.m_linearVelocity,m=i.m_linearVelocity,f=e.m_angularVelocity,y=i.m_angularVelocity;return c*(-f*p.y)+u*(f*p.x)+(p.x*(m.x+-y*a-d.x- -f*n)+p.y*(m.y+y*s-d.y-f*r))},v.prototype.IsLimitEnabled=function(){return this.m_enableLimit},v.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},v.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},v.prototype.GetUpperLimit=function(){return this.m_upperTranslation},v.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},v.prototype.IsMotorEnabled=function(){return this.m_enableMotor},v.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},v.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},v.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},v.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},v.prototype.GetMotorForce=function(){return this.m_motorImpulse},v.prototype.b2PrismaticJoint=function(t){this.__super.b2Joint.call(this,t);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=d.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},v.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,o=this.m_bodyB,s=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(o.GetLocalCenter());var a=n.GetTransform();o.GetTransform();i=n.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y;s=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=s,i=o.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,u=this.m_localAnchor2.y-this.m_localCenterB.y;s=i.col1.x*c+i.col2.x*u,u=i.col1.y*c+i.col2.y*u,c=s;var p=o.m_sweep.c.x+c-n.m_sweep.c.x-l,m=o.m_sweep.c.y+u-n.m_sweep.c.y-h;this.m_invMassA=n.m_invMass,this.m_invMassB=o.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=o.m_invI,this.m_axis.SetV(r.MulMV(a.R,this.m_localXAxis1)),this.m_a1=(p+l)*this.m_axis.y-(m+h)*this.m_axis.x,this.m_a2=c*this.m_axis.y-u*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(r.MulMV(a.R,this.m_localYAxis1)),this.m_s1=(p+l)*this.m_perp.y-(m+h)*this.m_perp.x,this.m_s2=c*this.m_perp.y-u*this.m_perp.x;var f=this.m_invMassA,y=this.m_invMassB,_=this.m_invIA,g=this.m_invIB;if(this.m_K.col1.x=f+y+_*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.col1.y=_*this.m_s1+g*this.m_s2,this.m_K.col1.z=_*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=_+g,this.m_K.col2.z=_*this.m_a1+g*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=f+y+_*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_enableLimit){var x=this.m_axis.x*p+this.m_axis.y*m;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=d.e_equalLimits:x<=this.m_lowerTranslation?this.m_limitState!=d.e_atLowerLimit&&(this.m_limitState=d.e_atLowerLimit,this.m_impulse.z=0):x>=this.m_upperTranslation?this.m_limitState!=d.e_atUpperLimit&&(this.m_limitState=d.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=d.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=d.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var v=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,w=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,S=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.m_linearVelocity.x-=this.m_invMassA*v,n.m_linearVelocity.y-=this.m_invMassA*b,n.m_angularVelocity-=this.m_invIA*w,o.m_linearVelocity.x+=this.m_invMassB*v,o.m_linearVelocity.y+=this.m_invMassB*b,o.m_angularVelocity+=this.m_invIB*S}else this.m_impulse.SetZero(),this.m_motorImpulse=0},v.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,s=e.m_linearVelocity,a=e.m_angularVelocity,l=i.m_linearVelocity,h=i.m_angularVelocity,c=0,u=0,p=0,m=0;if(this.m_enableMotor&&this.m_limitState!=d.e_equalLimits){var f=this.m_axis.x*(l.x-s.x)+this.m_axis.y*(l.y-s.y)+this.m_a2*h-this.m_a1*a,y=this.m_motorMass*(this.m_motorSpeed-f),_=this.m_motorImpulse,g=t.dt*this.m_maxMotorForce;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+y,-g,g),c=(y=this.m_motorImpulse-_)*this.m_axis.x,u=y*this.m_axis.y,p=y*this.m_a1,m=y*this.m_a2,s.x-=this.m_invMassA*c,s.y-=this.m_invMassA*u,a-=this.m_invIA*p,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*u,h+=this.m_invIB*m}var x=this.m_perp.x*(l.x-s.x)+this.m_perp.y*(l.y-s.y)+this.m_s2*h-this.m_s1*a,v=h-a;if(this.m_enableLimit&&this.m_limitState!=d.e_inactiveLimit){var b=this.m_axis.x*(l.x-s.x)+this.m_axis.y*(l.y-s.y)+this.m_a2*h-this.m_a1*a,w=this.m_impulse.Copy(),S=this.m_K.Solve33(new o,-x,-v,-b);this.m_impulse.Add(S),this.m_limitState==d.e_atLowerLimit?this.m_impulse.z=r.Max(this.m_impulse.z,0):this.m_limitState==d.e_atUpperLimit&&(this.m_impulse.z=r.Min(this.m_impulse.z,0));var C=-x-(this.m_impulse.z-w.z)*this.m_K.col3.x,D=-v-(this.m_impulse.z-w.z)*this.m_K.col3.y,T=this.m_K.Solve22(new n,C,D);T.x+=w.x,T.y+=w.y,this.m_impulse.x=T.x,this.m_impulse.y=T.y,S.x=this.m_impulse.x-w.x,S.y=this.m_impulse.y-w.y,S.z=this.m_impulse.z-w.z,c=S.x*this.m_perp.x+S.z*this.m_axis.x,u=S.x*this.m_perp.y+S.z*this.m_axis.y,p=S.x*this.m_s1+S.y+S.z*this.m_a1,m=S.x*this.m_s2+S.y+S.z*this.m_a2,s.x-=this.m_invMassA*c,s.y-=this.m_invMassA*u,a-=this.m_invIA*p,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*u,h+=this.m_invIB*m}else{var A=this.m_K.Solve22(new n,-x,-v);this.m_impulse.x+=A.x,this.m_impulse.y+=A.y,c=A.x*this.m_perp.x,u=A.x*this.m_perp.y,p=A.x*this.m_s1+A.y,m=A.x*this.m_s2+A.y,s.x-=this.m_invMassA*c,s.y-=this.m_invMassA*u,a-=this.m_invIA*p,l.x+=this.m_invMassB*c,l.y+=this.m_invMassB*u,h+=this.m_invIB*m}e.m_linearVelocity.SetV(s),e.m_angularVelocity=a,i.m_linearVelocity.SetV(l),i.m_angularVelocity=h},v.prototype.SolvePositionConstraints=function(i){void 0===i&&(i=0);var s,a,l=this.m_bodyA,h=this.m_bodyB,c=l.m_sweep.c,u=l.m_sweep.a,p=h.m_sweep.c,d=h.m_sweep.a,m=0,f=0,y=0,_=0,g=0,x=0,v=!1,b=0,w=e.FromAngle(u),S=e.FromAngle(d);s=w;var C=this.m_localAnchor1.x-this.m_localCenterA.x,D=this.m_localAnchor1.y-this.m_localCenterA.y;m=s.col1.x*C+s.col2.x*D,D=s.col1.y*C+s.col2.y*D,C=m,s=S;var T=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;m=s.col1.x*T+s.col2.x*A,A=s.col1.y*T+s.col2.y*A,T=m;var E=p.x+T-c.x-C,I=p.y+A-c.y-D;if(this.m_enableLimit){this.m_axis=r.MulMV(w,this.m_localXAxis1),this.m_a1=(E+C)*this.m_axis.y-(I+D)*this.m_axis.x,this.m_a2=T*this.m_axis.y-A*this.m_axis.x;var P=this.m_axis.x*E+this.m_axis.y*I;r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(b=r.Clamp(P,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),x=r.Abs(P),v=!0):P<=this.m_lowerTranslation?(b=r.Clamp(P-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),x=this.m_lowerTranslation-P,v=!0):P>=this.m_upperTranslation&&(b=r.Clamp(P-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),x=P-this.m_upperTranslation,v=!0)}this.m_perp=r.MulMV(w,this.m_localYAxis1),this.m_s1=(E+C)*this.m_perp.y-(I+D)*this.m_perp.x,this.m_s2=T*this.m_perp.y-A*this.m_perp.x;var B=new o,M=this.m_perp.x*E+this.m_perp.y*I,O=d-u-this.m_refAngle;if(x=r.Max(x,r.Abs(M)),a=r.Abs(O),v)f=this.m_invMassA,y=this.m_invMassB,_=this.m_invIA,g=this.m_invIB,this.m_K.col1.x=f+y+_*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.col1.y=_*this.m_s1+g*this.m_s2,this.m_K.col1.z=_*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=_+g,this.m_K.col2.z=_*this.m_a1+g*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=f+y+_*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_K.Solve33(B,-M,-O,-b);else{f=this.m_invMassA,y=this.m_invMassB,_=this.m_invIA,g=this.m_invIB;var R=f+y+_*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,L=_*this.m_s1+g*this.m_s2,k=_+g;this.m_K.col1.Set(R,L,0),this.m_K.col2.Set(L,k,0);var F=this.m_K.Solve22(new n,-M,-O);B.x=F.x,B.y=F.y,B.z=0}var N=B.x*this.m_perp.x+B.z*this.m_axis.x,V=B.x*this.m_perp.y+B.z*this.m_axis.y,G=B.x*this.m_s1+B.y+B.z*this.m_a1,U=B.x*this.m_s2+B.y+B.z*this.m_a2;return c.x-=this.m_invMassA*N,c.y-=this.m_invMassA*V,u-=this.m_invIA*G,p.x+=this.m_invMassB*N,p.y+=this.m_invMassB*V,d+=this.m_invIB*U,l.m_sweep.a=u,h.m_sweep.a=d,l.SynchronizeTransform(),h.SynchronizeTransform(),x<=t.b2_linearSlop&&a<=t.b2_angularSlop},Box2D.inherit(b,Box2D.Dynamics.Joints.b2JointDef),b.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,b.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n,this.localAxisA=new n},b.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},b.prototype.Initialize=function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint),w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,w.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new n,this.m_groundAnchor2=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_u1=new n,this.m_u2=new n},w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},w.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},w.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},w.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},w.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},w.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,r=t.x-e,n=t.y-i;return Math.sqrt(r*r+n*n)},w.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,r=t.x-e,n=t.y-i;return Math.sqrt(r*r+n*n)},w.prototype.GetRatio=function(){return this.m_ratio},w.prototype.b2PulleyJoint=function(t){this.__super.b2Joint.call(this,t);this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=r.Min(t.maxLengthA,this.m_constant-this.m_ratio*w.b2_minPulleyLength),this.m_maxLength2=r.Min(t.maxLengthB,(this.m_constant-w.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},w.prototype.InitVelocityConstraints=function(e){var i,r=this.m_bodyA,n=this.m_bodyB;i=r.m_xf.R;var o=this.m_localAnchor1.x-r.m_sweep.localCenter.x,s=this.m_localAnchor1.y-r.m_sweep.localCenter.y,a=i.col1.x*o+i.col2.x*s;s=i.col1.y*o+i.col2.y*s,o=a,i=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=a;var c=r.m_sweep.c.x+o,u=r.m_sweep.c.y+s,p=n.m_sweep.c.x+l,m=n.m_sweep.c.y+h,f=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,y=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,_=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c-f,u-y),this.m_u2.Set(p-_,m-g);var x=this.m_u1.Length(),v=this.m_u2.Length();x>t.b2_linearSlop?this.m_u1.Multiply(1/x):this.m_u1.SetZero(),v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero(),this.m_constant-x-this.m_ratio*v>0?(this.m_state=d.e_inactiveLimit,this.m_impulse=0):this.m_state=d.e_atUpperLimit,x<this.m_maxLength1?(this.m_limitState1=d.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=d.e_atUpperLimit,v<this.m_maxLength2?(this.m_limitState2=d.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=d.e_atUpperLimit;var b=o*this.m_u1.y-s*this.m_u1.x,w=l*this.m_u2.y-h*this.m_u2.x;if(this.m_limitMass1=r.m_invMass+r.m_invI*b*b,this.m_limitMass2=n.m_invMass+n.m_invI*w*w,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,e.warmStarting){this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio;var S=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,C=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,D=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,T=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;r.m_linearVelocity.x+=r.m_invMass*S,r.m_linearVelocity.y+=r.m_invMass*C,r.m_angularVelocity+=r.m_invI*(o*C-s*S),n.m_linearVelocity.x+=n.m_invMass*D,n.m_linearVelocity.y+=n.m_invMass*T,n.m_angularVelocity+=n.m_invI*(l*T-h*D)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},w.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyA,n=this.m_bodyB;e=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,s=this.m_localAnchor1.y-i.m_sweep.localCenter.y,a=e.col1.x*o+e.col2.x*s;s=e.col1.y*o+e.col2.y*s,o=a,e=n.m_xf.R;var l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=e.col1.x*l+e.col2.x*h,h=e.col1.y*l+e.col2.y*h,l=a;var c=0,u=0,p=0,m=0,f=0,y=0,_=0,g=0,x=0,v=0,b=0;this.m_state==d.e_atUpperLimit&&(c=i.m_linearVelocity.x+-i.m_angularVelocity*s,u=i.m_linearVelocity.y+i.m_angularVelocity*o,p=n.m_linearVelocity.x+-n.m_angularVelocity*h,m=n.m_linearVelocity.y+n.m_angularVelocity*l,x=-(this.m_u1.x*c+this.m_u1.y*u)-this.m_ratio*(this.m_u2.x*p+this.m_u2.y*m),v=this.m_pulleyMass*-x,b=this.m_impulse,this.m_impulse=r.Max(0,this.m_impulse+v),f=-(v=this.m_impulse-b)*this.m_u1.x,y=-v*this.m_u1.y,_=-this.m_ratio*v*this.m_u2.x,g=-this.m_ratio*v*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*f,i.m_linearVelocity.y+=i.m_invMass*y,i.m_angularVelocity+=i.m_invI*(o*y-s*f),n.m_linearVelocity.x+=n.m_invMass*_,n.m_linearVelocity.y+=n.m_invMass*g,n.m_angularVelocity+=n.m_invI*(l*g-h*_)),this.m_limitState1==d.e_atUpperLimit&&(c=i.m_linearVelocity.x+-i.m_angularVelocity*s,u=i.m_linearVelocity.y+i.m_angularVelocity*o,x=-(this.m_u1.x*c+this.m_u1.y*u),v=-this.m_limitMass1*x,b=this.m_limitImpulse1,this.m_limitImpulse1=r.Max(0,this.m_limitImpulse1+v),f=-(v=this.m_limitImpulse1-b)*this.m_u1.x,y=-v*this.m_u1.y,i.m_linearVelocity.x+=i.m_invMass*f,i.m_linearVelocity.y+=i.m_invMass*y,i.m_angularVelocity+=i.m_invI*(o*y-s*f)),this.m_limitState2==d.e_atUpperLimit&&(p=n.m_linearVelocity.x+-n.m_angularVelocity*h,m=n.m_linearVelocity.y+n.m_angularVelocity*l,x=-(this.m_u2.x*p+this.m_u2.y*m),v=-this.m_limitMass2*x,b=this.m_limitImpulse2,this.m_limitImpulse2=r.Max(0,this.m_limitImpulse2+v),_=-(v=this.m_limitImpulse2-b)*this.m_u2.x,g=-v*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*_,n.m_linearVelocity.y+=n.m_invMass*g,n.m_angularVelocity+=n.m_invI*(l*g-h*_))},w.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var i,n=this.m_bodyA,o=this.m_bodyB,s=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,c=0,u=0,p=0,m=0,f=0,y=0,_=0,g=0,x=0,v=0,b=0,w=0,S=0,C=0;return this.m_state==d.e_atUpperLimit&&(i=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,u=this.m_localAnchor1.y-n.m_sweep.localCenter.y,S=i.col1.x*c+i.col2.x*u,u=i.col1.y*c+i.col2.y*u,c=S,i=o.m_xf.R,p=this.m_localAnchor2.x-o.m_sweep.localCenter.x,m=this.m_localAnchor2.y-o.m_sweep.localCenter.y,S=i.col1.x*p+i.col2.x*m,m=i.col1.y*p+i.col2.y*m,p=S,f=n.m_sweep.c.x+c,y=n.m_sweep.c.y+u,_=o.m_sweep.c.x+p,g=o.m_sweep.c.y+m,this.m_u1.Set(f-s,y-a),this.m_u2.Set(_-l,g-h),x=this.m_u1.Length(),v=this.m_u2.Length(),x>t.b2_linearSlop?this.m_u1.Multiply(1/x):this.m_u1.SetZero(),v>t.b2_linearSlop?this.m_u2.Multiply(1/v):this.m_u2.SetZero(),b=this.m_constant-x-this.m_ratio*v,C=r.Max(C,-b),b=r.Clamp(b+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),f=-(w=-this.m_pulleyMass*b)*this.m_u1.x,y=-w*this.m_u1.y,_=-this.m_ratio*w*this.m_u2.x,g=-this.m_ratio*w*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*f,n.m_sweep.c.y+=n.m_invMass*y,n.m_sweep.a+=n.m_invI*(c*y-u*f),o.m_sweep.c.x+=o.m_invMass*_,o.m_sweep.c.y+=o.m_invMass*g,o.m_sweep.a+=o.m_invI*(p*g-m*_),n.SynchronizeTransform(),o.SynchronizeTransform()),this.m_limitState1==d.e_atUpperLimit&&(i=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,u=this.m_localAnchor1.y-n.m_sweep.localCenter.y,S=i.col1.x*c+i.col2.x*u,u=i.col1.y*c+i.col2.y*u,c=S,f=n.m_sweep.c.x+c,y=n.m_sweep.c.y+u,this.m_u1.Set(f-s,y-a),(x=this.m_u1.Length())>t.b2_linearSlop?(this.m_u1.x*=1/x,this.m_u1.y*=1/x):this.m_u1.SetZero(),b=this.m_maxLength1-x,C=r.Max(C,-b),b=r.Clamp(b+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),f=-(w=-this.m_limitMass1*b)*this.m_u1.x,y=-w*this.m_u1.y,n.m_sweep.c.x+=n.m_invMass*f,n.m_sweep.c.y+=n.m_invMass*y,n.m_sweep.a+=n.m_invI*(c*y-u*f),n.SynchronizeTransform()),this.m_limitState2==d.e_atUpperLimit&&(i=o.m_xf.R,p=this.m_localAnchor2.x-o.m_sweep.localCenter.x,m=this.m_localAnchor2.y-o.m_sweep.localCenter.y,S=i.col1.x*p+i.col2.x*m,m=i.col1.y*p+i.col2.y*m,p=S,_=o.m_sweep.c.x+p,g=o.m_sweep.c.y+m,this.m_u2.Set(_-l,g-h),(v=this.m_u2.Length())>t.b2_linearSlop?(this.m_u2.x*=1/v,this.m_u2.y*=1/v):this.m_u2.SetZero(),b=this.m_maxLength2-v,C=r.Max(C,-b),b=r.Clamp(b+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),_=-(w=-this.m_limitMass2*b)*this.m_u2.x,g=-w*this.m_u2.y,o.m_sweep.c.x+=o.m_invMass*_,o.m_sweep.c.y+=o.m_invMass*g,o.m_sweep.a+=o.m_invI*(p*g-m*_),o.SynchronizeTransform()),C<t.b2_linearSlop},Box2D.postDefs.push((function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2})),Box2D.inherit(S,Box2D.Dynamics.Joints.b2JointDef),S.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,S.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new n,this.groundAnchorB=new n,this.localAnchorA=new n,this.localAnchorB=new n},S.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},S.prototype.Initialize=function(t,e,i,r,n,o,s){void 0===s&&(s=0),this.bodyA=t,this.bodyB=e,this.groundAnchorA.SetV(i),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(o);var a=n.x-i.x,l=n.y-i.y;this.lengthA=Math.sqrt(a*a+l*l);var h=o.x-r.x,c=o.y-r.y;this.lengthB=Math.sqrt(h*h+c*c),this.ratio=s;var u=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=u-this.ratio*w.b2_minPulleyLength,this.maxLengthB=(u-w.b2_minPulleyLength)/this.ratio},Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint),C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,C.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.K3=new e,this.impulse3=new o,this.impulse2=new n,this.reduced=new n,this.m_localAnchor1=new n,this.m_localAnchor2=new n,this.m_impulse=new o,this.m_mass=new i},C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},C.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},C.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},C.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},C.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},C.prototype.IsLimitEnabled=function(){return this.m_enableLimit},C.prototype.EnableLimit=function(t){this.m_enableLimit=t},C.prototype.GetLowerLimit=function(){return this.m_lowerAngle},C.prototype.GetUpperLimit=function(){return this.m_upperAngle},C.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_lowerAngle=t,this.m_upperAngle=e},C.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},C.prototype.EnableMotor=function(t){this.m_enableMotor=t},C.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},C.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},C.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0),this.m_maxMotorTorque=t},C.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},C.prototype.b2RevoluteJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=d.e_inactiveLimit},C.prototype.InitVelocityConstraints=function(e){var i,n=this.m_bodyA,o=this.m_bodyB,s=0;this.m_enableMotor||this.m_enableLimit,i=n.m_xf.R;var a=this.m_localAnchor1.x-n.m_sweep.localCenter.x,l=this.m_localAnchor1.y-n.m_sweep.localCenter.y;s=i.col1.x*a+i.col2.x*l,l=i.col1.y*a+i.col2.y*l,a=s,i=o.m_xf.R;var h=this.m_localAnchor2.x-o.m_sweep.localCenter.x,c=this.m_localAnchor2.y-o.m_sweep.localCenter.y;s=i.col1.x*h+i.col2.x*c,c=i.col1.y*h+i.col2.y*c,h=s;var u=n.m_invMass,p=o.m_invMass,m=n.m_invI,f=o.m_invI;if(this.m_mass.col1.x=u+p+l*l*m+c*c*f,this.m_mass.col2.x=-l*a*m-c*h*f,this.m_mass.col3.x=-l*m-c*f,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=u+p+a*a*m+h*h*f,this.m_mass.col3.y=a*m+h*f,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=m+f,this.m_motorMass=1/(m+f),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var y=o.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;r.Abs(this.m_upperAngle-this.m_lowerAngle)<2*t.b2_angularSlop?this.m_limitState=d.e_equalLimits:y<=this.m_lowerAngle?(this.m_limitState!=d.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=d.e_atLowerLimit):y>=this.m_upperAngle?(this.m_limitState!=d.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=d.e_atUpperLimit):(this.m_limitState=d.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=d.e_inactiveLimit;if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var _=this.m_impulse.x,g=this.m_impulse.y;n.m_linearVelocity.x-=u*_,n.m_linearVelocity.y-=u*g,n.m_angularVelocity-=m*(a*g-l*_+this.m_motorImpulse+this.m_impulse.z),o.m_linearVelocity.x+=p*_,o.m_linearVelocity.y+=p*g,o.m_angularVelocity+=f*(h*g-c*_+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},C.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyA,n=this.m_bodyB,o=0,s=0,a=0,l=0,h=0,c=i.m_linearVelocity,u=i.m_angularVelocity,p=n.m_linearVelocity,m=n.m_angularVelocity,f=i.m_invMass,y=n.m_invMass,_=i.m_invI,g=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=d.e_equalLimits){var x=m-u-this.m_motorSpeed,v=this.m_motorMass*-x,b=this.m_motorImpulse,w=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+v,-w,w),u-=_*(v=this.m_motorImpulse-b),m+=g*v}if(this.m_enableLimit&&this.m_limitState!=d.e_inactiveLimit){e=i.m_xf.R,s=this.m_localAnchor1.x-i.m_sweep.localCenter.x,a=this.m_localAnchor1.y-i.m_sweep.localCenter.y,o=e.col1.x*s+e.col2.x*a,a=e.col1.y*s+e.col2.y*a,s=o,e=n.m_xf.R,l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y,o=e.col1.x*l+e.col2.x*h,h=e.col1.y*l+e.col2.y*h,l=o;var S=p.x+-m*h-c.x- -u*a,C=p.y+m*l-c.y-u*s,D=m-u;this.m_mass.Solve33(this.impulse3,-S,-C,-D),this.m_limitState==d.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==d.e_atLowerLimit?this.m_impulse.z+this.impulse3.z<0&&(this.m_mass.Solve22(this.reduced,-S,-C),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0):this.m_limitState==d.e_atUpperLimit&&this.m_impulse.z+this.impulse3.z>0&&(this.m_mass.Solve22(this.reduced,-S,-C),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0),c.x-=f*this.impulse3.x,c.y-=f*this.impulse3.y,u-=_*(s*this.impulse3.y-a*this.impulse3.x+this.impulse3.z),p.x+=y*this.impulse3.x,p.y+=y*this.impulse3.y,m+=g*(l*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)}else{e=i.m_xf.R,s=this.m_localAnchor1.x-i.m_sweep.localCenter.x,a=this.m_localAnchor1.y-i.m_sweep.localCenter.y,o=e.col1.x*s+e.col2.x*a,a=e.col1.y*s+e.col2.y*a,s=o,e=n.m_xf.R,l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y,o=e.col1.x*l+e.col2.x*h,h=e.col1.y*l+e.col2.y*h,l=o;var T=p.x+-m*h-c.x- -u*a,A=p.y+m*l-c.y-u*s;this.m_mass.Solve22(this.impulse2,-T,-A),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,c.x-=f*this.impulse2.x,c.y-=f*this.impulse2.y,u-=_*(s*this.impulse2.y-a*this.impulse2.x),p.x+=y*this.impulse2.x,p.y+=y*this.impulse2.y,m+=g*(l*this.impulse2.y-h*this.impulse2.x)}i.m_linearVelocity.SetV(c),i.m_angularVelocity=u,n.m_linearVelocity.SetV(p),n.m_angularVelocity=m},C.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);var i,n,o=0,s=this.m_bodyA,a=this.m_bodyB,l=0,h=0,c=0,u=0;if(this.m_enableLimit&&this.m_limitState!=d.e_inactiveLimit){var p=a.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,m=0;this.m_limitState==d.e_equalLimits?(o=r.Clamp(p-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection),m=-this.m_motorMass*o,l=r.Abs(o)):this.m_limitState==d.e_atLowerLimit?(l=-(o=p-this.m_lowerAngle),o=r.Clamp(o+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),m=-this.m_motorMass*o):this.m_limitState==d.e_atUpperLimit&&(l=o=p-this.m_upperAngle,o=r.Clamp(o-t.b2_angularSlop,0,t.b2_maxAngularCorrection),m=-this.m_motorMass*o),s.m_sweep.a-=s.m_invI*m,a.m_sweep.a+=a.m_invI*m,s.SynchronizeTransform(),a.SynchronizeTransform()}i=s.m_xf.R;var f=this.m_localAnchor1.x-s.m_sweep.localCenter.x,y=this.m_localAnchor1.y-s.m_sweep.localCenter.y;h=i.col1.x*f+i.col2.x*y,y=i.col1.y*f+i.col2.y*y,f=h,i=a.m_xf.R;var _=this.m_localAnchor2.x-a.m_sweep.localCenter.x,g=this.m_localAnchor2.y-a.m_sweep.localCenter.y;h=i.col1.x*_+i.col2.x*g,g=i.col1.y*_+i.col2.y*g,_=h;var x=a.m_sweep.c.x+_-s.m_sweep.c.x-f,v=a.m_sweep.c.y+g-s.m_sweep.c.y-y,b=x*x+v*v,w=Math.sqrt(b);n=w;var S=s.m_invMass,D=a.m_invMass,T=s.m_invI,A=a.m_invI,E=10*t.b2_linearSlop;if(b>E*E){var I=1/(S+D);c=I*-x,u=I*-v;var P=.5;s.m_sweep.c.x-=P*S*c,s.m_sweep.c.y-=P*S*u,a.m_sweep.c.x+=P*D*c,a.m_sweep.c.y+=P*D*u,x=a.m_sweep.c.x+_-s.m_sweep.c.x-f,v=a.m_sweep.c.y+g-s.m_sweep.c.y-y}return this.K1.col1.x=S+D,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=S+D,this.K2.col1.x=T*y*y,this.K2.col2.x=-T*f*y,this.K2.col1.y=-T*f*y,this.K2.col2.y=T*f*f,this.K3.col1.x=A*g*g,this.K3.col2.x=-A*_*g,this.K3.col1.y=-A*_*g,this.K3.col2.y=A*_*_,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(C.tImpulse,-x,-v),c=C.tImpulse.x,u=C.tImpulse.y,s.m_sweep.c.x-=s.m_invMass*c,s.m_sweep.c.y-=s.m_invMass*u,s.m_sweep.a-=s.m_invI*(f*u-y*c),a.m_sweep.c.x+=a.m_invMass*c,a.m_sweep.c.y+=a.m_invMass*u,a.m_sweep.a+=a.m_invI*(_*u-g*c),s.SynchronizeTransform(),a.SynchronizeTransform(),n<=t.b2_linearSlop&&l<=t.b2_angularSlop},Box2D.postDefs.push((function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new n})),Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef),D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,D.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},D.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},D.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint),T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,T.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new n,this.m_localAnchorB=new n,this.m_impulse=new o,this.m_mass=new i},T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},T.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new n(t*this.m_impulse.x,t*this.m_impulse.y)},T.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},T.prototype.b2WeldJoint=function(t){this.__super.b2Joint.call(this,t),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new i},T.prototype.InitVelocityConstraints=function(t){var e,i=0,r=this.m_bodyA,n=this.m_bodyB;e=r.m_xf.R;var o=this.m_localAnchorA.x-r.m_sweep.localCenter.x,s=this.m_localAnchorA.y-r.m_sweep.localCenter.y;i=e.col1.x*o+e.col2.x*s,s=e.col1.y*o+e.col2.y*s,o=i,e=n.m_xf.R;var a=this.m_localAnchorB.x-n.m_sweep.localCenter.x,l=this.m_localAnchorB.y-n.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*l,l=e.col1.y*a+e.col2.y*l,a=i;var h=r.m_invMass,c=n.m_invMass,u=r.m_invI,p=n.m_invI;this.m_mass.col1.x=h+c+s*s*u+l*l*p,this.m_mass.col2.x=-s*o*u-l*a*p,this.m_mass.col3.x=-s*u-l*p,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=h+c+o*o*u+a*a*p,this.m_mass.col3.y=o*u+a*p,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=u+p,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,r.m_linearVelocity.x-=h*this.m_impulse.x,r.m_linearVelocity.y-=h*this.m_impulse.y,r.m_angularVelocity-=u*(o*this.m_impulse.y-s*this.m_impulse.x+this.m_impulse.z),n.m_linearVelocity.x+=c*this.m_impulse.x,n.m_linearVelocity.y+=c*this.m_impulse.y,n.m_angularVelocity+=p*(a*this.m_impulse.y-l*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},T.prototype.SolveVelocityConstraints=function(t){var e,i=0,r=this.m_bodyA,n=this.m_bodyB,s=r.m_linearVelocity,a=r.m_angularVelocity,l=n.m_linearVelocity,h=n.m_angularVelocity,c=r.m_invMass,u=n.m_invMass,p=r.m_invI,d=n.m_invI;e=r.m_xf.R;var m=this.m_localAnchorA.x-r.m_sweep.localCenter.x,f=this.m_localAnchorA.y-r.m_sweep.localCenter.y;i=e.col1.x*m+e.col2.x*f,f=e.col1.y*m+e.col2.y*f,m=i,e=n.m_xf.R;var y=this.m_localAnchorB.x-n.m_sweep.localCenter.x,_=this.m_localAnchorB.y-n.m_sweep.localCenter.y;i=e.col1.x*y+e.col2.x*_,_=e.col1.y*y+e.col2.y*_,y=i;var g=l.x-h*_-s.x+a*f,x=l.y+h*y-s.y-a*m,v=h-a,b=new o;this.m_mass.Solve33(b,-g,-x,-v),this.m_impulse.Add(b),s.x-=c*b.x,s.y-=c*b.y,a-=p*(m*b.y-f*b.x+b.z),l.x+=u*b.x,l.y+=u*b.y,h+=d*(y*b.y-_*b.x+b.z),r.m_angularVelocity=a,n.m_angularVelocity=h},T.prototype.SolvePositionConstraints=function(e){var i;void 0===e&&(e=0);var n=0,s=this.m_bodyA,a=this.m_bodyB;i=s.m_xf.R;var l=this.m_localAnchorA.x-s.m_sweep.localCenter.x,h=this.m_localAnchorA.y-s.m_sweep.localCenter.y;n=i.col1.x*l+i.col2.x*h,h=i.col1.y*l+i.col2.y*h,l=n,i=a.m_xf.R;var c=this.m_localAnchorB.x-a.m_sweep.localCenter.x,u=this.m_localAnchorB.y-a.m_sweep.localCenter.y;n=i.col1.x*c+i.col2.x*u,u=i.col1.y*c+i.col2.y*u,c=n;var p=s.m_invMass,d=a.m_invMass,m=s.m_invI,f=a.m_invI,y=a.m_sweep.c.x+c-s.m_sweep.c.x-l,_=a.m_sweep.c.y+u-s.m_sweep.c.y-h,g=a.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,x=10*t.b2_linearSlop,v=Math.sqrt(y*y+_*_),b=r.Abs(g);v>x&&(m*=1,f*=1),this.m_mass.col1.x=p+d+h*h*m+u*u*f,this.m_mass.col2.x=-h*l*m-u*c*f,this.m_mass.col3.x=-h*m-u*f,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=p+d+l*l*m+c*c*f,this.m_mass.col3.y=l*m+c*f,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=m+f;var w=new o;return this.m_mass.Solve33(w,-y,-_,-g),s.m_sweep.c.x-=p*w.x,s.m_sweep.c.y-=p*w.y,s.m_sweep.a-=m*(l*w.y-h*w.x+w.z),a.m_sweep.c.x+=d*w.x,a.m_sweep.c.y+=d*w.y,a.m_sweep.a+=f*(c*w.y-u*w.x+w.z),s.SynchronizeTransform(),a.SynchronizeTransform(),v<=t.b2_linearSlop&&b<=t.b2_angularSlop},Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef),A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,A.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new n,this.localAnchorB=new n},A.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_weldJoint,this.referenceAngle=0},A.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var t=this;this.m_sprite={graphics:{clear:function(){t.m_ctx.clearRect(0,0,t.m_ctx.canvas.width,t.m_ctx.canvas.height)}}}},t.prototype._color=function(t,e){return"rgba("+((16711680&t)>>16)+","+((65280&t)>>8)+","+(255&t)+","+e+")"},t.prototype.b2DebugDraw=function(){this.m_drawFlags=0},t.prototype.SetFlags=function(t){void 0===t&&(t=0),this.m_drawFlags=t},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(t){void 0===t&&(t=0),this.m_drawFlags|=t},t.prototype.ClearFlags=function(t){void 0===t&&(t=0),this.m_drawFlags&=~t},t.prototype.SetSprite=function(t){this.m_ctx=t},t.prototype.GetSprite=function(){return this.m_ctx},t.prototype.SetDrawScale=function(t){void 0===t&&(t=0),this.m_drawScale=t},t.prototype.GetDrawScale=function(){return this.m_drawScale},t.prototype.SetLineThickness=function(t){void 0===t&&(t=0),this.m_lineThickness=t,this.m_ctx.strokeWidth=t},t.prototype.GetLineThickness=function(){return this.m_lineThickness},t.prototype.SetAlpha=function(t){void 0===t&&(t=0),this.m_alpha=t},t.prototype.GetAlpha=function(){return this.m_alpha},t.prototype.SetFillAlpha=function(t){void 0===t&&(t=0),this.m_fillAlpha=t},t.prototype.GetFillAlpha=function(){return this.m_fillAlpha},t.prototype.SetXFormScale=function(t){void 0===t&&(t=0),this.m_xformScale=t},t.prototype.GetXFormScale=function(){return this.m_xformScale},t.prototype.DrawPolygon=function(t,e,i){if(e){var r=this.m_ctx,n=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(i.color,this.m_alpha),r.moveTo(t[0].x*n,t[0].y*n);for(var o=1;o<e;o++)r.lineTo(t[o].x*n,t[o].y*n);r.lineTo(t[0].x*n,t[0].y*n),r.closePath(),r.stroke()}},t.prototype.DrawSolidPolygon=function(t,e,i){if(e){var r=this.m_ctx,n=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(i.color,this.m_alpha),r.fillStyle=this._color(i.color,this.m_fillAlpha),r.moveTo(t[0].x*n,t[0].y*n);for(var o=1;o<e;o++)r.lineTo(t[o].x*n,t[o].y*n);r.lineTo(t[0].x*n,t[0].y*n),r.closePath(),r.fill(),r.stroke()}},t.prototype.DrawCircle=function(t,e,i){if(e){var r=this.m_ctx,n=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(i.color,this.m_alpha),r.arc(t.x*n,t.y*n,e*n,0,2*Math.PI,!0),r.closePath(),r.stroke()}},t.prototype.DrawSolidCircle=function(t,e,i,r){if(e){var n=this.m_ctx,o=this.m_drawScale,s=t.x*o,a=t.y*o;n.moveTo(0,0),n.beginPath(),n.strokeStyle=this._color(r.color,this.m_alpha),n.fillStyle=this._color(r.color,this.m_fillAlpha),n.arc(s,a,e*o,0,2*Math.PI,!0),n.moveTo(s,a),n.lineTo((t.x+i.x*e)*o,(t.y+i.y*e)*o),n.closePath(),n.fill(),n.stroke()}},t.prototype.DrawSegment=function(t,e,i){var r=this.m_ctx,n=this.m_drawScale;r.strokeStyle=this._color(i.color,this.m_alpha),r.beginPath(),r.moveTo(t.x*n,t.y*n),r.lineTo(e.x*n,e.y*n),r.closePath(),r.stroke()},t.prototype.DrawTransform=function(t){var e=this.m_ctx,i=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(16711680,this.m_alpha),e.moveTo(t.position.x*i,t.position.y*i),e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*i,(t.position.y+this.m_xformScale*t.R.col1.y)*i),e.strokeStyle=this._color(65280,this.m_alpha),e.moveTo(t.position.x*i,t.position.y*i),e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*i,(t.position.y+this.m_xformScale*t.R.col2.y)*i),e.closePath(),e.stroke()}}(),i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs,tagpro.ready((function(){tagpro.world=new function(){var t=tagpro.events.gravity?tagpro.events.gravity.map((function(t){return t.gravity}))[0]:{x:0,y:0},e=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(t.x,t.y),!0),i={},r={},n=[];this._objectBodies=r,this._b2World=e;var o=1e3/60,s=performance.now()+o;setTimeout((function(){!1}),5e3),this.update=function(t){if(!tagpro.replayPaused&&(1===tagpro.state||5===tagpro.state)){var a=performance.now();if(!(s-a>o)){for(var l in i){var h=(f=i[l]).player;if(f.SetAwake(!0),h.draw&&!h.dead){var c=f.GetPosition(),u=f.GetAngle();(m=h.sync)&&(m.frame--,m.step.x>0&&c.x<m.to.x||m.step.x<0&&c.x>m.to.x?c.x+=m.step.x:m.step.x=0,m.step.y>0&&c.y<m.to.y||m.step.y<0&&c.y>m.to.y?c.y+=m.step.y:m.step.y=0,m.step.a>0&&u<m.to.a||m.step.a<0&&u>m.to.a?u+=m.step.a:m.step.a=0,m.frame<=0&&(h.sync=null));var p=f.GetLinearVelocity();tagpro.events.playerControls?tagpro.events.playerControls.forEach((function(t){t.playerControls(h,f,p)})):1!==tagpro.state&&5!==tagpro.state||(h.left&&p.x>-h.ms&&(p.x-=h.ac),h.right&&p.x<h.ms&&(p.x+=h.ac),h.up&&p.y>-h.ms&&(p.y-=h.ac),h.down&&p.y<h.ms&&(p.y+=h.ac)),f.SetPosition(c),f.SetAngle(u),f.SetLinearVelocity(p),h.speed=p.Length(),h.x=100*c.x,h.y=100*c.y,h.angle=u,tagpro.events.playerUpdate&&tagpro.events.playerUpdate.forEach((function(t){t.playerUpdate(h,f)}))}else f.SetPosition(new Box2D.Common.Math.b2Vec2(-100,-100))}for(var l in n.forEach((function(t){!function(t){for(var e in i){var r=i[e];if(!r.player.dead){var n=r.GetWorldCenter(),o=new Box2D.Common.Math.b2Vec2(0,0);if(o.Add(n),o.Subtract(t.position),!(o.Length()>2.6)){var s=.06*r.GetMass()/Math.pow(o.Length(),2);o.NegativeSelf(),o.Multiply(s),r.ApplyImpulse(o,n)}}}}(t)})),r){var d=(f=r[l]).object;if(f.SetAwake(!0),d.draw){var m;c=f.GetPosition();(m=d.sync)&&(m.frame--,m.step.x>0&&c.x<m.to.x||m.step.x<0&&c.x>m.to.x?c.x+=m.step.x:m.step.x=0,m.step.y>0&&c.y<m.to.y||m.step.y<0&&c.y>m.to.y?c.y+=m.step.y:m.step.y=0,m.frame<=0&&(d.sync=null)),f.SetPosition(c),d.x=100*c.x,d.y=100*c.y,tagpro.events.objectUpdate&&tagpro.events.objectUpdate.forEach((function(t){t.objectUpdate(e,d,f)}))}else f.SetPosition(new Box2D.Common.Math.b2Vec2(-100,-100))}for(var l in e.Step(1/60,8,3),i){var f=i[l];if(!(h=f.player).dead){p=f.GetLinearVelocity(),c=f.GetPosition(),u=f.GetAngle();h.speed=p.Length(),h.x=100*c.x,h.y=100*c.y,h.angle=u}}if(tagpro.events.update&&tagpro.events.update.forEach((function(t){t.update()})),s+=o,(a=performance.now())>=s){if(t>=10)return void(s=a);tagpro.world.update((t||0)+1)}}}};var a=new Box2D.Dynamics.b2FixtureDef,l=new Box2D.Dynamics.b2BodyDef;a.density=1,a.friction=.5,a.restitution=.2,a.filter.categoryBits=-1,l.type=Box2D.Dynamics.b2Body.b2_staticBody,tagpro.events.setWallPhysics&&tagpro.events.setWallPhysics.forEach((function(t){t.setWallPhysics(Box2D,l,a)})),function t(e){tagpro.map?e():setTimeout((function(){t(e)}),0)}((function(){for(var t=tagpro.map,i=0,r=t.length;i!=r;i++)for(var n=0,o=t[0].length;n!=o;n++){if(1==parseInt(t[i][n]))a.shape=new Box2D.Collision.Shapes.b2PolygonShape,1.1==t[i][n]?a.shape.SetAsArray([new Box2D.Common.Math.b2Vec2(-.2,.2),new Box2D.Common.Math.b2Vec2(-.2,-.2),new Box2D.Common.Math.b2Vec2(.2,.2)]):1.2==t[i][n]?a.shape.SetAsArray([new Box2D.Common.Math.b2Vec2(-.2,-.2),new Box2D.Common.Math.b2Vec2(.2,-.2),new Box2D.Common.Math.b2Vec2(-.2,.2)]):1.3==t[i][n]?a.shape.SetAsArray([new Box2D.Common.Math.b2Vec2(.2,-.2),new Box2D.Common.Math.b2Vec2(.2,.2),new Box2D.Common.Math.b2Vec2(-.2,-.2)]):1.4==t[i][n]?a.shape.SetAsArray([new Box2D.Common.Math.b2Vec2(.2,.2),new Box2D.Common.Math.b2Vec2(-.2,.2),new Box2D.Common.Math.b2Vec2(.2,-.2)]):a.shape.SetAsBox(.2,.2),l.position.Set(.4*i,.4*n),e.CreateBody(l).CreateFixture(a)}})),this.syncObject=function(t,i){var n=r[t.id]||(r[t.id]=this.objectCreators[t.type](t,e));if(n&&(t.angle=n.GetAngle(),t.draw)){if(n.SetAwake(!0),i)t.sync=null,n.SetPosition(new Box2D.Common.Math.b2Vec2(t.rx,t.ry));else{var o=n.GetPosition();t.sync={to:{x:t.rx,y:t.ry},frame:Math.ceil((tagpro.fps||60)/10)},t.sync.step={x:(t.sync.to.x-o.x)/t.sync.frame,y:(t.sync.to.y-o.y)/t.sync.frame},0==t.sync.frame&&(t.sync=null)}n.SetLinearVelocity(new Box2D.Common.Math.b2Vec2(t.lx,t.ly)),n.SetAngularVelocity(t.a)}},this.syncPlayer=function(t,r){var n=i[t.id]||function(t){if(null!=t.rx&&null!=t.ry&&null!=t.lx&&null!=t.ly&&null!=t.a){t.sync=null;var r=new Box2D.Dynamics.b2FixtureDef,n=new Box2D.Dynamics.b2BodyDef;r.density=1,r.friction=.5,r.restitution=.2,r.shape=new Box2D.Collision.Shapes.b2CircleShape(.19),n.type=Box2D.Dynamics.b2Body.b2_dynamicBody,n.linearDamping=.5,n.angularDamping=.5,tagpro.events.setPlayerPhysics&&tagpro.events.setPlayerPhysics.forEach((function(t){t.setPlayerPhysics(Box2D,n,r)}));var o=e.CreateBody(n),s=o.CreateFixture(r);return o.SetPosition(new Box2D.Common.Math.b2Vec2(t.rx,t.ry)),t.x=100*t.rx,t.y=100*t.ry,t.angle=t.ra,o.player=t,o.fixture=s,i[t.id]=o,o}}(t);if(n){if(n.SetAwake(!0),r)t.sync=null,n.SetPosition(new Box2D.Common.Math.b2Vec2(t.rx,t.ry)),n.SetAngle(t.ra),t.x=100*t.rx,t.y=100*t.ry;else{if(t.dead||!t.draw)return;var o=n.GetPosition(),s=n.GetAngle();t.sync={to:{x:t.rx,y:t.ry,a:t.ra},frame:Math.ceil((tagpro.fps||60)/10)},t.sync.step={x:(t.sync.to.x-o.x)/t.sync.frame,y:(t.sync.to.y-o.y)/t.sync.frame,a:(t.sync.to.a-s)/t.sync.frame},0==t.sync.frame&&(t.sync=null)}n.SetLinearVelocity(new Box2D.Common.Math.b2Vec2(t.lx,t.ly)),n.SetAngularVelocity(t.a),n.fixture.GetDensity()!=t.den&&(n.fixture.SetDensity(t.den),n.ResetMassData())}},this.destoryPlayer=function(t){var r=i[t];r&&(e.DestroyBody(r),delete i[t])},this.createGravityWell=function(t,e){n.push({position:new Box2D.Common.Math.b2Vec2(t,e)})},this.objectCreators={marsball:function(t){if(null!=t.rx&&null!=t.ry&&null!=t.lx&&null!=t.ly&&null!=t.a){var i=new Box2D.Dynamics.b2FixtureDef,r=new Box2D.Dynamics.b2BodyDef;i.density=2,i.friction=.5,i.restitution=.6,i.shape=new Box2D.Collision.Shapes.b2CircleShape(.39),r.type=Box2D.Dynamics.b2Body.b2_dynamicBody,r.linearDamping=.5,r.angularDamping=.5,t.sensor&&(i.isSensor=!0);var n=e.CreateBody(r);n.CreateFixture(i);return n.SetPosition(new Box2D.Common.Math.b2Vec2(t.rx,t.ry)),t.x=100*t.rx,t.y=100*t.ry,t.angle=n.GetAngle(),n.object=t,n}}}}})),tagpro.ready((function(){tagpro.musicPlayer=new function(){var t=$("audio#music"),e=["mp3","m4a","ogg"],i=!1,r=!1,n=this;this.list=[],this.current=null,this.disabled=!1,this.next=function(){if(tagpro.music&&!n.disabled&&(i=!1,r)){var o=tagpro.musicPlayer.list.shift();o.volume=parseFloat(o.volume||.5),tagpro.musicPlayer.list.push(o),tagpro.musicPlayer.mute(),tagpro.musicPlayer.current=o,(t=$("<audio id='music' volume='"+o.volume+"' autoplay='true'>").appendTo($(document.body)))[0].volume=o.volume*tagpro.volumeCoefficient,e.forEach((function(e){var i=0==o.url.indexOf("/")?o.url:"/sounds/music/"+o.url;t.append("<source type='audio/"+e+"' src='//"+tagproConfig.cdn+i+"."+e+"'></source>")})),tagpro.events.afterMusicStart&&tagpro.events.afterMusicStart.forEach((function(e){e.afterMusicStart(t[0])})),t.on("ended",tagpro.musicPlayer.next)}},this.refreshVolume=function(){t&&t.length&&(t[0].volume=t[0].getAttribute("volume")*tagpro.volumeCoefficient)},this.getCurrentAudioPlayer=function(){if(t&&t.length&&tagpro.musicPlayer.current)return t[0]},this.mute=function(){i=!0,t&&t.length&&(t[0].pause(),t.remove(),tagpro.musicPlayer.current=null)},this.disable=function(){n.disabled||(n.disabled=!0,n.mute())},this.keyBindings={190:this.next},$(document).on("keyup",(function(t){if(!tagpro.disableControls&&"text"!=t.target.type){var e=tagpro.musicPlayer.keyBindings[t.which];e&&e()}})),this.setList=function(){var t=function(t){for(;t.length;)tagpro.musicPlayer.list.push(t.splice(Math.floor(Math.random()*t.length),1)[0]);r=!0,!i&&tagpro.music&&tagpro.musicPlayer.next()};tagproConfig.eventMusic?t(tagproConfig.eventMusic):$.ajax({timeout:1e3,dataType:"json",url:"//"+tagproConfig.musicHost+"/music?callback=?",success:t})},setTimeout((function(){if(tagpro.musicPlayer.setList()){if(r=!0,i||!tagpro.music)return;tagpro.musicPlayer.next()}}))}})),tagpro.ready((function(){tagpro.sound=void 0,tagpro.music=void 0,tagpro.volume=void 0,tagpro.volumeCoefficient=1;var t=function(t,e){$.cookie(t,e,{expires:36500,path:"/",domain:tagproConfig.cookieHost}),tagpro[t]=e},e=function(t){t&&"music"!=t||(tagpro.music?tagpro.musicPlayer.next():tagpro.musicPlayer.mute()),t&&"sound"!=t||tagpro.sound||$("audio").not("#music").each((function(){this.play&&(this.pause(),4==this.readyState&&(this.currentTime=0))})),t&&"volume"!=t||(tagpro.volumeCoefficient=Math.pow(10,tagpro.volume/20),tagpro.musicPlayer.refreshVolume()),tagpro.events.afterUpdateSounds&&tagpro.events.afterUpdateSounds.forEach((function(e){e.afterUpdateSounds(t)}))};$(window).ready((function(){tagpro.sound=$.cookie("sound"),tagpro.music=$.cookie("music"),tagpro.volume=$.cookie("volume"),null==tagpro.sound&&t("sound",!0),null==tagpro.music&&t("music",!1),null==tagpro.volume?t("volume",0):tagpro.volume=Math.min(parseInt(tagpro.volume),0)})),$.fn.soundControl=function(){$(this);var i=$(this).find("#soundEffects"),r=$(this).find("#soundMusic");$slider=$(this).find("#volumeSlider");var n=function(){tagpro.sound?i.removeClass("off"):i.addClass("off"),tagpro.music?r.removeClass("off"):r.addClass("off"),$slider.val(tagpro.volume)};i.click((function(i){i.preventDefault(),t("sound",!tagpro.sound),n(),e("sound")})),r.click((function(i){i.preventDefault(),t("music",!tagpro.music),n(),e("music")})),$slider.change((function(i){t("volume",parseInt($slider.val())),e("volume")})),$slider.on("input",(function(t){var i,r;i="volume",r=parseInt($slider.val()),tagpro[i]=r,e("volume")})),n(),e()},$(document).ready((function(){$("div#sound").soundControl()}))})),tagpro.ready((function(){if(!tagproConfig.replay)return;const t=function(t,e){let i=$.cookie.json;$.cookie.json=e;let r=t();return $.cookie.json=i,r},e=function(e,i){return t((()=>$.cookie(e)),i)},i=function(e,i,r){return t((()=>$.cookie(e,i,{expires:36500,path:"/",domain:tagproConfig.cookieHost})),r)},r=function(t,r,n){r.on("click",(()=>{r.hasClass("unpinned")?(r.removeClass("unpinned"),t.removeClass("unpinned"),i(n,!0,!0)):(r.addClass("unpinned"),t.addClass("unpinned"),i(n,!1,!0))})),tagpro.socket.once("map",(()=>{t.removeClass("hide"),e(n,!0)||setTimeout((()=>{r.addClass("unpinned"),t.addClass("unpinned")}),5e3)}))},n=t=>new Date(t).toISOString().substring(14,19),o=t=>tagpro.replayData.initialState===tagpro.states.COUNTDOWN&&t<tagpro.replayData.startPacket[0]?"-"+n(tagpro.replayData.firstTimePacket[2].time-(t-tagpro.replayData.firstTimePacket[0])+1e3):tagpro.replayData.overtimePacket&&t>=tagpro.replayData.overtimePacket[0]?n(tagpro.replayData.overtimePacket[2].time+(t-tagpro.replayData.overtimePacket[0]))+" OT":n(tagpro.replayData.startPacket[2].time-(t-tagpro.replayData.startPacket[0]));let s=$(".replayBarTop"),a=$("#replayBarTopTack"),l=$("#replayPlayPause"),h=$("#replaySeekBar"),c=$("#replaySkipBack"),u=$("#replaySkipForward"),p=$("#replayRestart"),d=$("#replayClock");r(s,a,"replayShowTopBar");let m,f,y,_=!1,g=!1,x=null,v=!1;const b=t=>{if(tagpro.replayPaused||tagpro.state===tagpro.states.ENDED)return;t||(l.removeClass("fa-pause"),l.addClass("fa-play"),l.attr("title",l.attr("data-title-paused")));const e=Date.now();tagpro.gameEndsAt&&!tagpro.overtimeStartedAt?y=tagpro.gameEndsAt.valueOf()-e:tagpro.overtimeStartedAt&&(y=e-tagpro.overtimeStartedAt.valueOf()),tagpro.replayPlayer.pause(),tagpro.pauseableTimeouts.pauseAll(),tagpro.replayPaused=!0;let i=tagpro.musicPlayer.getCurrentAudioPlayer();i&&i.pause()},w=()=>{if(!tagpro.replayPaused&&tagpro.state===tagpro.states.ENDED)return;l.removeClass("fa-play"),l.addClass("fa-pause"),l.attr("title",l.attr("data-title-unpaused"));const t=Date.now();tagpro.gameEndsAt&&!tagpro.overtimeStartedAt?tagpro.gameEndsAt=t+y:tagpro.overtimeStartedAt&&(tagpro.overtimeStartedAt=t-y),tagpro.replayPlayer.play(),tagpro.pauseableTimeouts.resumeAll(),tagpro.replayPaused=!1;let e=tagpro.musicPlayer.getCurrentAudioPlayer();e&&e.play()},S=()=>tagpro.replayPaused?w():b(),C=t=>{tagpro.state!==tagpro.states.ENDED&&(b(!0),g=!0,f=tagpro.sound,tagpro.sound=!1,tagpro.gameEndsAt=null,tagpro.overtimeStartedAt=null,Object.keys(tagpro.players).map(Number).forEach((t=>{tagpro.players[t].lastSync={},tagpro.replayPlayer.emit("playerLeft",t)})),tagpro.pauseableTimeouts.shiftAll(-1),tagpro.replayReset=!0,tagpro.replayPlayer.seek(t),tagpro.replayPlayer.play())},D=t=>{if(tagpro.state===tagpro.states.ENDED)return;let e=1e3*t,i=Math.min(Math.max(m+e,tagpro.replayData.minTS),tagpro.replayData.maxTSSeek);C(i)},T=()=>D(-10),A=()=>D(10),E=t=>{v||(tagpro.state=tagpro.states.ENDED,v=!0,h.val(tagpro.replayData.maxTSSeek),h.prop("disabled",!0),c.addClass("disabled"),u.addClass("disabled"),l.addClass("disabled"),$("#replayTimeline .step").addClass("disabled"),setTimeout(tagpro.musicPlayer.disable,t?2e4:5e3))};h.prop("min",tagpro.replayData.minTS),h.prop("max",tagpro.replayData.maxTSSeek),h.val(tagpro.replayData.minTS),h.on("input",(()=>d.text(o(h.val())))),h.on("mousedown",(()=>_=!0)),h.on("mouseup",(()=>{w(),tagpro.state===tagpro.states.ENDED?(m=tagpro.replayData.maxTS,h.val(tagpro.replayData.maxTSSeek)):C(h.val()),_=!1})),c.on("click",T),u.on("click",A),l.on("click",S),p.on("click",(()=>location.reload())),tagpro.replayActions={back:T,forward:A,playpause:S},tagpro.socket.on("replayTime",(t=>{g&&tagpro.pauseableTimeouts.setBase(t.time)})),tagpro.socket.on("replayEnd",(()=>E(!1))),tagpro.socket.on("end",(()=>E(!0))),tagpro.socket.on("replaySeekFinished",(t=>{tagpro.sound=f,g=!1,tagpro.pauseableTimeouts.setBase(0),tagpro.pauseableTimeouts.shiftAll(t.to),Object.values(tagpro.players).forEach((t=>t.draw=!0)),x&&x(),l.removeClass("fa-play"),l.addClass("fa-pause"),tagpro.replayPaused=!1})),tagpro.socket.on("replayPlayerMessage",(t=>{t.for===tagpro.playerId&&tagpro.replayPlayer.emit(t.type,t.data)})),tagpro.replayUpdateTimer=()=>{if(tagpro.state===tagpro.states.ENDED)return;const t=Date.now();let e;if(tagpro.gameEndsAt&&!tagpro.overtimeStartedAt?e=tagpro.gameEndsAt.valueOf()-t:tagpro.overtimeStartedAt&&(e=t-tagpro.overtimeStartedAt.valueOf()),tagpro.state===tagpro.states.OVERTIME)m=tagpro.replayData.overtimePacket[0]+e;else{const t=tagpro.state===tagpro.states.COUNTDOWN?tagpro.replayData.firstTimePacket:tagpro.replayData.startPacket;m=t[0]+(t[2].time-e)}_||(h.val(m),d.text(o(m)))},r($(".replayBarLeft"),$("#replayBarLeftTack"),"replayShowLeftBar");let I,P=!1;const B=function(){let t=$("#replayTimeline");t.empty();let e=function(e,i,r){let n=tagpro.replayData.minTS,o=(e-n)/(tagpro.replayData.maxTSSeek-n);o<0&&(o=0),o>1&&(o=1);let s=$('<div class="step"></div>').attr("style",`--pos: ${o}`).attr("title",i).attr("data-seek",e-2e3);r&&s.addClass(r),t.append(s)},i=tagpro.replayData.timeline;if(O.includes("allcaps"))for(const t of[1,2])for(const r of i[`team${t}`]){let i=r[0];if("s-captures"===r[1]){e(i,1===t?"Red Capture":"Blue Capture",`team${t}Color`)}}for(const t of i[R]||[]){let i=t[0],r=t[1];if(r.startsWith("s-")&&O.includes(r)){e(i,r.charAt(2).toUpperCase()+r.slice(3,-1))}}if(P)for(const t of i.modevents){let i=t[0],r=t[1];if(O.includes(r)){e(i,r.charAt(0).toUpperCase()+r.slice(1,-1),"modEventColor")}}$("#replayTimeline .step").on("click",(function(){let t=$(this).attr("data-seek");C(t)}))};tagpro.socket.on("recorder-metadata",(t=>{I=t.uuid,t.mod&&(P=!0,$(".replayBarLeft #modToggles").removeClass("hide"))}));let M=e("replayTimelineItems",!1);M||(M="allcaps,s-marks",i("replayTimelineItems",M,!1));let O=M.split(",");for(const t of O)$(".replayBarToggle").each((function(){$(this).attr("data-toggle")===t&&$(this).prop("checked",!0)}));$(".replayBarToggle").on("change",(function(){let t=$(this).attr("data-toggle");$(this).prop("checked")?O.includes(t)||O.push(t):O=O.filter((e=>e!==t)),M=O.join(","),i("replayTimelineItems",M,!1),B()}));let R,L,k={},F=[];const N=function(){if(g)x=N;else if(L&&F[L]&&R!==L)tagpro.replayPlayer.emit("id",L);else{for(const t of[1,2]){let e=$(`#team${t}Players`);e.empty();let i=F.filter((e=>e&&e.team===t));for(const t of i){let i=$("<i></i>").attr("data-player-id",t.id).text(t.name);t.id===R&&(i.addClass("activePlayer"),$("#name").val(t.name));let r=k[t.id];if(r){let t=$('<a target="_blank"><i class="fa fa-user"></i></a>').attr("href",`/profile/${r}`);e.append(t)}else if(P){let i=$('<a target="_blank"><i class="fa fa-network-wired"></i></a>').attr("href",`/history/redirect?target=modIP&gameUuid=${I}&player=${t.id}`);e.append(i)}e.append(i)}for(let t=i.length;t<4;t++){let t=$('<i class="noPlayer">-</i>');e.append(t)}}$(".replayBarLeft .playerList i").on("click",(function(){let t=Number($(this).attr("data-player-id"));t&&R!==t&&(L=t,tagpro.replayPlayer.emit("id",t))})),(()=>{let t=20;for(;t>=12;){$(".replayBarLeft").css("font-size",`${t}px`);let e=$(".replayBarLeft")[0].getBoundingClientRect().bottom;if($(".replayBarLeft #toggles")[0].getBoundingClientRect().bottom<=e)break;t--}})(),B(),function(){const t=(t,e)=>{let i=$(`.replayBarLeft #toggles span[data-count=${t}]`);i.text(e),e&&i.parent().removeClass("noEntries")};let e=$(".replayBarLeft #toggles span[data-count]");e.text(0),e.parent().addClass("noEntries");let i=tagpro.replayData.timeline;t("allcaps",i.team1.filter((t=>"s-captures"===t[1])).length+i.team2.filter((t=>"s-captures"===t[1])).length);let r={};for(const t of i[R]||[]){let e=t[1];e.startsWith("s-")&&(r[e]||=0,r[e]++)}if(P)for(const t of i.modevents){let e=t[1];r[e]||=0,r[e]++}for(const e of Object.keys(r))t(e,r[e])}()}};tagpro.socket.on("recorder-metadata",(t=>{for(const e of t.players||[])k[e.id]=e.userId})),tagpro.socket.on("p",(t=>{t=t.u||t;let e=!1;for(const i of t){let t=i.id;F[t]||={id:t};for(const r of["name","team"])i.hasOwnProperty(r)&&F[t][r]!==i[r]&&(F[t][r]=i[r],e=!0)}e&&N()})),tagpro.socket.on("playerLeft",(t=>{if(!v){if(F[t]=null,t===R){let t=F.find((t=>t));t&&tagpro.replayPlayer.emit("id",t.id)}N()}})),tagpro.socket.on("id",(t=>{R=Number(t),N()}));const V=t=>{t&&(tagpro.replayPlayer.emit("id",t),R=t,N())},G=t=>{let e=Object.keys(tagpro.players).map(Number);t&&e.reverse();let i=e.indexOf(tagpro.playerId),r=e[i+1]||e[0];V(r)},U=t=>{let e=t?1:2,i=Object.values(tagpro.players).find((t=>t.team===e&&t.flag));V(i&&i.id)};Object.assign(tagpro.replayActions,{next:()=>G(!0),prev:()=>G(!1),redflagcarrier:()=>U(!0),blueflagcarrier:()=>U(!1)});const j=()=>{$(".replayBarLeft .playerList i").off(),$(".replayBarLeft .playerList i").addClass("disabled"),$(".replayBarToggle").off(),$(".replayBarToggle").prop("disabled",!0)};tagpro.socket.on("replayEnd",j),tagpro.socket.on("end",j)})),tagpro.ready((function(){function t(){var t=!0;$(".js-region-cookie").each((function(){$(this).prop("checked")&&(t=!1)})),$("#region_auto").prop("checked",t)}function e(t,e){t.parent().css({"font-weight":e?"bold":"normal",color:e?"#8BC34A":"#FFFFFF"})}$(".js-region-cookie").each((function(){var e=$(this).attr("name"),i=$.cookie(e),r="true"===(i&&i.toString());$(this).prop("checked",r),$(this).click(t)})),t(),$("#region_auto").click((function(){$("#region_auto").prop("checked",!0),$(".js-region-cookie").each((function(){$(this).prop("checked",!1)}))})),tagpro.helpers.saveRegions=function(){$(".js-region-cookie").each((function(){var t=$(this).attr("name"),e=!!$(this).prop("checked");$.cookie(t,e,{expires:36500,path:"/",domain:tagproConfig.cookieHost})}))},tagpro.helpers.setAllRegions=function(t){e($(".js-region-cookie"),t)},tagpro.helpers.setRegion=function(t,i){var r=("Region "+t).replace(/\s/g,"_").toLowerCase();e($(".js-region-cookie[name='"+r+"']"),i)},tagpro.helpers.getRegions=function(){return $(".js-region-cookie:checked").map((function(){return $(this).data("region")})).get()}})),tagpro.ready((function(){if(!tagproConfig.replay){var t="",e=0,i="",r="",n={},o=new Uint32Array(2),s="",a=new Uint8Array(2),l=new Uint32Array(2),h=0,c={},u=!0,p=!1,d=!1,m=new Date,f=0,y=m.getTime(),_=1,g=NaN,x=0,v=["Red","Blue"],b=new Uint32Array(2),w={},S=0,C=[new I(0,0),new I(0,0)],D=[[],[]],T=0,A=0;E({status:"initialized"}),tagpro.socket.on("clientInfo",(function(t){i=t.gameUuid||""})),tagpro.socket.on("groupId",(function(t){r=t||""})),tagpro.socket.on("map",(function(t){if(""==s){t.info&&(n=t.info),(o[0]=t.tiles.length)&&(o[1]=t.tiles[0].length);var e=0,i=0;function r(){if(i){var t=new I(i,0);t.write(e,6),s+=t.finish(0)}}for(var h=0;h<o[1];h++)for(var c=0;c<o[0];c++){var u=10*t.tiles[c][h]>>>0;u<10?u=0:u<20?u-=9:u<90?u=4+(u/10>>>0):u<100?u-=77:u<130?u=7+(u/10>>>0):u<140?u-=110:u<240?u=8+(u/10>>>0):u<250?u-=208:u<260?u-=216:u=10+(u/10>>>0),u==e?i++:(r(),e=u,i=1)}r();for(var p=0;p<2;p++){var d=40*o[p];if(d){var m=d-1;a[p]=32,4294901760&m||(a[p]-=16,m<<=16),4278190080&m||(a[p]-=8,m<<=8),4026531840&m||(a[p]-=4,m<<=4),3221225472&m||(a[p]-=2,m<<=2),2147483648&m||(a[p]-=1)}l[p]=20+((1<<a[p])-d>>>1)}}})),tagpro.socket.on("teamNames",(function(t){t.redTeamName&&(v[0]=t.redTeamName),t.blueTeamName&&(v[1]=t.blueTeamName)})),tagpro.socket.on("score",(function(t){"r"in t&&(b[0]=t.r),"b"in t&&(b[1]=t.b)})),tagpro.socket.on("time",(function(i){var r=new Date,n=r.getTime();if(3==i.state)d||(d=!0,E({status:"preGame"}));else if(!p){if(p=!0,location.port)t=location.hostname,e=parseInt(location.port,10);else{var o=tagproConfig.gameSocket.split(":");t=o[0],e=parseInt(o[1],10)}if(m=r,d){var s=(.06*(n-y)>>>0)+f+Math.round(.06*i.time);x=Math.round(i.time/15e3)/4,g=s-3600*x,A=T,E({status:"inGame",recording:!0,data:{server:t,port:e,date:n/1e3>>>0,timeLimit:x}})}else E({status:"inGame",recording:!1,data:{server:t,port:e,date:n/1e3>>>0}})}})),tagpro.socket.on("end",(function(t){P(!0,!0)})),tagpro.socket.on("disconnect",B),document.getElementById("exit").addEventListener("click",B),tagpro.socket.on("object",(function(t){"marsball"!=t.type||t.id in c||(h++,c[t.id]=null)})),tagpro.socket.on("playerLeft",(function(t){var e=Date.now(),i=w[t];if(i){if(p){i.lastTime=(.06*(e-y)>>>0)+f,i.timeline.length&&i.timeline[i.timeline.length-1].time>=i.lastTime&&(i.lastTime=i.timeline[i.timeline.length-1].time+1),i.team=0,i.score>0&&(i.score=0);var n=new I(i.lastTime,7);n.write(3,2),n.write(0,1),n.tally(0),n.tally(0),i.flag||n.write(0,1),n.tally(0),n.tally(0);for(var o=1;o<16;o<<=1)i.powers&o&&n.write(0,1);i.timeline.push(n)}else delete w[t];--T<=1&&A>=4&&r&&(P(!1,!0),tagpro.showOptions())}})),tagpro.socket.on("splat",(function(t){p&&D[t.t-1].push(t)})),tagpro.socket.on("p",(function(t){var e=Date.now(),i=t.t||0;i?(f=i,y=e,i<=g&&(g=i-1)):i=(.06*(e-y)>>>0)+f,i<_&&(i=_),t=t.u||t;for(var r=new Uint32Array(2),n=0;n<t.length;n++){var o=t[n],s=w[o.id];s?s.message++:(++T>A&&p&&(A=T),o.id>S&&(S=o.id),s=w[o.id]={firstTime:p?i:0,lastTime:0,firstName:"",lastName:"",lastAuth:!1,auth:!1,name:"",flair:0,degree:0,score:0,points:0,team:0,initialTeam:0,flag:0,potato:0,powers:0,"s-pops":0,"s-captures":0,"s-grabs":0,"s-returns":0,"s-tags":0,"s-powerups":0,"s-prevent":0,"s-support":0,timeline:[],toggles:[[],[],[]],message:p?0:1}),o.name&&(s.auth||(s.name=o.name),s.firstName||(s.firstName=o.name),s.lastName=o.name),(s.lastAuth=o.auth)&&(s.auth=!0),o.flair&&(s.flair=1+(o.flair.x|o.flair.y<<4)),o.degree&&(s.degree=o.degree),"score"in o&&(s.score=o.score),"points"in o&&(s.points=o.points);var h=function(t){var e=0;return t in o&&(o[t]>s[t]&&s.message>1&&(e=o[t]-s[t]),s[t]=o[t]),e},c=h("s-pops"),u=h("s-captures"),d=h("s-grabs"),m=h("s-returns"),x=h("s-tags"),v=h("s-powerups"),b=h("s-prevent"),E=h("s-support");if(p){c&&(s.team||o.team)&&r[(s.team||o.team)-1]++;var P=!(c||s.team&&o.team&&o.team!=s.team),B="flag"in o?o.flag?o.flag:0:s.flag,M=new I(i,P&&B?6:7);o.team&&o.team!=s.team?(s.team?M.write(2,2):M.write(2|o.team-1,2),s.team=o.team):M.write(0,1),M.write(c?1:0,1),M.tally(m),M.tally(x>m?x-m:0),s.flag||M.write(d?1:0,1),M.tally(u),"potatoFlag"in o&&(s.potato=o.potatoFlag?1:0),P&&((s.flag||d)&&u&&M.write(B?1:0,1),!s.flag&&d&&B&&M.write((3==B)<<1|s.potato,2)),s.flag=B,M.tally(v),["grip","bomb","tagpro","speed"].forEach((function(t,e){var i=1<<e;s.powers&i?t in o&&!o[t]?(s.powers^=i,M.write(1,1)):(M.write(0,1),M.emptySize++):o[t]?v-- >0&&(s.powers|=i,M.write(1,1),M.emptySize++):v>0&&M.write(0,1)})),M.empty||(s.timeline.push(M),_=i+1);var O=function(t,e){var r=s.toggles[e],n=r.length-1,o=Math.max(i-t,g+1);o<=r[n]+1?r[n]=i:(r.push(o),r.push(i))};switch(1==b&&O(60,0),E){case 1:O(300,1);break;case 2:O(300,2);break;case 3:O(300,1),O(300,2)}}else o.team&&(s.team=s.initialTeam=o.team)}for(var R=0;R<2;R++){var L;if(D[R].length>r[R]&&D[R].splice(0,D[R].length-r[R]),r[R])for(C[R].tally(D[R].length);L=D[R].shift();)C[R].write(Math.min(Math.max(L.x+l[0],0),(1<<a[0])-1),a[0]),C[R].write(Math.min(Math.max(L.y+l[1],0),(1<<a[1])-1),a[1])}}))}function E(t){if(window.tagproAnalyticsCollector=t,window.tagproAnalyticsListener)try{window.tagproAnalyticsListener()}catch(t){console.error(t)}}function I(t,e){var i=this,r="",n=0,o=0;this.empty=!0,this.time=t,this.emptySize=e,this.write=function(t,e){for(;e--;)n<<=1,t&1<<e&&(n|=1,i.empty=!1),8==++o&&(r+=String.fromCharCode(n),n=0,o=0)},this.tally=function(t){for(;t--;)i.write(1,1);i.write(0,1)},this.finish=function(t){var e=i.time-t-1;e<0&&(e=0);for(var n=8-(o+2&7)&7,s=0,a=1<<n;a<=e;a+=1<<n)s=a,n+=8;return i.write(n>>>3,2),i.write(e-s,n),r},this.pad=function(){return i.write(0,8-(7&o)&7),r}}function P(a,l){var c=Date.now();if(u&&(u=!1,p)){var D={server:t,port:e,uuid:i,group:r,date:m.getTime()/1e3>>>0,finished:a,map:{name:n.name||"Untitled",author:n.author||"Unknown"},teams:[{name:v[0],score:b[0]},{name:v[1],score:b[1]}]};if(d){D.timeLimit=x,D.duration=Math.max((.06*(c-y)>>>0)+f,_)-g,D.map.marsballs=h,D.map.width=o[0],D.map.tiles=btoa(s),D.players=[],D.teams[0].splats=btoa(C[0].pad()),D.teams[1].splats=btoa(C[1].pad());for(var T=1;T<=S;T++)if(T in w){var A=[T],P=w[T];if(P.timeline.length||P.initialTeam){var B="",M=g,O=function(){for(var t=7,e=0,i=new Uint32Array(3);;){var r,n=0,o=1/0;e<P.timeline.length&&(n=1,o=P.timeline[e].time);for(var s=0;s<3;s++)i[s]<P.toggles[s].length&&(P.toggles[s][i[s]]<o?(n=2<<s,o=P.toggles[s][i[s]]):P.toggles[s][i[s]]==o&&(n|=2<<s));if(!n)break;1&n?r=P.timeline[e]:(r=new I(o,t)).write(0,t);for(s=0;s<3;s++)r.write(P.toggles[s][i[s]]==o,1);B+=r.finish(M),M=o,1&n&&(e++,t=r.emptySize);for(s=0;s<3;s++)n&2<<s&&i[s]++}};O();var R=P.auth,L=P.name,k=P.flair,F=P.initialTeam;if(P.lastTime&&P.lastName)for(var N=T+1;N<=S;N++)if(N in w){var V=w[N];if(V.firstTime>P.lastTime&&V.firstName==P.lastName&&(!P.lastAuth||V.auth&&V.name==P.name)&&V.degree==P.degree&&(P=V,!R&&P.name&&(L=P.name),P.auth&&(R=!0),P.flair&&(k=P.flair),O(),A.push(N),!P.lastTime||!P.lastName))break}D.players.push({auth:R,name:L,flair:k,degree:P.degree,score:P.score,points:P.points,team:F,events:btoa(B)})}for(var G in A)delete w[A[G]]}}E({status:"postGame",recording:d,data:D,upload:l})}}function B(){P(!1,!1)}}));